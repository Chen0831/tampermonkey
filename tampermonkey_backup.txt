{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"æŒŠ","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http*://avmo.pw/*","http*://avso.pw/*","http*://avxo.pw/*","http*://*javlibrary.com/*","http*://*5avlib.com/*","http*://*look4lib.com/*","http*://*javlib3.com/*","http*://*javli6.com/*","http*://*j8vlib.com/*","http*://*j9lib.com/*","http*://www.libredmm.com/products/*","http*://www.javbus.com/*","http*://www.javbus.me/*","http*://www.javbus2.com/*","http*://www.javbus3.com/*","http*://www.javbus5.com/*","http*://*j8vlib.com/*","http*://*j8vlib.com/*","http*://avdb.la/movie/*","http*://www.141jav.com/view/*","http*://www.av4you.net/work/*.htm","http*://www.dmmy18.com/*","http*://pan.baidu.com/disk/home*","http*://115.com/?tab=offline&mode=wangpan","http*://cloud.letv.com/webdisk/home/index","http*://disk.yun.uc.cn/","http*://www.furk.net/users/files/add","*.yunpan.360.cn/my/","http://www.dmm.co.jp/digital/videoa/*","http://www.btcherry.org/*","https://btdigg.org/search*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"search_index":"n0"},"ts":1477008630814},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/8392-%E6%8C%8A/code/%E6%8C%8A.user.js","uuid":"77ec453c-eea7-4924-85cb-4f7680f91fc5","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIOaMigovLyBAbmFtZXNwYWNlICAg5pK4Ci8vIEBkZXNjcmlwdGlvbiDoh6rliqjojrflj5bno4Hpk77mjqXlubboh6rliqjnprvnur/kuIvovb0KCi8vIEBpbmNsdWRlICAgICBodHRwKjovL2F2bW8ucHcvKgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly9hdnNvLnB3LyoKLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vYXZ4by5wdy8qCgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly8qamF2bGlicmFyeS5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly8qNWF2bGliLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovLypsb29rNGxpYi5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly8qamF2bGliMy5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly8qamF2bGk2LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovLypqOHZsaWIuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vKmo5bGliLmNvbS8qCgoKLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vd3d3LmxpYnJlZG1tLmNvbS9wcm9kdWN0cy8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovL3d3dy5qYXZidXMuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vd3d3LmphdmJ1cy5tZS8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovL3d3dy5qYXZidXMyLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovL3d3dy5qYXZidXMzLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovL3d3dy5qYXZidXM1LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwKjovLypqOHZsaWIuY29tLyoKCi8vIEBpbmNsdWRlICAgICBodHRwKjovLypqOHZsaWIuY29tLyoKCi8vIEBpbmNsdWRlICAgICBodHRwKjovL2F2ZGIubGEvbW92aWUvKgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly93d3cuMTQxamF2LmNvbS92aWV3LyoKLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vd3d3LmF2NHlvdS5uZXQvd29yay8qLmh0bQovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly93d3cuZG1teTE4LmNvbS8qCgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly9wYW4uYmFpZHUuY29tL2Rpc2svaG9tZSoKLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vMTE1LmNvbS8/dGFiPW9mZmxpbmUmbW9kZT13YW5ncGFuCi8vIEBpbmNsdWRlICAgICBodHRwKjovL2Nsb3VkLmxldHYuY29tL3dlYmRpc2svaG9tZS9pbmRleAovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly9kaXNrLnl1bi51Yy5jbi8KLy8gQGluY2x1ZGUgICAgIGh0dHAqOi8vd3d3LmZ1cmsubmV0L3VzZXJzL2ZpbGVzL2FkZAovLyBAaW5jbHVkZSAgICAgKi55dW5wYW4uMzYwLmNuL215LwovLyBAaW5jbHVkZSAgICAgaHR0cDovL3d3dy5kbW0uY28uanAvZGlnaXRhbC92aWRlb2EvKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3d3dy5idGNoZXJyeS5vcmcvKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly9idGRpZ2cub3JnL3NlYXJjaCoKCi8vIEB2ZXJzaW9uICAgICAxLjM4Ci8vIEBydW4tYXQgICAgICBkb2N1bWVudC1lbmQKLy8gQGdyYW50ICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCAgICAgICBHTV9zZXRDbGlwYm9hcmQKLy8gQGdyYW50ICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgR01fYWRkU3R5bGUKLy8gPT0vVXNlclNjcmlwdD09Ci8qCi8vIEBpbmNsdWRlICAgICBodHRwczovL2J0ZGlnZy5vcmcvc2VhcmNoKgovLyBAaW5jbHVkZSAgICAgaHR0cDovL3d3dy5jaWxpemh1c2hvdS5jb20vc2VhcmNoLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly93d3cubWlubmFuby1hdi5jb20vYXYqCi8vIEBpbmNsdWRlICAgICBodHRwOi8vd3d3Lm9pc2luYm9zb2Z0LmNvbS9kZXJhLyoKCiovCnZhciBtYWluID0gewogIC8vYXbkv6Hmga/mn6Xor6Ig57G7CiAgamF2OiB7CiAgICB0eXBlOiAwLAogICAgcmU6IC8oYXZtb3xhdnNvfGF2eG8pLiptb3ZpZS4qLywKICAgIHZpZDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAkKCcuaGVhZGVyJylbMF0ubmV4dEVsZW1lbnRTaWJsaW5nLmlubmVySFRNTDsKICAgIH0sCiAgICBwcm9jOiBmdW5jdGlvbigpIHsKICAgICAgaW5zZXJ0X2FmdGVyKCcjbW92aWUtc2hhcmUnKTsKICAgIH0KICB9LAogIGphdmxpYnJhcnk6IHsKICAgIHR5cGU6IDAsCiAgICByZTogLyhqYXZsaWJyYXJ5fGphdmxpYjN8bG9vazRsaWJ8NWF2bGlifGphdmxpNnxqOHZsaWJ8ajlsaWIpLipcP3Y9LiovLAogICAgdmlkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICQoJyN2aWRlb19pZCcpWzBdLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RleHQnKVswXS5pbm5lckhUTUw7CiAgICB9LAogICAgcHJvYzogZnVuY3Rpb24oKSB7CiAgICAgIGluc2VydF9hZnRlcignI3ZpZGVvX2Zhdm9yaXRlX2VkaXQnKTsKICAgIH0KICB9LAogIGxpYnJlZG1tOiB7CiAgICB0eXBlOiAwLAogICAgcmU6IC9saWJyZWRtbS8sCiAgICB2aWQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbG9jYXRpb24uaHJlZi5tYXRjaCgvcHJvZHVjdHNcLyguKikvKVsxXTsKICAgIH0sCiAgICBwcm9jOiBmdW5jdGlvbigpIHsKICAgICAgaW5zZXJ0X2FmdGVyKCcuY29udGFpbmVyJyk7CiAgICB9CiAgfSwKICBkbW06IHsKICAgIHR5cGU6IDAsCiAgICByZTogL2RtbVwuY29cLmpwLywKICAgIHZpZDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciByZXN1bHQgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoLy4qY2lkPS8sICcnKS5yZXBsYWNlKC9cL1w/Py4qLywgJycpLm1hdGNoKC9bXmhfMC05XS4qLyk7CiAgICAgIHJldHVybiByZXN1bHRbMF0gPyByZXN1bHRbMF0ucmVwbGFjZSgnMDAnLCAnJykgOiAnJzsKICAgIH0sCiAgICBwcm9jOiBmdW5jdGlvbigpIHsKICAgICAgaW5zZXJ0X2FmdGVyKCcubGg0JykKICAgIH0sCiAgfSwKICBtaW5uYW5vOiB7CiAgICB0eXBlOiAwLAogICAgcmU6IC9taW5uYW5vLWF2LywKICAgIHZpZDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBlbGVtcyA9ICQoJy50MTEnKTsKICAgICAgdmFyIHIgPSAnJzsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChlbGVtc1tpXS50ZXh0Q29udGVudCA9PSAn5ZOB55WqJykgewogICAgICAgICAgciA9IGVsZW1zW2ldLm5leHRFbGVtZW50U2libGluZy50ZXh0Q29udGVudDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcjsKICAgIH0sCiAgICBwcm9jOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHRtcCA9IChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9ICQoJ3RhYmxlJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoYVtpXS5iZ0NvbG9yID09ICcjRUVFRUVFJykgewogICAgICAgICAgICByZXR1cm4gYVtpXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pKCk7CiAgICAgIGluc2VydF9hZnRlcih0bXApCiAgICB9CiAgfSwKICBvaXNpbmJvc29mdDogewogICAgdHlwZTogMCwKICAgIHJlOiAvb2lzaW5ib3NvZnQvLAogICAgdmlkOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHIgPSBsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKC8uKlwvKy8sICcnKS5yZXBsYWNlKCcuaHRtbCcsICcnKTsKICAgICAgcmV0dXJuIHIuaW5kZXhPZignLScpID09IHIubGFzdEluZGV4T2YoJy0nKSA/IHIgOiByLnJlcGxhY2UoL1x3Ki0/LywgJycpOwogICAgfSwKICAgIHByb2M6IGZ1bmN0aW9uKCkgewogICAgICAvLyBhZGRfc3R5bGUoJyNtYWduZXQtdGFiIHRhYmxle2NsZWFyOmJvdGg7fScpOwogICAgICBpbnNlcnRfYWZ0ZXIoJyNkZXRhaWxfaW5mbycpOwogICAgfQogIH0sCiAgamF2YnVzOiB7CiAgICB0eXBlOiAwLAogICAgcmU6IC9qYXZidXMvLAogICAgdmlkOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGEgPSAkKCcuaGVhZGVyJylbMF0ubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICByZXR1cm4gYSA/IGEudGV4dENvbnRlbnQgOiAnJzsKICAgIH0sCiAgICBwcm9jOiBmdW5jdGlvbigpIHsKICAgICAgaW5zZXJ0X2FmdGVyKCcjc3Rhci1kaXYnKQogICAgfQogIH0sCiAgYXZkYjogewogICAgdHlwZTogMCwKICAgIHJlOiAvYXZkYlwubGEvLAogICAgdmlkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICQoJy5pbmZvJylbMF0uZmlyc3RFbGVtZW50Q2hpbGQuaW5uZXJIVE1MLnJlcGxhY2UoLzwuKj4vLCAnJykudHJpbSgpOwogICAgfSwKICAgIHByb2M6IGZ1bmN0aW9uKCkgewogICAgICBpbnNlcnRfYWZ0ZXIoJCgnI2Rvd25zJylbMF0ucHJldmlvdXNFbGVtZW50U2libGluZykKICAgIH0KICB9LAogIGphdjE0MTogewogICAgdHlwZTogMCwKICAgIHJlOiAvMTQxamF2LywKICAgIHZpZDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBsb2NhdGlvbi5ocmVmLm1hdGNoKC92aWV3XC8oLiopXC8vKVsxXTsKICAgIH0sCiAgICBwcm9jOiBmdW5jdGlvbigpIHsKICAgICAgaW5zZXJ0X2FmdGVyKCQoJy5kbGJ0bicpWzBdLnByZXZpb3VzRWxlbWVudFNpYmxpbmcpCiAgICB9LAogIH0sCiAgYXY0eW91OiB7CiAgICB0eXBlOiAwLAogICAgcmU6IC9hdjR5b3UvLAogICAgdmlkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICQoJy5zdGFyLWRldGFpbC1uYW1lJylbMF0udGV4dENvbnRlbnQudHJpbSgpOwogICAgfSwKICAgIHByb2M6IGZ1bmN0aW9uKCkgewogICAgICBpbnNlcnRfYWZ0ZXIoJy5zdGFyLWRldGFpbCcpCiAgICB9CiAgfSwKICBkbW15MThfc2luOiB7CiAgICB0eXBlOiAwLAogICAgcmU6IC9kbW15MThcLmNvbVwvZGV0YWlsc1wuYXNweFw/aWQ9LiovLAogICAgdmlkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICQoJy5pbmZvIGxpJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgn55Wq5Y+377yaJywgJycpOwogICAgfSwKICAgIHByb2M6IGZ1bmN0aW9uKCkgewogICAgICBpbnNlcnRfYWZ0ZXIoJy5oZWFkX2NvdmVyYmFubmVyJykKICAgIH0sCiAgfSwKICAvL+e9keebmOS4i+i9vSDnsbsKICAvL+i/meS6myAkIOaYr+ecn+ato+eahCBqcXVlcnkKICBiYWlkdTogewogICAgdHlwZTogMSwKICAgIHJlOiAvcGFuXC5iYWlkdVwuY29tLywKICAgIGZpbGxfZm9ybTogZnVuY3Rpb24obWFnbmV0KSB7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nLWJ1dHRvbltkYXRhLWJ1dHRvbi1pZD1iMTNdJykuY2xpY2soKTsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjX2Rpc2tfaWRfMicpLmNsaWNrKCk7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaGFyZS1vZmZsaW5lLWxpbmsnKS52YWx1ZSA9IG1hZ25ldDsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nLWJ1dHRvbltkYXRhLWJ1dHRvbi1pZD1iNjVdJykuY2xpY2soKTsKICAgICAgICB9LCA1MDApCiAgICAgIH0sIDE1MDApOwogICAgfQogIH0sCiAgMTE1OiB7CiAgICB0eXBlOiAxLAogICAgcmU6IC8xMTVcLmNvbS8sCiAgICBmaWxsX2Zvcm06IGZ1bmN0aW9uKGxpbmspIHsKICAgICAgdmFyIHJzYyA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwocnNjKTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIENvcmVbJ09GRkw1UGx1ZyddLk9wZW5MaW5rKCk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgJCgnI2pzX29mZmxpbmVfbmV3X2FkZCcpLnZhbChsaW5rKTsKICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0KICAgICAgfSwgNDAwKTsKICAgIH0KICB9LAogIGxldHY6IHsKICAgIHR5cGU6IDEsCiAgICByZTogL2Nsb3VkXC5sZXR2XC5jb20vLAogICAgZmlsbF9mb3JtOiBmdW5jdGlvbihsaW5rKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgJCgnI29mZmxpbmUtYnRuJykuY2xpY2soKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgJCgnI29mZmxpbmVfY2xlYXJfY29tcGxldGUnKS5wcmV2KCkuY2xpY2soKTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICQoJyNvZmZsaW5lLWFkZC1saW5rJykudmFsKGxpbmspOwogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9LCAxMDAwKTsKICAgICAgfSwgMjAwMCk7CiAgICB9CiAgfSwKICBmdXJrOiB7CiAgICB0eXBlOiAxLAogICAgcmU6IC93d3dcLmZ1cmtcLm5ldC8sCiAgICBmaWxsX2Zvcm06IGZ1bmN0aW9uKGxpbmspIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAkKCcjdXJsJykudmFsKGxpbmsucmVwbGFjZSgnbWFnbmV0Oj94dD11cm46YnRpaDonLCAnJykpOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9LAogIDM2MDogewogICAgdHlwZTogMSwKICAgIHJlOiAveXVucGFuXC4zNjBcLmNuXC9teS8sCiAgICBmaWxsX2Zvcm06IGZ1bmN0aW9uKGxpbmspIHsKICAgICAgeXVucGFuLmNtZENlbnRlci5zaG93T2ZmbGluZURpYSgpOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICQoJy5vZmZkbC1idG4tY3JlYXRlJykuY2xpY2soKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgJCgnI29mZmRsVXJsJykudmFsKGxpbmspOwogICAgICAgIH0sIDUwMCk7CiAgICAgIH0sIDEwMDApOwogICAgfQogIH0sCiAgdWM6IHsKICAgIHR5cGU6IDEsCiAgICByZTogL2Rpc2tcLnl1blwudWNcLmNuXC8vLAogICAgZmlsbF9mb3JtOiBmdW5jdGlvbihsaW5rKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgJCgnI25ld3VjbHhidG5faW5kZXgnKS5jbGljaygpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAkKCcjdWNseHVybCcpLnZhbChsaW5rKTsKICAgICAgICB9LCAxMDAwKTsKICAgICAgfSwgMTIwMCk7CiAgICB9CiAgfSwKICAvL+ejgemTvuaOpeaQnOe0oiDnsbsKICBidGNoZXJyeV9hOiB7CiAgICB0eXBlOiAyLAogICAgcmU6IC9idGNoZXJyeVwub3JnXC9zZWFyY2hcP2tleXdvcmQ9LiovLAogICAgZnVuYzogZnVuY3Rpb24odGFiKSB7CiAgICAgIHZhciBzZWxlY3RvciA9ICcuciBkaXYgYSc7CiAgICAgIHZhciBhID0gJChzZWxlY3Rvcik7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBiID0gdGFiLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICBiLnNldEF0dHJpYnV0ZSgnbWFnbGluaycsIGFbaV0uaHJlZikKICAgICAgICAgIC8vY29uc29sZS5sb2coYVtpXS5ocmVmKQogICAgICAgIGFbaV0ucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChiKQogICAgICB9CiAgICB9LAogIH0sCiAgYnRjaGVycnlfYjogewogICAgdHlwZTogMiwKICAgIHJlOiAvYnRjaGVycnlcLm9yZ1wvaGFzaFwvLiovLAogICAgZnVuYzogZnVuY3Rpb24odGFiKSB7CiAgICAgIHZhciBzZWxlY3RvciA9ICcjY29udGVudCBkaXYgdWwnOwogICAgICB2YXIgYSA9ICQoc2VsZWN0b3IpWzBdOwogICAgICB0YWIuc2V0QXR0cmlidXRlKCdtYWdsaW5rJywgJCgnbGkgYScsIGEpWzBdKQogICAgICBhLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKHRhYiwgYSkKICAgIH0sCiAgfSwKICBidGRpZ2c6IHsKICAgIHR5cGU6IDIsCiAgICByZTogL2J0ZGlnZ1wub3JnXC9zZWFyY2gvLAogICAgZnVuYzogZnVuY3Rpb24odGFiKSB7CiAgICAgIGlmICgkKCcjc2VhcmNoX3JlcycpLmxlbmd0aCAhPSAwKSB7IC8v5pCc57Si6aG16Z2iCiAgICAgICAgdmFyIHNlbGVjdG9yID0gJy5zbmlwcGV0JzsKICAgICAgICB2YXIgYSA9ICQoc2VsZWN0b3IpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGIgPSB0YWIuY2xvbmVOb2RlKHRydWUpOwogICAgICAgICAgYi5zZXRBdHRyaWJ1dGUoJ21hZ2xpbmsnLCAkKCcudHR0aCBhJywgYVtpXS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKVswXS5ocmVmKTsKICAgICAgICAgIGFbaV0ucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChiKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGVsc2UgaWYgKCQoJy50b3JyZW50X2luZm9fdGJsJykubGVuZ3RoICE9IDApIHsgLy/or6bmg4XpobXpnaIKICAgICAgICB2YXIgc2VsZWN0b3IgPSAnLnRvcnJlbnRfaW5mb190YmwnOwogICAgICAgIHZhciBhID0gJChzZWxlY3RvcilbMF07CiAgICAgICAgdGFiLnNldEF0dHJpYnV0ZSgnbWFnbGluaycsICQoJ2EnLCBhKVsxXS5ocmVmKTsKICAgICAgICBhLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKHRhYiwgYSk7CiAgICAgIH0KICAgIH0sCiAgfSwKICAvLyBjaWxpemh1c2hvdV9hOiB7CiAgLy8gICAgIHJlOiAvY2lsaXpodXNob3UvLAogIC8vICAgICBmdW5jOiBmdW5jdGlvbihkaXYpIHsKICAvLyAgICAgICAgICR4YWZ0ZXIoJy50YWlsJywgZGl2LCBmdW5jdGlvbihlbGVtKSB7CiAgLy8gICAgICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2EnKVswXS5ocmVmOwogIC8vICAgICAgICAgfSk7CiAgLy8gICAgIH0sCiAgLy8gfSwKICAvLyAvLyBzaG91c2liYW9jYWlfc2luZ2xlOiB7CiAgLy8gLy8gICByZTogJycsCiAgLy8gLy8gICBmdW5jOiAnJywKICAvLyAvLyB9LAogIC8vIGJ0YXZhX2E6IHsKICAvLyAgICAgcmU6IC9zZWFyY2hcLy8sCiAgLy8gICAgIGZ1bmM6IGZ1bmN0aW9uKGRpdikgewogIC8vICAgICAgICAgJHhhZnRlcignLmRhdGEtbGlzdCAuZGF0ZScsIGRpdiwgZnVuY3Rpb24oZWxlbSkgewogIC8vICAgICAgICAgICAgIHJldHVybiAnbWFnbmV0Oj94dD11cm46YnRpaDonICsgZWxlbS5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJylbMF0uaHJlZi5tYXRjaCgvaGFzaFwvKC4qKS8pWzFdOwogIC8vICAgICAgICAgfSk7CiAgLy8gICAgIH0sCiAgLy8gfSwKICAvLyBidGF2YV9zaW5nbGU6IHsKICAvLyAgICAgcmU6IC9tYWduZXRcL2RldGFpbFwvaGFzaFwvLywKICAvLyAgICAgZnVuYzogZnVuY3Rpb24oZGl2KSB7CiAgLy8gICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhJywgJCgnI21hZ25ldExpbmsnKVswXS52YWx1ZSk7CiAgLy8gICAgICAgICBjb21tb24uYWZ0ZXIoJCgnI21hZ25ldExpbmsnKVswXSwgZGl2KTsKICAvLyAgICAgfSwKICAvLyB9LAogIC8vIC8vIGluc3RzZWVfYTp7CiAgLy8gLy8gICByZTogL15odHRwOlwvXC93d3dcLmluc3RzZWUuY29tXC8kfGluc3RzZWVcLmNvbVwvZGVmYXVsdC5hc3B4LiovLAogIC8vIC8vICAgZnVuYzogZnVuY3Rpb24oZGl2KXsKICAvLyAvLyAgIH0KICAvLyAvLyB9LAogIC8vIGRlbW86IHsKICAvLyAgICAgcmU6IC8uKi8sCiAgLy8gICAgIHZpZDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICByZXR1cm4gJ2RlbW8nCiAgLy8gICAgIH0sCiAgLy8gICAgIHByb2M6IGZ1bmN0aW9uKHRhYmxlKSB7CiAgLy8gICAgICAgICBjb21tb24uYWZ0ZXIoZG9jdW1lbnQuYm9keSwgdGFibGUpOwogIC8vICAgICB9CiAgLy8gfSwKfTsKdmFyIG1haW5fa2V5cyA9IE9iamVjdC5rZXlzKG1haW4pIC8v5LiL6Z2i55qE5LiN6KaB5Ye6546wCm1haW5bJ2N1cl90YWInXSA9IG51bGw7Cm1haW5bJ2N1cl92aWQnXSA9ICcnOwp2YXIgJCA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBjb250ZXh0KSB7CiAgaWYgKGNvbnRleHQpIHsKICAgIHJldHVybiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogIH0KICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7Cn07CnZhciBpbnNlcnRfYWZ0ZXIgPSBmdW5jdGlvbihiKSB7CiAgYiA9ICQoYilbMF07CiAgaWYgKGIpIHsKICAgIGIucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUobWFpbi5jdXJfdGFiLCBiKTsKICB9Cn07CnZhciBvZmZsaW5lX3NpdGVzID0gewogIGJhaWR1OiB7CiAgICB1cmw6ICdodHRwOi8vcGFuLmJhaWR1LmNvbS9kaXNrL2hvbWUnLAogICAgbmFtZTogJ+eZvuW6puS6kScsCiAgICBlbmFibGU6IHRydWUKICB9LAogIDExNTogewogICAgbmFtZTogJzExNeemu+e6vycsCiAgICB1cmw6ICdodHRwOi8vMTE1LmNvbS8/dGFiPW9mZmxpbmUmbW9kZT13YW5ncGFuJywKICAgIGVuYWJsZTogdHJ1ZSwKICB9LAogIGxldHY6IHsKICAgIG5hbWU6ICfkuZDop4bkupEnLAogICAgdXJsOiAnaHR0cDovL2Nsb3VkLmxldHYuY29tL3dlYmRpc2svaG9tZS9pbmRleCcsCiAgICBlbmFibGU6IGZhbHNlCiAgfSwKICAzNjA6IHsKICAgIG5hbWU6ICczNjDkupEnLAogICAgdXJsOiAnaHR0cDovL3l1bnBhbi4zNjAuY24vbXkvJywKICAgIGVuYWJsZTogZmFsc2UKICB9LAogIHVjOiB7CiAgICBuYW1lOiAnVUPnprvnur8nLAogICAgdXJsOiAnaHR0cDovL2Rpc2sueXVuLnVjLmNuLycsCiAgICBlbmFibGU6IGZhbHNlCiAgfSwKICBmdXJrOiB7CiAgICBuYW1lOiAnRnVyaycsCiAgICB1cmw6ICdodHRwczovL3d3dy5mdXJrLm5ldC91c2Vycy9maWxlcy9hZGQnLAogICAgZW5hYmxlOiB0cnVlCiAgfSwKfTsKdmFyIGNvbW1vbiA9IHsKICBhZGRfc3R5bGU6IGZ1bmN0aW9uKGNzcykgewogICAgaWYgKGNzcykgewogICAgICBHTV9hZGRTdHlsZShjc3MpOwogICAgfQogICAgZWxzZSB7CiAgICAgIEdNX2FkZFN0eWxlKFsKICAgICAgICAnI25vbmctdGFibGV7bWFyZ2luOjEwcHggYXV0bztjb2xvcjojNjY2ICFpbXBvcnRhbnQ7Zm9udC1zaXplOjEzcHg7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjogI0YyRjJGMjt9JywKICAgICAgICAnI25vbmctdGFibGUgdGgsI25vbmctdGFibGUgdGR7dGV4dC1hbGlnbjogY2VudGVyO2hlaWdodDozMHB4O2JhY2tncm91bmQtY29sb3I6ICNGRkY7cGFkZGluZzowIDFlbSAwO2JvcmRlcjogMXB4IHNvbGlkICNFRkVGRUY7fScsCiAgICAgICAgJy5ub25nLXJvd3t0ZXh0LWFsaWduOiBjZW50ZXI7aGVpZ2h0OjMwcHg7YmFja2dyb3VuZC1jb2xvcjogI0ZGRjtwYWRkaW5nOjAgMWVtIDA7Ym9yZGVyOiAxcHggc29saWQgI0VGRUZFRjt9JywKICAgICAgICAnLm5vbmctY29weXtjb2xvcjojMDhjICFpbXBvcnRhbnQ7fScsCiAgICAgICAgJy5ub25nLW9mZmxpbmV7dGV4dC1hbGlnbjogY2VudGVyO30nLAogICAgICAgICcjbm9uZy1oZWFkIGEge21hcmdpbi1yaWdodDogNXB4O30nLAogICAgICAgICcubm9uZy1vZmZsaW5lLWRvd25sb2Fke2NvbG9yOiByZ2IoMCwgMTgwLCAzMCkgIWltcG9ydGFudDsgbWFyZ2luLXJpZ2h0OiA0cHggIWltcG9ydGFudDt9JywKICAgICAgICAnLm5vbmctb2ZmbGluZS1kb3dubG9hZDpob3Zlcntjb2xvcjpyZWQgIWltcG9ydGFudDt9JywKICAgICAgXS5qb2luKCcnKSk7CiAgICB9CiAgfSwKICBoYW5kbGVfZXZlbnQ6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSA9PSAnbm9uZy1jb3B5JykgewogICAgICBldmVudC50YXJnZXQuaW5uZXJIVE1MID0gJ+aIkOWKnyc7CiAgICAgIEdNX3NldENsaXBib2FyZChldmVudC50YXJnZXQuaHJlZik7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgZXZlbnQudGFyZ2V0LmlubmVySFRNTCA9ICflpI3liLYnOwogICAgICB9LCAxMDAwKTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy/pmLvmraLot7PovawKICAgIH0KICAgIGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbGFzc05hbWUgPT0gJ25vbmctb2ZmbGluZS1kb3dubG9hZCcpIHsKICAgICAgdmFyIG1hZ2xpbmsgPSBldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnbWFnbGluaycpIHx8IGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ21hZ2xpbmsnKQogICAgICBHTV9zZXRWYWx1ZSgnbWFnbmV0JywgbWFnbGluayk7CiAgICB9CiAgICAvLyBlbHNlIGlmIChldmVudC50YXJnZXQuaWQgPT0gJ25vbmctc2VhcmNoLXNlbGVjdCcpIHsKICAgIC8vICAgY3VycmVudF9zZWFyY2hfbmFtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgIC8vICAgR01fc2V0VmFsdWUoJ3NlYXJjaCcsIGN1cnJlbnRfc2VhcmNoX25hbWUpOwogICAgLy8gICBzZWFyY2hfZW5naW5lc1tjdXJyZW50X3NlYXJjaF9uYW1lXShjdXJyZW50X3ZpZCwgZnVuY3Rpb24oc3JjLCBkYXRhKSB7CiAgICAvLyAgICAgbWFnbmV0X3RhYmxlLnVwZGF0YV90YWJsZShzcmMsIGRhdGEpOwogICAgLy8gICB9KTsKICAgIC8vIH0KICB9LAogIHJlZ19ldmVudDogZnVuY3Rpb24oKSB7IC8vVE9ETyB0YXJnZXQg5aSE55CGIOabtOeyvuWHhgogICAgdmFyIGxpc3QgPSBbCiAgICAgICcubm9uZy1jb3B5JywKICAgICAgJy5ub25nLW9mZmxpbmUtZG93bmxvYWQnCiAgICBdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChsaXN0W2ldKTsKICAgICAgZm9yICh2YXIgdSA9IDA7IHUgPCBhLmxlbmd0aDsgdSsrKSB7CiAgICAgICAgYVt1XS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlX2V2ZW50LCBmYWxzZSk7CiAgICAgIH0KICAgIH0KICAgIC8vIHZhciBiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI25vbmctc2VhcmNoLXNlbGVjdCcpWzBdOwogICAgLy8gYi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLmhhbmRsZV9ldmVudCwgZmFsc2UpOwoKICB9LAogIHBhcnNldGV4dDogZnVuY3Rpb24odGV4dCkgewogICAgdmFyIGRvYyA9IG51bGw7CiAgICB0cnkgewogICAgICBkb2MgPSBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoJycpOwogICAgICBkb2MuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCA9IHRleHQ7CiAgICAgIHJldHVybiBkb2M7CiAgICB9CiAgICBjYXRjaCAoZSkgewogICAgICBhbGVydCgncGFyc2UgZXJyb3InKTsKICAgIH0KICB9LAogIGluc2VydF9qczogZnVuY3Rpb24oanMsIG1hZ2xpbmspIHsKICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9qYXZhc2NyaXB0Jyk7CiAgICBzY3JpcHQuaW5uZXJIVE1MID0gJygnICsganMudG9TdHJpbmcoKSArICcpKFwnJyArIG1hZ2xpbmsgKyAnXCcpJzsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICB9LAogIGFkZF9taW5pX3RhYmxlOiBmdW5jdGlvbihzZWwsIGZ1bmMpIHsKICAgIHZhciBhID0gJChzZWwpOwogICAgZm9yICh2YXIgaSA9IGEubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgYVtpXS5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShhW2ldLCBtYWduZXRfdGFibGUubWluaSgpKTsgLy9UT0RPCiAgICAgIGZ1bmMoYVtpXSk7CiAgICB9CiAgfSwKfTsKdmFyIG1hZ25ldF90YWJsZSA9IHsKICB0ZW1wbGF0ZTogewogICAgY3JlYXRlX2hlYWQ6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgIGEuY2xhc3NOYW1lID0gJ25vbmctcm93JzsKICAgICAgYS5pZCA9ICdub25nLWhlYWQnOwogICAgICB2YXIgbGlzdCA9IFsKICAgICAgICAn5qCH6aKYJywKICAgICAgICAn5aSn5bCPJywKICAgICAgICAn5pON5L2cJywKICAgICAgICAn56a757q/5LiL6L29JwogICAgICBdOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgYiA9IHRoaXMuaGVhZC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwogICAgICAgICAgdmFyIG9wcyA9IFsiYnRpbyIsICJidGRiIl07CiAgICAgICAgICB2YXIgY3VyX2luZGV4ID0gR01fZ2V0VmFsdWUoInNlYXJjaF9pbmRleCIsMCk7CiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9wcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICB2YXIgb3AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgICAgICAgb3AudmFsdWUgPSBqLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIG9wLnRleHRDb250ZW50ID0gb3BzW2pdOwogICAgICAgICAgICBpZiAoY3VyX2luZGV4ID09IGopIHsKICAgICAgICAgICAgICBvcC5zZXRBdHRyaWJ1dGUoInNlbGVjdGVkIiwgInNlbGVjdGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wKTsKICAgICAgICAgIH0KICAgICAgICAgIGIucmVtb3ZlQ2hpbGQoYi5maXJzdENoaWxkKTsKICAgICAgICAgIGIuYXBwZW5kQ2hpbGQoc2VsZWN0KTsKICAgICAgICAgIGEuYXBwZW5kQ2hpbGQoYik7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgYi5maXJzdENoaWxkLnRleHRDb250ZW50ID0gbGlzdFtpXTsKICAgICAgICBhLmFwcGVuZENoaWxkKGIpOwogICAgICB9CiAgICAgIC8vIHZhciBzZWxlY3RfYm94ID0gdGhpcy5jcmVhdGVfc2VsZWN0X2JveCgpOwogICAgICAvLyBhLmZpcnN0Q2hpbGQuYXBwZW5kQ2hpbGQoc2VsZWN0X2JveCk7CgogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBjcmVhdGVfcm93OiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgYS5jbGFzc05hbWUgPSAnbm9uZy1yb3cnOwogICAgICBhLnNldEF0dHJpYnV0ZSgnbWFnbGluaycsIGRhdGEubWFnbGluayk7CiAgICAgIHZhciBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgdmFyIGxpc3QgPSBbCiAgICAgICAgdGhpcy5jcmVhdGVfaW5mbyhkYXRhLnRpdGxlLCBkYXRhLm1hZ2xpbmspLAogICAgICAgIHRoaXMuY3JlYXRlX3NpemUoZGF0YS5zaXplLCBkYXRhLnNyYyksCiAgICAgICAgdGhpcy5jcmVhdGVfb3BlcmF0aW9uKGRhdGEubWFnbGluayksCiAgICAgICAgdGhpcy5jcmVhdGVfb2ZmbGluZSgpCiAgICAgIF07CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjID0gYi5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgYy5hcHBlbmRDaGlsZChsaXN0W2ldKTsKICAgICAgICBhLmFwcGVuZENoaWxkKGMpOwogICAgICB9CiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGNyZWF0ZV9sb2FkaW5nOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOwogICAgICBhLmNsYXNzTmFtZSA9ICdub25nLXJvdyc7CiAgICAgIHZhciBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwogICAgICBwLnRleHRDb250ZW50ID0gJ0xvYWRpbmcnOwogICAgICBwLmlkID0gJ25vdGljZSc7CiAgICAgIGEuYXBwZW5kQ2hpbGQocCk7CiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGNyZWF0ZV9pbmZvOiBmdW5jdGlvbih0aXRsZSwgbWFnbGluaykgewogICAgICB2YXIgYSA9IHRoaXMuaW5mby5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgIGEuZmlyc3RDaGlsZC50ZXh0Q29udGVudCA9IHRpdGxlLmxlbmd0aCA8IDIwID8gdGl0bGUgOiB0aXRsZS5zdWJzdHIoMCwgMjApICsgJy4uLic7CiAgICAgIGEuZmlyc3RDaGlsZC5ocmVmID0gbWFnbGluazsKICAgICAgYS50aXRsZSA9IHRpdGxlOwogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBjcmVhdGVfc2l6ZTogZnVuY3Rpb24oc2l6ZSwgc3JjKSB7CiAgICAgIHZhciBhID0gdGhpcy5zaXplLmNsb25lTm9kZSh0cnVlKTsKICAgICAgYS50ZXh0Q29udGVudCA9IHNpemU7CiAgICAgIGEuaHJlZiA9IHNyYzsKICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgY3JlYXRlX29wZXJhdGlvbjogZnVuY3Rpb24obWFnbGluaykgewogICAgICB2YXIgYSA9IHRoaXMub3BlcmF0aW9uLmNsb25lTm9kZSh0cnVlKTsKICAgICAgYS5maXJzdENoaWxkLmhyZWYgPSBtYWdsaW5rOwogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBjcmVhdGVfb2ZmbGluZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhID0gdGhpcy5vZmZsaW5lLmNsb25lTm9kZSh0cnVlKTsKICAgICAgYS5jbGFzc05hbWUgPSAnbm9uZy1vZmZsaW5lJzsKICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgY3JlYXRlX3NlbGVjdF9ib3g6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZWN0X2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpOwogICAgICBzZWxlY3RfYm94LmlkID0gJ25vbmctc2VhcmNoLXNlbGVjdCc7CiAgICAgIHNlbGVjdF9ib3guc2V0QXR0cmlidXRlKCd0aXRsZScsICfliIfmjaLmkJzntKLnu5PmnpwnKTsKICAgICAgdmFyIHNlYXJjaF9uYW1lID0gR01fZ2V0VmFsdWUoJ3NlYXJjaCcsIGRlZmF1bHRfc2VhcmNoX25hbWUpOwogICAgICBmb3IgKHZhciBrIGluIHNlYXJjaF9lbmdpbmVzKSB7CiAgICAgICAgdmFyIG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICBpZiAoayA9PSBzZWFyY2hfbmFtZSkgewogICAgICAgICAgby5zZXRBdHRyaWJ1dGUoJ3NlbGVjdGVkJywgJ3NlbGVjdGVkJyk7CiAgICAgICAgfQogICAgICAgIG8uc2V0QXR0cmlidXRlKCd2YWx1ZScsIGspOwogICAgICAgIG8udGV4dENvbnRlbnQgPSBrOwogICAgICAgIHNlbGVjdF9ib3guYXBwZW5kQ2hpbGQobyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNlbGVjdF9ib3g7CiAgICB9LAogICAgaGVhZDogKGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgIHZhciBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBhLmFwcGVuZENoaWxkKGIpOwogICAgICByZXR1cm4gYTsKICAgIH0pKCksCiAgICBpbmZvOiAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHZhciBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBiLnRleHRDb250ZW50ID0gJ25hbWUnOwogICAgICBiLmhyZWYgPSAnc3JjJzsKICAgICAgYS5hcHBlbmRDaGlsZChiKTsKICAgICAgcmV0dXJuIGE7CiAgICB9KSgpLAogICAgc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBhLnRleHRDb250ZW50ID0gJ3NpemUnOwogICAgICByZXR1cm4gYTsKICAgIH0oKSwKICAgIG9wZXJhdGlvbjogKGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgY29weSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgY29weS5jbGFzc05hbWUgPSAnbm9uZy1jb3B5JzsKICAgICAgY29weS50ZXh0Q29udGVudCA9ICflpI3liLYnOwogICAgICBhLmFwcGVuZENoaWxkKGNvcHkpOwogICAgICByZXR1cm4gYTsKICAgIH0pKCksCiAgICBvZmZsaW5lOiAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHZhciBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBiLmNsYXNzTmFtZSA9ICdub25nLW9mZmxpbmUtZG93bmxvYWQnOwogICAgICBiLnRhcmdldCA9ICdfYmxhbmsnOwogICAgICBmb3IgKHZhciBrIGluIG9mZmxpbmVfc2l0ZXMpIHsKICAgICAgICBpZiAob2ZmbGluZV9zaXRlc1trXS5lbmFibGUpIHsKICAgICAgICAgIHZhciBjID0gYi5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICBjLmhyZWYgPSBvZmZsaW5lX3NpdGVzW2tdLnVybDsKICAgICAgICAgIGMudGV4dENvbnRlbnQgPSBvZmZsaW5lX3NpdGVzW2tdLm5hbWU7CiAgICAgICAgICBhLmFwcGVuZENoaWxkKGMpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYTsKICAgIH0pKCksCiAgfSwKICBjcmVhdGVfZW1wdHlfdGFibGU6IGZ1bmN0aW9uKCkgewogICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpOwogICAgYS5pZCA9ICdub25nLXRhYmxlJzsKICAgIHJldHVybiBhOwogIH0sCiAgdXBkYXRhX3RhYmxlOiBmdW5jdGlvbihzcmMsIGRhdGEsIHR5cGUpIHsKICAgIGlmICh0eXBlID09ICdmdWxsJykgewogICAgICB2YXIgdGFiID0gJCgnI25vbmctdGFibGUnKVswXTsKICAgICAgdGFiLnJlbW92ZUNoaWxkKHRhYi5xdWVyeVNlbGVjdG9yKCIjbm90aWNlIikucGFyZW50RWxlbWVudCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIHRhYi5hcHBlbmRDaGlsZCh0aGlzLnRlbXBsYXRlLmNyZWF0ZV9yb3coZGF0YVtpXSkpOwogICAgICB9CiAgICB9CiAgICAvLyBlbHNlIGlmKHR5cGUgPT0nbWluaScpewogICAgLy8gfQoKICAgIGNvbW1vbi5yZWdfZXZlbnQoKTsKICB9LAogIGZ1bGw6IGZ1bmN0aW9uKHNyYywgZGF0YSkgewogICAgdmFyIHRhYiA9IHRoaXMuY3JlYXRlX2VtcHR5X3RhYmxlKCk7CiAgICB0YWIuYXBwZW5kQ2hpbGQodGhpcy50ZW1wbGF0ZS5jcmVhdGVfaGVhZCgpKTsKICAgIC8vIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgLy8gICAgIHRhYi5hcHBlbmRDaGlsZCh0aGlzLnRlbXBsYXRlLmNyZWF0ZV9yb3coZGF0YVtpXSkpCiAgICAvLyB9CiAgICB2YXIgbG9hZGluZyA9IHRoaXMudGVtcGxhdGUuY3JlYXRlX2xvYWRpbmcoKTsKICAgIHRhYi5hcHBlbmRDaGlsZChsb2FkaW5nKTsKICAgIHJldHVybiB0YWI7CiAgfSwKICBtaW5pOiBmdW5jdGlvbihkYXRhKSB7CiAgICB2YXIgdGFiID0gdGhpcy5jcmVhdGVfZW1wdHlfdGFibGUoKTsKICAgIHRhYi5hcHBlbmRDaGlsZCh0aGlzLnRlbXBsYXRlLmNyZWF0ZV9vZmZsaW5lKCkpOwogICAgcmV0dXJuIHRhYjsKICB9Cn07CnZhciBzZWFyY2hfZW5naW5lcyA9IHsKICBzd2l0Y2hfZW5naW5lOiBmdW5jdGlvbihpKSB7CiAgICAvLyB2YXIgaW5kZXggPSBHTV9nZXRWYWx1ZSgic2VhcmNoX2luZGV4IiwwKTsKICAgIEdNX3NldFZhbHVlKCdzZWFyY2hfaW5kZXgnLCBpKQogICAgcmV0dXJuIGkKICB9LAogIGN1cl9lbmdpbmU6IGZ1bmN0aW9uKGt3LCBjYikgewogICAgdmFyIHogPSB0aGlzW0dNX2dldFZhbHVlKCdzZWFyY2hfaW5kZXgnLCAwKV07CiAgICBpZigheil7CiAgICAgIGFsZXJ0KCJzZWFyY2ggZW5naW5lIG5vdCBmb3VuZCIpOwogICAgfQogICAgcmV0dXJuIHooa3csIGNiKQogIH0sCiAgcGFyc2VfZXJyb3I6ZnVuY3Rpb24oYSl7CiAgICBhbGVydCgi6LCD55So5pCc57Si5byV5pOO6ZSZ6K+v77yM5Y+v6IO96ZyA6KaB5pu05paw77yM6K+35ZCR5L2c6ICF5Y+N6aaI44CCaT0iKyBhKQogIH0sCiAgZnVsbF91cmw6ICcnLAogIDA6IGZ1bmN0aW9uKGt3LCBjYikgewogICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICBtZXRob2Q6ICdHRVQnLAogICAgICB1cmw6ICdodHRwczovL2J0c28ucHcvc2VhcmNoLycgKyBrdywKICAgICAgb25sb2FkOiBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICBzZWFyY2hfZW5naW5lcy5mdWxsX3VybCA9IHJlc3VsdC5maW5hbFVybDsKICAgICAgICB2YXIgZG9jID0gY29tbW9uLnBhcnNldGV4dChyZXN1bHQucmVzcG9uc2VUZXh0KQogICAgICAgIGlmICghZG9jKSB7CiAgICAgICAgICBzZWFyY2hfZW5naW5lcy5wYXJzZV9lcnJvcihHTV9nZXRWYWx1ZSgnc2VhcmNoX2luZGV4JykpCiAgICAgICAgfQogICAgICAgIHZhciBkYXRhID0gW107CiAgICAgICAgdmFyIHQgPSBkb2MuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZGF0YS1saXN0JylbMF07CiAgICAgICAgaWYgKHQpIHsKICAgICAgICAgIHZhciBhID0gdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghYVtpXS5jbGFzc05hbWUubWF0Y2goJ2J0bicpKSB7CiAgICAgICAgICAgICAgZGF0YS5wdXNoKHsKICAgICAgICAgICAgICAgICd0aXRsZSc6IGFbaV0udGl0bGUsCiAgICAgICAgICAgICAgICAnbWFnbGluayc6ICdtYWduZXQ6P3h0PXVybjpidGloOicgKyBhW2ldLm91dGVySFRNTC5yZXBsYWNlKC8uKmhhc2hcLy8sICcnKS5yZXBsYWNlKC8iIC4qXG4uKlxuLipcbi4qLywgJycpLAogICAgICAgICAgICAgICAgJ3NpemUnOiBhW2ldLm5leHRFbGVtZW50U2libGluZy50ZXh0Q29udGVudCwKICAgICAgICAgICAgICAgICdzcmMnOiBhW2ldLmhyZWYsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2IocmVzdWx0LmZpbmFsVXJsLCBkYXRhKTsKICAgICAgfSwKICAgICAgb25lcnJvcjogZnVuY3Rpb24oZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB9CiAgICB9KQogIH0sCiAgMTogZnVuY3Rpb24oa3csIGNiKSB7CiAgICBHTV94bWxodHRwUmVxdWVzdCh7CiAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgIHVybDogJ2h0dHBzOi8vYnRkYi5pbi9xLycgKyBrdyArICcvJywKICAgICAgb25sb2FkOiBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICBzZWFyY2hfZW5naW5lcy5mdWxsX3VybCA9IHJlc3VsdC5maW5hbFVybDsKICAgICAgICB2YXIgZG9jID0gY29tbW9uLnBhcnNldGV4dChyZXN1bHQucmVzcG9uc2VUZXh0KQogICAgICAgIGlmKCFkb2MpewogICAgICAgICAgc2VhcmNoX2VuZ2luZXMucGFyc2VfZXJyb3IoR01fZ2V0VmFsdWUoJ3NlYXJjaF9pbmRleCcpKQogICAgICAgIH0KICAgICAgICB2YXIgZGF0YSA9IFtdOwogICAgICAgIHZhciBlbGVtcyA9IGRvYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdpdGVtLXRpdGxlJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgZGF0YS5wdXNoKHsKICAgICAgICAgICAgJ3RpdGxlJzogZWxlbXNbaV0uZmlyc3RDaGlsZC50aXRsZSwKICAgICAgICAgICAgJ21hZ2xpbmsnOiBlbGVtc1tpXS5uZXh0RWxlbWVudFNpYmxpbmcuZmlyc3RFbGVtZW50Q2hpbGQuaHJlZiwKICAgICAgICAgICAgJ3NpemUnOiBlbGVtc1tpXS5uZXh0RWxlbWVudFNpYmxpbmcuY2hpbGRyZW5bMV0udGV4dENvbnRlbnQsCiAgICAgICAgICAgICdzcmMnOiAnaHR0cHM6Ly9idGRiLmluJyArIGVsZW1zW2ldLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdocmVmJyksCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coZGF0YSkKICAgICAgICBjYihyZXN1bHQuZmluYWxVcmwsIGRhdGEpOwogICAgICB9LAogICAgICBvbmVycm9yOiBmdW5jdGlvbihlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgLy8gMjogZnVuY3Rpb24oa3csIGNiKSB7CiAgLy8gICBHTV94bWxodHRwUmVxdWVzdCh7CiAgLy8gICAgIG1ldGhvZDogJ1BPU1QnLAogIC8vICAgICB1cmw6IHRoaXMudXJsLAogIC8vICAgICBkYXRhOiAncz0nICsga3csCiAgLy8gICAgIGhlYWRlcnM6IHsKICAvLyAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcKICAvLyAgICAgfSwKICAvLyAgICAgb25sb2FkOiBmdW5jdGlvbihyZXN1bHQpIHsKICAvLyAgICAgICB2YXIgZG9jID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCcnKTsKICAvLyAgICAgICBkb2MuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCA9IHJlc3VsdC5yZXNwb25zZVRleHQ7CiAgLy8gICAgICAgdmFyIGRhdGEgPSBbXTsKICAvLyAgICAgICB2YXIgdCA9IGRvYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdsaXN0LWNvbnRlbnQnKVswXTsKICAvLyAgICAgICBpZiAodCkgewogIC8vICAgICAgICAgdmFyIGVsZW1zID0gdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdpdGVtLXRpdGxlJyk7CiAgLy8gICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1zLmxlbmd0aDsgaSsrKSB7CiAgLy8gICAgICAgICAgIGRhdGEucHVzaCh7CiAgLy8gICAgICAgICAgICAgJ3RpdGxlJzogZWxlbXNbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2EnKVswXS50ZXh0Q29udGVudCwKICAvLyAgICAgICAgICAgICAnbWFnbmV0JzogZWxlbXNbaV0ubmV4dEVsZW1lbnRTaWJsaW5nLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJylbMF0uaHJlZiwKICAvLyAgICAgICAgICAgICAnc2l6ZSc6IGVsZW1zW2ldLm5leHRFbGVtZW50U2libGluZy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYicpWzFdLnRleHRDb250ZW50CiAgLy8gICAgICAgICAgIH0pOwogIC8vICAgICAgICAgfQogIC8vICAgICAgICAgY2IocmVzdWx0LmZpbmFsVXJsLCBkYXRhKTsKICAvLyAgICAgICB9CiAgLy8gICAgIH0sCiAgLy8gICAgIG9uZXJyb3I6IGZ1bmN0aW9uKGUpIHsKICAvLyAgICAgICBjb25zb2xlLmxvZyhlKTsKICAvLyAgICAgfQogIC8vICAgfSk7CiAgLy8gfSwKfTsKaWYoR01fZ2V0VmFsdWUoJ3NlYXJjaF9pbmRleCcsbnVsbCkgPT09IG51bGwpewogIEdNX3NldFZhbHVlKCdzZWFyY2hfaW5kZXgnLDApCn0KdmFyIHJ1biA9IGZ1bmN0aW9uKCkgewogIGZvciAodmFyIGkgPSAwOyBpIDwgbWFpbl9rZXlzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgdiA9IG1haW5bbWFpbl9rZXlzW2ldXTsKCiAgICAvL2ZvciBqYXZsaWJyYXJ5CiAgICBpZigkKCIjYWR1bHR3YXJuaW5ncHJvbXB0IilbMF0gIT0gbnVsbCl7CiAgICAgICQoIiNhZHVsdHdhcm5pbmdwcm9tcHQgaW5wdXQiKVswXS5jbGljaygpCiAgICB9CgogICAgaWYgKHYucmUudGVzdChsb2NhdGlvbi5ocmVmKSkgewogICAgICBpZiAodi50eXBlID09IDApIHsKICAgICAgICB0cnkgewogICAgICAgICAgbWFpbi5jdXJfdmlkID0gdi52aWQoKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgIG1haW4uY3VyX3ZpZCA9ICcnOwogICAgICAgIH0KICAgICAgICBpZiAobWFpbi5jdXJfdmlkKSB7CiAgICAgICAgICBjb21tb24uYWRkX3N0eWxlKCk7CiAgICAgICAgICBtYWluLmN1cl90YWIgPSBtYWduZXRfdGFibGUuZnVsbCgpOwogICAgICAgICAgY29uc29sZS5sb2coJ+eVquWPt++8micsIG1haW4uY3VyX3ZpZCkKICAgICAgICAgIHYucHJvYygpCgogICAgICAgICAgLy8gY29uc29sZS5sb2cobWFpbi5jdXJfdGFiKQogICAgICAgICAgdmFyIHQgPSAkKCcjbm9uZy1oZWFkJylbMF0uZmlyc3RDaGlsZDsKICAgICAgICAgIHQuZmlyc3RDaGlsZC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgR01fc2V0VmFsdWUoJ3NlYXJjaF9pbmRleCcsIGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgdmFyIHMgPSAkKCcjbm9uZy10YWJsZScpWzBdOwogICAgICAgICAgICBzLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQocyk7CiAgICAgICAgICAgIHJ1bigpCiAgICAgICAgICB9KTsKICAgICAgICAgIAogICAgICAgICAgc2VhcmNoX2VuZ2luZXMuY3VyX2VuZ2luZShtYWluLmN1cl92aWQsIGZ1bmN0aW9uKHNyYywgZGF0YSkgewogICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICQoJyNub25nLXRhYmxlJylbMF0ucXVlcnlTZWxlY3RvckFsbCgnI25vdGljZScpWzBdLnRleHRDb250ZW50ID0gJ05vIHNlYXJjaCByZXN1bHQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIG1hZ25ldF90YWJsZS51cGRhdGFfdGFibGUoc3JjLCBkYXRhLCAnZnVsbCcpOwogICAgICAgICAgICAgIC8qZGlzcGxheSBzZWFyY2ggdXJsKi8KICAgICAgICAgICAgICB2YXIgeSA9ICQoJyNub25nLWhlYWQgdGgnKVsxXS5maXJzdENoaWxkOwogICAgICAgICAgICAgIHkuaHJlZiA9IHNlYXJjaF9lbmdpbmVzLmZ1bGxfdXJsOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZiAodi50eXBlID09IDEpIHsKICAgICAgICB2YXIganMgPSB2LmZpbGxfZm9ybTsKICAgICAgICB2YXIgbWFnbGluayA9IEdNX2dldFZhbHVlKCdtYWduZXQnKTsKICAgICAgICBpZiAobWFnbGluaykgewogICAgICAgICAgY29tbW9uLmluc2VydF9qcyhqcywgbWFnbGluayk7CiAgICAgICAgICBHTV9zZXRWYWx1ZSgnbWFnbmV0JywgJycpCiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgaWYgKHYudHlwZSA9PSAyKSB7CiAgICAgICAgY29tbW9uLmFkZF9zdHlsZSgpOwogICAgICAgIHYuZnVuYyhtYWduZXRfdGFibGUubWluaSgpKTsKICAgICAgICBtYWduZXRfdGFibGUudXBkYXRhX3RhYmxlKCcnLCAnJywgJ21pbmknKTsKICAgICAgfQogICAgICBicmVhazsKICAgIH0KICB9Cn07CgpydW4oKTs="},{"name":"Bypass Wait, Code & Login on Websites","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["down.lepan.cc","music.baidu.com","yinyueyun.baidu.com","media.store.kugou.com","trackercdn.kugou.com","yinyuetai.com","itwusun.com"],"orig_excludes":[],"orig_includes":["http://d.119g.com/*","http://123564.com/*","http://m.123564.com/*","http://www.5xfile.com/*","http://7958.com/*","http://*.7958.com/*","http://qjwm.com/*","http://*.qjwm.com/*","http://www.9pan.net/*","http://*.www.9pan.net/*","http://yun.baidu.com/*","http://*.yun.baidu.com/*","http://pan.baidu.com/*","http://*.pan.baidu.com/*","http://bx0635.com/*","http://*.bx0635.com/*","http://colayun.com/*","http://*.colayun.com/*","http://colafile.com/*","http://*.colafile.com/*","http://coladrive.com/*","http://*.coladrive.com/*","http://400gb.com/*","http://*.400gb.com/*","http://ctdisk.com/*","http://*.ctdisk.com/*","http://pipipan.com/*","http://*.pipipan.com/*","http://bego.cc/*","http://*.bego.cc/*","http://ctfile.com/*","http://*.ctfile.com/*","http://t00y.com/*","http://*.t00y.com/*","http://dlkoo.com/*","http://*.dlkoo.com/*","http://howfile.com/*","http://*.howfile.com/*","http://www.lepan.cc/*","http://www.sx566.com/*","http://rayfile.com/*","http://*.rayfile.com/*","http://sudupan.com/*","http://*.sudupan.com/*","http://vdisk.cn/*","http://*.vdisk.cn/*","http://yimuhe.com/*","http://*.yimuhe.com/*","http://douban.fm/*","http://jing.fm/*","http://moe.fm/*","http://fm.qq.com/*","http://music.163.com/*","http://www.1ting.com/*","http://www.565656.com/*","http://5sing.com/*","http://*.5sing.com/*","http://5sing.kugou.com/*","http://*.5sing.kugou.com/*","http://www.9ku.com/*","http://music.baidu.com/*","http://play.baidu.com/*","http://*.play.baidu.com/*","http://yinyueyun.baidu.com/*","http://www.djcc.com/*","http://www.djkk.com/*","http://www.djye.com/*","http://music.douban.com/*","http://www.duole.com/*","http://ear.duomi.com/*","http://web.kugou.com/*","http://kugou.com/*","http://www.kugou.com/*","http://oyinyue.com/*","http://*.oyinyue.com/*","http://y.qq.com/*","http://*.y.qq.com/*","http://i.y.qq.com/*","http://*.i.y.qq.com/*","http://fm.qq.com/*","http://*.fm.qq.com/*","http://y.qq.com/*","http://soso.music.qq.com/*","http://songtaste.com/*","http://*.songtaste.com/*","http://www.xiami.com/*","http://yinyuetai.com/*","http://*.yinyuetai.com/*","http://79pan.com/*","http://*.79pan.com/*","http://03xg.com/*","http://*.03xg.com/*","http://7mv.cc/*","http://*.7mv.cc/*","http://pan.52zz.org/*","http://*.pan.52zz.org/*","http://258pan.com/*","http://*.258pan.com/*","http://huimeiku.com/*","http://*.huimeiku.com/*","http://wpan.cc/*","http://*.wpan.cc/*","http://ypan.cc/*","http://*.ypan.cc/*","http://azpan.com/*","http://*.azpan.com/*","http://gxdisk.com/*","http://*.gxdisk.com/*","http://2kuai.com/*","http://*.2kuai.com/*","http://1wp.me/*","http://*.1wp.me/*","http://77pan.cc/*","http://*.77pan.cc/*","http://vvpan.com/*","http://*.vvpan.com/*","http://fmdisk.com/*","http://*.fmdisk.com/*","http://bx0635.com/*","http://*.bx0635.com/*","http://10pan.cc/*","http://*.10pan.cc/*","http://1pan.cc/*","http://*.1pan.cc/*","http://123wzwp.com/*","http://*.123wzwp.com/*","http://wwp5.com/*","http://*.wwp5.com/*","http://fydisk.com/*","http://*.fydisk.com/*","https://jixunmoe.github.io/cuwcl4c/config/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630838},"enabled":true,"position":2,"file_url":"https://greasyfork.org/scripts/2600-%E8%B7%B3%E8%BF%87%E7%BD%91%E7%AB%99%E7%AD%89%E5%BE%85-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%8A%E7%99%BB%E5%BD%95/code/%E8%B7%B3%E8%BF%87%E7%BD%91%E7%AB%99%E7%AD%89%E5%BE%85%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%8A%E7%99%BB%E5%BD%95.user.js","uuid":"2a45a57c-173d-4098-92c2-f1998ded182d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGdyYW50ICAgICAgICAgIHVuc2FmZVdpbmRvdwovLyBAZ3JhbnQgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QKLy8gQGdyYW50ICAgICAgICAgIEdNX29wZW5JblRhYgovLyBAZ3JhbnQgICAgICAgICAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZAovLyBAZ3JhbnQgICAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICAgICBHTV9pbmZvCgovLyBAcnVuLWF0ICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQG5hbWU6ZW4gICAgICAgIEJ5cGFzcyBXYWl0LCBDb2RlICYgTG9naW4gb24gV2Vic2l0ZXMKLy8gQG5hbWUgICAgICAgICAgIOi3s+i/h+e9keermeetieW+heOAgemqjOivgeeggeWPiueZu+W9lQovLyBAbmFtZTp6aC1DTiAgICAg6Lez6L+H572R56uZ562J5b6F44CB6aqM6K+B56CB5Y+K55m75b2VCi8vIEBuYW1lOnpoLVRXICAgICDnuZ7pgY7nq5npu57nrYnlvoXjgIHorZjliKXnorzlj4rnmbvpjIQKCi8vIEBkZXNjcmlwdGlvbiAgICAgICDnp7vpmaTlkITnsbvnvZHnq5npqozor4HnoIHjgIHnmbvlvZXjgIHlgJLorqHml7blj4rmm7TlpJohCi8vIEBkZXNjcmlwdGlvbjp6aC1DTiDnp7vpmaTlkITnsbvnvZHnq5npqozor4HnoIHjgIHnmbvlvZXjgIHlgJLorqHml7blj4rmm7TlpJohCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyDnp7vpmaTlkITpoZ7nq5npu57orZjliKXnorzjgIHnmbvpjITjgIHlgJLoqIjmmYLlj4rmm7TlpJohCi8vIEBkZXNjcmlwdGlvbjplbiAgICBSZW1vdmUgdmVyaWZ5IGNvZGUsIGxvZ2luIHJlcXVpcmVtZW50LCBjb3VudGluZyBkb3duLi4uIGFuZCBtb3JlIQoKCi8vIEBjb3B5cmlnaHQgICAgICAyMDE0KywgWXVsZWksIE1vZCBieSBKaXh1bi4KLy8vLyAgICAgICAgICAgICAgIEJhc2VkIG9uIFtDcmFjayBVcmwgV2FpdCBDb2RlIExvZ2luXSBCeSBZdWxlaQoKLy8g6YG/5YWNIFNvdXJjZSBNYXAg5paH5Lu25om+5LiN5Yiw55qE6ZSZ6K+vCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS9qcXVlcnkvMi4xLjQvanF1ZXJ5LmpzCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS91bmRlcnNjb3JlLmpzLzEuOC4zL3VuZGVyc2NvcmUuanMKCi8vLyBDcnlwdG9KUyDnm7jlhbPlupMKLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vY2RuLmJvb3Rjc3MuY29tL2NyeXB0by1qcy8zLjEuMi9jb21wb25lbnRzL2NvcmUtbWluLmpzCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS9jcnlwdG8tanMvMy4xLjIvY29tcG9uZW50cy9lbmMtYmFzZTY0LW1pbi5qcwovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly9jZG4uYm9vdGNzcy5jb20vY3J5cHRvLWpzLzMuMS4yL2NvbXBvbmVudHMvbWQ1LW1pbi5qcwovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzY2OTYvY29kZS9DcnlwdG9KUy1CeXRlQXJyYXkuanMKCi8vLyDpnZ7lkIzmraXmnprkuL4KLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8zNTg4LWludGVydmFsLWxvb3Blci9jb2RlL0ludGVydmFsLUxvb3Blci5qcwoKLy8vIOWFvOWuuSBHTSAxLngsIDIueAovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzI1OTkvY29kZS9nbTItcG9ydC12MTA0LmpzCgovLy8gQXJpYTIgUlBDCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvNTY3Mi9jb2RlL0FyaWEyLVJQQy1idWlsZC0xMC5qcwoKLy8gQGF1dGhvciAgICAgICAgIEppeHVuLk1vZTxZZWxsb3cgWW9zaGk+Ci8vIEBuYW1lc3BhY2UgICAgICBodHRwOi8vaml4dW4ub3JnLwovLyBAdmVyc2lvbiAgICAgICAgMy4wLjU3NQoKLy8g5bCd6K+V5L2/55So6ISa5pys55Sf5oiQ5Yy56YWN6KeE5YiZCgovLyBAaW5jbHVkZSBodHRwOi8vZC4xMTlnLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8xMjM1NjQuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL20uMTIzNTY0LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cuNXhmaWxlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly83OTU4LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjc5NTguY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3Fqd20uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoucWp3bS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LjlwYW4ubmV0LyoKLy8gQGluY2x1ZGUgaHR0cDovLyoud3d3LjlwYW4ubmV0LyoKLy8gQGluY2x1ZGUgaHR0cDovL3l1bi5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi55dW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3Bhbi5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5wYW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2J4MDYzNS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5ieDA2MzUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2NvbGF5dW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouY29sYXl1bi5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vY29sYWZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouY29sYWZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2NvbGFkcml2ZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5jb2xhZHJpdmUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzQwMGdiLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjQwMGdiLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9jdGRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouY3RkaXNrLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9waXBpcGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnBpcGlwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2JlZ28uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vKi5iZWdvLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL2N0ZmlsZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5jdGZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3QwMHkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoudDAweS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vZGxrb28uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouZGxrb28uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2hvd2ZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouaG93ZmlsZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LmxlcGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy5zeDU2Ni5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vcmF5ZmlsZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5yYXlmaWxlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9zdWR1cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnN1ZHVwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3ZkaXNrLmNuLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoudmRpc2suY24vKgovLyBAaW5jbHVkZSBodHRwOi8veWltdWhlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnlpbXVoZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vZG91YmFuLmZtLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ppbmcuZm0vKgovLyBAaW5jbHVkZSBodHRwOi8vbW9lLmZtLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ZtLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9tdXNpYy4xNjMuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy4xdGluZy5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LjU2NTY1Ni5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vNXNpbmcuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouNXNpbmcuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzVzaW5nLmt1Z291LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjVzaW5nLmt1Z291LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cuOWt1LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9tdXNpYy5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vcGxheS5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5wbGF5LmJhaWR1LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly95aW55dWV5dW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy5kamNjLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cuZGpray5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LmRqeWUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL211c2ljLmRvdWJhbi5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LmR1b2xlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9lYXIuZHVvbWkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3dlYi5rdWdvdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8va3Vnb3UuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy5rdWdvdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vb3lpbnl1ZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5veWlueXVlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly95LnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnkucXEuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2kueS5xcS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5pLnkucXEuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ZtLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLmZtLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly95LnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9zb3NvLm11c2ljLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9zb25ndGFzdGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouc29uZ3Rhc3RlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cueGlhbWkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3lpbnl1ZXRhaS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi55aW55dWV0YWkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzc5cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjc5cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8wM3hnLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjAzeGcuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzdtdi5jYy8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjdtdi5jYy8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9wYW4uNTJ6ei5vcmcvKgovLyBAaW5jbHVkZSBodHRwOi8vKi5wYW4uNTJ6ei5vcmcvKgovLyBAaW5jbHVkZSBodHRwOi8vMjU4cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjI1OHBhbi5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vaHVpbWVpa3UuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouaHVpbWVpa3UuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3dwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vKi53cGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL3lwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vKi55cGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL2F6cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLmF6cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9neGRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouZ3hkaXNrLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8ya3VhaS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi4ya3VhaS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vMXdwLm1lLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouMXdwLm1lLyoKLy8gQGluY2x1ZGUgaHR0cDovLzc3cGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouNzdwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vdnZwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoudnZwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ZtZGlzay5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5mbWRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2J4MDYzNS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5ieDA2MzUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzEwcGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouMTBwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vMXBhbi5jYy8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjFwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vMTIzd3p3cC5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi4xMjN3endwLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3A1LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnd3cDUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2Z5ZGlzay5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5meWRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cHM6Ly9qaXh1bm1vZS5naXRodWIuaW8vY3V3Y2w0Yy9jb25maWcvCgovLyBHTV94bWxIdHRwUmVxdWVzdCDov5znq6/mnI3liqHlmajliJfooagKLy8gQGNvbm5lY3QgZG93bi5sZXBhbi5jYwovLyBAY29ubmVjdCBtdXNpYy5iYWlkdS5jb20KLy8gQGNvbm5lY3QgeWlueXVleXVuLmJhaWR1LmNvbQovLyBAY29ubmVjdCBtZWRpYS5zdG9yZS5rdWdvdS5jb20KLy8gQGNvbm5lY3QgdHJhY2tlcmNkbi5rdWdvdS5jb20KLy8gQGNvbm5lY3QgeWlueXVldGFpLmNvbQovLyBAY29ubmVjdCBpdHd1c3VuLmNvbQoKLy8gPT0vVXNlclNjcmlwdD09CgoKKGZ1bmN0aW9uICgpIHsKCS8vIOWIneWni+WMlgp2YXIgY3JlYXRlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZCAoZG9jdW1lbnQpOwoKdmFyIEggPSB7CglzY3JpcHROYW1lOiAnQ1VXQ0w0QycsCglzY3JpcHRIb21lOiAnaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy96aC1DTi9zY3JpcHRzLzI2MDAnLAoJcmVwb3J0VXJsOiAgJ2h0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZm9ydW0vcG9zdC9kaXNjdXNzaW9uP0Rpc2N1c3Npb24vU2NyaXB0SUQ9MjYwMCcsCglpc0ZyYW1lOiAoZnVuY3Rpb24gKCkgewoJCXRyeSB7CgkJCXJldHVybiB1bnNhZmVXaW5kb3cudG9wICE9IHVuc2FmZVdpbmRvdy5zZWxmOwoJCX0gY2F0Y2ggKGUpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfSkoKSwKCgl2ZXJzaW9uOiAgICBHTV9pbmZvLnNjcmlwdC52ZXJzaW9uLAoJY3VycmVudFVybDogbG9jYXRpb24uaHJlZi5zcGxpdCAoJyMnKVswXSwKCWxvd2VySG9zdDogIGxvY2F0aW9uLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCksCglkaXJlY3RIb3N0OiBsb2NhdGlvbi5ob3N0bmFtZS5tYXRjaCgvXHcrXC4/XHcrPyQvKVswXS50b0xvd2VyQ2FzZSgpLAoKCWRlZmF1bHREbEljb246ICAgJ2p4X2RsJywKCWRlZmF1bHREbENsYXNzOiAnLmp4X2RsJywKCglub3A6IGZ1bmN0aW9uICgpIHt9LAoKCW1lcmdlOiBmdW5jdGlvbiAocGFyZW50KSB7CgkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKQoJCQlyZXR1cm4gcGFyZW50IHx8IHt9OwoKCQl2YXIgYXJncyA9IGFyZ3VtZW50czsKCQlmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewoJCQlpZiAoYXJndW1lbnRzW2ldKSB7CgkJCQlPYmplY3Qua2V5cyAoYXJndW1lbnRzW2ldKS5mb3JFYWNoIChmdW5jdGlvbiAoa2V5KSB7CgkJCQkJcGFyZW50W2tleV0gPSBhcmdzW2ldW2tleV07CgkJCQl9KTsKCQkJfQoJCX0KCgkJcmV0dXJuIHBhcmVudDsKCX0sCgoJZXh0cmFjdDogZnVuY3Rpb24gKGZvbykgewoJCXJldHVybiBmb28udG9TdHJpbmcoKS5tYXRjaCgvXC9cKihbXHNcU10rKVwqXC8vKVsxXS5yZXBsYWNlKC9ccyotLS4rL2csICcnKTsKCX0sCgoJc0Zvcm1hdDogZnVuY3Rpb24gKHNvdXJjZVN0cikgewoJCXZhciBhcmdzID0gYXJndW1lbnRzLAoJCQlhcmdMZW4gPSBhcmdzLmxlbmd0aDsKCgkJaWYgKGFyZ0xlbiA8PSAxKSByZXR1cm4gc291cmNlU3RyOyAvLyDml6DmlYjmiJbml6Dlj4LmlbAKCgkJZm9yICh2YXIgaSA9IGFyZ0xlbjsgaS0tOyApCgkJCXNvdXJjZVN0ciA9IHNvdXJjZVN0ci5yZXBsYWNlIChuZXcgUmVnRXhwKCclJyArIGkgKyAnKFteXFxkXXwkKScsJ2cnKSwgYXJnc1tpXSk7CgoJCXJldHVybiBzb3VyY2VTdHI7Cgl9LAoKCXNwcmludGY6IGZ1bmN0aW9uIChzb3VyY2VTdHIpIHsKCQl2YXIgYXJncyA9IGFyZ3VtZW50cywKCQkJYXJnTGVuID0gYXJncy5sZW5ndGg7CgoJCWlmIChhcmdMZW4gPD0gMSkgcmV0dXJuIHNvdXJjZVN0cjsgLy8g5peg5pWI5oiW5peg5Y+C5pWwCgoJCWZvciAodmFyIGkgPSAxOyBpIDwgYXJnTGVuOyBpKyspCgkJCXNvdXJjZVN0ciA9IHNvdXJjZVN0ci5yZXBsYWNlICgvJVtzZF0vaSwgYXJnc1tpXSk7CgoJCXJldHVybiBzb3VyY2VTdHI7Cgl9LAoKCWJlZ2luV2l0aDogZnVuY3Rpb24gKHN0ciwgd2hhdCkgewoJCXJldHVybiBzdHIuaW5kZXhPZiAod2hhdCkgPT09IDA7Cgl9LAoKCWNvbnRhaW5zOiBmdW5jdGlvbiAoc3RyLCB3aGF0KSB7CgkJcmV0dXJuIHN0ci5pbmRleE9mICh3aGF0KSAhPSAtMTsKCX0sCgoJYWRkRG93bmxvYWQ6IGZ1bmN0aW9uICh1cmwsIGZpbGUpIHsKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT0gMikgewoJCQlILmFkZFRvQXJpYSh1cmwsIGZpbGUpOwoJCX0gZWxzZSB7CgkJCUdNX29wZW5JblRhYiAoSC51cmkodXJsLCBmaWxlKSwgdHJ1ZSk7CgkJfQoJfSwKCgl1cmk6IGZ1bmN0aW9uICh1cmwsIGZpbGVuYW1lLCByZWYpIHsKCQlzd2l0Y2ggKEguY29uZmlnLmRVcmlUeXBlKSB7CgkJCWNhc2UgMToKCQkJCXJldHVybiAnY3V3Y2w0YzovL3wxfCcgKyBbCgkJCQkJdXJsLAoJCQkJCWZpbGVuYW1lLnRvU3RyaW5nKCkucmVwbGFjZSgvWyciXC9cXDp8XS9nLCAnXycpLAoJCQkJCShyZWYgfHwgbG9jYXRpb24uaHJlZikudG9TdHJpbmcoKS5yZXBsYWNlKC8jLiovLCAnJykKCQkJCV0uam9pbignfCcpOwoKCQkJY2FzZSAyOgoJCQkJLy8g5aaC5p6c6ISa5pys5rKh5pyJ5omL5Yqo57uR5a6aIEFyaWEg6L+e5o6lCgkJCQkvLyDmraTlpITov5vooYzlhajlsYDov57mjqXmjqXnrqEKCQkJCWlmICghSC5oYXNBcmlhQ2FwdHVyZSkKCQkJCQlILmNhcHR1cmVBcmlhICgpOwoKCQkJCXJldHVybiAnYXJpYTI6Ly98JyArIFsKCQkJCQl1cmwsCgkJCQkJZmlsZW5hbWUudG9TdHJpbmcoKS5yZXBsYWNlKC9bJyJcL1xcOnxdL2csICdfJyksCgkJCQkJKHJlZiB8fCBsb2NhdGlvbi5ocmVmKS50b1N0cmluZygpLnJlcGxhY2UoLyMuKi8sICcnKQoJCQkJXS5qb2luKCd8Jyk7CgoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuIHVybDsKCQl9Cgl9LAoKCXNldHVwQXJpYTogZnVuY3Rpb24gKGJGb3JjZU5ldykgewoJCWlmIChiRm9yY2VOZXcgfHwgIUguYXJpYSkgewoJCQlILmFyaWEyID0gbmV3IEFyaWEyKHsKCQkJCWF1dGg6IHsKCQkJCQl0eXBlOiBILmNvbmZpZy5kQXJpYV9hdXRoLAoJCQkJCXVzZXI6IEguY29uZmlnLnNBcmlhX3VzZXIsCgkJCQkJcGFzczogSC5jb25maWcuc0FyaWFfcGFzcwoJCQkJfSwKCQkJCWhvc3Q6IEguY29uZmlnLnNBcmlhX2hvc3QsCgkJCQlwb3J0OiBILmNvbmZpZy5kQXJpYV9wb3J0CgkJCX0pOwoJCX0KCgkJcmV0dXJuIEguYXJpYTI7Cgl9LAoKCWFkZFRvQXJpYTogZnVuY3Rpb24gKHVybCwgZmlsZW5hbWUsIHJlZmVyZXIsIGNvb2tpZSwgaGVhZGVycykgewoJCXZhciBhcmlhUGFyYW0gPSB7CgkJCW91dDogZmlsZW5hbWUsCgkJCXJlZmVyZXI6IHJlZmVyZXIgfHwgbG9jYXRpb24uaHJlZiwKCQkJZGlyOiBILmNvbmZpZy5zQXJpYV9kaXIsCgkJCSd1c2VyLWFnZW50JzogbmF2aWdhdG9yLnVzZXJBZ2VudCwKCQkJaGVhZGVyOiBoZWFkZXJzIHx8IFtdCgkJfTsKCgkJaWYgKGNvb2tpZSA9PT0gdHJ1ZSkKCQkJY29va2llID0gZG9jdW1lbnQuY29va2llOwoKCQlpZiAoY29va2llKQoJCQlhcmlhUGFyYW0uaGVhZGVyLnB1c2ggKCdDb29raWU6ICcgKyBjb29raWUpOwoKCQlILmFyaWEyLmFkZFVyaSAoW3VybF0sIGFyaWFQYXJhbSwgSC5ub3AsIGZ1bmN0aW9uIChyKSB7CgkJCXZhciBzRXJyb3JNc2c7CgkJCWlmIChyLmVycm9yKSB7CgkJCQlzRXJyb3JNc2cgPSBILnNwcmludGYgKCfplJnor6/ku6PnoIEgJXM6ICVzJywgci5lcnJvci5jb2RlLCByLmVycm9yLm1lc3NhZ2UpOwoJCQl9IGVsc2UgewoJCQkJc0Vycm9yTXNnID0gJ+S4jiBBcmlhMiDlkI7lj7DpgJrkv6HlpLHotKUsIOacjeWKoeacquW8gOWQrz8nOwoJCQl9CgoJCQlhbGVydCAoSC5zcHJpbnRmKCdbJXNdIOaPkOS6pOS7u+WKoeWPkeeUn+mUmeivryFcblxuJXMnLCBILnNjcmlwdE5hbWUsIHNFcnJvck1zZykpOwoJCX0pOwoJfSwKCgljYXB0dXJlQXJpYTogZnVuY3Rpb24gKGVsKSB7CgkJaWYgKEguY29uZmlnLmRVcmlUeXBlICE9PSAyKQoJCQlyZXR1cm4gOwoKCQlILmhhc0FyaWFDYXB0dXJlID0gdHJ1ZTsKCQlILnNldHVwQXJpYSAoKTsKCQkKCQkkKGVsIHx8IGRvY3VtZW50KS5jbGljayhmdW5jdGlvbiAoZSkgewoJCQl2YXIgbGlua0VsID0gZS50YXJnZXQ7CgkJCXZhciAkZWwgPSAkKGUudGFyZ2V0KTsKCQkJaWYgKCEkZWwuaXMoJ2EnKSkgewoJCQkJbGlua0VsID0gJGVsLnBhcmVudHMoJ2EnKVswXTsKCQkJfQoKCQkJaWYgKGxpbmtFbCAmJiBsaW5rRWwudGFnTmFtZSA9PSAnQScgJiYgSC5iZWdpbldpdGgobGlua0VsLmhyZWYsICdhcmlhMjovL3wnKSkgewoJCQkJZS5zdG9wUHJvcGFnYXRpb24gKCk7CgkJCQllLnByZXZlbnREZWZhdWx0ICAoKTsKCgkJCQl2YXIgbGluayA9IGxpbmtFbC5ocmVmLnNwbGl0KCd8Jyk7CgkJCQlILmFkZFRvQXJpYShsaW5rWzFdLCBkZWNvZGVVUklDb21wb25lbnQobGlua1syXSksIGxpbmtbM10sIGxpbmtFbC5jbGFzc0xpc3QuY29udGFpbnMoJ2FyaWEtY29va2llJykpOwoJCQl9CgkJfSk7Cgl9LAoKCWJ1aWxkQXJpYVBhcmFtOiBmdW5jdGlvbiAob3B0cykgewoJCWlmIChvcHRzLmNvb2tpZSkgewoJCQlvcHRzLmhlYWRlciA9IG9wdHMuaGVhZGVyIHx8IFtdOwoJCQlvcHRzLmhlYWRlci5wdXNoICgnQ29va2llOiAnICsgKG9wdHMuY29va2llIHx8IGRvY3VtZW50LmNvb2tpZSkpOwoJCQlkZWxldGUgb3B0cy5jb29raWU7CgkJfQoJCXJldHVybiBILm1lcmdlICh7CgkJCXJlZmVyZXI6IGxvY2F0aW9uLmhyZWYsCgkJCWRpcjogSC5jb25maWcuc0FyaWFfZGlyLAoJCQkndXNlci1hZ2VudCc6IG5hdmlnYXRvci51c2VyQWdlbnQKCQl9LCBvcHRzKTsKCX0sCgoJYmF0Y2hEb3dubG9hZDogZnVuY3Rpb24gKGZDYWxsYmFjaywgcmVmLCBhcnJEb3dubG9hZHMpIHsKCQlILnNldHVwQXJpYSAoKTsKCgkJcmV0dXJuIEguYXJpYTIuYmF0Y2hBZGRVcmkuYXBwbHkgKAoJCQkvLyB0aGlzCgkJCUguYXJpYTIsIAoKCQkJLy8gZkNhbGxiYWNrLCBmaWxlMSwgZmlsZTIsIC4uLgoJCQlbIGZDYWxsYmFjayBdLmNvbmNhdCAoCgkJCQlhcnJEb3dubG9hZHMubWFwIChmdW5jdGlvbiAoYXJnKSB7CgkJCQkJYXJnLm9wdGlvbnMgPSBILmJ1aWxkQXJpYVBhcmFtIChILm1lcmdlKHsgcmVmZXJlcjogcmVmIH0sIGFyZy5vcHRpb25zKSk7CgkJCQkJcmV0dXJuIGFyZzsKCQkJCX0pCgkJCSkKCQkpOwoJfQp9OwoKSC5tZXJnZSAoSCwgewoJX2xvZzogY29uc29sZS5sb2cuYmluZCAoY29uc29sZSksCglfaW5mOiBjb25zb2xlLmluZm8uYmluZCAoY29uc29sZSksCglfd2FyOiBjb25zb2xlLndhcm4uYmluZCAoY29uc29sZSksCglfZXJyOiBjb25zb2xlLmVycm9yLmJpbmQgKGNvbnNvbGUpLAoKCWxvZzogZnVuY3Rpb24gKF9wcmVmaXgsIG1zZykgewoJCXZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKCQlpZiAodHlwZW9mIG1zZyA9PSAnc3RyaW5nJykgewoJCQkvLyBUT0RPOiBTaW1wbGlmeSB0aGlzPwoJCQlILl9sb2cuYXBwbHkgKDAsIFtdLmNvbmNhdC5hcHBseSAoW19wcmVmaXggKyBtc2ddLCBhcmdzLnNsaWNlKDEpKSk7CgkJfSBlbHNlIHsKCQkJSC5fbG9nLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoW19wcmVmaXhdLCBhcmdzKSk7CgkJfQoJfS5iaW5kIChILCBILnNwcmludGYgKCdbJXNdW+aXpeW/l10gJywgSC5zY3JpcHROYW1lKSksCgoJaW5mbzogZnVuY3Rpb24gKF9wcmVmaXgsIG1zZykgewoJCXZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKCQlpZiAodHlwZW9mIG1zZyA9PSAnc3RyaW5nJykgewoJCQkvLyBUT0RPOiBTaW1wbGlmeSB0aGlzPwoJCQlILl9pbmYuYXBwbHkgKDAsIFtdLmNvbmNhdC5hcHBseSAoW19wcmVmaXggKyBtc2ddLCBhcmdzLnNsaWNlKDEpKSk7CgkJfSBlbHNlIHsKCQkJSC5faW5mLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoW19wcmVmaXhdLCBhcmdzKSk7CgkJfQoJfS5iaW5kIChILCBILnNwcmludGYgKCdbJXNdW+S/oeaBr10gJywgSC5zY3JpcHROYW1lKSksCgoJZXJyb3I6IGZ1bmN0aW9uIChfcHJlZml4LCBtc2cpIHsKCQl2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKS5jb25jYXQgKCdcblxu6ZSZ6K+v6L+96LiqJyArIG5ldyBFcnJvcigpLnN0YWNrKTsKCgkJaWYgKHR5cGVvZiBtc2cgPT0gJ3N0cmluZycpIHsKCQkJSC5fZXJyLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkgKFtfcHJlZml4ICsgbXNnXSwgYXJncy5zbGljZSgxKSkpOwoJCX0gZWxzZSB7CgkJCUguX2Vyci5hcHBseSAoMCwgW10uY29uY2F0LmFwcGx5KFtfcHJlZml4XSwgYXJncykpOwoJCX0KCX0uYmluZCAoSCwgSC5zcHJpbnRmICgnWyVzXVvplJnor69dICcsIEguc2NyaXB0TmFtZSkpLAoKCXdhcm46IGZ1bmN0aW9uIChfcHJlZml4LCBtc2cpIHsKCQl2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCgkJaWYgKHR5cGVvZiBtc2cgPT0gJ3N0cmluZycpIHsKCQkJLy8gVE9ETzogU2ltcGxpZnkgdGhpcz8KCQkJSC5faW5mLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkgKFtfcHJlZml4ICsgbXNnXSwgYXJncy5zbGljZSgxKSkpOwoJCX0gZWxzZSB7CgkJCUguX2luZi5hcHBseSAoMCwgW10uY29uY2F0LmFwcGx5KFtfcHJlZml4XSwgYXJncykpOwoJCX0KCX0uYmluZCAoSCwgSC5zcHJpbnRmICgnWyVzXVvorablkYpdICcsIEguc2NyaXB0TmFtZSkpCn0pOwoKSC5jb25maWcgPSBILm1lcmdlICh7CiAgICB2ZXJzaW9uOiAxLAogICAgYkRpYXBsYXlMb2c6IHRydWUsCiAgICBiWWVsbG93RWFzZUludGVybmF0aW9uYWw6IGZhbHNlLAogICAgYlllbGxvd0Vhc2VVc2VPbGRBcGk6IGZhbHNlLAogICAgYlllbGxvd0Vhc2VVc2VUaHJpZE9uRmFpbDogZmFsc2UsCiAgICBiVXNlQ3VzdG9tUnVsZXM6IGZhbHNlLAogICAgCiAgICBkQXJpYV9hdXRoOiBBcmlhMi5BVVRILm5vQXV0aCwKICAgIGRBcmlhX3BvcnQ6IDY4MDAsCiAgICBkVXJpVHlwZTogMCwKICAgIAogICAgc0FyaWFfZGlyOiAiRDpcXERvd25sb2FkXFwiLAogICAgc0FyaWFfaG9zdDogIjEyNy4wLjAuMSIsCiAgICBzQXJpYV9wYXNzOiAiIiwKICAgIHNBcmlhX3VzZXI6ICIiLAogICAgCiAgICBzQ3VzdG9tUnVsZTogIiIKfSwgKGZ1bmN0aW9uIChjb25mKSB7CglpZiAoIWNvbmYpIHJldHVybiB7fTsKCgl0cnkgewoJCXJldHVybiBKU09OLnBhcnNlIChjb25mKTsKCX0gY2F0Y2ggKGUpIHsKCQlILmluZm8gKCfphY3nva7mlofku7YgWyVzXSDml6DmlYgsIOeOsOWcqOS9v+eUqOepuueZvemFjee9ri4nLCBjb25mKTsKCQlyZXR1cm4ge307Cgl9Cn0pKEdNX2dldFZhbHVlIChILnNjcmlwdE5hbWUpKSk7Cgpjb25zdCBfX2xhdGVzdF92ZXJzaW9uID0gMTsKaWYgKEguY29uZmlnLnZlcnNpb24gIT0gX19sYXRlc3RfdmVyc2lvbikgewogICAgc3dpdGNoIChDb25maWcudmVyc2lvbikgewogICAgICAgIGNhc2UgdW5kZWZpbmVkOgogICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgSC5pbmZvKCfljYfnuqcgdjAg6YWN572u5paH5Lu2Li4uJyk7CiAgICAgICAgICAgIENvbmZpZy52ZXJzaW9uID0gMTsKCiAgICAgICAgICAgIENvbmZpZy5iWWVsbG93RWFzZUludGVybmF0aW9uYWwgPSBILmNvbmZpZy5iSW50ZXJuYXRpb25hbDsKICAgICAgICAgICAgQ29uZmlnLmJZZWxsb3dFYXNlVXNlT2xkQXBpID0gSC5jb25maWcuYlByb3h5SW5zdGFsbGVkOwogICAgICAgICAgICBDb25maWcuYlllbGxvd0Vhc2VVc2VUaHJpZE9uRmFpbCA9IEguY29uZmlnLmJVc2VUaHJpZE9uRmFpbDsKCiAgICAgICAgICAgIGRlbGV0ZSBILmNvbmZpZy5iSW50ZXJuYXRpb25hbDsKICAgICAgICAgICAgZGVsZXRlIEguY29uZmlnLmJVc2VUaHJpZE9uRmFpbDsKICAgICAgICAgICAgZGVsZXRlIEguY29uZmlnLmJQcm94eUluc3RhbGxlZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICBHTV9zZXRWYWx1ZSAoSC5zY3JpcHROYW1lLCBKU09OLnN0cmluZ2lmeShILmNvbmZpZykpOwp9CgovLyAyMDE0LjExLjMwOiDkuI3mmL7npLrml6Xlv5cKaWYgKCFILmNvbmZpZy5iRGlhcGxheUxvZyB8fCBILmlzRnJhbWUpIHsKCS8vIOWxj+iUveaXpeW/l+WHveaVsAoJSC5ub0xvZyA9IHRydWU7CglbJ2xvZycsICdpbmZvJ10ubWFwKGZ1bmN0aW9uIChmb29OYW1lKSB7CgkJSFsnXycgKyBmb29OYW1lLnNsaWNlKDAsIDMpXSA9IEhbZm9vTmFtZV0gPSBILm5vcDsKCX0pOwp9CgpILm1lcmdlIChILCB7Cglob29rUmVxdWlyZTogZnVuY3Rpb24gKG5hbWVzcGFjZSwgZm9vLCBjYWxsYmFjaykgewoJCS8vIFRoZSBmaXJzdCBvbmUgaXMgYHRoaXNgLCBzbyBub3QgZ29pbmcgdG8gYmUgdXNlZC4KCQl2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwgKGFyZ3VtZW50cywgMik7CgkJYXJnc1swXSA9IG51bGw7CgoJCXZhciBob29rUmVxID0gY3JlYXRlRWxlbWVudCAoJ3NjcmlwdCcpOwoJCWhvb2tSZXEudGV4dENvbnRlbnQgPSAnOygnICsgZnVuY3Rpb24gKG5hbWVzcGFjZSwgZm9vLCBjdXN0b20pIHsKCQkJdmFyICRucywgJGZvbzsKCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5ICh3aW5kb3csIG5hbWVzcGFjZSwgewoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuICRuczsKCQkJCX0sCgkJCQlzZXQ6IGZ1bmN0aW9uIChuKSB7CgkJCQkJJG5zID0gbjsKCgkJCQkJJGZvbyA9IG5bZm9vXTsKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkgKCRucywgZm9vLCB7CgkJCQkJCWdldDogZnVuY3Rpb24gKCkgewoJCQkJCQkJcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQl2YXIgcmV0ID0gY3VzdG9tLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoWyRucywgJGZvby5iaW5kICgkbnMpXSwgYXJndW1lbnRzKSk7CgkJCQkJCQkJaWYgKHJldCkgcmV0dXJuIHJldDsKCQkJCQkJCQlyZXR1cm4gJGZvby5hcHBseSAoJG5zLCBhcmd1bWVudHMpOwoJCQkJCQkJfTsKCQkJCQkJfSwKCQkJCQkJc2V0OiBmdW5jdGlvbiAoZm5OZXcpIHsKCQkJCQkJCSRmb28gPSBmbk5ldzsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQl9KTsKCQl9ICsgJykoIicgKyBuYW1lc3BhY2UgKyAnIiwgIicgKyBmb28gKyAnIiwgRnVuY3Rpb24uYmluZC5hcHBseSAoJwoJCQkrIGNhbGxiYWNrICsgJywgJyArIEpTT04uc3RyaW5naWZ5IChhcmdzKSArICcpKTsnOwoJCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQgKGhvb2tSZXEpOwoJCXJldHVybiBob29rUmVxOwoJfSwKCglob29rRGVmaW5lOiBmdW5jdGlvbiAoZm9vTmFtZSwgY2FsbGJhY2spIHsKCQkvLyBUaGUgZmlyc3Qgb25lIGlzIGB0aGlzYCwgc28gbm90IGdvaW5nIHRvIGJlIHVzZWQuCgkJdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsIChhcmd1bWVudHMsIDEpOwoJCWFyZ3NbMF0gPSBudWxsOwoKCQl2YXIgaG9va0RlZiA9IGNyZWF0ZUVsZW1lbnQgKCdzY3JpcHQnKTsKCQlob29rRGVmLnRleHRDb250ZW50ID0gJzsoJyArIGZ1bmN0aW9uIChmb29OYW1lLCBjdXN0b20pIHsKCQkJdmFyICRkZWZpbmU7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSAod2luZG93LCBmb29OYW1lLCB7CgkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCQkJCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkJCQl2YXIgcmV0ID0gY3VzdG9tLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoWyRkZWZpbmVdLCBhcmd1bWVudHMpKTsKCQkJCQkJaWYgKHJldCkgcmV0dXJuIHJldDsKCQkJCQkJcmV0dXJuICRkZWZpbmUuYXBwbHkgKHdpbmRvdywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJfSwKCQkJCXNldDogZnVuY3Rpb24gKG4pIHsKCQkJCQkkZGVmaW5lID0gbjsKCQkJCX0KCQkJfSk7CgkJfSArICcpKCInICsgbmFtZXNwYWNlICsgJyIsICInICsgZm9vICsgJyIsIEZ1bmN0aW9uLmJpbmQuYXBwbHkgKCcKCQkJKyBjYWxsYmFjayArICcsICcgKyBKU09OLnN0cmluZ2lmeSAoYXJncykgKyAnKSk7JzsKCQlkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkIChob29rRGVmKTsKCQlyZXR1cm4gaG9va0RlZjsKCX0sCgoJYmFzZTY0RGVjb2RlOiBmdW5jdGlvbiAoc3RyKSB7CgkJcmV0dXJuIENyeXB0b0pTLmVuYy5VdGY4LnN0cmluZ2lmeShDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKHN0cikpOwoJfSwKCQoJZ2V0Rmxhc2hWYXJzOiBmdW5jdGlvbiAoZWxlKSB7CgkJLy8galF1ZXJ5IGVsZW1lbnQgZml4LgoJCWlmICghZWxlKSByZXR1cm4ge307CgkJaWYgKGVsZS5qcXVlcnkpIGVsZSA9IGVsZVswXTsKCgkJLy8gQ2hlY2sgaWYgaXMgYSBmbGFzaCBvYmplY3QKCQlpZiAoZWxlLnR5cGUuaW5kZXhPZignZmxhc2gnKSA9PSAtMSkgcmV0dXJuIHt9OwoKCQlmb3IodmFyIGZsYXNoT2JqZWN0LCBmbGFzaFZhcnMgPSB7fSwgaSA9IGVsZS5jaGlsZE5vZGVzLmxlbmd0aDsgaS0tOykKCQkJaWYgKGVsZS5jaGlsZE5vZGVzW2ldLm5hbWUgPT0gJ2ZsYXNodmFycycpIHsKCQkJCWZsYXNoT2JqZWN0ID0gZWxlLmNoaWxkTm9kZXNbaV07CgkJCQlicmVhazsKCQkJfQoKCQlpZiAoZmxhc2hPYmplY3QpIHsKCQkJZmxhc2hPYmplY3QudmFsdWUucmVwbGFjZSgvJmFtcDsvZywgJyYnKS5yZXBsYWNlKC8oW1xzXFNdKz8pPShbXHNcU10rPykoJnwkKS9nLCBmdW5jdGlvbiAobiwga2V5LCB2YWx1ZSkgewoJCQkJLy8g5Yip55So5q2j5YiZ55qE5om56YeP5pu/5o2i5Yqf6IO95oqT5Y+W5pWw5o2uIF5eCgkJCQlmbGFzaFZhcnMgW2tleV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwoJCQl9KTsKCQl9CgoJCXJldHVybiBmbGFzaFZhcnM7Cgl9LAoKCWdldEZpcnN0S2V5OiBmdW5jdGlvbiAob2JqKSB7CgkJcmV0dXJuIE9iamVjdC5rZXlzKG9iailbMF07Cgl9LAoJZ2V0Rmlyc3RWYWx1ZTogZnVuY3Rpb24gKG9iaikgewoJCXRyeSB7CgkJCXJldHVybiBvYmpbSC5nZXRGaXJzdEtleShvYmopXTsKCQl9IGNhdGNoIChlKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX0sCgoJZ2V0TGlua0V4dDogZnVuY3Rpb24gKHVybCkgewoJCXJldHVybiB1cmwubWF0Y2goLy4rXC8oPzpbXi5dKyhcLi4rPykpKD86XD98JCkvKVsxXTsKCX0sCgoJZ2V0TGlua0V4dEZyb21RdWVyeTogZnVuY3Rpb24gKHVybCkgewoJCWlmIChILmNvbnRhaW5zKHVybCwgJz8nKSkgewoJCQl2YXIgcGFydHMgPSBsaW5rMy5zbGljZShsaW5rMy5pbmRleE9mKCc/JykgKyAxKS5yZXBsYWNlKC9bXj1dKz89KC4rPygmfCQpKS9nLCAnJDEnKS5zcGxpdCgnJicpOwoJCQlmb3IgKHZhciBpID0gcGFydHMubGVuZ3RoLCBleHRzOyBpLS07ICkgewoJCQkJaWYgKGV4dHMgPSBwYXJ0c1tpXS5tYXRjaCgvXC4oPzpbYS16MC05XXsyLDl9KS8pKSB7CgkJCQkJcmV0dXJuIGV4dHNbMF07CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIEguZ2V0TGlua0V4dCAodXJsKTsKCX0sCgoJcGFyc2VRdWVyeVN0cmluZzogZnVuY3Rpb24gKHJhd1VybCkgewoJCXZhciB1cmxQYXJhbXMgPSAoSC5jb250YWlucyAocmF3VXJsLCAnPycpCgkJCT8gcmF3VXJsLnNsaWNlIChyYXdVcmwuaW5kZXhPZignPycpICsgMSkKCQkJOiByYXdVcmwpLnNwbGl0KCcmJyk7CgoJCXZhciByZXQgPSB7fTsKCQlmb3IgKHZhciBpID0gMCwgcXVlcnlTdHIsIHBvc0VxdWFsOyBpIDwgdXJsUGFyYW1zLmxlbmd0aDsgaSsrKSB7CgkJCXF1ZXJ5U3RyID0gdXJsUGFyYW1zW2ldLnRvU3RyaW5nKCk7CgkJCXBvc0VxdWFsID0gcXVlcnlTdHIuaW5kZXhPZignPScpOwoJCQlpZiAocG9zRXF1YWwgPT0gLTEpIGNvbnRpbnVlOwoKCQkJcmV0W2RlY29kZVVSSUNvbXBvbmVudChxdWVyeVN0ci5zbGljZSAoMCwgcG9zRXF1YWwpKV0gPQoJCQkJZGVjb2RlVVJJQ29tcG9uZW50KHF1ZXJ5U3RyLnNsaWNlIChwb3NFcXVhbCArIDEpKTsKCQl9CgoJCXJldHVybiByZXQ7Cgl9LAoKCXdvcmRwcmVzc0F1ZGlvOiBmdW5jdGlvbiAoKSB7CgkJSC5sb2coJ1dvcmRQcmVzcyBBdWRpbyDmj5Lku7bpgJrnlKjku6PnoIEg5ZCv5YqoJyk7CgoJCXZhciBmaXhFbWJlZCA9IGZ1bmN0aW9uIChvYmopIHsKCQkJaWYgKG9iai50YWdOYW1lICE9ICdPQkpFQ1QnIHx8IG9iai5oYXNBdHRyaWJ1dGUoSC5zY3JpcHROYW1lKSkgcmV0dXJuOwoKCQkJdmFyIHNvbmdPYmogID0gSC5nZXRGbGFzaFZhcnMob2JqKTsKCQkJdmFyIHNvbmdBZGRyID0gSC5iYXNlNjREZWNvZGUoc29uZ09iai5zb3VuZEZpbGUpOwoJCQkkKCc8YT4nKS5odG1sKCfkuIvovb3jgIwnICsgc29uZ09iai50aXRsZXMgKyAn44CNPGJyPicpCgkJCQkuYXR0ciAoewoJCQkJCWhyZWY6IEgudXJpIChzb25nQWRkciwgc29uZ09iai50aXRsZXMgKyBzb25nQWRkci5zbGljZSgtNCkpLAoJCQkJCXRhcmdldDogJ19ibGFuaycKCQkJCX0pLmluc2VydEJlZm9yZSAob2JqKTsKCgkJCW9iai5zZXRBdHRyaWJ1dGUgKEguc2NyaXB0TmFtZSwgJ15eJyk7CgkJfTsKCgkJbmV3IE11dGF0aW9uT2JzZXJ2ZXIgKGZ1bmN0aW9uIChldmUpIHsKCQkJZm9yICh2YXIgaT0wOyBpPGV2ZS5sZW5ndGg7IGkrKykKCQkJCWlmIChldmVbaV0udGFyZ2V0LmNsYXNzTmFtZSA9PSAnYXVkaW9wbGF5ZXJfY29udGFpbmVyJyAmJiBldmVbaV0uYWRkZWROb2Rlcy5sZW5ndGgpCgkJCQkJZml4RW1iZWQoZXZlW2ldLmFkZGVkTm9kZXNbMF0pOwoJCX0pLm9ic2VydmUgKCQoJy5wb3N0ID4gLmVudHJ5JylbMF0sIHsKCQkJY2hpbGRMaXN0OiB0cnVlLAoJCQlzdWJ0cmVlOiB0cnVlCgkJfSk7CgoJCS8vIEZpcmVmb3ggZml4Li4gPSA9CgkJJCgnb2JqZWN0W2lkXj0iYXVkaW9wbGF5ZXJfIl0nKS5lYWNoKGZ1bmN0aW9uICgpIHsgZml4RW1iZWQodGhpcyk7IH0pOwoJCUgubG9nKCdXb3JkUHJlc3MgQXVkaW8g5o+S5Lu26YCa55So5Luj56CBIOe7k+adnycpOwoJfSwKCgl3YWl0VW50aWw6IGZ1bmN0aW9uIChjaGVja0NvbmQsIGZDYWxsYmFjaywgblRpbWVPdXQsIG5UaW1lSW50ZXJ2YWwpIHsKCQlpZiAodHlwZW9mIGZDYWxsYmFjayAhPSAnZnVuY3Rpb24nKQoJCQkvLyBSZXF1aXJlZC4KCQkJcmV0dXJuIDsKCgkJaWYgKCdzdHJpbmcnID09IHR5cGVvZiBjaGVja0NvbmQgJiYgY2hlY2tDb25kLmluZGV4T2YgKCcuJykgIT09IC0xKSB7CgkJCWNoZWNrQ29uZCA9IGNoZWNrQ29uZC5zcGxpdCAoJy4nKTsKCQl9CgkJaWYgKGNoZWNrQ29uZCBpbnN0YW5jZW9mIEFycmF5KSB7CgkJCWNoZWNrQ29uZCA9IGZ1bmN0aW9uICh2YXJzKSB7CgkJCQlmb3IgKHZhciBpID0gMCwgciA9IHVuc2FmZVdpbmRvdzsgaSA8IHZhcnMubGVuZ3RoOyBpKyspIHsKCQkJCQlyID0gclt2YXJzW2ldXTsKCQkJCQlpZiAoIXIpCgkJCQkJCXJldHVybiA7CgkJCQl9CgoJCQkJcmV0dXJuIHRydWU7CgkJCX0uYmluZCAobnVsbCwgY2hlY2tDb25kLnNsaWNlKCkpOwoJCX07CgoJCXZhciB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCQkJaWYgKCdmdW5jdGlvbicgPT0gdHlwZW9mIGNoZWNrQ29uZCkgewoJCQkJdHJ5IHsKCQkJCQlpZiAoIWNoZWNrQ29uZCgpKSByZXR1cm47CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJLy8gTm90IHJlYWR5IHlldC4KCQkJCQlyZXR1cm4gOwoJCQkJfQoJCQl9IGVsc2UgaWYgKCdzdHJpbmcnID09IHR5cGVvZiBjaGVja0NvbmQpIHsKCQkJCWlmICh0eXBlb2YgKHVuc2FmZVdpbmRvd1tjaGVja0NvbmRdKSA9PSAndW5kZWZpbmVkJykKCQkJCQlyZXR1cm4gOwoJCQl9CgkJCWNsZWFySW50ZXJ2YWwodGltZXIpOwoJCQl0cnkgewoJCQkJZkNhbGxiYWNrLmNhbGwodGhpcyk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCUguZXJyb3IgKCdbSC53YWl0VW50aWxdIENhbGxiYWNrIGZvciAlcyBoYWQgYW4gZXJyb3I6ICVzJywgSC52ZXJzaW9uLCBlLm1lc3NhZ2UpOwoJCQl9CgkJfSwgblRpbWVJbnRlcnZhbCB8fCAxNTApOwoKCQkvLyDlpoLmnpwgblRpbWVPdXQg55qE5Lyg5YWl5YC85Li6IHRydWUsIOWImeaXoOmZkOWItuetieW+hS4KCQlpZiAoblRpbWVPdXQgIT09IHRydWUpIHsKCQkJc2V0VGltZW91dCAoZnVuY3Rpb24gKCkgewoJCQkJLy8gVGltZW91dAoJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcik7CgkJCX0sIG5UaW1lT3V0IHx8IDEwMDAwKTsKCQl9Cgl9LAoKCW1ha2VGaW5lQ3NzOiBmdW5jdGlvbiAobmFtZSwgcGFyYW0pIHsKCQl2YXIgcmV0ID0ge307CgkJcmV0W25hbWVdID0gcGFyYW07CgkJWydtb3onLCAnd2Via2l0J10uZm9yRWFjaCAoZnVuY3Rpb24gKGUpIHsKCQkJcmV0WyctJyArIGUgKyAnLScgKyBuYW1lXSA9IHBhcmFtOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9LAoKCW1ha2VEZWxheUNzczogZnVuY3Rpb24gKHRyYW5zaXRpb25UZXh0KSB7CgkJcmV0dXJuIEgubWFrZUZpbmVDc3MoJ3RyYW5zaXRpb24nLCB0cmFuc2l0aW9uVGV4dCB8fCAnYWxsIC4ycycpOwoJfSwKCgltYWtlUm90YXRlQ3NzOiBmdW5jdGlvbiAoZGVnKSB7CgkJcmV0dXJuIEgubWFrZUZpbmVDc3MoJ3RyYW5zZm9ybScsICdyb3RhdGUoJyArIChkZWcgfHwgMTgwKSArICdkZWcpJyk7Cgl9LAoKCWNyZWF0ZU51bVBhZDogZnVuY3Rpb24gKG1heExlbiwgdGFyZ2V0SW5wdXQsIGZpbmlzaENhbGxiYWNrLCBjb2RlUmVzZXRDYWxsYmFjaykgewoJCWlmICghY29kZVJlc2V0Q2FsbGJhY2spCgkJCWNvZGVSZXNldENhbGxiYWNrID0gZUZ1bmM7CgoJCXZhciB0YWJsZSA9IGNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyksCgkJCXJjZGUgPSAkKHRhcmdldElucHV0KVswXTsKCQkkKHRhYmxlKS5jc3MoewoJCQknYmFja2dyb3VuZC1jb2xvcic6ICcjZmZjYzk5JywKCQkJJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJywKCQkJJ2JvdHRvbSc6ICcxNjRweCcsCgkJCSdsZWZ0JzogJzE3MHB4JwoJCX0pOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7CgkJCXZhciB0ciA9IGNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgMzsgaisrKSB7CgkJCQl2YXIgdGQgPSBjcmVhdGVFbGVtZW50KCd0ZCcpOwoJCQkJdGQuaW5uZXJIVE1MID0gJCh0ZCkuYXR0cignaycsICcxMjM0NTY3ODlDMOKGkCdbaSAqIDMgKyBqXSkuYXR0cignaycpOwoJCQkJdHIuYXBwZW5kQ2hpbGQodGQpOwoJCQl9CgkJCXRhYmxlLmFwcGVuZENoaWxkKHRyKTsKCQl9CgkJJCh0YWJsZSkuZmluZCgndGQnKS5jbGljayhmdW5jdGlvbiAoKSB7CgkJCXZhciB2YWwgPSByY2RlLnZhbHVlLAoJCQkJbGVuID0gdmFsLmxlbmd0aCwKCQkJCWtleSA9ICQodGhpcykuYXR0cignaycpIHx8ICcnOwoJCQkkKHJjZGUpLmZvY3VzKCk7CgoJCQlzd2l0Y2ggKGtleSkgewoJCQkJY2FzZSAn4oaQJzoKCQkJCQlyY2RlLnZhbHVlID0gdmFsLnNsaWNlKDAsIC0xKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ0MnOgoJCQkJCXJjZGUudmFsdWUgPSAnJzsKCQkJCQljb2RlUmVzZXRDYWxsYmFjayAoKTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJcmNkZS52YWx1ZSArPSBrZXk7CgkJCQkJbGVuICsrOwoJCQkJCWlmIChsZW4gPj0gbWF4TGVuKSB7CgkJCQkJCWlmIChmaW5pc2hDYWxsYmFjayhyY2RlLnZhbHVlKSkgewoJCQkJCQkJJCh0YWJsZSkuaGlkZSgpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY29kZVJlc2V0Q2FsbGJhY2soKTsKCQkJCQkJCXJjZGUudmFsdWUgPSAnJzsKCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJfQoJCX0pLmNzcyh7CgkJCWZvbnQ6ICdib2xkIDI1cHggVGFob21hJywKCQkJY29sb3I6ICdyZWQnLAoJCQljdXJzb3I6ICdwb2ludGVyJywKCQkJdmVydGljYWxBbGlnbjogJyBtaWRkbGUnLAoJCQl0ZXh0QWxpZ246ICcgY2VudGVyJywKCQkJYm9yZGVyOiAnMXB4IHNvbGlkICNEREREREQnLAoJCQlwYWRkaW5nOiAnNnB4JywKCQkJd2lkdGg6ICc0MHB4JywKCQkJaGVpZ2h0OiAnNDBweCcKCQl9KTsKCQlyZXR1cm4gdGFibGU7Cgl9LAoJcmVEaXJXaXRoUmVmOiBmdW5jdGlvbiAodGFyZ2V0VXJsKSB7CgkJaWYgKCF0YXJnZXRVcmwpIHJldHVybiA7CgkJSC5pbmZvICgnUmVkaXJlY3QgdG8gJXMuLi4nLCB0YXJnZXRVcmwpOwoJCQoJCXZhciBsaW5rID0gJCgnPGE+JykKCQkJLmF0dHIoJ2hyZWYnLCB0YXJnZXRVcmwpCgkJCS50ZXh0KCfmraPlnKjot7PovawgWycgKyB0YXJnZXRVcmwgKyAnXSwg6K+356iN5ZCOLi4gJykKCQkJLnByZXBlbmRUbyhkb2N1bWVudC5ib2R5KQoJCQkuY3NzICh7Zm9udFNpemU6IDEyLCBjb2xvcjogJ2luaGVyaXQnfSk7CgkJCgkJbGlua1swXS5jbGljaygpOwoJCXJldHVybiB0cnVlOwoJfSwKCgkvLyDnvZHnm5jlnLDlnYDoh6rliqjlr7zlkJEgW+WfuuS6jiBwaHBEaXNrIOeahOe9keebmF0KCXBocERpc2tBdXRvUmVkaXI6IGZ1bmN0aW9uIChmQ2FsbGJhY2spewoJCWlmICghZkNhbGxiYWNrKSB7CgkJCWZDYWxsYmFjayA9IGRvY3VtZW50LmJvZHkgPyBILnJlRGlyV2l0aFJlZiA6IGZ1bmN0aW9uIChwKSB7CgkJCQlILndhaXRVbnRpbCgnZG9jdW1lbnQuYm9keScsIEgucmVEaXJXaXRoUmVmLmJpbmQobnVsbCwgcCkpOwoJCQl9OwoJCX0KCgkJdmFyIHJDaGVja1BhdGggPSAvXC8oZmlsZSk/KGZpbGV8dmlldykoW1wvLlwtX10uKikvOwoJCS8vIEJlY2F1c2UgbG9jYXRpb24ueHggPSB4eCBkb2VzIG5vdCBwYXNzIHRoZSByZWZlciwgc28gd2UncmUgZ29pbmcgdG8gbWFrZSBhIGR1bW15IGZvcm0uCgkJaWYgKHJDaGVja1BhdGgudGVzdCAobG9jYXRpb24ucGF0aG5hbWUpKSB7CgkJCWZDYWxsYmFjayAobG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSAockNoZWNrUGF0aCwgJy8kMWRvd24kMycpKTsKCQl9IGVsc2UgaWYgKEguYmVnaW5XaXRoKGxvY2F0aW9uLnBhdGhuYW1lLCAnL3ZpZXdmaWxlJykpIHsKCQkJZkNhbGxiYWNrIChsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKCcvdmlld2ZpbGUnLCAnL2Rvd25sb2FkJykpOwoJCX0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQoKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJLy8g5o+S5YWl5qC35byP6KGoCglpbmplY3RTdHlsZTogZnVuY3Rpb24gKCkgewoJCXZhciBzdHlsZUJsb2NrID0gKHRoaXMgJiYgdGhpcy50YWdOYW1lID09ICdTVFlMRScpID8gdGhpcyA6IChILnN0eWxlQmxvY2sgfHwgY3JlYXRlRWxlbWVudCgnc3R5bGUnKSk7CgkJc3R5bGVCbG9jay50ZXh0Q29udGVudCArPSBbXS5qb2luLmNhbGwoYXJndW1lbnRzLCAnXG4nKTsKCQlILnN0eWxlQmxvY2sgPSBzdHlsZUJsb2NrOwoJCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVCbG9jayk7CgkJcmV0dXJuIHN0eWxlQmxvY2s7Cgl9LAoKCS8vIOW8uuWItumakOiXjy/mmL7npLrmn5DkupvlhYPntKAKCWZvcmNlSGlkZTogZnVuY3Rpb24gKCkgewoJCXJldHVybiBILmluamVjdFN0eWxlLmNhbGwgKHRoaXMsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKS5qb2luICgnLCAnKSArICd7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudCB9JyAgKTsKCX0sCglmb3JjZVNob3c6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gSC5pbmplY3RTdHlsZS5jYWxsICh0aGlzLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykuam9pbiAoJywgJykgKyAneyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50IH0nICk7Cgl9LAoJLy8g5by65Yi26ZqQ6JeP5qGG5p62Cglmb3JjZUhpZGVGcmFtZXM6IGZ1bmN0aW9uICgpewoJCXJldHVybiBmb3JjZUhpZGUoJ2lmcmFtZSwgZnJhbWVzZXQsIGZyYW1lJyk7Cgl9LAoKCS8vIOmAmueUqCBqUGxheWVyIOazqOWFpQoJalBsYXllclBhdGNoZXI6IGZ1bmN0aW9uIChjYWxsYmFjaywgbmFtZXNwYWNlKSB7CgkJLy8g6buY6K6k5Li6IGpQbGF5ZXIKCQlpZiAoIW5hbWVzcGFjZSkgbmFtZXNwYWNlID0gJ2pQbGF5ZXInOwoKCQlILmluZm8gKCfnrYnlgJkgalBsYXllciDlsLHnu6ogLi4nKTsKCQlILndhaXRVbnRpbCgnJC4nICsgbmFtZXNwYWNlICsgJy5wcm90b3R5cGUuc2V0TWVkaWEnLCBmdW5jdGlvbiAoKSB7CgkJCUguaW5mbyAoJ+W8gOWni+e7keWumuWHveaVsCAuLicpOwoJCQl1bnNhZmVPdmVyd3JpdGVGdW5jdGlvblNhZmVQcm94eSAoewoJCQkJc2V0TWVkaWE6IGZ1bmN0aW9uIChuZXdNZWRpYSkgewoJCQkJCUguaW5mbyAoJ+atjOabsuaVsOaNrjogJywgbmV3TWVkaWEpOwoJCQkJCWNhbGxiYWNrIChuZXdNZWRpYSk7CgkJCQkJdGhyb3cgbmV3IEVycm9yVW5zYWZlU3VjY2VzcygpOwoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cuJFtuYW1lc3BhY2VdLnByb3RvdHlwZSwgJy4kLicgKyBuYW1lc3BhY2UgKyAnLnByb3RvdHlwZScpOwoJCQlILmluZm8gKCfnu5Hlrprlrozmr5UsIGVuam95ficpOwoJCX0pOwoJfSwKCglmaXhTdHlsZU9yZGVyOiBmdW5jdGlvbiAoZWxTdHlsZSkgewoJCSQoJ2hlYWQnKS5hcHBlbmQgKGVsU3R5bGUpOwoJfSwKCgkvLyBGaXNoZXItWWF0ZXMgU2h1ZmZsZSBieSBjb21tdW5pdHkgd2lraSg/KQoJLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNjI3NDM5OAoJc2h1ZmZsZTogZnVuY3Rpb24gKGFycmF5KSB7CgkJdmFyIGNvdW50ZXIgPSBhcnJheS5sZW5ndGgsIHRlbXAsIGluZGV4OwoKCQkvLyBXaGlsZSB0aGVyZSBhcmUgZWxlbWVudHMgaW4gdGhlIGFycmF5CgkJd2hpbGUgKGNvdW50ZXIgPiAwKSB7CgkJCS8vIFBpY2sgYSByYW5kb20gaW5kZXgKCQkJaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjb3VudGVyKTsKCgkJCS8vIERlY3JlYXNlIGNvdW50ZXIgYnkgMQoJCQljb3VudGVyLS07CgoJCQkvLyBBbmQgc3dhcCB0aGUgbGFzdCBlbGVtZW50IHdpdGggaXQKCQkJdGVtcCA9IGFycmF5W2NvdW50ZXJdOwoJCQlhcnJheVtjb3VudGVyXSA9IGFycmF5W2luZGV4XTsKCQkJYXJyYXlbaW5kZXhdID0gdGVtcDsKCQl9CgoJCXJldHVybiBhcnJheTsKCX0KfSk7CgovLyDnroDljZXlsY/olL3lub/lkYoKdW5zYWZlV2luZG93LmFudGlhZHN2MiA9IDA7CnVuc2FmZURlZmluZUZ1bmN0aW9uICgnQ05aWl9BRF9CQVRDSCcsIGZ1bmN0aW9uICgpIHt9KTsKCi8vIOepuueZveWHveaVsCwg6YCC5ZCI6IW+56m66aG16Z2i5Ye95pWw44CCCnZhciBlRnVuYyA9IGZ1bmN0aW9uICgpIHt9LAoJdEZ1bmMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyAgfSwKCWZGdW5jID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH07Cgp2YXIgJF9HRVQgPSBILnBhcnNlUXVlcnlTdHJpbmcgKEguY3VycmVudFVybCk7CgpILmxvZyAoJ+iEmuacrOW8gOWni+aJp+ihjOOAgicpOwpILmxvZyAoJ+Wfn+WQjTogJXM7IOWujOaVtOWcsOWdgDogJXM7IOivt+axguWPguaVsDogJXMnLCBILmRpcmVjdEhvc3QsIEguY3VycmVudFVybCwgSlNPTi5zdHJpbmdpZnkgKCRfR0VUKSk7CkgubG9nICgn6ISa5pys54mI5pysIFsgJXMgXSAsIOWmguaenOWPkeeOsOiEmuacrOmXrumimOivt+aPkOS6pOWIsCBbICVzIF0g6LCi6LCi44CCJywgSC52ZXJzaW9uLCBILnJlcG9ydFVybCk7CgoKCXZhciBzaXRlcyA9IFsgLyogQ29tcGlsZWQgZnJvbSBBQS5jb25maWcuanMgKi8KewoJaWQ6ICdpbnRlcm5hbC5jb25maWcnLAoJbmFtZTogJ+iEmuacrOmFjee9rumhtemdoicsCglob3N0OiBbJ2xvY2FsaG9zdCcsICdqaXh1bm1vZS5naXRodWIuaW8nXSwKCXBhdGg6IFsnL2NvbmYvJywgJy9jdXdjbDRjL2NvbmZpZy8nXSwKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJdW5zYWZlV2luZG93LnJTY3JpcHRWZXJzaW9uID0gSC52ZXJzaW9uOwoJCXVuc2FmZVdpbmRvdy5yU2NyaXB0Q29uZmlnICA9IEpTT04uc3RyaW5naWZ5IChILmNvbmZpZyk7CgkJSC5pbmZvIChILmNvbmZpZyk7CgoJCXZhciBfYyA9IGNvbmZpcm07CgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoJ1NhdmVDb25maWcnLCBmdW5jdGlvbiAoZSkgewoJCQl0cnkgewoJCQkJdmFyIGNvbmZpZyA9IEpTT04uc3RyaW5naWZ5IChKU09OLnBhcnNlIChlLmRldGFpbCkpOwoJCQkJaWYgKF9jIChILnNwcmludGYgKCfnoa7lrprlgqjlrZjorr7lrproh7MgJXM/JywgSC5zY3JpcHROYW1lKSkpCgkJCQkJR01fc2V0VmFsdWUgKEguc2NyaXB0TmFtZSwgY29uZmlnKTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJYWxlcnQgKCfop6PmnpDorr7lrprlgLzlh7rplJkhJyk7CgkJCX0KCQl9KTsKCX0sCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKICAgICAgICBILmNhcHR1cmVBcmlhKGRvY3VtZW50LmJvZHkpOwoJfQp9CiwKLyogQ29tcGlsZWQgZnJvbSBhcGkubXVzaWMuc3B5LmpzICovCi8qKgogKiDnrKzkuInmlrkgLSAi6Z+z5LmQ6Ze06LCNIiDop6PmnpDmjqXlj6MKICogVFlQRV9TVUJfTU9EVUxFCiAqLwooewoJaWQ6ICdhcGkubXVzaWMuc3B5JywKCglzdG9yYWdlS2V5OiAnX01VU0lDX1NQWScsCglyZWxvYWRDYWNoZTogdHJ1ZSwKCgkvLyDliJ3lp4vljJbnm5HlkKzkuovku7YKCWluaXQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgZnVuY3Rpb24gKGUpIHsKCQkJc3dpdGNoIChlLmtleSkgewoJCQkJY2FzZSBzZWxmLnN0b3JhZ2VLZXk6CgkJCQkJc2VsZi5yZWxvYWRDYWNoZSA9IHRydWU7CgkJCQkJYnJlYWs7CgkJCX0KCQl9LCBmYWxzZSk7CgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoSC5zY3JpcHROYW1lICsgJy1ORS1TUFknLCBmdW5jdGlvbiAoZSkgewoJCQl2YXIgZGF0YSA9IEpTT04ucGFyc2UoZS5kZXRhaWwpOwoJCQl2YXIgaWQgPSBkYXRhLmlkOwoJCQlzZWxmLmdldE5ldEVhc2UoaWQsIHVuc2FmZVdpbmRvd1tkYXRhLmNhbGxiYWNrXSk7CgkJfSk7Cgl9LAoKCS8vIOi/m+ihjOe8k+WtmOmHjei9vQoJZG9SZWxvYWRDYWNoZTogZnVuY3Rpb24gKCkgewoJCXRyeSB7CgkJCXRoaXMuY2FjaGUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZVt0aGlzLnN0b3JhZ2VLZXldKTsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmNhY2hlID0ge307CgkJfQoKCQl0aGlzLnJlbG9hZENhY2hlID0gZmFsc2U7Cgl9LAoKCS8vIOivu+WFpee8k+WtmAoJY2FjaGVSZWFkOiBmdW5jdGlvbiAoc29uZ0lkKSB7CgkJaWYgKHRoaXMucmVsb2FkQ2FjaGUpCgkJCXRoaXMuZG9SZWxvYWRDYWNoZSgpOwoKCQlpZiAoIXRoaXMuY2FjaGUuaGFzT3duUHJvcGVydHkoc29uZ0lkKSkKCQkJcmV0dXJuIG51bGw7CgoJCXJldHVybiB0aGlzLmNhY2hlW3NvbmdJZF07Cgl9LAoKCS8vIOWCqOWtmOe8k+WtmAoJY2FjaGVTYXZlOiBmdW5jdGlvbiAoKSB7CgkJbG9jYWxTdG9yYWdlW3RoaXMuc3RvcmFnZUtleV0gPSBKU09OLnN0cmluZ2lmeSh0aGlzLmNhY2hlKTsKCX0sCgoJLy8g5YWs5byA5o6l5Y+jOiDojrflj5bpu4TmmJPnmoTpn7PkuZDlnLDlnYAKCS8vIOS8mOWFiOivu+WPlue8k+WtmCwg6Ziy5q2i6KKr5p+l5p2ACglnZXROZXRFYXNlOiBmdW5jdGlvbiAoc29uZ0lkLCBjYWxsYmFjaykgewoJCXZhciBzZWxmID0gdGhpczsKCgkJdmFyIGNhY2hlU29uZyA9IHRoaXMuY2FjaGVSZWFkKHNvbmdJZCk7CgkJaWYgKGNhY2hlU29uZykgewoJCQljYWxsYmFjayhjYWNoZVNvbmcudXJsKTsKCQkJcmV0dXJuIDsKCQl9CgoJCUdNX3htbGh0dHBSZXF1ZXN0KHsKCQkJbWV0aG9kOiAiR0VUIiwKCQkJdXJsOiAnaHR0cDovL2l0d3VzdW4uY29tL3NlYXJjaC93eS8nICsgc29uZ0lkICsgJz9wPTEmZj1qc29uJnNpZ249aXR3dXN1bicsCgkJCW9ubG9hZDogZnVuY3Rpb24ocmVzcG9uc2UpIHsKCQkJCS8vIOino+aekOaVsOaNrgoJCQkJdmFyIGRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7CgkJCQlpZiAoZGF0YS5sZW5ndGggPT09IDApIHsKCQkJCQljYWxsYmFjayhudWxsKTsKCQkJCQlyZXR1cm4gOwoJCQkJfQoKCQkJCS8vIOeOsOWcqOWwneivleivu+WPluatjOabsuaVsOaNrgoJCQkJdmFyIHNvbmcgPSBkYXRhLmZpbHRlcihmdW5jdGlvbiAoc29uZykgewoJCQkJCXJldHVybiBzb25nLlR5cGUgPT0gInd5IiAmJiBzb25nLlNvbmdJZCA9PSBzb25nSWQ7CgkJCQl9KS5wb3AoKTsKCgkJCQkvLyDmsqHmnInmib7liLAKCQkJCWlmICghc29uZykgewoJCQkJCWNhbGxiYWNrKG51bGwpOwoJCQkJCXJldHVybiA7CgkJCQl9CgoJCQkJLy8g5LyY5YWI6I635Y+W6auY5riF6Z+z6LSoCgkJCQl2YXIgdXJsID0gc29uZy5TcVVybCB8fCBzb25nLkhxVXJsIHx8IHNvbmcuTHFVcmw7CgoJCQkJLy8g5YKo5a2YCgkJCQl2YXIgc29uZ09iaiA9IHsKCQkJCQl0aW1lOiBEYXRlLm5vdygpLAoJCQkJCXVybDogdXJsLAoJCQkJfTsKCgkJCQlzZWxmLmNhY2hlW3NvbmdJZF0gPSBzb25nT2JqOwoJCQkJc2VsZi5jYWNoZVNhdmUoKTsKCQkJCWNhbGxiYWNrKHVybCk7CgkJCX0KCQl9KTsKCX0KfSksCi8qIENvbXBpbGVkIGZyb20gZGwuMTE5Zy5qcyAqLwp7CglpZDogJ2RsLjExOWcnLAoJbmFtZTogJzExOWcg572R55uYJywKCWhvc3Q6IFsnZC4xMTlnLmNvbSddLAoJbm9TdWJIb3N0OiB0cnVlLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5iZWdpbldpdGggKGxvY2F0aW9uLnBhdGhuYW1lLCAnL2YvJykgJiYgIUguY29udGFpbnMgKGxvY2F0aW9uLnBhdGhuYW1lLCAnX2JhaycpKSB7CgkJCWxvY2F0aW9uLnBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvKF8uKyk/XC4vLCAnX2Jhay4nKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwuMTIzNTY0LmpzICovCnsKCWlkOiAnZGwuMTIzNTY0JywKCW5hbWU6ICcxMjM1NjQg572R55uYJywKCWhvc3Q6IFsnMTIzNTY0LmNvbScsICdtLjEyMzU2NC5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCgljc3M6ICcuYWQxe2hlaWdodDoxcHggIWltcG9ydGFudH0nLAoJaGlkZTogWycjbG9hZGluZycsICcjeXptJ10sCglzaG93OiAnI2Rvd25sb2FkJywKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl1bnNhZmVXaW5kb3cua2lsbHBhbmFkcyA9IDE7Cgl9LAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJJCgnI2Rvd25sb2FkID4gYScpLmNsaWNrKCk7Cgl9Cn0KLAovKiBDb21waWxlZCBmcm9tIGRsLjV4ZmlsZS5qcyAqLwovKioKICogNXhmaWxlLmNvbQogKiAgIOS6lOaYn+e9keebmCAoPykKICovCih7CglpZDogJ2RsLjV4ZmlsZScsCgluYW1lOiAn5LqU5pif572R55uYJywKCWhvc3Q6IFsnd3d3LjV4ZmlsZS5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCgloaWRlOiBbCgkJJy5mYl9yJywgJ2lmcmFtZScsICdbaWRePSJfXyJdJywgJyNhZGRyX2JveCcKCV0sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCW9wZW46IHRGdW5jCgkJfSk7CgkJSC5waHBEaXNrQXV0b1JlZGlyICgpOwoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQl2YXIgZmlsZSA9IGxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9cZCsvKTsKCQl1bnNhZmVFeGVjKGZ1bmN0aW9uIChmaWQpIHsKCQkJaWYgKHR5cGVvZiBsb2FkX2Rvd25fYWRkcjEgPT0gJ2Z1bmN0aW9uJykKCQkJCWxvYWRfZG93bl9hZGRyMShmaWQpOwoJCX0sIGZpbGVbMF0pOwoJfQp9KSwKLyogQ29tcGlsZWQgZnJvbSBkbC43OTU4LmpzICovCnsKCWlkOiAnZGwuNzk1OCcsCgluYW1lOiAn5Y2D5Yab5LiH6ams572R55uY57O75YiXJywKCWhvc3Q6IFsnNzk1OC5jb20nLCAncWp3bS5jb20nXSwKCWhpZGU6IFsKCQknI2Rvd250YycsICdbaWRePSJjcHJvXyJdJywgJy5kb3dubG9hZF9hbGVydCcsICcjaW5wdXR5em0nLAoJCScjaG91c2UnLCAnI3VwdG93bicsICdhW2hyZWYkPSJtb25leS5odG1sIl0nLCAnYVtocmVmJD0icmVnLmh0bWwiXScKCV0sCglzaG93OiBbJyNkb3dudGMyJywgJy5uZXdfZG93biddLAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguY29udGFpbnMgKGxvY2F0aW9uLnBhdGhuYW1lLCAnZG93bl8nKSkgewoJCQlsb2NhdGlvbi5wYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoJ18nLCAnbG9hZF8nKTsKCQl9CgoJCUgud2FpdFVudGlsKCdhdXRoYWQnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZURlZmluZUZ1bmN0aW9uICgnYXV0aGFkJywgdEZ1bmMpOwoJCX0pOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIGRsLjlwYW4uanMgKi8KewoJaWQ6ICdkbC45cGFuJywKCW5hbWU6ICc555uYJywKCWhvc3Q6ICd3d3cuOXBhbi5uZXQnLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIC9cL1xkLy50ZXN0ICggbG9jYXRpb24ucGF0aG5hbWUgKSApIHsKCQkJbG9jYXRpb24ucGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlICgnLycsICcvZG93bi0nKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwuYmFpZHUuanMgKi8KewoJaWQ6ICdkbC5iYWlkdScsCgluYW1lOiAn55m+5bqm55uY5YWN5LiL6L29566h5a62JywKCWhvc3Q6IFsneXVuLmJhaWR1LmNvbScsICdwYW4uYmFpZHUuY29tJ10sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJSC53YWl0VW50aWwgKCdyZXF1aXJlJywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVFeGVjIChmdW5jdGlvbiAoKSB7CgkJCQl2YXIgc2VydmljZSA9IHJlcXVpcmUoJ2Rpc2stc3lzdGVtOndpZGdldC9wbHVnaW4vZG93bmxvYWQvdXRpbC9kb3dubG9hZENvbW1vblV0aWwuanMnKTsKCQkJCXNlcnZpY2UuaXNQbGF0Zm9ybVdpbmRvd3MgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfTsKCQkJfSk7CgkJfSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwuYngwNjM1LmpzICovCnsKCWlkOiAnZGwuYngwNjM1JywKCW5hbWU6ICfmmrTpm6rnm5gnLAoJaGlkZTogJyNiMj46bm90KCNkb3duX2JveCksIC50aXQgKyBkaXYsIC5jbGVhcitkaXYsIC5sb2dvX3InLAoJaG9zdDogJ2J4MDYzNS5jb20nLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXVuc2FmZVdpbmRvdy5vcGVuID0gbnVsbDsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBkbC5jb2xhZmlsZS5qcyAqLwp7CglpZDogJ2RsLmNvbGFmaWxlJywKCW5hbWU6ICflj6/kuZDnm5gnLAoJaG9zdDogWydjb2xheXVuLmNvbScsICdjb2xhZmlsZS5jb20nLCAnY29sYWRyaXZlLmNvbSddLAoJaGlkZTogWwoJCScudGFibGVfcmlnaHQnLCAnI2Rvd25fbGluazMnLCAnLnR1aScsICcuYWQxID4gLmFkMSA+ICo6bm90KC5kb3duYm94KScsCgoJCS8vIOiuoeaXtuS4i+i9vemhteeahOW5v+WRigoJCScuaG90cmVjLWVsZScsICcudmlld3NoYXJlLWNvcHktb3V0ZXInCgldLAoJZ2VuRGlnaXQ6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiAyNTUpOwoJfSwKCWdlblZhbGlkSXA6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gWzAsMCwwLDBdLm1hcCh0aGlzLmdlbkRpZ2l0KS5qb2luKCcuJyk7Cgl9LAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdmFyIGZpbGVfaWQgPSBsb2NhdGlvbi5wYXRobmFtZS5tYXRjaCgvXGQrLylbMF07CgoJCSQuYWpheCh7CgkJCXVybDogJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lICsgJy9hamF4LnBocD9hY3Rpb249ZG93bmFkZHJlc3MmZmlsZV9pZD0nICsgZmlsZV9pZCwKCQkJaGVhZGVyczogewoJCQkJJ1gtRm9yd2FyZGVkLUZvcic6IHRoaXMuZ2VuVmFsaWRJcCgpCgkJCX0sCgkJCWRhdGFUeXBlOiAndGV4dCcKCQl9KS5zdWNjZXNzIChmdW5jdGlvbiAocikgewoJCQl2YXIgJGRsID0gci5tYXRjaCAoL2Rvd25sb2FkRmlsZVwoIiguKz8pIi8pWzFdLnJlcGxhY2UoJy9kbC5waHAnLCAnL3RkLnBocCcpOwoJCQl2YXIgbGlua1RleHQgPSBILnNwcmludGYoJyVzIOS4k+eUqOS4i+i9vScsIEguc2NyaXB0TmFtZSk7CgoJCQkvLyDmlrDniYgKCQkJJCgnPGE+JykuYWRkQ2xhc3MgKCduZXctZGJ0bicpCgkJCQkuYXR0ciAoJ2hyZWYnLCAkZGwpCgkJCQkuYXBwZW5kICgkKCc8ZW0+JykuYWRkQ2xhc3MgKCdpY29uLWRvd25sb2FkJykpCgkJCQkuYXBwZW5kICgkKCc8Yj4nKS50ZXh0IChsaW5rVGV4dCkpCgkJCQkuYXBwZW5kVG8gKCQoJy5zbGlkZS1oZWFkZXItZnVuY3MnKSk7CgoJCQkvLyDml6fniYgKCQkJJCgnPGE+JykuYWRkQ2xhc3MgKCdidXR0b24gYnRuLWdyZWVuJykKCQkJCS5hdHRyICgnaHJlZicsICRkbCkKCQkJCS5hcHBlbmQgKCQoJzxpPicpLmFkZENsYXNzICgnaWNvbicpKQoJCQkJLmFwcGVuZCAobGlua1RleHQpCgkJCQkuYXBwZW5kVG8gKCQoJyNkb3duX3ZlcmlmeV9ib3ggPiBsaScpKQoJCQkJLmNzcyAoewoJCQkJCXdpZHRoOiAzMDAsCgkJCQkJbWFyZ2luOiAnMmVtIDAnCgkJCQl9KTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBkbC5jdGRpc2suanMgKi8KewoJaWQ6ICdkbC5jdGRpc2snLAoJbmFtZTogJ+WfjumAmue9keebmOezu+WIlycsCglob3N0OiBbCgkJJzQwMGdiLmNvbScsICdjdGRpc2suY29tJywgJ3BpcGlwYW4uY29tJywgJ2JlZ28uY2MnLAoJCSdjdGZpbGUuY29tJywgJ3QwMHkuY29tJwoJXSwKCXBhdGg6ICcvZmlsZS8nLAoJaGlkZTogWycuY2FwdGNoYScsICcua2tfeHNob3cnLCAnZGl2LnNwYW42OmZpcnN0LWNoaWxkJywgJyN0b3AgPiAuYWxlcnQnXSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQkvLyBGaXggQW50aS1BQlAgYXMgaXQgZG9lc24ndCBjaGVjayB0aGUgY29kZS4KCQlILndhaXRVbnRpbCAoJ2d1ZXN0dmlld2Noa2Zvcm0nLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQkJd2luZG93Lmd1ZXN0dmlld2Noa2Zvcm0gPSBmdW5jdGlvbiAoZm9ybSkgewoJCQkJCXJldHVybiBmb3JtLnJhbmRjb2RlICYmIGZvcm0ucmFuZGNvZGUudmFsdWUubGVuZ3RoID09IDQ7CgkJCQl9OwoJCQl9KTsKCQl9KTsKCgkJdmFyIGtleUZvcm0gPSBkb2N1bWVudC51c2VyX2Zvcm07CgkJdmFyICRrZiA9ICQoa2V5Rm9ybSk7CgkJCgkJdHJ5IHsKCQkJa2V5Rm9ybS5oYXNoX2tleS52YWx1ZSA9IEguYmFzZTY0RGVjb2RlKGtleUZvcm0uaGFzaF9pbmZvLnZhbHVlKTsKCQl9IGNhdGNoIChlKSB7CgkJCUguaW5mbyAoJ+e8uuWkseaIluaXoOaViOeahCBoYXNoX2tleSDlsZ7mgKflgLwsIOi3s+i/h+KApicpOwoJCX0KCgkJJGtmLmF0dHIoJ2FjdGlvbicsICRrZi5hdHRyKCdhY3Rpb24nKS5yZXBsYWNlKC8oVilcZC9pLCAnJDEyJykpOwoKCQkkKCcuY2FwdGNoYV9yaWdodCcpLmNzcygnZmxvYXQnLCAnbGVmdCcpOwoJCQoJCS8qIOWfjumAmueOsOWcqOeahOmqjOivgeeggeaYr+a3t+WQiOaVsOWtl+OAgeWtl+avjQoJCSQoJyN2ZmNvZGU6Zmlyc3QnKS5wYXJlbnQoKQoJCQkuYXBwZW5kKEguY3JlYXRlTnVtUGFkKDQsICQoJyNyYW5kY29kZScpWzBdLCBmdW5jdGlvbiAoKSB7CgkJCQkka2Yuc3VibWl0KCk7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSkpOwoJCSovCgoJCSQoJyNwYWdlX2NvbnRlbnQnKQoJCQkuYXR0cignaWQnLCAnXl9eJykKCQkJLnZhbCgnY3Byb0lmcmFtZXUxMjU4MTMwMnxodHRwdWJtY21tYmFpZHVzdGF0aWNjb21jcHJvbWVkaWFzbWFsbHBuZycpOwoKCQlILmxvZyAoJ+WfjumAmuWwsee7qi4nKTsKCX0sCgkKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCSQoJyNtb2RhbF9jYXB0Y2hhJykuYWRkQ2xhc3MoJ2luJykuc2hvdygpOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIGRsLmRsa29vLmpzICovCnsKCWlkOiAnZGwuZGxrb28nLAoJbmFtZTogJ+Wkp+i/nueUn+a0u+e9kScsCglleGFtcGxlOiAnaHR0cDovL3d3dy5kbGtvby5jb20vZG93bi82LzIwMTEvMjIyNjg2NzU0Lmh0bWwnLAoJaG9zdDogWydkbGtvby5jb20nXSwKCXBhdGg6ICcvZG93bi9kb3duZmlsZS5hc3AnLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC53cml0ZSA9IChmdW5jdGlvbiAoKSB7fSkuYmluZChudWxsKTsKCQkKICAgICAgICB2YXIgX2NlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZChkb2N1bWVudCk7CiAgICAgICAgdGhpcy5jcmVhdGVFbGVtZW50ID0gX2NlbDsKCQlkb2N1bWVudC5jcmVhdGVFbGVtZW50ID0gKGZ1bmN0aW9uICh0YWcpIHsKCQkJaWYgKHRhZy50b0xvd2VyQ2FzZSgpID09ICdzY3JpcHQnKQoJCQkJdGFnID0gJ2Rpdic7CgkJCXJldHVybiBfY2VsKHRhZyk7CgkJfSkuYmluZChudWxsKTsKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdmFyIGZpcnN0RWwgPSBkb2N1bWVudC5ib2R5LmNoaWxkcmVuWzBdOwoJCWlmICghZmlyc3RFbCkgZmlyc3RFbCA9IGRvY3VtZW50LmJvZHk7CgoJCXZhciBmaXJzdFR4dCA9IGZpcnN0RWwudGV4dENvbnRlbnQ7CgkJaWYgKEguYmVnaW5XaXRoKGZpcnN0VHh0LCAn6Ziy55uX6ZO+5o+Q56S6JykgfHwgSC5iZWdpbldpdGgoZmlyc3RUeHQsICfpqozor4HnoIEnKSkgewoJCQlILnJlRGlyV2l0aFJlZihsb2NhdGlvbi5ocmVmKTsKCQkJcmV0dXJuIDsKCQl9IGVsc2UgaWYgKEguYmVnaW5XaXRoKGZpcnN0VHh0LCAn6Ziy5Yi35pawJykpIHsKCQkJZmlyc3RFbC5zdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CgkJCWZpcnN0RWwudGV4dENvbnRlbnQgKz0gJ1xuXG7or7fnqI3lkI4sIDXnp5LlkI7oh6rliqjliLfmlrDigKYnOwoJCQlzZXRUaW1lb3V0KEgucmVEaXJXaXRoUmVmLCA1NTAwLCBsb2NhdGlvbi5ocmVmKTsKCQkJcmV0dXJuIDsKCQl9CgoJCXZhciBidG5EbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidHN1Ym1pdCcpOwoJCWlmIChidG5EbCkgewoJCQlidG5EbC5pZCA9IG51bGw7CgkJCWJ0bkRsLnZhbHVlID0gJ+W8gOWni+S4i+i9vSc7CgkJCWJ0bkRsLmRpc2FibGVkID0gZmFsc2U7CgoJCQl2YXIgZmFrZUJ0biA9IHRoaXMuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCQkJZmFrZUJ0bi5pZCA9ICdidHN1Ym1pdCc7CgkJCSQoZmFrZUJ0bikuaGlkZSgpLmFwcGVuZFRvKCdib2R5Jyk7CgkJfQoJfQp9LAovKiBDb21waWxlZCBmcm9tIGRsLmhvd2ZpbGUuanMgKi8KewoJaWQ6ICdkbC5ob3dmaWxlJywKCW5hbWU6ICflpb3nm5gnLAoJaG9zdDogJ2hvd2ZpbGUuY29tJywKCQoJaGlkZTogWycjZmxvYXRkaXYgZGl2JywgJy5yb3cxX3JpZ2h0J10sCgljc3MgOiAnI2Zsb2F0ZGl2IHsgdG9wOiAxNTBweDsgei1pbmRleDogOTk5OTk7IGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7IH0nCn0sCi8qIENvbXBpbGVkIGZyb20gZGwubGVwYW4uY2MuanMgKi8KewoJaWQ6ICdjYy5sZXBhbicsCgluYW1lOiAn5LmQ55uY6Ieq5Yqo5LiL6L295Zyw5Z2AJywKCWhvc3Q6IFsnd3d3LmxlcGFuLmNjJywgJ3d3dy5zeDU2Ni5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCXNob3c6ICcjZG93bl9ib3gnLAoJaGlkZTogWycud2lkZ2V0LWJveCcsICdhW2hyZWY9InZpcC5waHAiXSddLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCS8vIOegtOWdj+W5v+WRigoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh1bnNhZmVXaW5kb3csICdnb29nbGUnLCB7CgkJCXNldDogZnVuY3Rpb24gKCkgeyB9LAoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKCk7IH0KCQl9KTsKCQkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkodW5zYWZlV2luZG93LCAnYWRzYnlnb29nbGUnLCB7CgkJCXNldDogZnVuY3Rpb24gKCkgeyB9LAoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKCk7IH0KCQl9KTsKCQkKCQlILnJ1bGUuZXhlYygncGhwZGlzay56JywgJ29uU3RhcnQnKTsKCX0sCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQkkKCcjZG93bl9ib3ggLndpZGdldC1ib3gnKS5yZW1vdmVDbGFzcygnd2lkZ2V0LWJveCcpOwoJCSQoJ1tocmVmKj0iZG93bi5sZXBhbi5jYy8/ZG93bnVybCJdJykuZWFjaChmdW5jdGlvbihpLCBlbCl7CgkJCWVsLnJlbW92ZUF0dHJpYnV0ZSgnb25jbGljaycpOwoJCQlHTV94bWxodHRwUmVxdWVzdCh7CgkJCQltZXRob2Q6ICJHRVQiLAoJCQkJdXJsOiBlbC5ocmVmLAoJCQkJb25sb2FkOiBmdW5jdGlvbiAocikgewoJCQkJCXZhciB1cmwgPSByLnJlc3BvbnNlVGV4dC5tYXRjaCgvZGVsYXlVUkxcKCIoLis/KSIvKVsxXTsKCQkJCQljb25zb2xlLmluZm8oJ0ZpeCBsaW5rIHRvICVzJywgdXJsKTsKCQkJCQllbC5ocmVmID0gdXJsOwoJCQkJfQoJCQl9KTsKCQl9KTsKCX0KfQosCi8qIENvbXBpbGVkIGZyb20gZGwucmF5ZmlsZS5qcyAqLwp7CglpZDogJ2RsLnJheWZpbGUnLAoJbmFtZTogJ+mjnumAn+e9kScsCglob3N0OiAncmF5ZmlsZS5jb20nLAoJaGlkZTogWydkaXYubGVmdCddLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCWlmICh1bnNhZmVXaW5kb3cudmtleSkgewoJCQlsb2NhdGlvbi5wYXRobmFtZSArPSB1bnNhZmVXaW5kb3cudmtleTsKCQl9IGVsc2UgewoJCQl1bnNhZmVXaW5kb3cuZmlsZXNpemUgPSAxMDA7CgkJCXVuc2FmZVdpbmRvdy5zaG93RG93bmxvYWQgKCk7CgkJCXVuc2FmZVdpbmRvdy5zaG93RG93bmxvYWQgPSBlRnVuYzsKCQkJCgkJCSQoJyNkb3dubG9hZGxpbmsnKS5hZGRDbGFzcygnYnRuX2Rvd25Ob3dfemgtY24nKTsKCQkJJCgnI3ZvZGxpbmsnKS5hZGRDbGFzcygnYnRuX2Rvd25Ub29sc196aC1jbicpOwoJCX0KCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBkbC5zdWR1cGFuLmpzICovCnsKCWlkOiAnZGwuc3VkdXBhbicsCgluYW1lOiAn6YCf5bqm55uYJywKCWhvc3Q6IFsnc3VkdXBhbi5jb20nXSwKCXNob3c6IFsnI3NkcHh6bGonLCAnI3NkcHh6bGogPiB0ZCddLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCWlmIChILmJlZ2luV2l0aChsb2NhdGlvbi5wYXRobmFtZSwgJy9kb3duXycpKSB7CgkJCWxvY2F0aW9uLnBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSAoJy9kb3duXycsICcvc2RwL3hpYXphaV8nKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwudmRpc2suanMgKi8KewoJaWQ6ICdkbC52ZGlzaycsCgluYW1lOiAn5aiB55uYJywKCWhvc3Q6IFsndmRpc2suY24nXSwKCWhpZGU6IFsnI2xvYWRpbmdib3gnLCAnI3lhbnpoZW5nYm94JywgJyN5em1ib3gnLCAnI2dldGJveCA+IC5idG46Zmlyc3QtY2hpbGQnXSwKCXNob3c6IFsnI2J0bmJveCddCn0sCi8qIENvbXBpbGVkIGZyb20gZGwueWltdWhlLmpzICovCnsKCWlkOiAnZGwueWltdWhlJywKCW5hbWU6ICfkuIDmnKjnpr7nvZHnm5gnLAoJaG9zdDogJ3lpbXVoZS5jb20nLAoKCWhpZGU6IFsnI2xvYWRpbmcnLCAnLmdnYW8nLCAnLmt1YW4nXSwKCXNob3c6IFsnI3l6bSddLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlILnBocERpc2tBdXRvUmVkaXIoKTsKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguYmVnaW5XaXRoICggbG9jYXRpb24ucGF0aG5hbWUsICcvbl9kZC5waHAnICkpIHsKCQkJSC5yZURpcldpdGhSZWYoJCgnI2Rvd25zJykuYXR0cignaHJlZicpKTsKCQkJcmV0dXJuIDsKCQl9CgoJCXZhciBkbENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkICgnZG93bmxvYWQnKTsKCQlpZiAoIWRsQ29udGFpbmVyKSByZXR1cm4gOwoKCQkvLyDlvZPkuIvovb3moYbnmoQgc3R5bGUg5bGe5oCn6KKr5pu05pS55ZCOLCDmqKHmi5/kuIvovb3mjInpkq7ljZXlh7suCgkJdmFyIG1vID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIgKGZ1bmN0aW9uICgpIHsKCQkJJCgnYScsIGRsQ29udGFpbmVyKVsxXS5jbGljaygpOwoJCX0pOwoJCW1vLm9ic2VydmUgKGRsQ29udGFpbmVyLCB7IGF0dHJpYnV0ZXM6IHRydWUgfSk7CgoJCSQoJyN5em0+Zm9ybScpCgkJCS5hcHBlbmQoSC5jcmVhdGVOdW1QYWQoNCwgJyNjb2RlJywgZnVuY3Rpb24gKCkgewoJCQkJZG9jdW1lbnQueXpjb2RlLlN1Ym1pdC5jbGljaygpOwoJCQkJcmV0dXJuIHRydWU7CgkJCX0sIGZ1bmN0aW9uICgpIHsKCQkJCSQoJyN2Y29kZV9pbWcnKVswXS5jbGljaygpOwoJCQl9KSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZm0uZG91YmFuLmpzICovCnsKCWlkOiAnZm0uZG91YmFuJywKCW5hbWU6ICfosYbnk6PnlLXlj7AnLAoJaG9zdDogJ2RvdWJhbi5mbScsCglub1N1Ykhvc3Q6IHRydWUsCgljc3M6IC8qIFJlc291cmNlOiBmbS5kb3ViYW4uZGwuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCmEjanhfZG91YmFuX2RsIHsKCWJhY2tncm91bmQ6ICM5REQ2QzU7CglwYWRkaW5nOiAzcHggNXB4OwoJY29sb3I6ICNmZmYKfQoKYSNqeF9kb3ViYW5fZGw6aG92ZXIgewoJbWFyZ2luLWxlZnQ6IDVweDsKCXBhZGRpbmctbGVmdDogMTBweDsKCWJhY2tncm91bmQ6ICNCQUUyRDY7Cn0KCmRpdiNqeF9kb3ViYW5fZGxfd3JhcCB7CglmbG9hdDogcmlnaHQ7CgltYXJnaW4tdG9wOiAtMjMwcHg7CgltYXJnaW4tcmlnaHQ6IC0zMnB4OwoJZm9udC13ZWlnaHQ6IGJvbGQ7Cglmb250LWZhbWlseTogJ01pY3Jvc29mdCBKSGVuZ0hlaSBVSScsICflvq7ova/pm4Xpu5EnLCBzZXJpZi1zYW5zOwp9CiovfSksCgoJLy8g5Y+C6ICD5Luj56CBIOixhuiXpCwgVVNPOiA0OTkxMQoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdmFyIGxpbmtEb3dubG9hZCA9ICQoJzxhPicpLmNzcyhILm1ha2VEZWxheUNzcygpKQoJCQkuYXR0ciAoJ3RhcmdldCcsICdfYmxhbmsnKQoJCQkuYXR0ciAoJ2lkJywgJ2p4X2RvdWJhbl9kbCcpCgkJCS50ZXh0ICgn5LiL6L29Jyk7CgoJCSQoJzxkaXY+JykKCQkJLmF0dHIgKCdpZCcsICdqeF9kb3ViYW5fZGxfd3JhcCcpCgkJCS5hcHBlbmQobGlua0Rvd25sb2FkKQoJCQkuaW5zZXJ0QWZ0ZXIoJy5wbGF5ZXItd3JhcCcpOwoJCQoJCUgubG9nICgn562J5b6F6LGG55Oj55S15Y+w5Yqg6L29IC4uJyk7CgkJCgkJSC53YWl0VW50aWwoJ2V4dFN0YXR1c0hhbmRsZXInLCBmdW5jdGlvbiAoKSB7CgkJCUgubG9nICgn57uR5a6a5Ye95pWwIC4uJyk7CgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCQlleHRTdGF0dXNIYW5kbGVyOiBmdW5jdGlvbiAoanNvblNvbmdPYmopIHsKCQkJCQl2YXIgc29uZ09iaiA9IEpTT04ucGFyc2UoanNvblNvbmdPYmopOwoJCQkJCWlmICgnc3RhcnQnID09IHNvbmdPYmoudHlwZSAmJiBzb25nT2JqLnNvbmcpIHsKCQkJCQkJbGlua0Rvd25sb2FkCgkJCQkJCQkuYXR0cignaHJlZicsIEgudXJpIChzb25nT2JqLnNvbmcudXJsLCBzb25nT2JqLnNvbmcudGl0bGUgKyBzb25nT2JqLnNvbmcudXJsLnNsaWNlKC00KSkpCgkJCQkJCQkuYXR0cigndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5zb25nLnRpdGxlKTsKCQkJCQkJCgkJCQkJCUguaW5mbyAoJyVzID0+ICVzJywgc29uZ09iai5zb25nLnRpdGxlLCBzb25nT2JqLnNvbmcudXJsKTsKCQkJCQl9CgoJCQkJCXRocm93IG5ldyBFcnJvclVuc2FmZVN1Y2Nlc3MgKCk7CgkJCQl9CgkJCX0pOwoKCQkJSC5sb2cgKCflh73mlbDnu5Hlrprlrozmr5UsIEVuam95ficpOwoJCQkKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBmbS5qaW5nLmpzICovCnsKCWlkOiAnZm0uamluZycsCgluYW1lOiAnSmluZy5mbScsCglob3N0OiAnamluZy5mbScsCglub1N1Ykhvc3Q6IHRydWUsCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuZGxCb3ggPSAkKCc8YT4nKS5jc3MoewoJCQlwb3NpdGlvbjogJ2Fic29sdXRlJywKCQkJcmlnaHQ6IDAsCgkJCXpJbmRleDogOQoJCX0pLmF0dHIoJ3RhcmdldCcsICdfYmxhbmsnKS50ZXh0KCfkuIvovb0nKTsKCgkJSC5qUGxheWVyUGF0Y2hlciAoZnVuY3Rpb24gKHNvbmdPYmopIHsKCQkJdGhpcy5kbEJveAoJCQkJLmF0dHIgKCAnaHJlZicsIEguZ2V0Rmlyc3RWYWx1ZSAoc29uZ09iaikucmVwbGFjZSgvXD8uKy8sICcnKSApCgkJCQkuYXR0ciAoICd0aXRsZScsICQoJyNtc2NQbHIgPiAudGl0JykudGV4dCAoKSApOwoJCX0uYmluZCAodGhpcykpOwoKCQlILndhaXRVbnRpbCAoJ1BsYXllci5sb2FkJywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVPdmVyd3JpdGVGdW5jdGlvblNhZmVQcm94eSAoewoJCQkJbG9hZDogZnVuY3Rpb24gKCkgewoJCQkJCXNldFRpbWVvdXQgKGZ1bmN0aW9uICgpIHsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAoIG5ldyBDdXN0b21FdmVudCAoJ2p4X2ppbmdfZm1fcGxheWVyX2xvYWRlZCcpICk7CgkJCQkJfSwgMTAwKTsKCgkJCQkJdGhyb3cgbmV3IEVycm9yVW5zYWZlU3VjY2VzcygpOwoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cuUGxheWVyLCAnLlBsYXllcicpOwoJCX0pOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICgnanhfamluZ19mbV9wbGF5ZXJfbG9hZGVkJywgZnVuY3Rpb24gKCkgewoJCQlILmluZm8gKCdKaW5nLmZtIOaSreaUvuWZqOWKoOi9veWujOavlScpOwoJCQl0aGlzLmRsQm94LmFwcGVuZFRvKCQoJyNtc2NQbHInKSk7CgkJfS5iaW5kICh0aGlzKSwgZmFsc2UpOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIGZtLm1vZS5qcyAqLwovKioKICog6JCM5ZCm6Z+z5LmQ55S15Y+wCiAqIDIwMTYuMDQuMDg6IOS/ruWkjeS7pemAguW6lOaWsOeJiOaSreaUvuWZqOS7o+eggeOAggogKi8KKHsKCWlkOiAnZm0ubW9lJywKCW5hbWU6ICfokIznlLXlj7AgW21vZS5mbV0nLAoJaG9zdDogJ21vZS5mbScsCglub1N1Ykhvc3Q6IHRydWUsCglwYXRoOiAnL2xpc3Rlbi9oNScsCgloaWRlOiBbJyNwcm9tb3Rpb25fbHMnXSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQlILndhaXRVbnRpbCgnc2VhanMnLCBmdW5jdGlvbiAoKSB7CgkJCS8vIOeZu+W9leegtOinowoJCQl1bnNhZmVXaW5kb3cuaXNfbG9naW4gPSB0cnVlOwoJCQkKCQkJLy8g5LiL6L295oyJ6ZKuCgkJCXZhciBkbExpbmsgPSAkKCc8YT4nKS5hZGRDbGFzcygncGxheWVyLWJ1dHRvbiBsZWZ0JykuY3NzKEgubWFrZVJvdGF0ZUNzcyg5MCkpLmNzcyh7CgkJCQknd2lkdGgnOiAnMjZweCcsCgkJCQknYmFja2dyb3VuZC1wb3NpdGlvbic6ICctMTlweCAtOTZweCcKCQkJfSkuaW5zZXJ0QWZ0ZXIgKCQoJ2Rpdi5wbGF5ZXItYnV0dG9uLmJ1dHRvbi12b2x1bWUnKS5maXJzdCgpKTsKCQkJCgkJCS8vIOebkeWQrAoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoJCQkJSC5pbmZvKHNvbmdPYmopOwoKCQkJCWRsTGluawoJCQkJCS5hdHRyKCdocmVmJywgSC51cmkoc29uZ09iai51cmwsIHNvbmdPYmouc3ViX3RpdGxlICsgJy5tcDMnKSkKCQkJCQkuYXR0cigndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5zdWJfdGl0bGUpOwoJCQl9LCBmYWxzZSk7CgoJCQkvLyDmjILovb3lpJbmjILmqKHnu4QKCQkJdW5zYWZlRXhlYyAoZnVuY3Rpb24gKHNjcmlwdE5hbWUpIHsKCQkJCWZ1bmN0aW9uIG5vdGlmeVVwZGF0ZSAoY2xpcCkgewoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQgKCBuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUsIHtkZXRhaWw6IGNsaXAgfSkgKTsKCQkJCX0KCgkJCQlkZWZpbmUoJ3BsdWdpbi9qaXh1bicsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMpIHsKCQkJCQljb25zb2xlLmluZm8oJ1tDVVdDTDRDXSDlvIDlp4vms6jlhaUgLi4uJyk7CgkJCQkJdmFyIGxpc3RlbiA9IHJlcXVpcmUoJy9wdWJsaWMvanMvZm0vcGFnZS9saXN0ZW4uanMnKTsKCQkJCQl2YXIgcGxheWVyID0gcmVxdWlyZSgncGxheWVyL3BsYXllcicpOwoKCQkJCQl2YXIgX2luaXRQbGF5ZXIgPSBwbGF5ZXIuaW5pdFBsYXllcjsKCQkJCQlwbGF5ZXIuaW5pdFBsYXllciA9IGZ1bmN0aW9uIChjbGlwKSB7CgkJCQkJCW5vdGlmeVVwZGF0ZShjbGlwKTsKCQkJCQkJX2luaXRQbGF5ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJCWNvbnNvbGUuaW5mbygnW0NVV0NMNENdIOazqOWFpee7k+adnyAuLi4nKTsKCQkJCX0pOwoJCQkJCgkJCQkvLyDopoHmsYLovb3lhaXlpJbmjILmqKHnu4QKCQkJCXNlYWpzLnVzZSgncGx1Z2luL2ppeHVuJyk7CgkJCX0sIEguc2NyaXB0TmFtZSk7CgkJfSk7Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIGZtLnFxLmpzICovCnsKCWlkOiAnZm0ucXEnLAoJbmFtZTogJ1FRIOeUteWPsOS4i+i9veino+aekCcsCglob3N0OiAnZm0ucXEuY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCUgubG9nICgnV2FpdGluZyBmb3IgZm1RUS4uLicpOwoJCUgud2FpdFVudGlsKCckLnFQbGF5ZXIucGxheWVyLnBsYXlVcmwnLCBmdW5jdGlvbiAoKSB7CgkJCUgubG9nICgnZm1RUSBIb29rIHN0YXJ0IScpOwoJCQkKCQkJLy8gQ3JlYXRlRExCdXR0b24KCQkJdmFyIGRsTGluayA9ICQoJzxhPicpLmNzcyhILm1ha2VSb3RhdGVDc3MoOTApKS5jc3MoewoJCQkJJ2JhY2tncm91bmQtcG9zaXRpb24nOiAnLTI0cHggLTczcHgnCgkJCX0pOwoJCQkkKCcuYnRuX2RlbCcpLmFmdGVyKGRsTGluayk7CgkJCQoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoKCQkJCWRsTGluawoJCQkJCS5hdHRyKCdocmVmJywgSC51cmkoc29uZ09iai5zb25ndXJsLCBzb25nT2JqLm1zb25nICsgJy5tcDMnKSkKCQkJCQkuYXR0cigndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5tc29uZyk7CgkJCX0sIGZhbHNlKTsKCgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uICgpIHsKCQkJCXZhciBfcGxheXVybCA9IHdpbmRvdy4kLnFQbGF5ZXIucGxheWVyLnBsYXlVcmwuYmluZCh3aW5kb3cuJC5xUGxheWVyLnBsYXllcik7CgkJCQl2YXIgX3VwZGF0ZVVybCA9IGZ1bmN0aW9uICgpIHsKCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50ICggbmV3IEN1c3RvbUV2ZW50IChILnNjcmlwdE5hbWUsIHtkZXRhaWw6ICQucVBsYXllci5wbGF5TGlzdC5nZXRTb25nSW5mb09iaigpIH0pICk7CgkJCQl9CgkJCQl3aW5kb3cuJC5xUGxheWVyLnBsYXllci5wbGF5VXJsID0gZnVuY3Rpb24gKCkgewoJCQkJCV91cGRhdGVVcmwgKCk7CgkJCQkJcmV0dXJuIF9wbGF5dXJsLmFwcGx5ICgwLCBhcmd1bWVudHMpOwoJCQkJfTsKCgkJCQlfdXBkYXRlVXJsICgpOwoJCQl9KTsKCgkJCUgubG9nICgnZm1RUSBIb29rIGZpbmlzaCEnKTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy4xNjMuanMgKi8KLyoqCiAqIOe9keaYk+mfs+S5kOS4i+i9veino+aekCBCeSBKaXh1bgogKiAg4oCU4oCUIOWPl+WkoOS6hiBDb2ZmZWUgU2NyaXB0IOS6hgogKi8KKHsKCWlkOiAnbXVzaWMuMTYzJywKCW5hbWU6ICfnvZHmmJPpn7PkuZDkuIvovb3op6PmnpAnLAoJaG9zdDogJ211c2ljLjE2My5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJbm9GcmFtZTogZmFsc2UsCglkbF9pY29uOiB0cnVlLAoJY3NzOiAvKiBSZXNvdXJjZTogY29tLjE2My5tdXNpYy5kbC5jc3MgKi8KSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsgLyoKLm0tcGJhciwgLm0tcGJhciAuYmFyYmcgewoJd2lkdGg6IGNhbGMoIDQ1NXB4IC0gMi41ZW0gKTsKfQoKLm0tcGxheWJhciAucGxheSB7Cgl3aWR0aDogY2FsYyggNTcwcHggLSAyLjVlbSApOwp9CgoubS1wbGF5YmFyIC5vcGVyIHsKCXdpZHRoOiBpbml0aWFsOwp9CgouanhfZGw6aG92ZXIgewoJY29sb3I6IHdoaXRlOwp9CgotLSDlupXpg6jljZXmm7LkuIvovb0KLm0tcGxheWJhciAub3BlciAuanhfYnRuIHsKCXRleHQtaW5kZW50OiAwOwoJZm9udC1zaXplOiAxLjVlbTsKCW1hcmdpbjogMTNweCAycHggMCAwOwoJZmxvYXQ6IGxlZnQ7Cgljb2xvcjogI2NjYzsKCXRleHQtc2hhZG93OiAxcHggMXB4IDJweCBibGFjaywgMCAwIDFlbSBibGFjaywgMCAwIDAuMmVtICNhYWE7CglsaW5lLWhlaWdodDogMS42ZW07Cglmb250LXNpemU6IDEuMmVtOwp9CgoubS1wbGF5YmFyIC5vcGVyIC5qeF9kbDo6YmVmb3JlIHsKCXBhZGRpbmctcmlnaHQ6IC4yNWVtOwp9CgouanhfYnRuOmhvdmVyIHsKCWNvbG9yOiB3aGl0ZTsKfQoKLS0g5pKt5pS+5YiX6KGo5LiL6L29Ci5tLXBsYXliYXIgLmxpc3RoZGMgLmp4X2RsLmFkZGFsbCB7CglsZWZ0OiAzMDZweDsKCWxpbmUtaGVpZ2h0OiAxZW07CgktLSDlpJrkuIDkuKogcHgsIOWvuem9kOaWh+WtlwoJdG9wOiAxM3B4Owp9CgoubS1wbGF5YmFyIC5saXN0aGRjIC5saW5lLmp4X2RsX2xpbmUgewoJbGVmdDogMzg1cHg7Cn0KKi99KSwKCV9fTVAzX0JMQU5LOiAnaHR0cHM6Ly9qaXh1bm1vZS5naXRodWIuaW8vY3V3Y2w0Yy9ibGFuay5tcDMnLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCWlmIChILmNvbmZpZy5iVXNlVGhyaWRPbkZhaWwpIHsKCQkJSC5ydWxlLmdldCgnYXBpLm11c2ljLnNweScpLmluaXQoKTsKCQl9CgoJCXRoaXMuYlByb3h5TG9jYWwgPSBILmNvbmZpZy5iSW50ZXJuYXRpb25hbCAmJiBILmNvbmZpZy5iUHJveHlJbnN0YWxsZWQ7CgoJCWlmIChILmNvbmZpZy5iSW50ZXJuYXRpb25hbCkKCQkJdGhpcy5nZW5lcmF0ZUNkbigpOwoKCQlpZiAobG9jYWxTdG9yYWdlLl9fSElERV9CQU5ORVIpIHsKCQkJSC5mb3JjZUhpZGUoJyNpbmRleC1iYW5uZXInKTsKCQl9CgoJCXRoaXMucmVnUGxheWVyKCk7CgoJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQkvLyDkvJjlhYjkvb/nlKggSFRNTDUg5pKt5pS+5ZmoCgkJCS8vIOWmguaenOayoeacieWGjeiAg+iZkSBGbGFzaCDmlK/mj7QKCQkJCgkJCS8vIOaEn+inieW5tuayoeacieS7gOS5iOWNteeUqOS6hj8KCQkJdmFyIGZha2VQbGF0Rm9ybSA9IG5hdmlnYXRvci5wbGF0Zm9ybSArICItLUZha2UtbWFjIjsKCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hdmlnYXRvciwgInBsYXRmb3JtIiwgewoJCQkJZ2V0OiBmdW5jdGlvbigpeyByZXR1cm4gZmFrZVBsYXRGb3JtOyB9LAoJCQkJc2V0OiBmdW5jdGlvbigpe30KCQkJfSk7CgoKCQkJLy8g6aCG5L6/LCDop6PpjpblhajnkIPpmZDliLYKCQkJd2luZG93LkdSZXN0cmljdGl2ZSA9IGZhbHNlOwoJCX0pOwoJfSwKCglnZW5lcmF0ZUNkbjogZnVuY3Rpb24gKCkgewoJCS8vIFRPRE86CgkJLy8gKyDnlKjmiLfmj5DkvpsgQ0ROIOWIl+ihqAoJCS8vICsg55So5oi35oyH5a6a5L2/55So55qEIElQIOe8k+WtmOiKgueCuSAo5aW95YOP5Lya6ZqP5py6PykKCQkvLyDpmo/kvr8gcGluZyDkuoblh6DkuKoKCQl2YXIgY2RucyA9IFsKCQkJLy8g55S15L+hCgkJCSIxMjUuOTAuMjA2LjMyIiwgCgkJCSIyMjIuMTg2LjEzMi4xMDMiLCAKCQkJIjExNy4yMy42Ljg5IiwgCgkJCSIxMTkuMTQ1LjIwNy4xNyIsIAoJCQkiMTgwLjk3LjE4MC43MSIsIAoJCQkiMTE2LjU1LjIzNi45MyIsIAoJCQkiMjE4Ljc2LjEwNS40MiIsIAoJCQkiMTI1LjY0LjIzMi4xNSIsIAoJCQkiMTE1LjIzMS44Ny4zNyIsIAoJCQkiNTguMjIxLjc4LjY4IiwgCgkJCSIyMjAuMTEyLjE5NS4xNDgiLCAKCQkJIjIxOC42NC45NC42NyIsIAoJCQkiMzYuNDIuMzIuNzYiLCAKCQkJIjYxLjEzNi4yMTEuMTYiLCAKCQkJIjIxOC42NC45NC42OCIsIAoJCQkiMjE5LjEzOC4yMS43MSIsIAoJCQkiNDkuNzkuMjMyLjU4IiwgCgkJCSIxMjIuMjI4LjI0LjMwIiwgCgkJCSIxODIuMTA2LjE5NC44NSIsIAoJCQkiMjE4LjU5LjE4Ni45OCIsIAoJCQkiNjEuMTU4LjEzMy4yMSIsIAoJCQkiMTE3LjI3LjI0MS4yMCIsIAoJCQkiNTguNTEuMTUwLjEzMyIsIAoJCQkiMjE4LjI5LjQ5LjEzMiIsIAoJCQkiNjAuMjE1LjEyNS43NiIsIAoJCQkiMTgzLjYxLjIyLjE3IiwgCgkJCSIxODMuMTM0LjE0LjI2IiwgCgkJCSI1OC4yMjAuNi4xNDIiLCAKCQkJIjExNS4yMzEuMTU4LjQ0IiwgCgkJCSI2MS4xNjQuMjQxLjEwNSIsIAoJCQkiMTI1LjQ2LjIyLjEyNCIsIAoJCQkiMjIyLjI4LjE1Mi4xMzkiLCAKCQkJIjEyNC4xNjUuMjE2LjI0NCIsIAoJCQkiMjE4LjYwLjEwNi4xMTUiLCAKCQkJIjIwMi4xMDcuODUuODEiLCAKCQkJIjYxLjE3OS4xMDcuMTE2IiwgCgkJCSIxNzUuNDMuMjAuNjkiLCAKCQkJIjIyMC4xOTQuMjAzLjg2IiwgCgkJCSI2MS4xNjAuMjA5LjI3IiwgCgkJCSIxMjAuMjA5LjE0MS43OSIsIAoJCQkiMTIwLjIwOS4xNDIuMTM4IiwgCgkJCSIyMTkuMTM4LjIxLjcyIiwgCgkJCSI1OC4yMTYuMjEuMTMyIiwKCQkJJzE0LjIxNS4yMjguMTAnLAoJCQknMjE4Ljg3LjExMS44MycsCgoJCQkvLyDljJfkuqznlLXkv6EKCQkJJzIwMy4xMzAuNTkuOCcsCgkJCScyMDMuMTMwLjU5LjknLAoJCQknMjAzLjEzMC41OS4xMCcsCgkJCScyMDMuMTMwLjU5LjExJywKCQkJJzIwMy4xMzAuNTkuMTInCgkJXTsKCQl0aGlzLmNkbl9pcCA9IEguc2h1ZmZsZShjZG5zKTsKCX0sCgoJLyoqCgkgKiDnp7vpmaTntrLnq5nnmoTpmZDliLYKCSAqLwoJX2RvUmVtb3ZhbDogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlILndhaXRVbnRpbCgnbm0ueCcsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIENSMSA9IHNlbGYuc2VhcmNoRnVuY3Rpb24odW5zYWZlV2luZG93Lm5lai5lLCAnbmVqLmUnLCAnLmRhdGFzZXQ7aWYnKTsKCQkJdmFyIENSMiA9IHNlbGYuc2VhcmNoRnVuY3Rpb24odW5zYWZlV2luZG93Lm5tLngsICdubS54JywgICcuY29weXJpZ2h0SWQ9PScpOwoJCQl2YXIgQ1IzID0gc2VsZi5zZWFyY2hGdW5jdGlvbih1bnNhZmVXaW5kb3cubm0ueCwgJ25tLngnLCAgJy5wcml2aWxlZ2U7aWYnKTsKCQkJc2VsZi5mbHVzaExvZ1RhYmxlKCk7CgoJCQkvLyBDUjIg5L2N572u55qE5YWn5a655ZyoIENSMSDlh73mlbjlkI7liqDovIkKCQkJSC53YWl0VW50aWwoJ25tLnguJyArIENSMiwgZnVuY3Rpb24gKCkgewoJCQkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoYklzRnJhbWUsIENSMSwgQ1IyLCBDUjMpIHsKCQkJCQl2YXIgX0NSMSA9IG5lai5lW0NSMV07CgkJCQkJbmVqLmVbQ1IxXSA9IGZ1bmN0aW9uICh6LCBuYW1lKSB7CgkJCQkJCWlmIChuYW1lID09ICdjb3B5cmlnaHQnIHx8IG5hbWUgPT0gJ3Jlc0NvcHlyaWdodCcpIHsKCQkJCQkJCXJldHVybiAxOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gX0NSMS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCX07CgoJCQkJCW5tLnhbQ1IyXT0gZnVuY3Rpb24gKCkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfTsKCgkJCQkJbm0ueFtDUjNdPSBmdW5jdGlvbiAoKSB7CgkJCQkJCXZhciBzb25nRGV0YWlsID0gYXJndW1lbnRzWzBdOwoJCQkJCQlzb25nRGV0YWlsLnN0YXR1cyA9IDA7CgoJCQkJCQlpZiAoc29uZ0RldGFpbC5wcml2aWxlZ2UpIHsKCQkJCQkJCXNvbmdEZXRhaWwucHJpdmlsZWdlLnBsID0gMzIwMDAwOwoJCQkJCQkJc29uZ0RldGFpbC5wcml2aWxlZ2Uuc3RhdHVzID0gMDsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJcmV0dXJuIDA7CgkJCQkJfTsKCQkJCX0sIEguaXNGcmFtZSwgQ1IxLCBDUjIsIENSMyk7CgkJCX0sIDcwMDAsIDUwMCk7CgkJfSk7Cgl9LAoKCWFkZExvZ0l0ZW06IGZ1bmN0aW9uIChsb2dJdGVtKSB7CgkJaWYgKCF0aGlzLmxvZ0l0ZW1zKQoJCQl0aGlzLmxvZ0l0ZW1zID0gW107CgoJCXRoaXMubG9nSXRlbXMucHVzaChsb2dJdGVtKTsKCX0sCgoJZmx1c2hMb2dUYWJsZTogZnVuY3Rpb24gKCkgewoJCXZhciBsb2dJdGVtcyA9IHRoaXMubG9nSXRlbXM7CgkJdGhpcy5sb2dJdGVtcyA9IFtdOwoKCQlpZiAoIUgubm9Mb2cgJiYgbG9nSXRlbXMubGVuZ3RoID4gMCkKCQkJY29uc29sZS50YWJsZShsb2dJdGVtcyk7Cgl9LAoKCXNlYXJjaEZ1bmN0aW9uOiBmdW5jdGlvbihiYXNlLCBuYW1lLCBrZXkpIHsKCQl2YXIgaXNSZWcgPSBrZXkgaW5zdGFuY2VvZiBSZWdFeHA7CgoJCWZvciAodmFyIGJhc2VOYW1lIGluIGJhc2UpIHsKCQkJdmFyIGZuID0gYmFzZVtiYXNlTmFtZV07CgkJCWlmIChmbiAmJiB0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHsKCQkJCXZhciBmblN0ciA9IGZuLnRvU3RyaW5nKCk7CgkJCQlpZiAoaXNSZWcgPyBrZXkudGVzdChmblN0cikgOiBmblN0ci5pbmRleE9mKGtleSkgIT09IC0xKSB7CgkJCQkJaWYgKCFILm5vTG9nKSB7CgkJCQkJCXRoaXMuYWRkTG9nSXRlbSh7CgkJCQkJCQknS2V5d29yZCc6IGtleSwKCQkJCQkJCSdGb3VuZCc6IG5hbWUgKyAnLicgKyBiYXNlTmFtZQoJCQkJCQl9KTsKCQkJCQl9CgoJCQkJCXJldHVybiBiYXNlTmFtZTsKCQkJCX0KCQkJfQoJCX0KCQlILmluZm8oJ1NlYXJjaCAlcywgZm91bmQgbm90aGluZy4nLCBrZXkpOwoJCXJldHVybiBudWxsOwoJfSwKCgkvKioKCSAqIOiou+WGiuS4i+i8ieS6i+S7tgoJICogQHJldHVybiB7W3R5cGVdfSBbZGVzY3JpcHRpb25dCgkgKi8KCXJlZ1BsYXllcjogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKEguc2NyaXB0TmFtZSwgZnVuY3Rpb24oZSkgewoJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoKCQkJc2VsZi5saW5rRG93bmxvYWQuYXR0cih7CgkJCQlocmVmOiBILnVyaShzb25nT2JqLnNvbmdfdXJsIHx8IHNlbGYuZ2V0VXJpKEpTT04ucGFyc2Uoc29uZ09iai5zb25nKSksIHNvbmdPYmoubmFtZSArICIgWyIgKyBzb25nT2JqLmFydGlzdCArICJdLm1wMyIpLAoJCQkJdGl0bGU6ICfkuIvovb06ICcgKyBzb25nT2JqLm5hbWUKCQkJfSk7CgkJfSk7Cgl9LAoKCXJhbmRvbUNETjogZnVuY3Rpb24gKCkgewoJCXZhciBpcCA9IHRoaXMuY2RuX2lwLnNoaWZ0KCk7CgkJdGhpcy5jZG5faXAucHVzaChpcCk7CgkJcmV0dXJuIGlwOwoJfSwKCgl1cGRhdGVDRE46IGZ1bmN0aW9uIChjZG4pIHsKCQlpZiAoIWNkbikgY2RuID0gdGhpcy5yYW5kb21DRE4oKTsKCgkJaWYgKHRoaXMuY2hhbmdlQ0ROKQoJCQl0aGlzLmNoYW5nZUNETi5hdHRyKCd0aXRsZScsICfmm7TmjaIgQ0ROIFvlvZPliY06ICcgKyBjZG4gKyAnXSA9PiDliIfmrYzlkI7nlJ/mlYgnKTsKCgkJLy8g6YCa55+l5omA5pyJ5qCH562+6aG15pu05o2iIENETgoJCXRoaXMud3NfY2RuX21lZGlhID0gY2RuOwoJCWxvY2FsU3RvcmFnZS53c19jZG5fbWVkaWEgPSBjZG47CgkJR01fc2V0VmFsdWUoJ193c19jZG5fbWVkaWEnLCBjZG4pOwoKCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChILnNjcmlwdE5hbWUgKyAnLWNkbicsIHsKCQkJZGV0YWlsOiBjZG4KCQl9KSk7Cgl9LAoKCWhvb2tQbGF5ZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCWV4cG9ydEZ1bmN0aW9uKGZ1bmN0aW9uIChvYmopIHsKCQkJcmV0dXJuIHNlbGYuZ2V0VXJpKG9iaik7CgkJfSwgdW5zYWZlV2luZG93LCB7CgkJCWRlZmluZUFzOiAnX19qeF9nZXRTb25nVXJsJwoJCX0pOwoKCQkvLyDku47mkq3mlL7lmaggSG9vayDmlLnkuLrov5znq68gSG9vawoJCS8vIOWboOS4uueOsOWcqOavj+asoeaSreaUvumDveS8muivt+axguS4gOasoee9kee7nAoJCUgud2FpdFVudGlsKCduZWouaicsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIGhvb2tOYW1lID0gc2VsZi5zZWFyY2hGdW5jdGlvbih1bnNhZmVXaW5kb3cubmVqLmosICduZWouaicsICcucmVwbGFjZSgiYXBpIiwid2VhcGknKTsKCQkJdmFyIGhvb2tRdWV1ZVVwZGF0ZSA9IHNlbGYuc2VhcmNoRnVuY3Rpb24odW5zYWZlV2luZG93Lm5tLncucFAucHJvdG90eXBlLCAnbm0udy5wUC5wcm90b3R5cGUnLCAvcmV0dXJuIHRoaXNcLlx3K1xbdGhpc1wuXHcrXF0vKTsKCQkJc2VsZi5mbHVzaExvZ1RhYmxlKCk7CgoJCQl2YXIgY3VycmVudENETjsKCQkJaWYgKEguY29uZmlnLmJJbnRlcm5hdGlvbmFsICYmICFILmNvbmZpZy5iUHJveHlJbnN0YWxsZWQpIHsKCQkJCS8vIOaPkOWPluS/neWtmOeahCBDRE4KCQkJCXZhciBjaGFuZ2VDRE4gPSAkKCc8YT4nKS5hZGRDbGFzcygnanhfYnRuIGp4X2NkbicpLmluc2VydEFmdGVyKHNlbGYubGlua0Rvd25sb2FkKS50ZXh0KCfmjaInKTsKCQkJCXNlbGYuY2hhbmdlQ0ROID0gY2hhbmdlQ0ROOwoJCQkJY2hhbmdlQ0ROLmNsaWNrKGZ1bmN0aW9uICgpIHsKCQkJCQlzZWxmLnVwZGF0ZUNETigpOwoJCQkJfSk7CgoJCQkJY3VycmVudENETiA9IEdNX2dldFZhbHVlKCdfd3NfY2RuX21lZGlhJywgc2VsZi5yYW5kb21DRE4oKSk7CgkJCQlpZiAoIUguY29udGFpbnMoc2VsZi5jZG5faXAsIGN1cnJlbnRDRE4pKSB7CgkJCQkJY3VycmVudENETiA9IHNlbGYucmFuZG9tQ0ROKCk7CgkJCQl9CgkJCQlzZWxmLnVwZGF0ZUNETihjdXJyZW50Q0ROKTsKCgkJCQkvLyDmmoLml7bpmpDol48KCQkJCS8vIHNlbGYubGlua0Rvd25sb2FkLmhpZGUoKTsKCQkJfQoKCgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24oCgkJCQlzY3JpcHROYW1lLCBob29rTmFtZSwgaG9va1F1ZXVlVXBkYXRlLCBiSW50ZXJuYXRpb25hbCwKCQkJCWNkbl9pcCwgYlByb3h5SW5zdGFsbGVkLCBfX01QM19CTEFOSywKCQkJCWJVc2VUaHJpZE9uRmFpbAoJCQkpIHsKCQkJCXZhciBRVUVVRV9LRVkgPSAidHJhY2stcXVldWUtY2FjaGUiOwoJCQkJdmFyIENETl9LRVkgICA9ICdfd3NfY2RuX21lZGlhJzsKCgkJCQkvLyDlu7rnq4vnvJPlrZgKCQkJCXZhciBfY2FjaGUgPSB7fTsKCgkJCQkvKioKCQkJCSAqIOmHjei9vee8k+WtmO+8jOmYsuatoueUqOaIt+W8gOWQr+S4pOS4quagh+etvumhteWvvOiHtOabsuebrue8k+WtmOS4jeWQjOatpeOAggoJCQkJICovCgkJCQlmdW5jdGlvbiByZWxvYWRDYWNoZSAoKSB7CgkJCQkJdHJ5IHsKCQkJCQkJX2NhY2hlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbUVVFVUVfS0VZXSk7CgkJCQkJfSBjYXRjaCAoZXJyKSB7CgkJCQkJCWxvY2FsU3RvcmFnZVtRVUVVRV9LRVldID0gJ3t9JzsKCQkJCQl9CgkJCQl9CgoJCQkJLyoqCgkJCQkgKiDlgqjlrZjnvJPlrZjoh7MgbG9jYWxTdG9yYWdlCgkJCQkgKi8KCQkJCWZ1bmN0aW9uIHNhdmVDYWNoZSAoKSB7CgkJCQkJbG9jYWxTdG9yYWdlW1FVRVVFX0tFWV0gPSBKU09OLnN0cmluZ2lmeShfY2FjaGUpOwoJCQkJfQoKCQkJCS8vIOebkeWQrOe8k+WtmOOAgUNETiDlkIzmraXkuovku7YKCQkJCXZhciBfbmVlZF9yZWxvYWQgPSB0cnVlOwoJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBmdW5jdGlvbiAoZSkgewoJCQkJCXN3aXRjaCAoZS5rZXkpIHsKCQkJCQkJY2FzZSBRVUVVRV9LRVk6CgkJCQkJCQlfbmVlZF9yZWxvYWQgPSB0cnVlOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIENETl9LRVk6CgkJCQkJCQljZG5faXAgPSBsb2NhbFN0b3JhZ2VbQ0ROX0tFWV07CgkJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9LCBmYWxzZSk7CgoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihzY3JpcHROYW1lICsgJy1jZG4nLCBmdW5jdGlvbihlKSB7CgkJCQkJY2RuX2lwID0gZS5kZXRhaWw7CgkJCQl9KTsKCgkJCQlmdW5jdGlvbiBjaGVja0FuZFJlbG9hZCAoKSB7CgkJCQkJaWYgKF9uZWVkX3JlbG9hZCkKCQkJCQkJcmVsb2FkQ2FjaGUoKTsKCQkJCX0KCgkJCQkvKioKCQkJCSAqIOWFi+mahuS4gOS7veWvueixoQoJCQkJICogQHBhcmFtICB7T2JqZWN0fSBvYmog5a+56LGhCgkJCQkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICDlhYvpmoblkI7nmoTlr7nosaEKCQkJCSAqLwoJCQkJZnVuY3Rpb24gcmVidWlsZF9vYmplY3QgKG9iaikgewoJCQkJCXJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIGdlbmVyYXRlU2NyaXB0UHJvdG9jb2wgKHNvbmdPYmopIHsKCQkJCQlyZXR1cm4gewoJCQkJCQlhcnRpc3Q6IChzb25nT2JqLmFydGlzdHMgfHwgc29uZ09iai5hcikubWFwKGZ1bmN0aW9uKGFydGlzdCkgewoJCQkJCQkJcmV0dXJuIGFydGlzdC5uYW1lOwoJCQkJCQl9KS5qb2luKCfjgIEnKSwKCQkJCQkJbmFtZTogc29uZ09iai5uYW1lLAoJCQkJCQlzb25nOiBKU09OLnN0cmluZ2lmeShzb25nT2JqKQoJCQkJCX07CgkJCQl9CgoJCQkJLyoqCgkJCQkgKiDlsIbmm7Lnm67lhajpg6jovazmjaLkuLrpu4TmmJPmkq3mlL7lmajog73or4bliKvnmoTmoLzlvI/jgIIKCQkJCSAqIEBwYXJhbSAge0FycmF5fSBzb25ncyDmm7Lnm67liJfooagKCQkJCSAqIEByZXR1cm4ge09iamVjdH0gICAgICDmtYHph4/mqKHmi58KCQkJCSAqLwoJCQkJZnVuY3Rpb24gc29uZ3NfdG9fZGF0YSAoc29uZ3MpIHsKCQkJCQl2YXIgc29uZ09iaiA9IHNvbmdzWzBdOwoKCQkJCQl2YXIgZXZlU29uZ09iaiA9IGdlbmVyYXRlU2NyaXB0UHJvdG9jb2woc29uZ09iaik7CgoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUsIHsKCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJfSkpOwoKCQkJCQlyZXR1cm4gewoJCQkJCQljb2RlOiAyMDAsCgkJCQkJCWRhdGE6IHNvbmdzLm1hcChmdW5jdGlvbiAoc29uZykgewoJCQkJCQkJdmFyIHNvbmdfb2JqID0gcmVidWlsZF9vYmplY3Qoc29uZyk7CgkJCQkJCQlpZiAoc29uZ19vYmoubXAzVXJsKSB7CgkJCQkJCQkJaWYgKGJJbnRlcm5hdGlvbmFsKSB7CgkJCQkJCQkJCXNvbmdfb2JqLm1wM1VybCA9IHNvbmdfb2JqLm1wM1VybC5yZXBsYWNlKCdodHRwOi8vJywgJ2h0dHA6Ly8xMjcuMC4wLjE6NDAwMy8nKTsKCQkJCQkJCQl9CgkJCQkJCQkJc29uZ19vYmoudXJsID0gc29uZ19vYmoubXAzVXJsOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlzb25nX29iai51cmwgPSBfX2p4X2dldFNvbmdVcmwoc29uZ19vYmopOwoJCQkJCQkJfQoJCQkJCQkJc29uZ19vYmouZXhwaSA9IDFlMTM7CgkJCQkJCQlyZXR1cm4gc29uZ19vYmo7CgkJCQkJCX0pLAoJCQkJCQlfcmF3OiBzb25ncwoJCQkJCX07CgkJCQl9CgoJCQkJdmFyIGFqYXggPSBuZWoualtob29rTmFtZV07CgkJCQlmdW5jdGlvbiBhamF4UGF0Y2hNYWlubGFuZCAodXJsLCBwYXJhbXMpIHsKCQkJCQlpZiAoLTEgIT09IHVybC5pbmRleE9mKCdsb2cvJykpIHsKCQkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJCQlwYXJhbXMub25sb2FkKHsgY29kZTogMjAwIH0pOwoJCQkJCQl9LCAxMDApOwoJCQkJCQlyZXR1cm4gOwoJCQkJCX0KCgkJCQkJaWYgKHVybCA9PSAnL2FwaS9zb25nL2VuaGFuY2UvcGxheWVyL3VybCcpIHsKCQkJCQkJdXJsID0gJy9hcGkvdjMvc29uZy9kZXRhaWwnOwoKCQkJCQkJaWYgKHBhcmFtcy5xdWVyeS5icikKCQkJCQkJCWRlbGV0ZSBwYXJhbXMucXVlcnkuYnI7CgoJCQkJCQkvLyDmo4Dmn6XnvJPlrZgsIOWHj+Wwkea1gemHjwoJCQkJCQl2YXIgX2lkcyA9IEpTT04ucGFyc2UocGFyYW1zLnF1ZXJ5Lmlkcyk7CgkJCQkJCXZhciBfcmVxX2lkcyA9IFtdOwoJCQkJCQljaGVja0FuZFJlbG9hZCgpOwoJCQkJCQlfaWRzID0gX2lkcy5tYXAoZnVuY3Rpb24gKGlkKSB7CgkJCQkJCQlpZiAoaWQgaW4gX2NhY2hlKSB7CgkJCQkJCQkJcmV0dXJuIF9jYWNoZVtpZF07CgkJCQkJCQl9CgoJCQkJCQkJX3JlcV9pZHMucHVzaChpZCk7CgkJCQkJCQlyZXR1cm4gaWQ7CgkJCQkJCX0pOwoKCQkJCQkJaWYgKF9yZXFfaWRzLmxlbmd0aCA9PT0gMCkgewoJCQkJCQkJLy8g55u05o6l6L+U5Zue5oiR5Lus55qE57yT5a2Y5pWw5o2uCgkJCQkJCQljb25zb2xlLmluZm8oJ1slc11bSU5GT10gTG9hZCBmcm9tIGNhY2hlOiAnLCBzY3JpcHROYW1lLCBwYXJhbXMucXVlcnkuaWRzKTsKCQkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCl7CgkJCQkJCQkJcGFyYW1zLm9ubG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQkJfSwgMSwgc29uZ3NfdG9fZGF0YShfaWRzKSk7CgkJCQkJCQlyZXR1cm4gOwoJCQkJCQl9CgoJCQkJCQkvLyDnvLrlsJHmlbDmja4sIOivt+axguacjeWKoeWZqAoJCQkJCQljb25zb2xlLmluZm8oJ1slc11bSU5GT10gUmVxdWVzdCBmcm9tIHNlcnZlcjogJywgc2NyaXB0TmFtZSwgX3JlcV9pZHMpOwoKCQkJCQkJLy8gdjMgYXBpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gX3JlcV9pZHMubWFwKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgaWQ6IGlkIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YV9zdHIgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jID0gZGF0YV9zdHI7CgkJCQkJCXBhcmFtcy5xdWVyeSA9IGRhdGE7CgoJCQkJCQkvLyDmioogb25sb2FkIOe8k+WtmOaIkeS7rOeahOWHveaVsO+8jOaWueS+v+e8k+WtmOOAggoJCQkJCQl2YXIgX29ubG9hZCA9IHBhcmFtcy5vbmxvYWQ7CgkJCQkJCXBhcmFtcy5vbmxvYWQgPSBmdW5jdGlvbiAoZGF0YSkgewoJCQkJCQkJLy8g6aaW5YWI6YeN5paw5Yqg6L2957yT5a2YLCDpmLLmraLlhrLnqoEKCQkJCQkJCWNoZWNrQW5kUmVsb2FkKCk7CgoJCQkJCQkJLy8g5ou85o6l5pWw5o2u6Iez57yT5a2YCgkJCQkJCQlkYXRhLnNvbmdzLmZvckVhY2goZnVuY3Rpb24gKHNvbmcpIHsKCQkJCQkJCQl2YXIgaSA9IF9pZHMuaW5kZXhPZihzb25nLmlkKTsKCgkJCQkJCQkJaWYgKGkgPT0gLTEpIHsgZGVidWdnZXI7IC8vIGkg5LiN5b6X5bCP5LqOIDAgIQoJCQkJCQkJCQl0aHJvdyBuZXcgRXJyb3IoJ+WPluW+l+e0ouW8leWksei0peOAgicpOwoJCQkJCQkJCX0KCgkJCQkJCQkJX2lkc1tpXSA9IHNvbmc7CgkJCQkJCQkJX2NhY2hlW3NvbmcuaWRdID0gc29uZzsKCQkJCQkJCX0pOwoKCQkJCQkJCS8vIOWCqOWtmAoJCQkJCQkJc2F2ZUNhY2hlKCk7CgoJCQkJCQkJc2V0VGltZW91dChfb25sb2FkLCAxLCBzb25nc190b19kYXRhKF9pZHMpKTsKCQkJCQkJfTsKCQkJCQl9CgoJCQkJCXJldHVybiBhamF4KHVybCwgcGFyYW1zKTsKCQkJCX0KCgkJCQkvLyDlvLrliLbliLfmlrDmkq3mlL7lmagKCQkJCS8vIOeUqOS6juino+aekOS4i+i9vSAvIOa1t+WkluWkhOeQhuOAggoJCQkJZnVuY3Rpb24gbmV4dFNvbmcgKCkgewoJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ueHQnKS5jbGljaygpOwoJCQkJfQoJCQkJbmV4dFNvbmcoKTsKCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcnYnKS5jbGljaygpOwoJCQkJfSwgMzAwKTsKCgkJCQl2YXIgc29uZ0luZm8gPSB7fTsKCQkJCXZhciBicl9saXN0ID0gWzEyODAwMCwgOTYwMDAsIDE5MjAwMCwgMzIwMDAwXTsKCgkJCQlmdW5jdGlvbiBhamF4UGF0Y2hJbnRlcm5hdGlvbmFsICh1cmwsIHBhcmFtcywgdHJ5X2JyKSB7CgkJCQkJdmFyIF9ub25jZSA9IHNvbmdJbmZvLl9ub25jZTsKCgkJCQkJaWYgKC0xICE9PSB1cmwuaW5kZXhPZignbG9nLycpKSB7CgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCQkJcGFyYW1zLm9ubG9hZCh7IGNvZGU6IDIwMCB9KTsKCQkJCQkJfSwgMTAwKTsKCQkJCQkJcmV0dXJuIDsKCQkJCQl9CgoJCQkJCWlmICh1cmwgPT0gJy9hcGkvc29uZy9lbmhhbmNlL3BsYXllci91cmwnKSB7CgkJCQkJCXZhciBzZWxmID0gdGhpczsKCgkJCQkJCWlmICghcGFyYW1zLmhlYWRlcnMpCgkJCQkJCQlwYXJhbXMuaGVhZGVycyA9IHt9OwoKCQkJCQkJcGFyYW1zLmhlYWRlcnNbJ1gtUmVhbC1JUCddID0gJzExOC44OC44OC44OCc7CgoJCQkJCQl2YXIgX29ubG9hZCA9IHBhcmFtcy5vbmxvYWQ7CgkJCQkJCXBhcmFtcy5vbmxvYWQgPSBmdW5jdGlvbiAoZGF0YSkgewoJCQkJCQkJaWYgKGRhdGEuZGF0YVswXS51cmwpIHsKCQkJCQkJCQlvblBhcnNlU3VjY2VzcyhkYXRhLmRhdGFbMF0udXJsKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8g6Kej5p6Q5LiN5Yiw6Z+z5LmQLCDlubbkuJTkuI3lnKjph43or5XpmLbmrrU6CgkJCQkJCQkJLy8g5bCd6K+V5L2/55So56ys5LiJ5pa55pCc5q2MCgkJCQkJCQkJaWYgKGJVc2VUaHJpZE9uRmFpbCAmJiAhdHJ5X2JyKSB7CgkJCQkJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUgKyAnLU5FLVNQWScsIHsKCQkJCQkJCQkJCWRldGFpbDogSlNPTi5zdHJpbmdpZnkoewoJCQkJCQkJCQkJCWlkOiBKU09OLnBhcnNlKHBhcmFtcy5xdWVyeS5pZHMpWzBdLAoJCQkJCQkJCQkJCWNhbGxiYWNrOiBnZW5lcmF0ZUNhbGxiYWNrKG9uUmVjdlNweURhdGEpCgkJCQkJCQkJCQl9KQoJCQkJCQkJCQl9KSk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJLy8g6Kej5p6Q5LiN5Yiw6Z+z5LmQOiDoh6rliqjkuIvkuIDpppYKCQkJCQkJCQkJZmFpbFRyeU5leHQoKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgoJCQkJCQkJcmV0dXJuIDsKCQkJCQkJfTsKCQkJCQl9CgoJCQkJCXJldHVybiBhamF4KHVybCwgcGFyYW1zKTsKCgkJCQkJZnVuY3Rpb24gZ2VuZXJhdGVDYWxsYmFjayAoY2IpIHsKCQkJCQkJdmFyIG5hbWUgPSAnX2NiXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkuc2xpY2UoMykgKyAnXycgKyBEYXRlLm5vdygpOwoJCQkJCQl3aW5kb3dbbmFtZV0gPSBmdW5jdGlvbiAoKSB7CgkJCQkJCQl2YXIgciA9IGNiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCQlkZWxldGUgd2luZG93W25hbWVdOwoJCQkJCQkJcmV0dXJuIHI7CgkJCQkJCX07CgkJCQkJCXJldHVybiBuYW1lOwoJCQkJCX0KCgkJCQkJZnVuY3Rpb24gb25QYXJzZVN1Y2Nlc3MgKHVybCkgewoJCQkJCQkvLyDlt7Lnu4/mmK/liKvnmoTmrYzmm7LlnKjop6PmnpDkuK3kuoYhCgkJCQkJCWlmIChfbm9uY2UgIT0gc29uZ0luZm8uX25vbmNlKSByZXR1cm4gOwoKCQkJCQkJLy8gbTEwIOWfn+WQjeeahOmfs+S5kOaWh+S7tuWPr+S7pemAmui/h+WJjee9riBjZG4gaXAg57uV6L+HLgoJCQkJCQl2YXIgc29uZ191cmwgPSB1cmw7CgkJCQkJCWlmICgvbVxkK1wubXVzaWNcLjEyNlwubmV0Ly50ZXN0KHNvbmdfdXJsKSkgewoJCQkJCQkJc29uZ191cmwgPSBzb25nX3VybC5yZXBsYWNlKCdodHRwOi8vJywgJ2h0dHA6Ly8nICsgY2RuX2lwICsgJy8nKTsKCQkJCQkJfQoKCgkJCQkJCS8vIOaehOW7uuS4i+i9veS/oeaBrwoJCQkJCQl2YXIgX2luZm8gPSByZWJ1aWxkX29iamVjdChzb25nSW5mbyk7CgkJCQkJCXZhciBldmVTb25nT2JqID0gZ2VuZXJhdGVTY3JpcHRQcm90b2NvbChfaW5mbyk7CgkJCQkJCWV2ZVNvbmdPYmouc29uZ191cmwgPSBzb25nX3VybDsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoc2NyaXB0TmFtZSwgewoJCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJCX0pKTsKCgkJCQkJCXJldHVybiBfb25sb2FkKHsKCQkJCQkJCWRhdGE6IFt7CgkJCQkJCQkJaWQ6IHNvbmdJbmZvLmlkLAoJCQkJCQkJCXVybDogc29uZ191cmwsCgkJCQkJCQkJYnI6IDE5MjAwMCwKCQkJCQkJCQlzaXplOiAwLAoJCQkJCQkJCW1kNTogbnVsbCwKCQkJCQkJCQljb2RlOiAyMDAsCgkJCQkJCQkJZXhwaTogMTIwMCwKCQkJCQkJCQl0eXBlOiAnbXAzJywKCQkJCQkJCQlnYWluOiAwLAoJCQkJCQkJCWZlZTogMCwKCQkJCQkJCQl1ZjogbnVsbCwKCQkJCQkJCQlwYXllZDogMCwKCQkJCQkJCQljYW5FeHRlbmQ6IGZhbHNlCgkJCQkJCQl9XSwKCQkJCQkJCWNvZGU6IDIwMAoJCQkJCQl9KTsKCQkJCQl9CgoJCQkJCWZ1bmN0aW9uIGZhaWxUcnlOZXh0ICgpIHsKCQkJCQkJY29uc29sZS53YXJuKCdbJXNdIOi9veWFpemfs+S5kOaVsOaNruWksei0pSwg5YeG5aSH5LitLi4nLCBzY3JpcHROYW1lKTsKCgkJCQkJCWlmICghdHJ5X2JyKSB7CgkJCQkJCQl0cnlfYnIgPSBwYXJzZUludChwYXJhbXMucXVlcnkuYnIpOwoJCQkJCQl9CgoJCQkJCQl2YXIgaSA9IGJyX2xpc3QuaW5kZXhPZih0cnlfYnIpICsgMTsKCQkJCQkJaWYgKGkgPCBicl9saXN0Lmxlbmd0aCkgewoJCQkJCQkJY29uc29sZS5pbmZvICgnWyVzXSDlsJ3or5XnoIHnjocgJWRrYnBzJywgc2NyaXB0TmFtZSwgYnJfbGlzdFtpXSAvIDEwMDApOwoJCQkJCQkJcGFyYW1zLm9ubG9hZCA9IF9vbmxvYWQ7CgkJCQkJCQlhamF4UGF0Y2hJbnRlcm5hdGlvbmFsKHVybCwgcGFyYW1zLCBicl9saXN0W2ldKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWNvbnNvbGUuaW5mbyAoJ1slc10g5pS+5byDLCDot7Poh7PkuIvkuIDpppYnLCBzY3JpcHROYW1lKTsKCQkJCQkJCW5leHRTb25nKCk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWZ1bmN0aW9uIG9uUmVjdlNweURhdGEgKHVybCkgewoJCQkJCQlpZiAoIXVybCkgewoJCQkJCQkJY29uc29sZS5pbmZvKCfpgJrov4fnrKzkuInmlrnojrflj5bpn7PkuZDlnLDlnYDlpLHotKUsIOatjOabsuS4jeWPr+eUqC4nKTsKCQkJCQkJCWZhaWxUcnlOZXh0KCk7CgkJCQkJCQlyZXR1cm4gOwoJCQkJCQl9CgoJCQkJCQlvblBhcnNlU3VjY2Vzcyh1cmwpOwoJCQkJCX0KCQkJCX0KCgkJCQl2YXIgcHVyZUludGVybmF0aW9uYWwgPSBiSW50ZXJuYXRpb25hbCAmJiAhYlByb3h5SW5zdGFsbGVkOwoJCQkJbmVqLmpbaG9va05hbWVdID0gcHVyZUludGVybmF0aW9uYWwgPyBhamF4UGF0Y2hJbnRlcm5hdGlvbmFsIDogYWpheFBhdGNoTWFpbmxhbmQ7CgkJCQlpZiAocHVyZUludGVybmF0aW9uYWwpIHsKCQkJCQl2YXIgX3F1ZXVlVXBkYXRlID0gbm0udy5wUC5wcm90b3R5cGVbaG9va1F1ZXVlVXBkYXRlXTsKCQkJCQlubS53LnBQLnByb3RvdHlwZVtob29rUXVldWVVcGRhdGVdID0gZnVuY3Rpb24gKCkgewoJCQkJCQl2YXIgciA9IF9xdWV1ZVVwZGF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQlzb25nSW5mbyA9IHJlYnVpbGRfb2JqZWN0KHIpOwoJCQkJCQlzb25nSW5mby5fbm9uY2UgPSBNYXRoLnJhbmRvbSgpOwoJCQkJCQlyZXR1cm4gcjsKCQkJCQl9OwoJCQkJfQoKCQkJfSwKCQkJCUguc2NyaXB0TmFtZSwgaG9va05hbWUsIGhvb2tRdWV1ZVVwZGF0ZSwgSC5jb25maWcuYkludGVybmF0aW9uYWwsIAoJCQkJY3VycmVudENETiwgSC5jb25maWcuYlByb3h5SW5zdGFsbGVkLCBzZWxmLl9fTVAzX0JMQU5LLAoJCQkJSC5jb25maWcuYlVzZVRocmlkT25GYWlsCgkJCSk7CgkJfSk7Cgl9LAoKCS8qKgoJICog5aSW6ZO+5pKt5pS+5Zmo6JmV55CGCgkgKi8KCWhvb2tQbGF5ZXJPdXRjaGFpbjogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlILndhaXRVbnRpbCgnbm0ubS5EbScsIGZ1bmN0aW9uKCkgewoJCQlzZWxmLmxpbmtEb3dubG9hZCA9ICQoJzxhPicpCgkJCQkuaW5zZXJ0QmVmb3JlKCcub3ByQm94ID4gLmJnLm9wZW4nKQoJCQkJLmFkZENsYXNzKCdiZyBuZXh0JykKCQkJCS5jc3MoewoJCQkJCXRyYW5zZm9ybTogJ3JvdGF0ZSg5MGRlZyknLAoJCQkJCXBvc2l0aW9uOiAnYWJzb2x1dGUnLAoJCQkJCXJpZ2h0OiAnMjFweCcsCgkJCQkJdG9wOiAnM3B4JywKCQkJCQlvcGFjaXR5OiAwLjYKCQkJCX0pOwoKCQkJLy8g5bCL5om+5rOo5YWl5Ye95pW4CgkJCXZhciBmblBsYXlBdEluZGV4ID0gc2VsZi5zZWFyY2hGdW5jdGlvbih1bnNhZmVXaW5kb3cubm0ubS5EbS5wcm90b3R5cGUsCgkJCQknbm0ubS5EbS5wcm90b3R5cGUnLCAnLm1wM1VybCk7Jyk7CgkJCXNlbGYuZmx1c2hMb2dUYWJsZSgpOwoKCQkJaWYgKCFmblBsYXlBdEluZGV4KQoJCQkJcmV0dXJuIDsKCgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24oc2NyaXB0TmFtZSwgZm5QbGF5QXRJbmRleCwgYkludGVybmF0aW9uYWwsIGJQcm94eUluc3RhbGxlZCwgY2RuX2lwLCBjc3NUaXRsZSwgY3NzU3VidGl0bGUpIHsKCQkJCXZhciBDRE5fS0VZID0gJ193c19jZG5fbWVkaWEnOwoJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBmdW5jdGlvbiAoZSkgewoJCQkJCXN3aXRjaCAoZS5rZXkpIHsKCQkJCQkJY2FzZSBDRE5fS0VZOgoJCQkJCQkJY2RuX2lwID0gbG9jYWxTdG9yYWdlW0NETl9LRVldOwoJCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfSwgZmFsc2UpOwoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihzY3JpcHROYW1lICsgJy1jZG4nLCBmdW5jdGlvbihlKSB7CgkJCQkJY2RuX2lwID0gZS5kZXRhaWw7CgkJCQl9KTsKCgkJCQlmdW5jdGlvbiBpbnNlcnRBZnRlcihuZXdOb2RlLCByZWYpIHsKCQkJCQlyZWYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3Tm9kZSwgcmVmLm5leHRTaWJsaW5nKTsKCQkJCX0KCgkJCQl2YXIgc3ViVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzbWFsbCcpOwoJCQkJdmFyIHBhZ2VUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpOwoJCQkJaWYgKHBhZ2VUaXRsZSkgewoJCQkJCWluc2VydEFmdGVyKHN1YlRpdGxlLCBwYWdlVGl0bGUpOwoJCQkJCXBhZ2VUaXRsZS5zdHlsZS5jc3NUZXh0ID0gY3NzVGl0bGU7CgkJCQkJc3ViVGl0bGUuc3R5bGUuY3NzVGV4dCA9IGNzc1N1YnRpdGxlOwoJCQkJfQoKCgkJCQl2YXIgX2Jha1BsYXllclVwZGF0ZVVJID0gbm0ubS5EbS5wcm90b3R5cGVbZm5QbGF5QXRJbmRleF07CgoJCQkJdmFyIG0gPSBfYmFrUGxheWVyVXBkYXRlVUkudG9TdHJpbmcoKS5tYXRjaCgvPXRoaXMuKFx3KylcWy8pOwoJCQkJaWYgKCFtKSByZXR1cm4gOwoKCQkJCXZhciB0cmFja3MgPSBtWzFdOwoJCQkJbm0ubS5EbS5wcm90b3R5cGVbZm5QbGF5QXRJbmRleF0gPSBmdW5jdGlvbihzb25nSW5kZXgpIHsKCQkJCQl2YXIgaSA9IHBhcnNlSW50KHNvbmdJbmRleCkgfHwgMDsKCQkJCQl2YXIgbGVuID0gdGhpc1t0cmFja3NdLmxlbmd0aDsKCQkJCQlpZiAoaSA+PSBsZW4pIHsKCQkJCQkJaSA9IDA7CgkJCQkJfSBlbHNlIGlmIChpIDwgMCkgewoJCQkJCQlpID0gbGVuIC0gMTsKCQkJCQl9CgoJCQkJCXZhciB0cmFjayA9IHRoaXNbdHJhY2tzXVtpXTsKCQkJCQl0cmFjay5mZWUgPSB0cmFjay5zdGF0dXMgPSAwOwoKCQkJCQlzdWJUaXRsZS50ZXh0Q29udGVudCA9ICdcdTI1YjYgJyArIHRyYWNrLm5hbWU7CgkJCQkJc3ViVGl0bGUudGl0bGUgPSB0cmFjay5uYW1lOwoKCQkJCQkvLyDlnIvpmpvnlKjmiLbovYnmj5vlnLDlnYAKCQkJCQlpZiAoYkludGVybmF0aW9uYWwpIHsKCQkJCQkJaWYgKGJQcm94eUluc3RhbGxlZCkgewoJCQkJCQkJdHJhY2subXAzVXJsID0gdHJhY2subXAzVXJsLnJlcGxhY2UoJ2h0dHA6Ly8nLCAnaHR0cDovLzEyNy4wLjAuMTo0MDAzLycpOwoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXZhciBzb25nX3VybCA9IHRyYWNrLm1wM1VybDsKCQkJCQkJCWlmICgvbVxkK1wubXVzaWNcLjEyNlwubmV0Ly50ZXN0KHNvbmdfdXJsKSkgewoJCQkJCQkJCXNvbmdfdXJsID0gc29uZ191cmwucmVwbGFjZSgnaHR0cDovLycsICdodHRwOi8vJyArIGNkbl9pcCArICcvJyk7CgkJCQkJCQl9CgkJCQkJCQl0cmFjay5tcDNVcmwgPSBzb25nX3VybDsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJdmFyIGV2ZVNvbmdPYmogPSB7CgkJCQkJCWFydGlzdDogKHRyYWNrLmFydGlzdHMgfHwgdHJhY2suYXIpLm1hcChmdW5jdGlvbihhcnRpc3QpIHsKCQkJCQkJCXJldHVybiBhcnRpc3QubmFtZTsKCQkJCQkJfSkuam9pbign44CBJyksCgkJCQkJCW5hbWU6IHRyYWNrLm5hbWUsCgkJCQkJCXNvbmc6IEpTT04uc3RyaW5naWZ5KHRyYWNrKQoJCQkJCX07CgoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUsIHsKCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJfSkpOwoKCQkJCQlyZXR1cm4gX2Jha1BsYXllclVwZGF0ZVVJLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQkJCgkJCX0sIEguc2NyaXB0TmFtZSwgZm5QbGF5QXRJbmRleCwgSC5jb25maWcuYkludGVybmF0aW9uYWwsIEguY29uZmlnLmJQcm94eUluc3RhbGxlZCwgc2VsZi5jZG5faXAsIEguZXh0cmFjdChmdW5jdGlvbiAoKSB7LyoKCQkJCXBhZGRpbmctdG9wOiAuMmVtOwoJCQkJb3ZlcmZsb3c6IGhpZGRlbjsKCQkJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJCQl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQkJKi99KSwgSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsvKgoJCQkJcGFkZGluZy1sZWZ0OiAuNXJlbTsKCQkJCWNvbG9yOiAjYWFhOwoJCQkJZGlzcGxheTogYmxvY2s7CgkJCQltYXJnaW4tdG9wOiAtMC41cmVtOwoJCQkJb3ZlcmZsb3c6IGhpZGRlbjsKCQkJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJCQl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQkJKi99KSk7CgkJfSk7Cgl9LAoKCWhvb2tQbGF5ZXJGbTogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlILndhaXRVbnRpbCgnbm0ubS5mTycsIGZ1bmN0aW9uKCkgewoJCQl2YXIgaG9vayA9IHNlbGYuc2VhcmNoRnVuY3Rpb24oCgkJCQl1bnNhZmVXaW5kb3cubm0ubS5mTy5wcm90b3R5cGUsICdubS5tLmZPOjonLCAnLm1wM1VybCx0cnVlJyk7CgkJCXNlbGYuZmx1c2hMb2dUYWJsZSgpOwoKCQkJc2VsZi5saW5rRG93bmxvYWQgPSAkKCc8YT4nKQoJCQkJLnByZXBlbmRUbygnLm9wdHMuZi1jYj4uZi1mcicpCgkJCQkuYWRkQ2xhc3MoJ2ljb24gaWNvbi1uZXh0JykKCQkJCS5odG1sKCcmbmJzcDsnKQoJCQkJLmNzcygndHJhbnNmb3JtJywgJ3JvdGF0ZSg5MGRlZyknKTsKCQkJCgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24oc2NyaXB0TmFtZSwgaG9vaykgewoJCQkJdmFyIF9iYWtQbGF5U29uZyA9IG5tLm0uZk8ucHJvdG90eXBlW2hvb2tdOwoKCQkJCW5tLm0uZk8ucHJvdG90eXBlW2hvb2tdID0gZnVuY3Rpb24oc29uZ09iaikgewoJCQkJCXZhciBldmVTb25nT2JqID0gewoJCQkJCQlhcnRpc3Q6IChzb25nT2JqLmFydGlzdHMgfHwgc29uZ09iai5hcikubWFwKGZ1bmN0aW9uKGFydGlzdCkgewoJCQkJCQkJcmV0dXJuIGFydGlzdC5uYW1lOwoJCQkJCQl9KS5qb2luKCfjgIEnKSwKCQkJCQkJbmFtZTogc29uZ09iai5uYW1lLAoJCQkJCQlzb25nOiBKU09OLnN0cmluZ2lmeShzb25nT2JqKQoJCQkJCX07CgoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUsIHsKCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJfSkpOwoKCQkJCQlyZXR1cm4gX2Jha1BsYXlTb25nLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQl9LCBILnNjcmlwdE5hbWUsIGhvb2spOwoJCX0pOwoJfSwKCgkvLyDmnI3liqHlmaggMSB+IDg7IOS9huaYr+iyjOS8vCAxIH4gMiDnmoTmnIDnqLPlrpoKCWdldFVyaTogZnVuY3Rpb24oc29uZykgewoJCXZhciBkc2ZJZDsKCQl2YXIgcSA9IChzb25nLmggfHwgc29uZy5oTXVzaWMgfHwgc29uZy5tIHx8IHNvbmcubU11c2ljIHx8IHNvbmcubCB8fCBzb25nLmxNdXNpYyB8fCBzb25nLmEgfHwgc29uZy5hTXVzaWMpOwoJCWlmIChxKSBkc2ZJZCA9IHEuZmlkIHx8IHEuZHNmSWQ7CgkJaWYgKCFkc2ZJZCkgewoJCQljb25zb2xlLmluZm8oJ+atjOabsiAlc1slZF0g5bey5LiL5p6277yM5peg5rOV6I635Y+W6Z+z5LmQ5Zyw5Z2AIScsIHNvbmcubmFtZSwgc29uZy5pZCk7CgkJCXJldHVybiB0aGlzLl9fTVAzX0JMQU5LOwoJCX0KCQl2YXIgcmFuZFNlcnZlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTsKCgoJCXZhciBjZG5QcmVmaXggPSAnJzsKCQl2YXIgY2RuU2VydmVyID0gJ20nOwoJCWlmIChILmNvbmZpZy5iSW50ZXJuYXRpb25hbCkgewoJCQlpZiAoSC5jb25maWcuYlByb3h5SW5zdGFsbGVkKSB7CgkJCQljZG5QcmVmaXggPSAnMTI3LjAuMC4xOjQwMDMvJzsKCQkJfSBlbHNlIHsKCQkJCWNkblByZWZpeCA9IHRoaXMud3NfY2RuX21lZGlhICsgJy8nOwoJCQkJY2RuU2VydmVyID0gJ3AnOwoJCQl9CgkJfQoKCQlyZXR1cm4gImh0dHA6Ly8iICsgY2RuUHJlZml4ICsgY2RuU2VydmVyICsgcmFuZFNlcnZlciArICIubXVzaWMuMTI2Lm5ldC8iICsgKHRoaXMuZGZzSGFzaChkc2ZJZCkpICsgIi8iICsgZHNmSWQgKyAiLm1wMyI7Cgl9LAoKCS8qKgoJICog5bCL5om+IERGUyDlk4jluIwKCSAqIEBwYXJhbSAge0ludGVnZXJ9IGRmc2lkICAg5ZOI5biM5YC8CgkgKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgICAgIOino+aekOWQjueahOWFp+WuueeahOWAvAoJICovCglkZnNIYXNoOiBmdW5jdGlvbihkZnNpZCkgewoJCWZ1bmN0aW9uIHN0clRvS2V5Q29kZXMgKHN0cikgewoJCQlyZXR1cm4gU3RyaW5nKHN0cikuc3BsaXQoJycpLm1hcChmdW5jdGlvbihlKSB7CgkJCQlyZXR1cm4gZS5jaGFyQ29kZUF0KCk7CgkJCX0pOwoJCX0KCgkJLy8g6L+Y5Y6fOgoJCS8vIGFyci5tYXAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZSkgfSkuam9pbignJyk7CgkJLy8g5LiN6IO955u05o6l5LygIFN0cmluZy5mcm9tQ2hhckNvZGUgISEg5Y+C5pWwMiDnmoQgaW5kZXgg5Lya546p5Z2P6L+U5Zue5YC8CgkJCgkJdmFyIGtleXMgPSBbCgkJCTUxLCAxMDMsIDExMSwgNTYsIDM4LCAzNiwKCQkJNTYsIDQyLCA1MSwgNDIsIDUxLCAxMDQsCgkJCTQ4LCAxMDcsIDQwLCA1MCwgNDEsIDUwCgkJXTsKCgkJdmFyIGZpZHMgPSBzdHJUb0tleUNvZGVzKGRmc2lkKS5tYXAoZnVuY3Rpb24oZmlkLCBpKSB7CgkJCXJldHVybiAoZmlkIF4ga2V5c1tpICUga2V5cy5sZW5ndGhdKSAmIDB4RkY7CgkJfSk7CgoJCXJldHVybiBDcnlwdG9KUwoJCQkJCQkuTUQ1KENyeXB0b0pTLmxpYi5CeXRlQXJyYXkoZmlkcykpCgkJCQkJCS50b1N0cmluZyhDcnlwdG9KUy5lbmMuQmFzZTY0KQoJCQkJCQkucmVwbGFjZSgvXC8vZywgIl8iKQoJCQkJCQkucmVwbGFjZSgvXCsvZywgIi0iKTsKCX0sCgoJZW5jX2FqYXg6IGZ1bmN0aW9uICh1cmwsIHJlcU9iaiwgY2IpIHsKCQl2YXIgX2Nyc2YgPSB1bnNhZmVXaW5kb3cuTkVKX0NPTkYucF9jc3JmLnBhcmFtOwoJCXZhciBfdG9rZW4gPSBkb2N1bWVudC5jb29raWUubWF0Y2gobmV3IFJlZ0V4cCh1bnNhZmVXaW5kb3cuTkVKX0NPTkYucF9jc3JmLmNvb2tpZSArICc9KFxcdyspJykpWzFdOwoJCXJlcU9ialtfY3JzZl0gPSBfdG9rZW47CgoJCS8vIOaehOW7uiB1cmwKCQl1cmwgKz0gdXJsLmluZGV4T2YoJz8nKSA9PT0gLTEgPyAnPycgOiAnJic7CgkJdXJsICs9IF9jcnNmICsgJz0nICsgX3Rva2VuOwoKCQl2YXIgZW5jcnlwdGVkRGF0YSA9IHVuc2FmZVdpbmRvdy5hc3JzZWEoSlNPTi5zdHJpbmdpZnkocmVxT2JqKSwgIjAxMDAwMSIsIjAwZTBiNTA5ZjYyNTlkZjg2NDJkYmMzNTY2MjkwMTQ3N2RmMjI2NzdlYzE1MmI1ZmY2OGFjZTYxNWJiN2I3MjUxNTJiM2FiMTdhODc2YWVhOGE1YWE3NmQyZTQxNzYyOWVjNGVlMzQxZjU2MTM1ZmNjZjY5NTI4MDEwNGUwMzEyZWNiZGE5MjU1N2M5Mzg3MDExNGFmNmM5ZDA1YzRmN2YwYzM2ODViN2E0NmJlZTI1NTkzMjU3NWNjZTEwYjQyNGQ4MTNjZmU0ODc1ZDNlODIwNDdiOTdkZGVmNTI3NDFkNTQ2YjhlMjg5ZGM2OTM1YjNlY2UwNDYyZGIwYTIyYjhlNyIsICIwQ29KVW02UXl3OFc4anVkIik7CgkJdmFyIHBvc3REYXRhID0gewoJCQlwYXJhbXM6IGVuY3J5cHRlZERhdGEuZW5jVGV4dCwKCQkJZW5jU2VjS2V5OiBlbmNyeXB0ZWREYXRhLmVuY1NlY0tleQoJCX07CgoJCXZhciBhamF4ID0gJC5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCW1ldGhvZDogJ1BPU1QnLAoJCQlkYXRhOiBwb3N0RGF0YSwKCQkJZGF0YVR5cGU6ICdqc29uJwoJCX0pOwoKCQlpZiAoY2IpIGFqYXguZG9uZShjYik7CgoJCXJldHVybiBhamF4OwoJfSwKCglmZXRjaFNvbmc6IGZ1bmN0aW9uIChpZHMsIGNiKSB7CgkJcmV0dXJuIHRoaXMuZW5jX2FqYXgoJy93ZWFwaS9zb25nL2RldGFpbC8nLCB7CgkJCWlkczogaWRzCgkJfSwgY2IpOwoJfSwKCglnZXRNdklkOiBmdW5jdGlvbiAoc29uZ0lkLCBjYikgewoJCXZhciBfY2FjaGU7CgkJdHJ5IHsKCQkJX2NhY2hlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UubXZfY2FoY2UpOwoJCX0gY2F0Y2ggKGUpIHsKCQkJX2NhY2hlID0ge307CgkJfQoKCQlpZiAoc29uZ0lkIGluIF9jYWNoZSkgewoJCQljYihfY2FjaGVbc29uZ0lkXSk7CgkJCXJldHVybiA7CgkJfQoKCQl0aGlzLmZldGNoU29uZyhbJF9HRVQuaWRdLCBmdW5jdGlvbiAoZGF0YSkgewoJCQlpZiAoZGF0YS5jb2RlID09IDIwMCkgewoJCQkJdmFyIG12aWQgPSBfY2FjaGVbc29uZ0lkXSA9IGRhdGEuc29uZ3NbMF0ubXZpZDsKCQkJCWxvY2FsU3RvcmFnZS5tdl9jYWhjZSA9IEpTT04uc3RyaW5naWZ5KF9jYWNoZSk7CgkJCQljYihtdmlkKTsKCQkJfQoJCX0pOwoJfSwKCglwYXJzZU12OiBmdW5jdGlvbiAoKSB7CgkJdmFyICRmbGFzaEJveCA9ICQoJyNmbGFzaF9ib3gnKTsKCQlpZiAoJGZsYXNoQm94Lmxlbmd0aCkgewoJCQl2YXIgaHRtbCA9ICRmbGFzaEJveC5odG1sKCk7CgkJCXZhciBwYXJhbXMgPSBILnBhcnNlUXVlcnlTdHJpbmcoaHRtbC5tYXRjaCgvZmxhc2h2YXJzPSIoW1xzXFNdKz8pIi8pWzFdLnJlcGxhY2UoLyZhbXA7L2csICcmJykpOwoKCQkJdmFyIHEgPSB7CgkJCQlodXJsOiAn6auY5riFJywKCQkJCW11cmw6ICfmoIfmuIUnLAoJCQkJbHVybDogJ+a4o+eUu+i0qCcKCQkJfTsKCgkJCXZhciAkZGxIb2xkZXIgPSAkKCc8cD4nKS5jc3MoewoJCQkJdGV4dEFsaWduOiAncmlnaHQnCgkJCX0pLnRleHQoJ01WIOS4i+i9vTogJykuaW5zZXJ0QWZ0ZXIoJGZsYXNoQm94KTsKCQkJT2JqZWN0LmtleXMocSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CgkJCQlpZiAocGFyYW1zW2tleV0pIHsKCQkJCQl2YXIgJGRsID0gJCgnPGE+JykuYXR0cih7CgkJCQkJCWhyZWY6IEgudXJpKHBhcmFtc1trZXldLCBILnNwcmludGYoJyVzWyVzTVZdLm1wNCcsIHBhcmFtcy50cmFja05hbWUsIHFba2V5XSkpLAoJCQkJCQl0aXRsZTogSC5zcHJpbnRmKCfkuIvovb0gJXMg55qEICVzIE12JywgcGFyYW1zLnRyYWNrTmFtZSwgcVtrZXldKQoJCQkJCX0pLnByb3AoJ2Rvd25sb2FkJywgdHJ1ZSkudGV4dChxW2tleV0pOwoKCQkJCQkvLyDkv67mraMgMTYzIOiHquW3seeahOi3s+i9rC4KCQkJCQlILmNhcHR1cmVBcmlhKCRkbCk7CgkJCQkJJGRsSG9sZGVyLmFwcGVuZCgkZGwpOwoJCQkJCSRkbEhvbGRlci5hcHBlbmQoJyB8ICcpOwoJCQkJfQoJCQl9KTsKCQkJJGRsSG9sZGVyLmFwcGVuZChILnNwcmludGYgKCfmj5Dkvps6ICVzICVzICcsIEguc2NyaXB0TmFtZSwgSC52ZXJzaW9uKSk7CgoJCQlpZiAoSC5jb25maWcuYkludGVybmF0aW9uYWwpIHsKCQkJCSRmbGFzaEJveC5odG1sKGh0bWwucmVwbGFjZSgvcmVzdHJpY3Q9dHJ1ZS9nLCAncmVzdHJpY3Q9JykpOwoKCQkJCS8vIOiHquWKqOWFs+mXreW8ueWHuueahOaPkOekuuahhgoJCQkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIHQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgkJCQkJCXZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3pjbHMnKVswXTsKCQkJCQkJaWYgKGVsKSB7CgkJCQkJCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnbW91c2Vkb3duJykpOwoJCQkJCQkJY2xlYXJJbnRlcnZhbCh0KTsKCQkJCQkJfQoJCQkJCX0sIDEwMCk7CgkJCQl9KTsKCQkJfQoJCX0KCX0sCgoJZW5hYmxlU29uZ1BsYXlCdXR0b246IGZ1bmN0aW9uICgpIHsKCQl2YXIgZW5hYmxlUGxheUJ1dHRvbk9uU29uZ1BhZ2UgPSBmdW5jdGlvbigpIHsKCQkgIC8vIFRyeSB0byBmaW5kIGEgbm9ybWFsIGJ1dHRvbi4gSWYgaXQgY291bGQgYmUgZm91bmQsIGRvIG5vdGhpbmcuCgkJICB2YXIgcGxheUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3UtYnRuaS1hZGRwbHknKTsKCQkJaWYgKHBsYXlCdXR0b24ubGVuZ3RoID09IDEpIHsKCQkJCXdpbmRvdy5jbGVhckludGVydmFsKGVuYWJsZVBsYXlCdXR0b25JbnRlcnZhbCk7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIE90aGVyd2lzZSBpdCBzaG91bGQgYmUgYSBkaXNhYmxlZCBidXR0b24uCgkJCXBsYXlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd1LWJ0bmktcGxheS1kaXMnKTsKCQkJaWYgKHBsYXlCdXR0b24ubGVuZ3RoID09IDEpIHsKCQkJCXdpbmRvdy5jbGVhckludGVydmFsKGVuYWJsZVBsYXlCdXR0b25JbnRlcnZhbCk7CgkJCQl2YXIgc29uZ0lkID0gJCgnI2NvbnRlbnQtb3BlcmF0aW9uJykuZGF0YSgncmlkJyk7CgkJCQlwbGF5QnV0dG9uWzBdLm91dGVySFRNTCA9ICc8YSBkYXRhLXJlcy1hY3Rpb249InBsYXkiIGRhdGEtcmVzLWlkPSIjU09OR0lEIyIgZGF0YS1yZXMtdHlwZT0iMTgiIGhyZWY9ImphdmFzY3JpcHQ6OyIgY2xhc3M9InUtYnRuMiB1LWJ0bjItMiB1LWJ0bmktYWRkcGx5IGYtZmwiIGhpZGVmb2N1cz0idHJ1ZSIgdGl0bGU9IuaSreaUviI+PGk+PGVtIGNsYXNzPSJwbHkiPjwvZW0+5pKt5pS+PC9pPjwvYT48YSBkYXRhLXJlcy1hY3Rpb249ImFkZHRvIiBkYXRhLXJlcy1pZD0iI1NPTkdJRCMiIGRhdGEtcmVzLXR5cGU9IjE4IiBocmVmPSJqYXZhc2NyaXB0OjsiIGNsYXNzPSJ1LWJ0bmkgdS1idG5pLWFkZCIgaGlkZWZvY3VzPSJ0cnVlIiB0aXRsZT0i5re75Yqg5Yiw5pKt5pS+5YiX6KGoIj48L2E+Jy5yZXBsYWNlKC8jU09OR0lEIy9nLCBzb25nSWQpOwoJCQl9CgkJfTsKCQl2YXIgZW5hYmxlUGxheUJ1dHRvbkludGVydmFsID0gd2luZG93LnNldEludGVydmFsKGVuYWJsZVBsYXlCdXR0b25PblNvbmdQYWdlLCAxMDAwKTsKCX0sCgoJZW5hYmxlUGxheWxpc3RQbGF5QnV0dG9uOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGVuYWJsZVBsYXlCdXR0b25PblBsYXlsaXN0UGFnZSA9IGZ1bmN0aW9uKCkgewoJCQkvLyBGaW5kIG91dCBkaXNhYmxlZCBzb25ncy4KCQkJdmFyIGRpc2FibGVkU29uZ3NJblBsYXlsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnanMtZGlzJyk7CgkJCWlmIChkaXNhYmxlZFNvbmdzSW5QbGF5bGlzdC5sZW5ndGggPT09IDApewoJCQkJd2luZG93LmNsZWFySW50ZXJ2YWwoZW5hYmxlUGxheUJ1dHRvbkludGVydmFsKTsKCQkJfQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRpc2FibGVkU29uZ3NJblBsYXlsaXN0Lmxlbmd0aDsgKXsKCQkJCWRpc2FibGVkU29uZ3NJblBsYXlsaXN0W2ldLmNsYXNzTmFtZSA9IGRpc2FibGVkU29uZ3NJblBsYXlsaXN0W2ldLmNsYXNzTmFtZS5yZXBsYWNlKCdqcy1kaXMnLCAnJyk7CgkJCX0KCQl9OwoJCXZhciBlbmFibGVQbGF5QnV0dG9uSW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZW5hYmxlUGxheUJ1dHRvbk9uUGxheWxpc3RQYWdlLCAxMDAwKTsKCX0sCgoJb25Cb2R5RnJhbWU6IGZ1bmN0aW9uICgpIHsKCQlzd2l0Y2gobG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKVsxXSkgewoJCQljYXNlICdtdic6IAkJCS8vIE1WCgkJCQl0aGlzLnBhcnNlTXYoKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnb3V0Y2hhaW4nOiAJLy8g5aSW6ZO+CgkJCQl0aGlzLmhvb2tQbGF5ZXJPdXRjaGFpbigpOwoJCQkJYnJlYWs7CgoJCQljYXNlICdzb25nJzogCQkvLyDljZXmm7IKCQkJCXRoaXMuZW5hYmxlU29uZ1BsYXlCdXR0b24oKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnYWxidW0nOiAJCS8vIOS4k+i+kQoJCQljYXNlICdhcnRpc3QnOiAJCS8vIOiJuuacr+WutgoJCQljYXNlICdwbGF5bGlzdCc6IAkvLyDmkq3mlL7liJfooagKCQkJY2FzZSAnZGlzY292ZXInOiAJLy8g6aaW6aG1CgkJCQl0aGlzLmVuYWJsZVBsYXlsaXN0UGxheUJ1dHRvbigpOwoJCQkJYnJlYWs7CgkJfQoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQl0aGlzLl9kb1JlbW92YWwoKTsKCQl1bnNhZmVXaW5kb3cuR0Ficm9hZCA9IGZhbHNlOwoKCQkvLyDkuI3lnKjmoYbmnrbln7fooYwKCQlpZiAoSC5pc0ZyYW1lKSB7CgkJCXRoaXMub25Cb2R5RnJhbWUoKTsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5saW5rRG93bmxvYWQgPSAkKCc8YT4nKS5hcHBlbmRUbygkKCcubS1wbGF5YmFyIC5vcGVyJykpLmF0dHIoewoJCQl0aXRsZTogJ+aSreaUvumfs+S5kCwg5Y2z5Yi76Kej5p6QJwoJCX0pLmNsaWNrKGZ1bmN0aW9uKGUpIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9KS5hZGRDbGFzcyhILmRlZmF1bHREbEljb24pLmFkZENsYXNzKCdqeF9idG4nKTsKCgkJdGhpcy5saW5rRG93bmxvYWRBbGwgPSAkKCc8YT4nKS5hZGRDbGFzcyhILmRlZmF1bHREbEljb24pLmFkZENsYXNzKCdhZGRhbGwnKS50ZXh0KCflhajpg6jkuIvovb0nKS5hdHRyKHsKCQkJdGl0bGU6ICfkuIvovb3liJfooajph4znmoTmiYDmnInmrYzmm7InCgkJfSkuY2xpY2soZnVuY3Rpb24oZSkgewoJCQllLnN0b3BQcm9wYWdhdGlvbigpOwoKCQkJdmFyIHRyYWNrUXVldWUgPSBsb2NhbFN0b3JhZ2VbJ3RyYWNrLXF1ZXVlJ107CgkJCXZhciBhcmlhMiA9IG5ldyBBcmlhMi5CQVRDSChILmFyaWEyLCBmdW5jdGlvbigpIHsKCQkJCXJldHVybiBILmluZm8oYXJndW1lbnRzKTsKCQkJfSk7CgoJCQl2YXIgdHJhY2tzID0gSlNPTi5wYXJzZSh0cmFja1F1ZXVlKTsKCQkJdmFyIHBhZHMgPSB+fk1hdGgubG9nMTAodHJhY2tzLmxlbmd0aCk7CgoJCQl0cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2ssIGkpIHsKCQkJCXZhciBhcnRpc3RzID0gKHRyYWNrLmFydGlzdHMgfHwgdHJhY2suYXIpLm1hcChnZXROYW1lKS5qb2luKCfjgIEnKTsKCgkJCQl2YXIgcGFyYW0gPSBILmJ1aWxkQXJpYVBhcmFtKHsKCQkJCQlvdXQ6IHBhZFplcm8oaSkgKyAiLiAiICsgdHJhY2submFtZSArICIgWyIgKyBhcnRpc3RzICsgIl0ubXAzIgoJCQkJfSk7CgoJCQkJYXJpYTIuYWRkKEFyaWEyLmZuLmFkZFVyaSwgW3NlbGYuZ2V0VXJpKHRyYWNrKV0sIHBhcmFtKTsKCQkJfSk7CgkJCWFyaWEyLnNlbmQodHJ1ZSk7CgoJCQlmdW5jdGlvbiBnZXROYW1lICh4KSB7CgkJCQlyZXR1cm4geC5uYW1lOwoJCQl9CgoJCQlmdW5jdGlvbiBwYWRaZXJvIChzdHIpIHsKCQkJCWZvciAodmFyIGkgPSBzdHIubGVuZ3RoOyBpIDwgcGFkczsgaSsrKSB7CgkJCQkJc3RyID0gJzAnICsgc3RyOwoJCQkJfQoKCQkJCXJldHVybiBzdHI7CgkJCX0KCQl9KS5oaWRlKCk7CgoJCS8vIOaaguaXtuemgeeUqOaJuemHj+S4i+i9veWKn+iDveOAggoKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT09IDIvKiBVUklfVVNFX0FSSUEgKi8pIHsKCQkJSC5jYXB0dXJlQXJpYSh0aGlzLmxpbmtEb3dubG9hZCk7CgkJfSBlbHNlIHsKCQkJdGhpcy5saW5rRG93bmxvYWRBbGwuYWRkQ2xhc3MoJ2p4X2hpZGUnKTsKCQl9CgoJCXN3aXRjaCAobG9jYXRpb24ucGF0aG5hbWUpIHsKCQkJY2FzZSAnL2RlbW8vZm0nOgoJCQkJdGhpcy5ob29rUGxheWVyRm0oKTsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCUgud2FpdFVudGlsKGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiAkKCcubGlzdGhkYyA+IC5hZGRhbGwnKS5sZW5ndGg7CgkJCQl9LCBmdW5jdGlvbigpIHsKCQkJCQlzZWxmLmxpbmtEb3dubG9hZEFsbC5pbnNlcnRCZWZvcmUoJCgnLm0tcGxheWJhciAubGlzdGhkYyAuYWRkYWxsJykpLmFmdGVyKCQoJzxhPicpLmFkZENsYXNzKCdsaW5lIGp4X2RsX2xpbmUnKSk7CgkJCQl9LCB0cnVlLCA1MDApOwoJCQkJdGhpcy5ob29rUGxheWVyKCk7CgkJfQoKCQkvLyDmjqfliLblj7DmiafooYw6IGxvY2FsU3RvcmFnZS5fUExFQVNFX0FVVE9fU0lHTiA9IDEKCQkvLyDljbPlj6/lkK/nlKjoh6rliqjnrb7liLDlip/og70gKOS4jeS8muiuoeeul+aXtuW3rikgOkQKCQlpZihsb2NhbFN0b3JhZ2UuX1BMRUFTRV9BVVRPX1NJR04pCgkJCXNldFRpbWVvdXQodGhpcy5hdXRvX3NpZ24uYmluZCh0aGlzKSwgMzAwMCk7CgoJCS8vIOaOp+WItuWPsOaJp+ihjDogbG9jYWxTdG9yYWdlLl9fSElERV9CQU5ORVIgPSAxCgkJLy8g5Y2z5Y+v56e76Zmk6aaW6aG15qiq5bmF5LiO5a6i5oi356uv5YWl5Y+j6ZO+5o6lIDpECgkJaWYgKGxvY2FsU3RvcmFnZS5fX0hJREVfQkFOTkVSKSB7CgkJCXZhciAkbHN0ID0gJCgnLm0tbmF2ID4gLmxzdCcpOwoJCQkkbHN0LnByZXYoKS5hZGRDbGFzcygnbHN0Jyk7CgkJCSRsc3QucmVtb3ZlKCk7CgkJfQoJfSwKCglhdXRvX3NpZ246IGZ1bmN0aW9uICgpIHsKCQl2YXIgZCA9IG5ldyBEYXRlKCk7CgkJdmFyIGRhdGVfc3RyID0gZC5nZXRGdWxsWWVhcigpICsgJy8nICsgZC5nZXRNb250aCgpICsgJy8nICsgZC5nZXREYXkoKTsKCQlpZiAobG9jYWxTdG9yYWdlLl9fU0lHTl9EQVRFICE9IGRhdGVfc3RyKSB7CgkJCWxvY2FsU3RvcmFnZS5fX1NJR05fREFURSA9IGRhdGVfc3RyOwoKCQkJdGhpcy5lbmNfYWpheCgnL2FwaS9wb2ludC9kYWlseVRhc2s/dHlwZT0xJywgeyAgfSwgZnVuY3Rpb24gKHIpIHsKCQkJCWlmIChyLmNvZGUgPT0gMjAwKSB7CgkJCQkJSC5pbmZvKCfnrb7liLDmiJDlip86IOiOt+W+lyAlYyVkJWMg54K556ev5YiGLicsICdjb2xvcjpibHVlJywgci5wb2ludCwgJ2NvbG9yOmluaXRpYWwnKTsKCQkJCX0gZWxzZSB7CgkJCQkJSC5pbmZvKCfnrb7liLDlpLHotKUgKCVjJWQlYyk6ICVzJywgJ2NvbG9yOmJsdWUnLCByLmNvZGUsICdjb2xvcjppbml0aWFsJywgci5tc2cpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIG11c2ljLjF0aW5nLmpzICovCnsKCWlkOiAnbXVzaWMuMXRpbmcnLAoJbmFtZTogJ+S4gOWQrOmfs+S5kCcsCglob3N0OiBbJ3d3dy4xdGluZy5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCXBhdGg6IFsnL3BsYXllci8nLCAnL2FsYnVtXyddLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXRoaXMuZGxCdG4gPSAkKCcuc29uZ2FjdCBhLmRvd24nKQoJCQkudGV4dCAoJ+ebtOaOpeS4i+i9vScpCgkJCS5yZW1vdmVBdHRyKCdvbmNsaWNrJyk7CgoJCUgud2FpdFVudGlsICgneWl0aW5nLnBsYXllci5lbnRpdHkuc3JjJywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVFeGVjIChmdW5jdGlvbiAoKSB7CgkJCQl2YXIgcGxheVRyaWdnZXIgPSBmdW5jdGlvbiAoKSB7CgkJCQkJLy8gZGxCdG4uYXR0cignaHJlZicsIHdpbmRvdy55aXRpbmcucGxheWVyLmVudGl0eS5zcmMpOwoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQgKCBuZXcgQ3VzdG9tRXZlbnQgKEguc2NyaXB0TmFtZSkgKTsKCQkJCX07CgoJCQkJd2luZG93LnlpdGluZy5wbGF5ZXIuaG9vaygncGxheScsIHBsYXlUcmlnZ2VyKTsKCQkJCXBsYXlUcmlnZ2VyICgpOwoJCQl9KTsKCQl9KTsKCgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoSC5zY3JpcHROYW1lLCB0aGlzLmV2ZW50SGFuZGxlci5iaW5kICh0aGlzKSwgZmFsc2UpOwoJCXRoaXMuZXZlbnRIYW5kbGVyICgpOwoJfSwKCglldmVudEhhbmRsZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc29uZ1RpdGxlID0gJCgnLnNvbmcgLnNvbmd0aXRsZSA+IGEnKS50ZXh0ICgpOwoJCXRoaXMuZGxCdG4uYXR0ciAoewoJCQlocmVmOiBILnVyaSAodW5zYWZlV2luZG93LnlpdGluZy5wbGF5ZXIuZW50aXR5LnNyYywgc29uZ1RpdGxlICsgJy5tcDMnKSwKCQkJdGl0bGU6ICfkuIvovb06ICcgKyBzb25nVGl0bGUKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy41NjU2NTYuanMgKi8KewoJaWQ6ICdtdXNpYy41NjU2NTYnLAoJbmFtZTogJzU2NTY1NiDpn7PkuZAnLAoJaG9zdDogJ3d3dy41NjU2NTYuY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCXBhdGg6IFsnL3BsdXMvcGxheWVyLmFzaHgnLCAnL3RpbmcvJ10sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCUgualBsYXllclBhdGNoZXIgKGZ1bmN0aW9uIChzb25nT2JqKSB7CgkJCXZhciBzb25nQWRkciA9IHNvbmdPYmoubXAzIHx8IHNvbmdPYmoubTRhOwoJCQkkKCcucGxheS1pbmZvLW90aGVyb3B0ID4gYTpsYXN0JykKCQkJCS5hdHRyKCdocmVmJywgSC51cmkgKHNvbmdBZGRyLCBzb25nT2JqLnNvbmduYW1lICsgc29uZ09iai5tNGEuc2xpY2UoLTQpKSkKCQkJCS5maW5kKCdzcGFuJykudGV4dCgn5LiL6L29OiAnICsgc29uZ09iai5zb25nbmFtZSArICcgLSAnICsgc29uZ09iai5zaW5nZXJuYW1lKTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy41c2luZy5qcyAqLwp7CglpZDogJ211c2ljLjVzaW5nJywKCW5hbWU6ICc1c2luZyDkuIvovb3op6PmnpAnLAoJaG9zdDogWyc1c2luZy5jb20nLCAnNXNpbmcua3Vnb3UuY29tJ10sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCWlmIChILmJlZ2luV2l0aChsb2NhdGlvbi5wYXRobmFtZSwgJy9mbS8nKSkgewoJCQkvLyBlLmcuIGh0dHA6Ly81c2luZy5rdWdvdS5jb20vZm0vbS8KCQkJdGhpcy5fZm1Ib29rICgpOwoJCX0KCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguY29udGFpbnMobG9jYXRpb24ucGF0aG5hbWUsICcvZG93bi8nKSkgewoJCQl0aGlzLl9kbFBhZ2UgKCk7CgkJCXJldHVybiA7CgkJfQoKCQkvLyDml6fniYjljZXmm7Lmkq3mlL7pobXpnaIKCQlILndhaXRVbnRpbCAoJ3BhZ2VPcHRpb25zLnRpY2tldCcsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIHNvbmdPYmogPSBKU09OLnBhcnNlKEguYmFzZTY0RGVjb2RlKHVuc2FmZVdpbmRvdy5wYWdlT3B0aW9ucy50aWNrZXQpKTsKCQkJJCgnLmZ1bmNfaWNvbjM+YScpLmF0dHIgKHsKCQkJCWhyZWY6IEgudXJpKHNvbmdPYmouZmlsZSwgc29uZ09iai5zb25nTmFtZSArICcubXAzJyksCgkJCQl0aXRsZTogJ+WNleWHu+S4i+i9vTogJyArIHNvbmdPYmouc29uZ05hbWUsCgkJCX0pLmh0bWwoJzxiLz7nm7Tpk77kuIvovb0nKTsKCgkJCSQoJyNwbGF5JykuY3NzICh7CgkJCQl0b3A6ICdpbml0aWFsJwoJCQl9KTsKCQkJJCgnLnNvbmdfcGxheScpLmNzcyAoewoJCQkJbWFyZ2luVG9wOiAnMWVtJwoJCQl9KTsKCQkJJCgnLnJ0MicpLmhpZGUoKTsKCQkJJCgnI3JlcG9ydCcpLnBhcmVudCgpLmhpZGUoKTsKCQl9KTsKCgkJLy8g5paw54mI5Y2V5puy5pKt5pS+6aG16Z2iCgkJSC53YWl0VW50aWwgKCdnbG9iYWxzLnRpY2tldCcsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIHNvbmdPYmogPSBKU09OLnBhcnNlKEguYmFzZTY0RGVjb2RlKHVuc2FmZVdpbmRvdy5nbG9iYWxzLnRpY2tldCkpOwoJCQkkKCcudmlld19pbmZvPnVsOmxhc3Q+bGk6Zmlyc3QnKS5yZXBsYWNlV2l0aCgkKCc8bGk+JykuYXBwZW5kICgKCQkJCSQoJzxhPicpLnRleHQoJ+eCueaIkeS4i+i9vScpLmF0dHIoewoJCQkJCWhyZWY6IEgudXJpKHNvbmdPYmouZmlsZSwgc29uZ09iai5zb25nTmFtZSArICcubXAzJyksCgkJCQkJdGl0bGU6ICfljZXlh7vkuIvovb06ICcgKyBzb25nT2JqLnNvbmdOYW1lLAoJCQkJCXRhcmdldDogJ19ibGFuaycKCQkJCX0pLmNzcyAoJ2NvbG9yJywgJyNGODc4NzcnKQoJCQkpKTsKCQl9KTsKCX0sCgoJX2RsUGFnZTogZnVuY3Rpb24gKCkgewoJCXZhciAkZGwgPSAkKCc8cD4nKS5wcmVwZW5kVG8gKCQoJy5zaW5nX3ZpZXcnKSkudGV4dCgn5q2j5Zyo6Kej5p6Q6Z+z5LmQ5Zyw5Z2A4oCmJyk7CgoJCSQuZ2V0KCQoJy5tYWluID4gaDEgPiBhJykuYXR0cignaHJlZicpKS5zdWNjZXNzIChmdW5jdGlvbiAocmVzKSB7CgkJCXZhciBzb25nQWRkcmVzcyA9IHJlcy5tYXRjaCgvInRpY2tldCJccyo6XHMqXCIoLis/KSIvKTsKCQkJaWYgKHNvbmdBZGRyZXNzKSB7CgkJCQl2YXIgc29uZ09iaiA9IEpTT04ucGFyc2UoSC5iYXNlNjREZWNvZGUoc29uZ0FkZHJlc3NbMV0pKTsKCQkJCXNvbmdBZGRyZXNzID0gSC51cmkoc29uZ09iai5maWxlLCBzb25nT2JqLnNvbmdOYW1lICsgJy5tcDMnKTsKCQkJfSBlbHNlIGlmIChzb25nQWRkcmVzcyA9IHJlcy5tYXRjaCgvLFxzKmZpbGVccyo6XHMqXCIoLis/KSIvKSkgewoJCQkJLy8g5p2l5rqQ6K+35rGCCgkJCQlzb25nQWRkcmVzcyA9IHNvbmdBZGRyZXNzWzFdOwoJCQl9IGVsc2UgewoJCQkJJGRsIC50ZXh0ICgnKiDkuIvovb3op6PmnpDlpLHotKXvvIzor7forr/pl67mrYzmm7LpobXop6PmnpDjgIInKQoJCQkJCS5jc3MgKCdjb2xvcicsICdyZWQnKTsKCQkJCXJldHVybiA7CgkJCX0KCgkJCSRkbC50ZXh0KCfop6PmnpDlrozmr5U6ICcpLmFwcGVuZCAoJCgnPGE+JykuYXR0cih7CgkJCQlocmVmOiBzb25nQWRkcmVzcywKCQkJCXRhcmdldDogJ19ibGFuaycKCQkJfSkudGV4dCgn54K55oiR5LiL6L29JykpOwoJCX0pLmVycm9yIChmdW5jdGlvbiAoKSB7CgkJCSRkbCAudGV4dCAoJyog572R57uc6ZSZ6K+v77yM6K+356iN5YCZ6YeN6K+V5oiW6K6/6Zeu5q2M5puy6aG16Kej5p6Q44CCJykKCQkJCS5jc3MgKCdjb2xvcicsICdyZWQnKTsKCQl9KTsKCX0sCgoJX2ZtSG9vazogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLmZtSG9va2VkKSByZXR1cm4gOwoJCXRoaXMuZm1Ib29rZWQgPSB0cnVlOwoKCQlILmhvb2tEZWZpbmUgKCdkZWZpbmUnLCBmdW5jdGlvbiAoc2NyaXB0TmFtZSwgX2RlZmluZSwgbW9kdWxlTmFtZSwgcmVxdWlyZXMsIGZDYWxsYmFjaykgewoJCQlpZiAoJ3BsYXllci9zaW5nbGUnID09PSBtb2R1bGVOYW1lKSB7CgkJCQlyZXR1cm4gX2RlZmluZSAobW9kdWxlTmFtZSwgcmVxdWlyZXMsIGZ1bmN0aW9uIChyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKCQkJCQl2YXIgcmV0ID0gZkNhbGxiYWNrLmNhbGwgKG51bGwsIHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSk7CgoJCQkJCXZhciAkd3NwID0gbW9kdWxlLmV4cG9ydHM7CgkJCQkJdmFyIE1lZGlhRWxlbWVudCA9ICR3c3AubWVkaWFFbGVtZW50OwoJCQkJCSR3c3AubWVkaWFFbGVtZW50ID0gZnVuY3Rpb24gKHBsYXllckJveElkLCBvcHRpb25zKSB7CgkJCQkJCW9wdGlvbnMuc3RhdHMuZW5hYmxlID0gZmFsc2U7CgkJCQkJCXZhciBtUGxheWVyID0gbmV3IE1lZGlhRWxlbWVudCAocGxheWVyQm94SWQsIG9wdGlvbnMpOwoJCQkJCQl2YXIgX3BsYXkgPSBtUGxheWVyLnBsYXk7CgkJCQkJCW1QbGF5ZXIucGxheSA9IGZ1bmN0aW9uIChzb25nT2JqKSB7CgkJCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50ICggbmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lLCB7ZGV0YWlsOiBzb25nT2JqfSkgKTsKCQkJCQkJCXJldHVybiBfcGxheS5jYWxsIChtUGxheWVyLCBzb25nT2JqKTsKCQkJCQkJfTsKCQkJCQkJcmV0dXJuIG1QbGF5ZXI7CgkJCQkJfTsKCQkJCQlyZXR1cm4gcmV0OwoJCQkJfSk7CgkJCX0KCQl9LCBILnNjcmlwdE5hbWUpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCXZhciBzb25nT2JqID0gZS5kZXRhaWw7CgkJCXNldFRpbWVvdXQgKGZ1bmN0aW9uICgpIHsKCQkJCSQoJy5qcC1kb3dubG9hZCcpLmF0dHIgKHsKCQkJCQlocmVmOiBILnVyaShzb25nT2JqLmZpbGUsIHNvbmdPYmouc29uZ05hbWUgKyAnLm1wMycpLAoJCQkJCXRpdGxlOiAn5LiL6L29OiAnICsgc29uZ09iai5zb25nTmFtZQoJCQkJfSk7CgkJCX0sIDEpOwoJCX0sIGZhbHNlKTsKCX0sCgp9LAovKiBDb21waWxlZCBmcm9tIG11c2ljLjlrdS5qcyAqLwp7CglpZDogJ211c2ljLjlrdScsCgluYW1lOiAnOemFt+mfs+S5kCcsCglob3N0OiAnd3d3LjlrdS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJaGlkZTogWycjTFIyJywgJyNMUjMnLCAnI3NlZWdjJywgJy5kb25nRG93biddLAoJcGF0aDogWycvcGxheS8nLCAnL3BsYXkuaHRtJ10sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuZGxMaW5rID0gJCgnPGE+JykKCQkJLmF0dHIgKCd0YXJnZXQnLCAnX2JsYW5rJykKCQkJLmF0dHIgKCd0aXRsZScsICAn5q2j5Zyo5oqT5Y+W5q2M5puy5pWw5o2uIC4uJykKCQkJLnRleHQgKCfkuIvovb0nKTsKCgkJSC5qUGxheWVyUGF0Y2hlciAoZnVuY3Rpb24gKHNvbmdPYmopIHsKCQkJdmFyIHNvbmdVcmwgID0gc29uZ09iai5tcDMgfHwgc29uZ09iai5tNGEsCgkJCQlzb25nTmFtZSA9ICQoJyNwbGF5X211c2ljbmFtZScpLnRleHQoKTsKCgkJCXRoaXMuZGxMaW5rCgkJCQkuYXR0ciAoJ2hyZWYnLCBILnVyaSAoc29uZ1VybCwgc29uZ05hbWUgKyBzb25nVXJsLnNsaWNlKC00KSkpCgkJCQkuYXR0ciAoJ3RpdGxlJywgJ+S4i+i9vTogJyArIHNvbmdOYW1lKTsKCQl9LmJpbmQgKHRoaXMpKTsKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJJCgnLnJpbmdEb3duJykuY3NzICh7CgkJCWZsb2F0OiAnbm9uZScsCgkJCWRpc3BsYXk6ICdibG9jaycsCgkJCXRleHRBbGlnbjogJ2NlbnRlcicKCQl9KS5odG1sICh0aGlzLmRsTGluayk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuYmFpZHUuanMgKi8KewoJaWQ6ICdtdXNpYy5iYWlkdScsCgluYW1lOiAn55m+5bqm6Z+z5LmQJywKCWhvc3Q6ICdtdXNpYy5iYWlkdS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJcGF0aDogL15cL3NvbmdcL1xkK1wvZG93bmxvYWQvLAoKCWhpZGU6ICcuZm9yZWlnbi10aXAnLAoJX3NldFRleHQ6IGZ1bmN0aW9uICh0ZXh0KSB7CgkJaWYgKHRleHRbMF0gPT0gJysnKSB7CgkJCXRoaXMuYnRuRG93bmxvYWQudGl0bGUuYXBwZW5kKHRleHQuc2xpY2UoMSkpOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnRuRG93bmxvYWQudGl0bGUudGV4dCh0ZXh0KTsKCQl9Cgl9LAoJX3NldExpbms6IGZ1bmN0aW9uICh1cmwpIHsKCQl0aGlzLmJ0bkRvd25sb2FkLmJ0bi5hdHRyKCdocmVmJywgdXJsKTsKCX0sCglfYnRuOiBmdW5jdGlvbiAodGV4dCwgb3V0ZXJJY29uLCBpbm5lckljb24pIHsKCQl2YXIgYnRuID0gJCgnPGE+PHNwYW4gY2xhc3M9ImlubmVyIj48aSBjbGFzcz0iaWNvbiBidG4taWNvbi0nICsgaW5uZXJJY29uICsgJyI+JykKCQkJLmFkZENsYXNzKCdidG4gYnRuLScgKyBvdXRlckljb24gKyAnIGFjdGl2ZWQnKQoJCQkuYXR0cigndGFyZ2V0JywgJ19ibGFuaycpCgkJCS5hdHRyKCdocmVmJywgJyMnKQoJCQkuYXBwZW5kVG8odGhpcy5wKTsKCgkJcmV0dXJuICh7CgkJCWJ0bjogYnRuLAoJCQl0aXRsZTogJCgnPHNwYW4+JykuYXBwZW5kVG8oJCgnLmlubmVyJywgYnRuKSkudGV4dCh0ZXh0KQoJCX0pOwoJfSwKCglfaW5pdERsOiBmdW5jdGlvbiAoZSkgewoJCXRoaXMuZG93bmxvYWRJbmZvID0gSlNPTi5wYXJzZShlLmRldGFpbCkuZG93bmxvYWRJbmZvOwoJfSwKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoSC5zY3JpcHROYW1lLCB0aGlzLl9pbml0RGwuYmluZCAodGhpcyksIGZhbHNlKTsKCgkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoc2NyaXB0TmFtZSkgewoJCQkvLyDlsY/olL3lub/lkYrlhpnlh7oKCQkJZG9jdW1lbnQud3JpdGUgPSAoZnVuY3Rpb24gd3JpdGUoKXt9KS5iaW5kKDApOwoKCQkJd2luZG93LnRpbmcgPSB7fTsKCQkJdmFyIG9yaWdJbml0RG93bmxvYWQ7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cudGluZywgJ2luaXREb3dubG9hZCcsIHsKCQkJCWdldDogZnVuY3Rpb24gKCkgewoJCQkJCXJldHVybiBmdW5jdGlvbiAoaW5pdE9wdHMpIHsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAobmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lLCB7ZGV0YWlsOiBKU09OLnN0cmluZ2lmeSAoaW5pdE9wdHMpfSkpOwoKCQkJCQkJcmV0dXJuIG9yaWdJbml0RG93bmxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJfSwKCQkJCXNldDogZnVuY3Rpb24gKGlkbCkgewoJCQkJCW9yaWdJbml0RG93bmxvYWQgPSBpZGw7CgkJCQl9CgkJCX0pOwoJCX0sIEguc2NyaXB0TmFtZSk7Cgl9LAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQl0aGlzLnBhcnNlciA9IEgucnVsZS5nZXQgKCdtdXNpYy5iYWlkdS5wbGF5Jyk7CgkJaWYgKCF0aGlzLnBhcnNlcikgewoJCQlILmVycm9yICgnUmVxdWlyZWQgcnVsZSBgbXVzaWMuYmFpZHUucGxheWAgbWlzc2luZywgcGxlYXNlIHJlLWluc3RhbGwgdGhpcyBzY3JpcHQuJyk7CgkJCXJldHVybiA7CgkJfQoKCQkvLyDluqblqJjnmoTmjInpkq7liY3pnaLmj5LlhaXmiJHku6znmoQKCQl2YXIgb3BlckRpdiA9ICQoJy5vcGVyYXRpb24nKS5wcmVwZW5kKCc8ZGl2IGNsYXNzPSJjbGVhcmZpeCI+Jyk7CgkJdGhpcy5wID0gJCgnPHA+JykucHJlcGVuZFRvKG9wZXJEaXYpLmNzcygnbWFyZ2luLWJvdHRvbScsICcyZW0nKTsKCgkJLy8g5re75Yqg5oyJ6ZKuCgkJdGhpcy5idG5Eb3dubG9hZCA9IHRoaXMuX2J0bign6K+36YCJ5oup6Z+z6LSoJywgJ2gnLCAnZG93bmxvYWQtc21hbGwnKTsKCQkvLyB0aGlzLmJ0bkV4cG9ydCA9IHRoaXMuX2J0bign5a+85Ye65Zyw5Z2AJywgJ2InLCAnZG93bmxvYWQtc21hbGwnKTsKCQl0aGlzLmJ0bkRvd25sb2FkLmJ0bi5jbGljayh0aGlzLl9jbGlja0RsLmJpbmQodGhpcykpOwoKCQkkKCcuZG93bi1yYWRpbycpLmNoYW5nZShmdW5jdGlvbiAoKSB7CgkJCXNlbGYuY2hhbmdlQml0cmF0ZSgkKHRoaXMpKTsKCQl9KS5maWx0ZXIoJzpjaGVja2VkJykuY2hhbmdlKCk7Cgl9LAoKCV9jbGlja0RsOiBmdW5jdGlvbiAoZSkgewoJCWlmICh0aGlzLmJ0bkRvd25sb2FkLmJ0bi5kYXRhICgnZG8tbm90aGluZycpKQoJCQlyZXR1cm4gOwoKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJdmFyIHNlbGYgPSB0aGlzOwoJCXZhciAkZWwgPSB0aGlzLiRlbDsKCgkJdmFyIHNpZCAgPSAkZWwuZGF0YSgnc2lkJyksCgkJCXJhdGUgPSAkZWwuZGF0YSgncmF0ZScpLAoJCQlmbXQgID0gJGVsLmRhdGEoJ2Zvcm1hdCcpOwoKCQlzZWxmLl9zZXRUZXh0ICgnKyAo5byA5aeL6Kej5p6QKScpOwoJCXZhciBmbiA9IEguc3ByaW50ZignJXMgWyVzXS4lcycsIHRoaXMuZG93bmxvYWRJbmZvLnNvbmdfdGl0bGUsIHRoaXMuZG93bmxvYWRJbmZvLnNpbmdlcl9uYW1lLCBmbXQpOwoJCXRoaXMucGFyc2VyLl9hZGRGYXYgKHNpZCwgZnVuY3Rpb24gKGVyckluZm8pIHsKCQkJdmFyIGJOZWVkUm1GYXYgPSBlcnJJbmZvLmNvZGUgPT09IDIyMDAwOwoKCQkJc2VsZi5wYXJzZXIuX2dldFJlYWxVcmwgKHNlbGYucGFyc2VyLl9idWlsZFVybChzaWQsIHJhdGUsIGZtdCksIGZ1bmN0aW9uICh1cmwpIHsKCQkJCUguYWRkRG93bmxvYWQodXJsLCBmbik7CgkJCQlzZWxmLl9zZXRMaW5rIChILnVyaSAodXJsLCBmbikpOwoJCQkJc2VsZi5fc2V0VGV4dCAoJysgKOino+aekOWujOavlSknKTsKCQkJCXNlbGYuYnRuRG93bmxvYWQuYnRuLmRhdGEoJ3BhcnNlLScgKyByYXRlLCBbdXJsLCBmbl0pOwoJCQkJaWYgKGJOZWVkUm1GYXYpIHNlbGYucGFyc2VyLl9ybUZhdiAoc2lkKTsKCgkJCQlzZWxmLmJ0bkRvd25sb2FkLmJ0bi5kYXRhICgnZG8tbm90aGluZycsIHRydWUpOwoJCQl9KTsKCQl9KTsKCX0sCgoJY2hhbmdlQml0cmF0ZTogZnVuY3Rpb24gKCRlbCkgewoJCXRoaXMuJGVsID0gJGVsOwoJCXRoaXMuX3NldFRleHQgKEguc3ByaW50Zign5LiL6L29ICglc2ticHMsICVzIOagvOW8jyknLCAkZWwuZGF0YSgncmF0ZScpLCAkZWwuZGF0YSgnZm9ybWF0JykpKTsKCQl2YXIgZGF0YVVybCA9IHRoaXMuYnRuRG93bmxvYWQuYnRuLmRhdGEgKCdwYXJzZS0nICsgJGVsLmRhdGEoJ3JhdGUnKSk7CgkJdGhpcy5idG5Eb3dubG9hZC5idG4uZGF0YSAoJ2RvLW5vdGhpbmcnLCAhIWRhdGFVcmwpOwoKCQlpZiAoZGF0YVVybCkgewoJCQl0aGlzLl9zZXRMaW5rIChkYXRhVXJsKTsKCQkJdGhpcy5fc2V0VGV4dCAoJysgKOW3suino+aekCknKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuYmFpZHUucGxheS5qcyAqLwp7CglpZDogJ211c2ljLmJhaWR1LnBsYXknLAoJbmFtZTogJ+eZvuW6pumfs+S5kOebkicsCglob3N0OiAncGxheS5iYWlkdS5jb20nLAoJcGF0aDogJy8nLAoKCXNob3c6ICcjZmxvYXRCdG4+Lmxvc3NsZXNzJywKCgkvLyBqUXVlcnkg55qEIHdpZHRoIOiuoeeul+WcqOeBq+eLkOS4i+S8muWMheaLrOagt+W8j+ihqCwg5Y2z5L2/5YWD57Sg5bey57uP5LiN5ZyoIGJvZHkg6YeM4oCmCgljc3M6ICAnLmNvbHVtbjR7d2lkdGg6MCAhaW1wb3J0YW50fScsCgoJLy8g5Y2V5puy6Kej5p6Q5Y+q5pyJ6L+Z5LqbCglxdWFsaXRpZXM6ICdhdXRvXzEgbXAzXzMyMCtfMSBtcDNfMzIwXzEnLnNwbGl0KCcgJyksCgoJLyoqCgkgKiBAcHJpdmF0ZQoJICog5Yid5aeL5YyW5LqL5Lu257uR5a6aCgkgKi8KCWluaXRFdmVudHM6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmlzQXJpYSA9IEguY29uZmlnLmRVcmlUeXBlID09IDI7CgoJCS8vIEJhdGNoIGRvd25sb2FkIHF1ZXVlCgkJSC5zZXR1cEFyaWEgKCk7CgkJdGhpcy4kcSA9IG5ldyBJbnRlcnZhbExvb3AoW10sIHRoaXMuX2JhdGNoLmJpbmQodGhpcyksIDMwMCk7CgkJdGhpcy4kcS5sb29wKCk7IC8vIOWHhuWkh+aOpeaUtuaVsOaNrgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKEguc2NyaXB0TmFtZSArICctQkFUQ0gnLCB0aGlzLl9iYXRjaERvd25sb2FkLmJpbmQgKHRoaXMpLCBmYWxzZSk7CgoJCWlmICghdGhpcy5pc0FyaWEpIHsKCQkJSC53YXJuICgn5om56YeP5LiL6L295LuF5pSv5o+0IEFyaWEyIOaooeW8jyEnKTsKCQl9CgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKEguc2NyaXB0TmFtZSwgdGhpcy5fcmVjdkV2ZW50LmJpbmQgKHRoaXMpLCBmYWxzZSk7Cgl9LAoKCS8qKgoJICog6ZSZ6K+v5pWw5o2uCgkgKiBAdHlwZSB7T2JqZWN0fQoJICovCglFUlJPUjogewoJCScyMjIzMic6IHsKCQkJdGV4dDogSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsvKgror7fmjILkuIoq5aSn6ZmGKumprOeUsiwg5Zug5YW25a6D5Zyw5Yy66K6/6Zeu6KKr5bGP6JS9LgoK5aaC5p6c5oKo5Lya5L2/55So55u45YWz5o+S5Lu2LCDor7fliqDlhaXkuIvov7DlnLDlnYDoh7Pop4TliJk6ICAKaHR0cDovL211c2ljLmJhaWR1LmNvbS9kYXRhL3VzZXIvY29sbGVjdD8qICAKCuaCqOWPr+S7peaMieS4iyBDdHJsK0Mg5ou36LSd6K+l5raI5oGvLgoK55u45YWz6ZiF6K+7OiBodHRwczovL2dpdGh1Yi5jb20vSml4dW5Nb2UvY3V3Y2w0Yy93aWtpL+mFjeWQiOWkp+mZhuS7o+eQhuWunueOsOiuv+mXruino+mZpOWwgemUgQoqL30pLAoJCQlsZXZlbDogJ2Vycm9yJywKCQkJYWxlcnQ6IHRydWUKCQl9LAoJCScyMjMyMic6IHsKCQkJdGV4dDogJ+W3sue7j+WcqOaUtuiXj+WIl+ihqCwg5LiN56e76ZmkLicsCgkJCWxldmVsOiAnaW5mbycKCQl9LAoJCScyMjMzMSc6IHsKCQkJdGV4dDogJ+S6keerr+aUtuiXj+W3sua7oSwg6K+35YWI6IW+5Ye65L2N572uIScsCgkJCWxldmVsOiAnd2FybicsCgkJCWFsZXJ0OiB0cnVlCgkJfSwKCQknMjIwMDAnOiB7CgkJCXRleHQ6ICflm6DkuIvovb3op6PmnpDogIzmt7vliqDoh7PmlLbol48sIOino+aekOWQjuenu+mZpOmTvuaOpS4nLAoJCQlsZXZlbDogJ2luZm8nCgkJfQoJfSwKCgkvKioKCSAqIOaPkOWPlumUmeivr+S/oeaBrwoJICogQHBhcmFtICB7SW50ZWdlcn0gZXJyQ29kZSDplJnor6/ku6PnoIEKCSAqIEByZXR1cm4ge09iamVjdH0gICAgICAgICAg6ZSZ6K+v5L+h5oGv6K+m57uGCgkgKi8KCWVycm9yOiBmdW5jdGlvbiAoZXJyQ29kZSkgewoJCXZhciBlcnJJbmZvID0gdGhpcy5FUlJPUltlcnJDb2RlLnRvU3RyaW5nKCldIHx8IHsKCQkJdGV4dDogJ+acquefpemUmeivrzogJyArIGVyckNvZGUsCgkJCWFsZXJ0OiB0cnVlLAoJCQlsZXZlbDogJ3dhcm4nCgkJfTsKCQllcnJJbmZvLmNvZGUgPSBwYXJzZUludChlcnJDb2RlLCAxMCk7CgoJCUhbZXJySW5mby5sZXZlbF0oZXJySW5mby50ZXh0KTsKCgkJaWYgKGVyckluZm8uYWxlcnQpCgkJCWFsZXJ0KCBlcnJJbmZvLnRleHQgKTsKCgkJcmV0dXJuIGVyckluZm87Cgl9LAoKCS8qKgoJICogQHByaXZhdGUKCSAqIOaLpuaIquaSreaUvuWZqOS4i+i9veS6i+S7tgoJICovCglob29rUGxheWVyRG93bmxvYWQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCS8vIGZtUGxheWVyVmlldyDmmK/mnIDlkI7kuIDkuKoKCQlILndhaXRVbnRpbCAoJ2ZtUGxheWVyVmlldycsIGZ1bmN0aW9uICgpIHsKCQkJdGhhdC4kZGxCdG4gPSAkKCcubWFpbi1wYW5lbCAuZG93bmxvYWQgPiBhJyk7CgoJCQl1bnNhZmVFeGVjKGZ1bmN0aW9uIChzY3JpcHROYW1lLCBob29rQmF0Y2gpIHsKCQkJCS8vIOm7hOmHkSBWSVAKCQkJCXZhciBvbGRTZXRWaXAgPSBIUS5tb2RlbC5zZXRWaXBJbmZvOwoJCQkJSFEubW9kZWwuc2V0VmlwSW5mbyA9IGZ1bmN0aW9uICggaXNWaXAsIHogKSB7CgkJCQkJaWYgKCFpc1ZpcCkgewoJCQkJCQlpc1ZpcCA9IHRydWU7CgkJCQkJfQoKCQkJCQlyZXR1cm4gb2xkU2V0VmlwLmNhbGwgKHRoaXMsIGlzVmlwLCB6KTsKCQkJCX07CgkJCQlIUS5tb2RlbC5pc0dvbGQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9OwoJCQkJSFEubW9kZWwuc2V0VmlwSW5mbyAoKTsKCgkJCQl2YXIgYmFrRXh0cmFjdFVzZXJJbmZvID0gVXNlck1vZGVsLnByb3RvdHlwZS5fZ2V0VXNlckluZm87CgkJCQlVc2VyTW9kZWwucHJvdG90eXBlLl9nZXRVc2VySW5mbyA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgciA9IGJha0V4dHJhY3RVc2VySW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCWlmICghci52aXApIHsKCQkJCQkJci52aXAgPSB7CgkJCQkJCQljbG91ZDogewoJCQkJCQkJCXNlcnZpY2VfbGV2ZWw6ICdnb2xkJwoJCQkJCQkJfQoJCQkJCQl9OwoJCQkJCX0KCQkJCQlyLmlzU2hvd1NvdXJjZUljb24gPSBmYWxzZTsKCgkJCQkJcmV0dXJuIHI7CgkJCQl9OwoKCQkJCS8vIOWxj+iUveaXpeW/l+WPkemAgSwg5Yi35bGP5aW954OmCgkJCQlsb2dDdHJsLnNlbmRMb2cgPSBmdW5jdGlvbiAoKSB7fTsKCgkJCQl2YXIgaW5zdEZsb2F0QnRuID0gbGlzdFZpZXcudGlwLmRhdGEoInVpLWZsb2F0QnV0dG9uIik7CgkJCQl2YXIgb2xkTXVzaWNEb3dubG9hZCA9IGxpc3RWaWV3LmRvd25sb2FkOwoJCQkJbGlzdFZpZXcuZG93bmxvYWQgPSBmdW5jdGlvbiAoc29uZ0luZGV4LCBpc0ZsYWMpIHsKCQkJCQkvLyDmibnph4/kuIvovb0sIOS9huaYr+S4jeaYryBBcmlhIOaooeW8j+WImeaUvuW8gwoJCQkJCWlmICghaG9va0JhdGNoICYmIHNvbmdJbmRleC5sZW5ndGggPiAxKSB7CgkJCQkJCXJldHVybiBvbGRNdXNpY0Rvd25sb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfQoJCQkJCXZhciBzb25nRGF0YSA9IGluc3RGbG9hdEJ0bi5saXN0RWxlbS5yZWVsTGlzdCgib3B0aW9uIiwgImRhdGEiKS5maWx0ZXIoZnVuY3Rpb24gKGUsIGkpIHsKCQkJCQkJcmV0dXJuIC0xICE9PSBzb25nSW5kZXguaW5kZXhPZihpKQoJCQkJCX0pLm1hcCAoZnVuY3Rpb24gKGUpIHsKCQkJCQkJcmV0dXJuIHsKCQkJCQkJCXNvbmdOYW1lOiAgIGUuc29uZ05hbWUsCgkJCQkJCQlhcnRpc3ROYW1lOiBlLmFydGlzdE5hbWUsCgkJCQkJCQlzb25nSWQ6ICAgICBlLnNvbmdJZCwKCQkJCQkJCWlzRmxhYzogICAgICEhaXNGbGFjLAoJCQkJCQkJaXNGYXY6ICAgICAgISFlLmhhc0NvbGxlY3RlZAoJCQkJCQl9OwoJCQkJCX0pOwoKCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50IChuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUgKyAnLUJBVENIJywgeyBkZXRhaWw6IEpTT04uc3RyaW5naWZ5KHNvbmdEYXRhKSB9KSk7CgkJCQl9OwoKCQkJCShmdW5jdGlvbiAoKSB7CgkJCQkJLy8g5Y+W5raI5LiL6L295oyJ6ZKu54K55Ye7CgkJCQkJdGhpcy4kdGl0bGUuZmluZCgnLmRvd25sb2FkJykub2ZmKCdjbGljaycpOwoKCQkJCQkvLyDnu5Hlrprmkq3mlL7kuovku7YKCQkJCQl0aGlzLmxpc3RDdHJsLm9uKCdjaGFuZ2U6c29uZ0xpbmsnLCBmdW5jdGlvbiAoeiwgc29uZ0RhdGEpIHsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAobmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lLCB7ZGV0YWlsOiBKU09OLnN0cmluZ2lmeSAoc29uZ0RhdGEpfSkpOwoJCQkJCX0pOwoJCQkJfSkuY2FsbCAod2luZG93LnNvbmdJbmZvVmlldyk7CgkJCX0sIEguc2NyaXB0TmFtZSwgdGhpcy5pc0FyaWEpOwoJCX0pOwoJfSwKCgkvKioKCSAqIEBwcml2YXRlCgkgKiBkb2N1bWVudC1zdGFydCDlm57osIMKCSAqLwoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuaW5pdEV2ZW50cyAoKTsKCQl0aGlzLmhvb2tQbGF5ZXJEb3dubG9hZCAoKTsKCX0sCgoJLyoqCgkgKiDmj5DkuqQgUG9zdCDor7fmsYIKCSAqIEBwYXJhbSAge1JlcXVlc3R9IHJlcSAgIOivt+axguWvueixoSwg5Y+C6KeBIEdNX3htbGh0dHBSZXF1ZXN0CgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgICB4bWxodHRwUmVxdWVzdCDlr7nosaEKCSAqLwoJcG9zdDogZnVuY3Rpb24gKHJlcSkgewoJCXJlcS5tZXRob2QgPSAnUE9TVCc7CgkJcmVxLmhlYWRlcnMgPSByZXEuaGVhZGVycyB8fCB7fTsKCQlyZXEuaGVhZGVycy5SZWZlcmVyID0gcmVxLmhlYWRlcnMuUmVmZXJlciB8fCAnaHR0cDovL211c2ljLmJhaWR1LmNvbS8nOwoJCXJlcS5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwoJCXJlcS5kYXRhID0gJC5wYXJhbShyZXEuZGF0YSk7CgoJCXJldHVybiBHTV94bWxodHRwUmVxdWVzdChyZXEpOwoJfSwKCgkvKioKCSAqIEBwcml2YXRlCgkgKiDmkq3mlL7lmajkuIvmlrnnmoTkuIvovb3kuovku7bmjqXnrqEKCSAqIEBwYXJhbSAge0V2ZW50fSBlICAg5LqL5Lu2CgkgKi8KCV9yZWN2RXZlbnQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHNvbmdEYXRhID0gSlNPTi5wYXJzZSAoZS5kZXRhaWwpOwoKCQlmb3IgKHZhciBpID0gMy8qIHRoaXMucXVhbGl0aWVzLmxlbmd0aCAqLywgc29uZzsgIXNvbmcgJiYgaS0tOyApCgkJCXNvbmcgPSBzb25nRGF0YS5saW5rc1t0aGlzLnF1YWxpdGllc1tpXV07CgoJCS8vIOiOt+WPluatjOabsuWksei0pQoJCWlmICghc29uZyB8fCAhc29uZy5zb25nTGluaykgewoJCQlILndhcm4gKCfop6PmnpDkuIvovb3lnLDlnYDlpLHotKUsIOWPr+iDveeZvuW6puabtOaWsOS6huiOt+WPluaWueW8jy4nKTsKCQkJcmV0dXJuIDsKCQl9CgoJCXRoaXMuJGRsQnRuLmF0dHIgKHsKCQkJdGl0bGU6IHNvbmcuc29uZ05hbWUsCgkJCWhyZWY6IEgudXJpKHNvbmcuc29uZ0xpbmssIEguc3ByaW50ZignJXMgWyVzXS4lcycsIHNvbmdEYXRhLnNvbmdOYW1lLCBzb25nRGF0YS5hcnRpc3ROYW1lLCBzb25nLmZvcm1hdCkpCgkJfSk7Cgl9LAoKCS8qKgoJICog6ZqP5py65pWwCgkgKiBAcmV0dXJuIHtTdHJpbmd9IOmaj+acuuaVsAoJICovCglfcm5kOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zbGljZSgyKTsKCX0sCgoJLyoqCgkgKiDop6PmnpDnmb7luqbov5Tlm57nmoTkuI3op4TliJnmlbDmja4KCSAqIEBwYXJhbSAge1Jlc3BvbnNlfSByICAgR01feG1saHR0cFJlcXVlc3Qub25sb2FkIOWbnuiwg+eahOWPguaVsCAxCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgIOebuOWFs+aVsOaNrgoJICovCglfcGFyc2VSYXc6IGZ1bmN0aW9uIChyKSB7CgkJcmV0dXJuIEpTT04ucGFyc2Uoci5yZXNwb25zZVRleHQucmVwbGFjZSgvXHMvZywgJycpKTsKCX0sCgoJLyoqCgkgKiDop6PmnpDnmb7luqbov5Tlm57nmoTkuI3op4TliJnmlbDmja7nmoQgZGF0YSDoioLngrkKCSAqIEBwYXJhbSAge1Jlc3BvbnNlfSByICAgR01feG1saHR0cFJlcXVlc3Qub25sb2FkIOWbnuiwg+eahOWPguaVsCAxCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgIOebuOWFs+aVsOaNrgoJICovCglfcGFyc2U6IGZ1bmN0aW9uIChyKSB7CgkJcmV0dXJuIHRoaXMuX3BhcnNlUmF3KHIpLmRhdGE7Cgl9LAoKCS8qKgoJICog5Y+W5q2M5puy5piv5ZCm5Zyo5pS26JeP6YeM6Z2iLCDmmK/nmoTor53liJnog73nm7TmjqXop6PmnpAKCSAqIEBwYXJhbSAge0ludGVnZXJ9ICAgc29uZ0lkIOabsuebriBJRAoJICogQHBhcmFtICB7RnVuY3Rpb259ICBjYkRvbmUg5Zue6LCDLCAxIOWPguaVsCwgQm9vbGVhbiDmmK/lkKblnKjmlLbol4/lpLkKCSAqIEByZXR1cm4ge0Jvb2xlYW59ICAgICAgICBbZGVzY3JpcHRpb25dCgkgKi8KCV9pc0ZhdjogZnVuY3Rpb24gKHNvbmdJZCwgY2JEb25lKSB7CgkJdmFyIHNlbGYgPSB0aGlzOwoJCUdNX3htbGh0dHBSZXF1ZXN0ICh7CgkJCW1ldGhvZDogJ0dFVCcsCgkJCXVybDogSC5zcHJpbnRmKCdodHRwOi8vbXVzaWMuYmFpZHUuY29tL2RhdGEvdXNlci9pc0NvbGxlY3Q/dHlwZT1zb25nJmlkcz0lcyZyPSVzJywgc29uZ0lkLCB0aGlzLl9ybmQoKSksCgkJCW9ubG9hZDogZnVuY3Rpb24gKHIpIHsKCQkJCWNiRG9uZSghIXNlbGYuX3BhcnNlKHIpLmlzQ29sbGVjdCk7CgkJCX0KCQl9KTsKCX0sCgoJLyoqCgkgKiDliqDlhaXmlLbol4/lpLkKCSAqIEBwYXJhbSB7SW50ZWdlcn0gIHNvbmdJZCDmm7Lnm64gSUQKCSAqIEBwYXJhbSB7RnVuY3Rpb259IGNiRG9uZSDlm57osIPplJnor6/kv6Hmga8KCSAqLwoJX2FkZEZhdjogZnVuY3Rpb24gKHNvbmdJZCwgY2JEb25lKSB7CgkJdmFyIHNlbGYgPSB0aGlzOwoJCXRoaXMucG9zdCh7CgkJCXVybDogJ2h0dHA6Ly9tdXNpYy5iYWlkdS5jb20vZGF0YS91c2VyL2NvbGxlY3Q/cj0nICsgdGhpcy5fcm5kKCksCgkJCWRhdGE6IHsKCQkJCWlkczogc29uZ0lkLAoJCQkJdHlwZTogJ3NvbmcnLAoJCQkJcGF5X3R5cGU6IDAKCQkJfSwKCQkJb25sb2FkOiBmdW5jdGlvbiAocikgewoJCQkJY2JEb25lKHNlbGYuZXJyb3Ioc2VsZi5fcGFyc2VSYXcocikuZXJyb3JDb2RlKSk7CgkJCX0KCQl9KTsKCX0sCgoJLyoqCgkgKiDnp7vpmaTmlLbol4/lpLkKCSAqIEBwYXJhbSB7SW50ZWdlcn0gIHNvbmdJZCDmm7Lnm64gSUQKCSAqIEBwYXJhbSB7RnVuY3Rpb259IGNiRG9uZSDlm57osIPplJnor6/kv6Hmga8KCSAqLwoJX3JtRmF2OiBmdW5jdGlvbiAoc29uZ0lkLCBjYkRvbmUpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgkJdGhpcy5wb3N0KHsKCQkJdXJsOiAnaHR0cDovL211c2ljLmJhaWR1LmNvbS9kYXRhL3VzZXIvZGVsZXRlQ29sbGVjdGlvbj9yPScgKyB0aGlzLl9ybmQoKSwKCQkJZGF0YTogewoJCQkJaWRzOiBzb25nSWQsCgkJCQl0eXBlOiAnc29uZycsCgkJCQlwYXlfdHlwZTogMAoJCQl9LAoJCQlvbmxvYWQ6IGZ1bmN0aW9uIChyKSB7CgkJCQljYkRvbmUoc2VsZi5lcnJvcihzZWxmLl9wYXJzZVJhdyhyKS5lcnJvckNvZGUpKTsKCQkJfQoJCX0pOwoJfSwKCgkvKioKCSAqIOebtOaOpeiOt+WPluabsuebruS/oeaBrywg6K+356Gu5L+d55So5oi35pyJ5p2D6ZmQ55u05o6l6Kej5p6Q5oiW5Zyo5pS26JeP5aS55YaFLgoJICogQHBhcmFtICB7SW50ZWdlcn0gIHNvbmdJZCAgIOabsuebriBJRAoJICogQHBhcmFtICB7RnVuY3Rpb259IGNiU29uZyAgIOWbnuiwgwoJICovCglfZ2V0U29uZ0luZm9EaXJlY3Q6IGZ1bmN0aW9uIChzb25nSWQsIGNiU29uZykgewoJCXZhciBzZWxmID0gdGhpczsKCQlHTV94bWxodHRwUmVxdWVzdCAoewoJCQltZXRob2Q6ICdHRVQnLAoJCQl1cmw6ICdodHRwOi8veWlueXVleXVuLmJhaWR1LmNvbS9kYXRhL2Nsb3VkL2Rvd25sb2FkP3NvbmdJZHM9JyArIHNvbmdJZCwKCQkJb25sb2FkOiBmdW5jdGlvbiAocikgewoJCQkJY2JTb25nKHNlbGYuX3BhcnNlKHIpLmRhdGEpOwoJCQl9CgkJfSk7Cgl9LAoKCS8qKgoJICog6I635Y+W5puy55uu5L+h5oGvCgkgKiBAcGFyYW0gIHtJbnRlZ2VyfSAgc29uZ0lkIOabsuebriBJRAoJICogQHBhcmFtICB7RnVuY3Rpb259IGNiU29uZyDlm57osIMKCSAqLwoJX2dldFNvbmdJbmZvOiBmdW5jdGlvbiAoc29uZ0lkLCBjYlNvbmcpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgkJdGhpcy5fYWRkRmF2KHNvbmdJZCwgZnVuY3Rpb24gKGVyckluZm8pIHsKCQkJaWYgKGVyckluZm8ubGV2ZWwgPT0gJ2Vycm9yJykgewoJCQkJSC5lcnJvcign5re75Yqg5pS26JeP5aS55Ye66ZSZLCDlj5bmtojmk43kvZwuJyk7CgkJCQlyZXR1cm4gOwoJCQl9CgoJCQl2YXIgaXNGYXYgPSBlcnJJbmZvLmNvZGUgPT09IDIyMDAwOwoJCQl2YXIgcVJlbW92ZUZhdiA9ICQuRGVmZXJyZWQoKTsKCQkJcVJlbW92ZUZhdi5kb25lKGlzRmF2ID8gSC5ub3AgOiBmdW5jdGlvbiAoKSB7CgkJCQlILmluZm8gKCfnp7vpmaTkuLrop6PmnpDogIzkuLTml7bmt7vliqDnmoTmrYzmm7LigKYgJXMnLCBzb25nSWQpOwoJCQkJc2VsZi5fcm1GYXYoc29uZ0lkKTsKCQkJfSk7CgoJCQlzZWxmLl9nZXRTb25nSW5mb0RpcmVjdChzb25nSWQsIGZ1bmN0aW9uIChyKSB7CgkJCQljYlNvbmcociwgcVJlbW92ZUZhdi5yZXNvbHZlLmJpbmQocVJlbW92ZUZhdikpOwoJCQl9KTsKCQl9KTsKCX0sCgoJLyoqCgkgKiDmoLnmja7ln7rmnKzkv6Hmga/mnoTlu7rkuIvovb3lnLDlnYAKCSAqIEBwYXJhbSAge0ludGVnZXJ9IHNvbmdJZCAgICAgIOabsuebriBJRAoJICogQHBhcmFtICB7SW50ZWdlcn0gc29uZ1JhdGUgICAg56CB546HLCDljZXkvY3kuLoga2JwcwoJICogQHBhcmFtICB7U3RyaW5nfSAgbXVzaWNGb3JtYXQg6Z+z5LmQ5paH5Lu25qC85byPCgkgKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgICAgICAgICDmnoTlu7rnmoTmlofku7blnLDlnYAsIOmcgOimgSBDb29raWUKCSAqLwoJX2J1aWxkVXJsOiBmdW5jdGlvbiAoc29uZ0lkLCBzb25nUmF0ZSwgbXVzaWNGb3JtYXQpIHsKCQlyZXR1cm4gSC5zcHJpbnRmKAoJCQknaHR0cDovL3lpbnl1ZXl1bi5iYWlkdS5jb20vZGF0YS9jbG91ZC9kb3dubG9hZHNvbmdmaWxlP3NvbmdJZHM9JXMmcmF0ZT0lcyZmb3JtYXQ9JXMnLAoJCQlzb25nSWQsIHNvbmdSYXRlLCBtdXNpY0Zvcm1hdAoJCSk7Cgl9LAoKCS8qKgoJICog5p6E5bu65peg6ZyA6ZmE5Yqg5pWw5o2u55qE5LiL6L295Zyw5Z2ACgkgKiBAcGFyYW0gIHtTdHJpbmd9ICAgdXJsICAg5Lya6Lez6L2s55qE5Zyw5Z2ACgkgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2JVcmwg5Zue6LCDLCAxIOWPguaVsCwgU3RyaW5nIOecn+WunuWcsOWdgAoJICovCglfZ2V0UmVhbFVybDogZnVuY3Rpb24gKHVybCwgY2JVcmwpIHsKCQlHTV94bWxodHRwUmVxdWVzdCAoewoJCQltZXRob2Q6ICdHRVQnLAoJCQl1cmw6IHVybCwKCQkJaGVhZGVyczogewoJCQkJUmFuZ2U6ICdieXRlcz0wLTEnCgkJCX0sCgkJCW9ubG9hZDogZnVuY3Rpb24gKHIpIHsKCQkJCWNiVXJsIChyLmZpbmFsVXJsKTsKCQkJfQoJCX0pOwoJfSwKCgkvKioKCSAqIOmAieaLqeacgOmrmOeggeeOhwoJICogQHBhcmFtICB7T2JqZWN0fSBkbCAgIOW4puacieeggeeOh+aVsOaNrueahOWvueixoQoJICogQHJldHVybiB7T2JqZWN0fSAgICAgIOacgOmrmOeahOeggeeOh+WvueixoQoJICovCglfZ2V0QmVzdFF1YWxpdHk6IGZ1bmN0aW9uIChkbCkgewoJCXZhciBxdSA9IE9iamVjdC5rZXlzKGRsKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CgkJCWlmICghZGxbYV0pIHJldHVybiBkbFtiXSA/IC0xIDogMDsKCQkJaWYgKCFkbFtiXSkgcmV0dXJuICAxOwoJCQlyZXR1cm4gZGxbYV0ucmF0ZSAtIGRsW2JdLnJhdGU7CgkJfSkucG9wKCk7CgoJCXJldHVybiBkbFtxdV07Cgl9LAoKCV9yZW5hbWVVcmw6IGZ1bmN0aW9uIChvbGRVcmwsIGZpbGUpIHsKCQkvLyAgICAvMTIzNDUveHh4Lm1wMz95eXkgLT4gLzEyMzQ1L2ZpbGUubXAzP3l5eQoJCXJldHVybiBvbGRVcmwucmVwbGFjZSgvKFwvXGQrXC8pLitcPy8sICckMScgKyBmaWxlICsgJz8nKTsKCX0sCgoJLyoqCgkgKiBAcHJpdmF0ZQoJICog5om56YeP5LiL6L295aSE55CG55qE5Zue6LCD5Ye95pWwCgkgKiBAcGFyYW0gIHtGdW5jdGlvbn0gbmV4dCAgICDlm57osIMsIOW9k+WJjemhueebruWkhOeQhuWujOavleWQjuiwg+eUqAoJICogQHBhcmFtICB7T2JqZWN0fSAgIG9ialNvbmcg5puy55uu5L+h5oGvCgkgKi8KCV9iYXRjaDogZnVuY3Rpb24gKG5leHQsIG9ialNvbmcpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCS8vIOajgOafpeaYr+WQpumcgOimgeS4tOaXtuWKoOWFpeaUtuiXj+WkuQoJCXZhciBnZXRTb25nSW5mb1R5cGUgPSBvYmpTb25nLmlzRmF2ID8gJ19nZXRTb25nSW5mb0RpcmVjdCcgOiAnX2dldFNvbmdJbmZvJzsKCQl0aGlzW2dldFNvbmdJbmZvVHlwZV0gKG9ialNvbmcuc29uZ0lkLCBmdW5jdGlvbiAoZGwsIGNiUmVtb3ZlRmF2KSB7CgkJCS8vIOmZpOmdnumAieaLqeS4i+aXoOaNnyDlkKbliJnkuI3ph4fnlKjml6DmjZ8KCQkJaWYgKCFvYmpTb25nLmlzRmxhYyAmJiBkbC5mbGFjKQoJCQkJZGVsZXRlIGRsLmZsYWM7CgoJCQl2YXIgc29uZ0RsID0gc2VsZi5fZ2V0QmVzdFF1YWxpdHkoZGwpOwoJCQl2YXIgZmlsZSA9IEguc3ByaW50ZignJXMgWyVzXS4lcycsIG9ialNvbmcuc29uZ05hbWUsIG9ialNvbmcuYXJ0aXN0TmFtZSwgc29uZ0RsLmZvcm1hdCk7CgoJCQlzZWxmLl9nZXRSZWFsVXJsIChzZWxmLl9idWlsZFVybChvYmpTb25nLnNvbmdJZCwgc29uZ0RsLnJhdGUsIHNvbmdEbC5mb3JtYXQpLCBmdW5jdGlvbiAodXJsKSB7CgkJCQkvLyDnp7vpmaTkuLTml7bnlKjnmoTmlLbol4/lpLksIOS4jeWNoOS9jQoJCQkJaWYgKGNiUmVtb3ZlRmF2KQoJCQkJCWNiUmVtb3ZlRmF2ICgpOwoKCQkJCUguYWRkRG93bmxvYWQgKHNlbGYuX3JlbmFtZVVybCh1cmwsIGZpbGUpLCBmaWxlKTsKCQkJCW5leHQgKCk7CgkJCX0pOwoJCX0pOwoJfSwKCgkvKioKCSAqIEBwcml2YXRlCgkgKiDmibnph4/kuIvovb3kuovku7bmjqXnrqHlh73mlbAKCSAqIEBwYXJhbSAge0V2ZW50fSBlICAg5LqL5Lu2CgkgKi8KCV9iYXRjaERvd25sb2FkOiBmdW5jdGlvbiAoZSkgewoJCXZhciBhcnJTb25ncyA9IEpTT04ucGFyc2UgKGUuZGV0YWlsKTsKCQl2YXIgJHEgPSB0aGlzLiRxOwoKCQkkcS5hZGQuYXBwbHkoJHEsIGFyclNvbmdzKTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy5iYWlkdS55aW55dWV5dW4uanMgKi8KewoJaWQ6ICdtdXNpYy5iYWlkdS55aW55dWV5dW4nLAoJbmFtZTogJ+mfs+S5kOS6keS4i+i9vScsCglob3N0OiAneWlueXVleXVuLmJhaWR1LmNvbScsCglub1N1Ykhvc3Q6IHRydWUsCglwYXRoOiAnLycsCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCUgud2FpdFVudGlsKCd1c2VyTW9kZWwuc2V0JywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVFeGVjKGZ1bmN0aW9uIChzY3JpcHROYW1lLCBob29rQmF0Y2gpIHsKCQkJCXZhciBiYWtVc2VyU2V0SW5mbyA9IHVzZXJNb2RlbC5zZXQ7CgkJCQl1c2VyTW9kZWwuc2V0ID0gZnVuY3Rpb24gKGtleSwgdmFsLCBvcHRzKSB7CgkJCQkJaWYgKGtleSA9PT0gJ3VzZXJJbmZvJyAmJiB2YWwpIHsKCQkJCQkJdmFsLnZpcCA9IHZhbC5nb2xkZW4gPSB0cnVlOwoJCQkJCX0KCQkJCQlyZXR1cm4gYmFrVXNlclNldEluZm8uYXBwbHkodXNlck1vZGVsLCBhcmd1bWVudHMpOwoJCQkJfTsKCQkJCQoJCQkJLy8gRm9yY2UgdXBkYXRlIHVzZXIgZGF0YSB2aWEgaG9vawoJCQkJdXNlck1vZGVsLnNldCgndXNlckluZm8nLCB1c2VyTW9kZWwuZ2V0KCd1c2VySW5mbycpKTsKCQkJfSk7CgkJfSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZGpjYy5qcyAqLwp7CglpZDogJ211c2ljLmRqY2MnLAoJbmFtZTogJ0RKQ0Mg6Iie5puyJywKCWhvc3Q6IFsnd3d3LmRqY2MuY29tJy8qICwgJ3d3dy5kai5jYycgKi9dLAoJbm9TdWJIb3N0OiB0cnVlLAoKCXBhdGg6IFsnL2RqLycsICcvcGxheS5waHAnXSwKCW1pc3NpbmdEb21haW41OiAnaHR0cDovL2Rvd24uZGpjYy5jb20vbXVzaWMvJywKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJSC53YWl0VW50aWwgKCckLnBvc3QnLCBmdW5jdGlvbiAoKSB7CgkJCWNvbnNvbGUuaW5mbyAoJ+aJp+ihjCBWSVAg56C06KejIChwbGF5LnBocCDpobXpnaLml6DmlYgpIC4uJyk7CgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uIChzY3JpcHRIb21lLCBzY3JpcHROYW1lKSB7CgkJCQlmdW5jdGlvbiBybmROdW1iZXIgKCkgewoJCQkJCXJldHVybiB+fig5OTk5OSAqIE1hdGgucmFuZG9tKCkpOwoJCQkJfQoKCQkJCWNvbnNvbGUuaW5mbyAoc2NyaXB0SG9tZSk7CgkJCQl2YXIgX3Bvc3QgPSAkLnBvc3Q7CgkJCQkkLnBvc3QgPSBmdW5jdGlvbiAoYWRkciwgY2IpIHsKCQkJCQlpZiAoYWRkciA9PSAnL2FqYXgucGhwP2FqYXg9dXNlcmluZm8nKSB7CgkJCQkJCXJldHVybiBfcG9zdC5jYWxsICgkLCBhZGRyLCBmdW5jdGlvbiAocykgewoJCQkJCQkJaWYgKHMgPT0gJycpCgkJCQkJCQkJcyA9IFsxLCBzY3JpcHROYW1lLCAwLCBzY3JpcHRIb21lLCAwLCAwLAoJCQkJCQkJCQlybmROdW1iZXIoKSwgcm5kTnVtYmVyKCksIDAsIDAsIDIsCgkJCQkJCQkJCSflsIrotLXnmoQgJyArIHNjcmlwdE5hbWUgKyAnIOeUqOaItycsICc55bm0JwoJCQkJCQkJCV0uam9pbignKndyZionKTsKCgkJCQkJCQljYiAocyk7CgkJCQkJCX0pOwoJCQkJCX0KCQkJCQlyZXR1cm4gX3Bvc3QuYXBwbHkgKCQsIGFyZ3VtZW50cyk7CgkJCQl9OwoKCQkJCXJldHVybiBmdW5jdGlvbiAoKSB7fTsKCQkJfSwgSC5zY3JpcHRIb21lLCBILnNjcmlwdE5hbWUpOwoJCX0pOwoKCQkvLyDmkq3mlL7lmajliqvmjIEgW+aAgOeWkeWkseaViD9dCgkJSC53YWl0VW50aWwgKCdqd3BsYXllci5hcGknLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uICgpIHsKCQkJCXZhciBfc3AgPSB3aW5kb3cuandwbGF5ZXIuYXBpLnNlbGVjdFBsYXllcjsKCQkJCXdpbmRvdy5qd3BsYXllci5hcGkuc2VsZWN0UGxheWVyID0gZnVuY3Rpb24gKHNlbCkgewoJCQkJCXZhciBtUGxheWVyID0gX3NwIChzZWwpOwoJCQkJCXZhciBfc2V0dXAgPSBtUGxheWVyLnNldHVwOwoJCQkJCW1QbGF5ZXIuc2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykgewoJCQkJCQljb25zb2xlLmluZm8gKCdzZXR1cCcsIG9wdGlvbnMpOwoJCQkJCQl2YXIgX29wbCA9IG9wdGlvbnMuZXZlbnRzLm9uUGxheWxpc3RJdGVtOwoJCQkJCQlvcHRpb25zLmV2ZW50cy5vblBsYXlsaXN0SXRlbSA9IGZ1bmN0aW9uIChldmVudFBsYXlsaXN0Q2hhbmdlKSB7CgkJCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50ICggbmV3IEN1c3RvbUV2ZW50IChILnNjcmlwdE5hbWUsIHsKCQkJCQkJCQlkZXRhaWw6IEpTT04uc3RyaW5naWZ5IChtUGxheWVyLmdldFBsYXlsaXN0SXRlbSAoKSkKCQkJCQkJCX0pICk7CgkJCQkJCQlyZXR1cm4gX29wbC5hcHBseSAodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfTsKCQkJCQkJcmV0dXJuIF9zZXR1cC5hcHBseSAobVBsYXllciwgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJCXJldHVybiBtUGxheWVyOwoJCQkJfTsKCQkJfSk7CgkJfSk7CgoJCXRoaXMuZGxMaW5rMSA9ICQoJzxhPicpLnRleHQgKCfor5XlkKzkuIvovb0nKS5hdHRyICgndGFyZ2V0JywgJ19ibGFuaycpOwoJCXRoaXMuZGxMaW5rMiA9ICQoJzxhPicpLnRleHQgKCfpq5jmuIXkuIvovb0nKS5hdHRyICgndGFyZ2V0JywgJ19ibGFuaycpOwoKCQkvLyDkuIvovb3mlbDmja7op6PmnpAKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCXZhciBzb25nT2JqID0gSlNPTi5wYXJzZSAoZS5kZXRhaWwpOwoJCQlpZiAoSC5iZWdpbldpdGggKHNvbmdPYmouZmlsZSwgd3JmSncuUGxheWVyLmRvbWFpblswXSkpCgkJCQlzb25nT2JqLmZpbGUgPSBzb25nT2JqLmZpbGUuc2xpY2UgKHdyZkp3LlBsYXllci5kb21haW5bMF0ubGVuZ3RoKTsKCgkJCXRoaXMuZGxMaW5rMS5hdHRyICgnaHJlZicsIEgudXJpICh3cmZKdy5QbGF5ZXIuZG9tYWluWzBdICsgc29uZ09iai5maWxlICwgc29uZ09iai50aXRsZSArICcubXAzJykpOwoJCQl0aGlzLmRsTGluazIuYXR0ciAoJ2hyZWYnLCBILnVyaSAobWlzc2luZ0RvbWFpbjUgKyAoc29uZ09iai5maWxlMiB8fCBzb25nT2JqLmZpbGUpLCBzb25nT2JqLnRpdGxlICsgJy7pq5jmuIUubXAzJykpOwoJCQlILmluZm8gKHNvbmdPYmopOwoJCX0uYmluZCh0aGlzKSwgZmFsc2UpOwoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQkkKCcjbGlzdHRhYnMnKQoJCQkuYXBwZW5kICh0aGlzLmRsTGluazEpCgkJCS5hcHBlbmQgKHRoaXMuZGxMaW5rMikKCQkJLmNzcyAoJ2hlaWdodCcsICdpbml0aWFsJykKCQkJLmNzcyAoJ21pbi1oZWlnaHQnLCAnMTYwJyk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZGpray5qcyAqLwp7CglpZDogJ211c2ljLmRqa2snLAoJbmFtZTogJ0RKIOWXqOWXqCcsCglob3N0OiAnd3d3LmRqa2suY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCWNzczogLyogUmVzb3VyY2U6IGNvbS5kamtrLmRsLmNzcyAqLwpILmV4dHJhY3QoZnVuY3Rpb24gKCkgeyAvKgojanhfZGxfd3JhcHBlciB7CiAgICBmbG9hdDogcmlnaHQ7CiAgICBtYXJnaW4tcmlnaHQ6IDEuNWVtOwp9CgojanhfZGxfd3JhcHBlciA+IGEgewoJdHJhbnNpdGlvbjogY29sb3IgLjRzOwoJY29sb3I6ICNhYWE7Cn0KCiNqeF9kbF93cmFwcGVyID4gYTpob3ZlciB7Cgljb2xvcjogI2ZmZjsKCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQoqL30pLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmRsSG9sZGVyID0gJCgnPGRpdiBpZD0ianhfZGxfd3JhcHBlciI+Jyk7CgkJdGhpcy5kbEhvbGRlci5hcHBlbmQoJ+S4i+i9vTogJyk7CgkJdGhpcy5kbEhxICAgICA9ICQoJzxhPicpLnRleHQoJ+mrmOa4hScpLmFwcGVuZFRvICh0aGlzLmRsSG9sZGVyKS5wcm9wKCdkb3dubG9hZCcsIHRydWUpOwoJCXRoaXMuZGxIb2xkZXIuYXBwZW5kKCcgfCAnKTsKCQl0aGlzLmRsTGluayAgID0gJCgnPGE+JykudGV4dCgn6K+V5ZCsJykuYXBwZW5kVG8gKHRoaXMuZGxIb2xkZXIpLnByb3AoJ2Rvd25sb2FkJywgdHJ1ZSk7CgoJCUgualBsYXllclBhdGNoZXIgKGZ1bmN0aW9uIChzb25nT2JqKSB7CgkJCXZhciBzb25nQWRkciAgPSBzb25nT2JqLm1wMyB8fCBzb25nT2JqLm00YTsKCQkJdmFyIHNvbmdUaXRsZSA9IHNvbmdPYmoudGl0bGUgfHwgJCgnI3BsYXlUaXRsZSAuanAtdGl0bGUnKS50ZXh0KCkucmVwbGFjZSgvLivvvJovLCAnJyk7CgkJCQoJCQl0aGlzLmRsTGluay5hdHRyKHsKCQkJCWhyZWY6IEgudXJpKHNvbmdBZGRyLCBzb25nVGl0bGUgKyBzb25nQWRkci5zbGljZSgtNCkpLAoJCQkJdGl0bGU6ICfor5XlkKzpn7PotKg6ICcgKyBzb25nVGl0bGUKCQkJfSk7CgoJCQl0aGlzLmRsSHEuYXR0cih7CgkJCQlocmVmOiBILnVyaSh0aGlzLnVwZ3JhZGVIUShzb25nQWRkciksIHNvbmdUaXRsZSArICcubXAzJyksCgkJCQl0aXRsZTogJ+mrmOa4hemfs+i0qDogJyArIHNvbmdUaXRsZQoJCQl9KTsKCQl9LmJpbmQgKHRoaXMpKTsKCX0sCgoJLy8gU291cmNlOiA1MnBvamllCgl1cGdyYWRlSFE6IGZ1bmN0aW9uICh1cmwpIHsKCQlyZXR1cm4gdXJsCgkJICAgICAgICAgLnJlcGxhY2UodW5zYWZlV2luZG93LnNfc3RyLCAnaHR0cDovL2RvLmRqa2suY29tL21wMycpCgkJICAgICAgICAgLnJlcGxhY2UoLy4uLiQvLCAnbXAzJykKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5kbEhvbGRlci5hcHBlbmRUbyAoJCgnLm1haW4tcGFuZWwnKSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZGp5ZS5qcyAqLwp7CglpZDogJ211c2ljLmRqeWUnLAoJbmFtZTogJ0RKIOeIt+eIt+e9kScsCglob3N0OiAnd3d3LmRqeWUuY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCXBhdGg6ICcvcGxheWVyLycsCgljc3MgOiAvKiBSZXNvdXJjZTogY29tLmRqeWUuZGwuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCiNqeF9kbF9idG4gewoJbWFyZ2luLXRvcDogN3B4OwoJZmxvYXQ6IHJpZ2h0Owp9CgojanhfZGxfYnRuID4gYSB7Cgl0cmFuc2l0aW9uOiBjb2xvciAuNHM7Cgljb2xvcjogYmxhY2s7Cn0KCiNqeF9kbF9idG4gPiBhOmhvdmVyIHsKCWNvbG9yOiAjNDQ0Owp9CiovfSksCgoJdG9NcDM6IGZ1bmN0aW9uIChzb25nKSB7CgkJcmV0dXJuIHNvbmcucmVwbGFjZSgvW2Etel0qXC4vLCAnbXAzLicpLnJlcGxhY2UoL200YSQvLCAnbXAzP3R5cGU9ZG93bicpOwoJfSwKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5saW5rSG9sZGVyID0gJCgnPHAgaWQ9Imp4X2RsX2J0biI+Jyk7CgkJdGhpcy5saW5rSG9sZGVyLmFwcGVuZCgn5LiL6L29OiAnKQoJCXRoaXMubGlua000QSA9ICQoJzxhPicpLmFwcGVuZFRvICh0aGlzLmxpbmtIb2xkZXIpLnRleHQgKCfor5XlkKwnKTsKCQl0aGlzLmxpbmtIb2xkZXIuYXBwZW5kICgnIHwgJyk7CgkJdGhpcy5saW5rTVAzID0gJCgnPGE+JykuYXBwZW5kVG8gKHRoaXMubGlua0hvbGRlcikudGV4dCAoJ21wMycpCgkJCS5hdHRyICgndGl0bGUnLCAn6K+35rOo5oSPOiDor6Xpk77mjqXlj6/og73lm6DkuLrmnI3liqHlmajphY3nva7mm7TmlrDlr7zoh7Tml6Dms5XkuIvovb0nKTsKCgkJSC5qUGxheWVyUGF0Y2hlciAoZnVuY3Rpb24gKHNvbmdPYmopIHsKCQkJdmFyIHNvbmdMaW5rID0gc29uZ09iai5tNGEucmVwbGFjZSgvXD8uKi8sICcnKTsKCQkJdmFyIHNvbmdUaXRsZSA9ICQoJyNwbGF5X3RpdGxlJykudGV4dCAoKTsKCgkJCXRoaXMubGlua000QS5hdHRyKCdocmVmJywgSC51cmkgKHNvbmdMaW5rLCBzb25nVGl0bGUgKyAnLm00YScpKTsKCQkJdGhpcy5saW5rTVAzLmF0dHIoJ2hyZWYnLCBILnVyaSAodGhpcy50b01wMyhzb25nTGluayksIHNvbmdUaXRsZSArICcubXAzJykpOwoJCX0uYmluZCAodGhpcykpOwoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmxpbmtIb2xkZXIKCQkJLmFwcGVuZFRvICgkKCcuYmZfY2tjJykpCgkJCS5jc3MoJ3BhZGRpbmctcmlnaHQnLCAnMWVtJyk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZG91YmFuLmpzICovCi8qKgogKiDosYbnk6Ppn7PkuZDkuIvovb3op6PmnpAgQnkgSml4dW4KICovCih7CglpZDogJ211c2ljLmRvdWJhbicsCgluYW1lOiAn6LGG55Oj6Z+z5LmQ5LiL6L296Kej5p6QJywKCWhvc3Q6ICdtdXNpYy5kb3ViYW4uY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCW5vRnJhbWU6IGZhbHNlLAoJZGxfaWNvbjogdHJ1ZSwKCWNzczogLyogUmVzb3VyY2U6IGNvbS5kb3ViYW4ubXVzaWMuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCi5jb250YWluZXIgLm1vZDEgewoJd2lkdGg6IDUyNXB4Owp9CgouY29udGFpbmVyIC5tb2QyIHsKCXdpZHRoOiA4M3B4Owp9CgoqL30pLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciAkYnRuRG93bmxvYWQgPSAkKCc8YT4nKS5hdHRyKCdpZCcsICdidG4tZG93bmxvYWQnKTsKCQkkKCc8aT4nKS5hZGRDbGFzcygnanhfZGwganhfYnRuJykuYXBwZW5kVG8oJGJ0bkRvd25sb2FkKTsKCQlILmNhcHR1cmVBcmlhKCRidG5Eb3dubG9hZCk7CgoJCWZ1bmN0aW9uIGluamVjdF9kbF9pY29uICgpIHsKCQkJJGJ0bkRvd25sb2FkLnByZXBlbmRUbygnLmNvbnRhaW5lciAubW9kMicpOwoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlX3VybCAoc29uZykgewoJCQl2YXIgdXJsID0gSC51cmkoc29uZy5nZXQoJ3VybCcpLCBzb25nLmdldCgndGl0bGUnKSArICIgWyIgKyBzb25nLmdldCgnYXJ0aXN0X25hbWUnKSArICJdLm1wMyIpOwoJCQkkYnRuRG93bmxvYWQuYXR0cignaHJlZicsIHVybCk7CgkJfQoKCQlleHBvcnRGdW5jdGlvbihoYW5kbGVfdXJsLCB1bnNhZmVXaW5kb3csIHsKCQkJZGVmaW5lQXM6ICJkbF9qaXh1biIKCQl9KTsKCgkJZXhwb3J0RnVuY3Rpb24oaW5qZWN0X2RsX2ljb24sIHVuc2FmZVdpbmRvdywgewoJCQlkZWZpbmVBczogImluaXRfaml4dW4iCgkJfSk7CgoJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQlyZXF1aXJlKFsncGxheWVyL2FwcCcsICdwbGF5ZXIvbW9kZWxzL3NvbmcnLCAncGxheWVyL3ZpZXdzL3BsYXlpbmZvJ10sIGZ1bmN0aW9uIChBcHAsIFNvbmcsIFBsYXlJbmZvKSB7CgkJCQlzZXRUaW1lb3V0KGluaXRfaml4dW4sIDI1KTsKCgkJCQl2YXIgc3AgPSBTb25nLnByb3RvdHlwZS5zdGFydFBsYXlpbmc7CgkJCQlTb25nLnByb3RvdHlwZS5zdGFydFBsYXlpbmcgPSBmdW5jdGlvbiAoKSB7CgkJCQkJZGxfaml4dW4odGhpcyk7CgkJCQkJcmV0dXJuIHNwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoKCQkJCXZhciBwaXIgPSBQbGF5SW5mby5wcm90b3R5cGUucmVuZGVyOwoJCQkJUGxheUluZm8ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgciA9IHBpci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCWluaXRfaml4dW4oKTsKCQkJCQlyZXR1cm4gcjsKCQkJCX07CgkJCX0pOwoJCX0pOwoJfQp9KSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy5kdW9sZS5qcyAqLwp7CglpZDogJ211c2ljLmR1b2xlJywKCW5hbWU6ICflpJrkuZDpn7PkuZAnLAoJaG9zdDogJ3d3dy5kdW9sZS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBidG5QcmV2U29uZyA9ICQoJyNwbGF5ZXJfcmlnaHQgLmxhc3QnKSwKCQkJYnRuRG93bmxvYWQgPSBidG5QcmV2U29uZy5jbG9uZSgpOwoJCQoJCSQoJyNwbGF5ZXJfcmlnaHQnKS5hbmltYXRlKHsKCQkJJ3dpZHRoJzogJys9MzInCgkJfSwgNTAwKTsKCQkKCQl2YXIgc29uZ0luZm8gPSAkKCdhLm11c2ljX2luZm8nKS5jc3MoewoJCQknY3Vyc29yJzogJ3RleHQnCgkJfSkucmVtb3ZlQXR0cignaHJlZicpOwoKCgkJdmFyIG1vID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIgKGZ1bmN0aW9uICgpIHsKCQkJaWYgKHNvbmdJbmZvWzBdLmhhc0F0dHJpYnV0ZSgnaHJlZicpKQoJCQkJc29uZ0luZm8ucmVtb3ZlQXR0ciAoJ2hyZWYnKTsKCQl9LmJpbmQgKHRoaXMpKTsKCQltby5vYnNlcnZlIChzb25nSW5mb1swXSwgewoJCQlhdHRyaWJ1dGVzOiB0cnVlCgkJfSk7CgoJCWJ0bkRvd25sb2FkLmluc2VydEJlZm9yZShidG5QcmV2U29uZy5wcmV2KCkpLnJlbW92ZUNsYXNzKCdsYXN0JykuY3NzKHsKCQkJJ3dpZHRoJzogJzAnLAoJCQknZGlzcGxheSc6ICdpbmxpbmUnLAoJCQknYmFja2dyb3VuZC1wb3NpdGlvbic6ICctMTUwcHggLTEwNHB4JwoJCX0pLmNzcyhILm1ha2VSb3RhdGVDc3MoOTApKS5hbmltYXRlKHsKCQkJJ3dpZHRoJzogJys9MzInCgkJfSwgNTAwKS5hdHRyKCd0YXJnZXQnLCAnX2JsYW5rJyk7CgkJCgkJdmFyIG9sZFBsYXlOZXcgPSB1bnNhZmVXaW5kb3cuZHVvbGVQbGF5ZXIucGxheU5ldzsKCQl2YXIgcmFuZG9tSWQ7CgoJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCXBsYXlOZXc6IChmdW5jdGlvbiAodCwgbikgewoJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAoCgkJCQkJbmV3IEN1c3RvbUV2ZW50IChILnNjcmlwdE5hbWUsIHtkZXRhaWw6IEpTT04uc3RyaW5naWZ5ICh7CgkJCQkJCW1wMzogdCwKCQkJCQkJaW5mbzogdGhpcy5jdXJNdXNpYwoJCQkJCX0pfSkKCQkJCSk7CgoJCQkJdGhyb3cgbmV3IEVycm9yVW5zYWZlU3VjY2VzcyAoKTsKCQkJfSkuYmluZCh1bnNhZmVXaW5kb3cuZHVvbGVQbGF5ZXIpCgkJfSwgdW5zYWZlV2luZG93LmR1b2xlUGxheWVyLCAnLmR1b2xlUGxheWVyJyk7CgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKEguc2NyaXB0TmFtZSwgZnVuY3Rpb24gKGUpIHsKCQkJdmFyIHNvbmdPYmogID0gSlNPTi5wYXJzZSAoZS5kZXRhaWwpLAoJCQkJc29uZ0luZm8gPSBzb25nT2JqLmluZm87CgoJCQlidG5Eb3dubG9hZC5hdHRyKHsKCQkJCWhyZWY6IEgudXJpIChzb25nT2JqLm1wMywgc29uZ0luZm8uc29uZ19uYW1lICsgJyBbJyArIHNvbmdJbmZvLmFsYnVtX25hbWUgKyAnXSAtICcgKyBzb25nSW5mby5zaW5nZXJfbmFtZSArICcubXAzJyksCgkJCQl0aXRsZTogJ+WNleWHu+S4i+i9vTogJyArIHNvbmdJbmZvLnNvbmdfbmFtZQoJCQl9KTsKCQl9LCBmYWxzZSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZHVvbWkuZWFyLmpzICovCnsKCWlkOiAnbXVzaWMuZHVvbWkuZWFyJywKCW5hbWU6ICfpgrvlsYXnmoTogLPmnLUnLAoJaG9zdDogJ2Vhci5kdW9taS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJSC53b3JkcHJlc3NBdWRpbyAoKTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy5rdWdvdS5qcyAqLwovKioKICog6YW354uX6Z+z5LmQ6Kej5p6QIEJ5IEppeHVuCiAqIOaKk+WMhemFt+eLl+mfs+S5kCA6RAogKi8KKHsKCWlkOiAnbXVzaWMua3Vnb3UnLAoJbmFtZTogJ+mFt+eLl+mfs+S5kOS4i+i9veino+aekCcsCglob3N0OiBbJ3dlYi5rdWdvdS5jb20nLCAna3Vnb3UuY29tJywgJ3d3dy5rdWdvdS5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCW5vRnJhbWU6IHRydWUsCgloaWRlOiAnI2FkdicsCgljc3M6IC8qIFJlc291cmNlOiBjb20ua3Vnb3UuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCi5kaWFsb2ctc2hhZG93IHsKCWRpc3BsYXk6IGZsZXg7CglqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCWFsaWduLWl0ZW1zOiBjZW50ZXI7Cglwb3NpdGlvbjogZml4ZWQ7CglsZWZ0OiAwOwoJdG9wOiAwOwoJaGVpZ2h0OiAxMDAlOwoJd2lkdGg6IDEwMCU7CgliYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4zKTsKCXotaW5kZXg6IDEwMDsKfQoKLmRpYWxvZy1jb250YWluZXIgewoJbWluLXdpZHRoOiBjYWxjKDc2OHB4ICsgMmVtKTsKCW1pbi1oZWlnaHQ6IDIwZW07CglwYWRkaW5nOiAxZW07CgliYWNrZ3JvdW5kOiAjZmZmOwoJYm94LXNoYWRvdzogMnB4IDJweCAycHggIzY2NjsKCWJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNiw2LDYsLjMpOwoJcG9zaXRpb246IHJlbGF0aXZlOwoJcGFkZGluZy10b3A6IDIuNWVtOwp9CgouZGlhbG9nLWJhciB7Cglwb3NpdGlvbjogYWJzb2x1dGU7CglsZWZ0OiAwOwoJdG9wOiAwOwoJcGFkZGluZzogLjRlbTsKCXdpZHRoOiBjYWxjKDEwMCUgLSAuOGVtKTsKCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCB3aGl0ZTsKCWJhY2tncm91bmQ6ICMwMEE3RjI7Cgljb2xvcjogd2hpdGU7Cn0KCi5kaWFsb2ctYmFyLWJ0biB7CglmbG9hdDogcmlnaHQ7Cgl3aWR0aDogMWVtOwoJaGVpZ2h0OiAxZW07Cglib3JkZXI6IDFweCBzb2xpZCB3aGl0ZTsKCXRleHQtYWxpZ246IGNlbnRlcjsKCWxpbmUtaGVpZ2h0OiAxLjI7CglwYWRkaW5nOiAwIC41ZW07CgltYXJnaW4tbGVmdDogLjVlbTsKfQoKLmRpYWxvZy1jb250ZW50IGlmcmFtZSB7CgloZWlnaHQ6IDMwZW07Cgl3aWR0aDogMTAwJTsKfQoqL30pLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT09IDIvKiBVUklfVVNFX0FSSUEgKi8pIHsKCQkJSC5zZXR1cEFyaWEoKTsKCQl9Cgl9LAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBfQ09OU1RfQkFTRSA9ICdodHRwczovL2ppeHVubW9lLmdpdGh1Yi5pby9jdXdjbDRjL2t1Z291LWRsJzsKCgkJdmFyICRkbFNoYWRvdyA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ2RpYWxvZy1zaGFkb3cnKS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKTsKCQl2YXIgJGRsRGlhbG9nID0gJCgnPGRpdj4nKS5hZGRDbGFzcygnZGlhbG9nLWNvbnRhaW5lcicpLmFwcGVuZFRvKCRkbFNoYWRvdyk7CgkJdmFyICRkbERpYWxvZ1RpdGxlID0gJCgnPGRpdj4nKS5hZGRDbGFzcygnZGlhbG9nLWJhcicpLmFwcGVuZFRvKCRkbERpYWxvZykudGV4dCgn5LiL6L2956qX5Y+jJyk7CgkJdmFyICRkbERpYWxvZ0NvbnRhaW5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ2RpYWxvZy1jb250ZW50JykuYXBwZW5kVG8oJGRsRGlhbG9nKTsKCQl2YXIgJGRsRGlhbG9nQ2xvc2VCdG4gPSAkKCc8c3Bhbj4nKS5hZGRDbGFzcygnZGlhbG9nLWJhci1idG4nKS5hcHBlbmRUbygkZGxEaWFsb2dUaXRsZSkudGV4dCgn5YWzJyk7CgkJdmFyICRkbERpYWxvZ01hbmFnZUJ0biA9ICQoJzxzcGFuPicpLmFkZENsYXNzKCdkaWFsb2ctYmFyLWJ0bicpLmFwcGVuZFRvKCRkbERpYWxvZ1RpdGxlKS50ZXh0KCfnrqEnKTsKCgkJLy8g5YWz6Zet5oyJ6ZKu6KKr54K55Ye7CgkJJGRsRGlhbG9nQ2xvc2VCdG4uY2xpY2soZnVuY3Rpb24gKCkgewoJCQkkZGxTaGFkb3cuaGlkZSgpOwoJCX0pOwoKCQkkZGxEaWFsb2dNYW5hZ2VCdG4uY2xpY2soZnVuY3Rpb24gKCkgewoJCQkkd25kRG93bmxvYWRCb3gudG9nZ2xlKCk7CgkJCSR3bmREb3dubG9hZE1hbmFnZXIudG9nZ2xlKCk7CgkJfSk7CgoJCXZhciAkd2FpdE1zZyA9ICQoJzxkaXY+JykudGV4dCgn5q2j5Zyo6I635Y+W55u45YWz5L+h5oGvLi4nKS5hcHBlbmRUbygkZGxEaWFsb2dDb250YWluZXIpOwoKCQl2YXIgZnJhbWVEbERpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwoJCXZhciAkd25kRG93bmxvYWRCb3ggPSAkKGZyYW1lRGxEaWFsb2cpLmhpZGUoKS5hcHBlbmRUbygkZGxEaWFsb2dDb250YWluZXIpOwoJCWZyYW1lRGxEaWFsb2cuc3JjID0gX0NPTlNUX0JBU0U7CgoJCXZhciBmcmFtZURsTWFuYWdlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwoJCXZhciAkd25kRG93bmxvYWRNYW5hZ2VyID0gJChmcmFtZURsTWFuYWdlcikuaGlkZSgpLmFwcGVuZFRvKCRkbERpYWxvZ0NvbnRhaW5lcik7CgkJZnJhbWVEbE1hbmFnZXIuc3JjID0gX0NPTlNUX0JBU0UgKyAnL2RsLmh0bWwnOwoKCQl2YXIgYWN0aW9uRGxEaWFsb2cgID0gWydzZXQnLCAnY2xlYXInXTsKCQl2YXIgYWN0aW9uRGxNYW5hZ2VyID0gWydhZGQnXTsKCQlmdW5jdGlvbiBwb3N0IChhY3Rpb24sIGRhdGEpIHsKCQkJdmFyIGZyYW1lID0gYWN0aW9uRGxEaWFsb2cuaW5kZXhPZihhY3Rpb24pICE9IC0xID8gZnJhbWVEbERpYWxvZyA6IGZyYW1lRGxNYW5hZ2VyOwoJCQl2YXIgbXNnID0gewoJCQkJYWN0aW9uOiBhY3Rpb24sCgkJCQlkYXRhOiBkYXRhCgkJCX07CgoJCQlmcmFtZS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KG1zZyksICcqJyk7CgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVEb3dubG9hZCAoc29uZ3MpIHsKCQkJcG9zdCgnY2xlYXInKTsKCQkJJHdhaXRNc2cuaGlkZSgpOwoJCQkkd25kRG93bmxvYWRCb3guc2hvdygpOwoJCQkkd25kRG93bmxvYWRNYW5hZ2VyLmhpZGUoKTsKCQkJJGRsU2hhZG93LnNob3coKTsKCQkJdmFyIHJlc291cmNlID0gSlNPTi5wYXJzZSh1bmVzY2FwZShzb25ncykpLm1hcChmdW5jdGlvbiAoc29uZykgewoJCQkJcmV0dXJuIHsKCQkJCQl0eXBlOiAnYXVkaW8nLAoJCQkJCWlkOiAwLAoJCQkJCWhhc2g6IHNvbmcuSGFzaAoJCQkJfTsKCQkJfSk7CgoJCQl2YXIgcGF5bG9hZCA9IHsKCQkJCSJ1c2VyaWQiOiAwLAoJCQkJInRva2VuIjogIiIsCgkJCQkidmlwIjogMSwKCQkJCSJiZWhhdmlvciI6ICJkb3dubG9hZCIsCgkJCQkicmVsYXRlIjogMSwKCQkJCSJyZXNvdXJjZSI6IHJlc291cmNlLAoJCQkJImFwcGlkIjogMTAwMSwKCQkJCSJjbGllbnR2ZXIiOiAiODAzMSIsCgkJCQkic291cmNlIjogewoJCQkJCSJtb2R1bGUiOiAiMSIsCgkJCQkJInR5cGUiOiAiMCIsCgkJCQkJImlkIjogMAoJCQkJfQoJCQl9OwoKCQkJR01feG1saHR0cFJlcXVlc3QoewoJCQkJbWV0aG9kOiAiUE9TVCIsCgkJCQl1cmw6ICJodHRwOi8vbWVkaWEuc3RvcmUua3Vnb3UuY29tL3YxL2dldF9yZXNfcHJpdmlsZWdlIiwKCQkJCWRhdGE6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLAoJCQkJaGVhZGVyczogewoJCQkJCSJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIgoJCQkJfSwKCQkJCW9ubG9hZDogZnVuY3Rpb24ocmVzcG9uc2UpIHsKCQkJCQlwb3N0KCdzZXQnLCBKU09OLnBhcnNlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCkpOwoJCQkJCSR3YWl0TXNnLmhpZGUoKTsKCQkJCQkkd25kRG93bmxvYWRCb3guc2hvdygpOwoJCQkJfSwKCQkJCW9uZXJyb3I6IGZ1bmN0aW9uICgpIHsKCQkJCQlhbGVydCgn5o6l5Y+j6I635Y+W5aSx6LSlLCDor7fnqI3lkI7ph43or5UhJyk7CgkJCQkJJGRsU2hhZG93LmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoKCQl2YXIgbG9vcGVyID0gbmV3IEludGVydmFsTG9vcChbXSwgcHJvY19oYXNoLCA1MDApOwoJCWxvb3Blci5sb29wKCk7CgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBvbk1lc3NhZ2UsIGZhbHNlKTsKCQlmdW5jdGlvbiBvbk1lc3NhZ2UgKGUpIHsKCQkJdmFyIGRhdGEgPSBKU09OLnBhcnNlKGUuZGF0YSk7CgkJCWlmIChkYXRhLmFjdGlvbiA9PSAnY2FuY2VsJykgewoJCQkJJGRsU2hhZG93LmhpZGUoKTsKCQkJfSBlbHNlIGlmIChkYXRhLmFjdGlvbiA9PSAnZG93bmxvYWQnKSB7CgkJCQkkd25kRG93bmxvYWRCb3guaGlkZSgpOwoJCQkJJHduZERvd25sb2FkTWFuYWdlci5zaG93KCk7CgoJCQkJbG9vcGVyLmFkZC5hcHBseShsb29wZXIsIGRhdGEuZGF0YSk7CgkJCX0gZWxzZSB7CgkJCQlILmVycm9yKCdVbmRlZmluZWQgYWN0aW9uOiAnICsgZGF0YS5hY3Rpb24pOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVfZGwgKHNvbmcpIHsKCQkJdmFyIGZpbGUgPSBzb25nLmZpbGVOYW1lICsgJy4nICsgc29uZy5leHROYW1lOwoJCQl2YXIgdXJsID0gc29uZy51cmw7CgoJCQlwb3N0KCdhZGQnLCBzb25nKTsKCQkJaWYgKEguY29uZmlnLmRVcmlUeXBlID09PSAyLyogVVJJX1VTRV9BUklBICovKSB7CgkJCQlILmFkZFRvQXJpYSh1cmwsIGZpbGUpOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBwcm9jX2hhc2ggKG5leHQsIGhhc2gpIHsKCQkJaGFzaCA9IGhhc2gudG9Mb3dlckNhc2UoKTsKCQkJdmFyIGtleSA9IENyeXB0b0pTLk1ENShoYXNoICsgJ2tnY2xvdWQnKS50b1N0cmluZygpOwoJCQlHTV94bWxodHRwUmVxdWVzdCh7CgkJCQltZXRob2Q6ICdHRVQnLAoJCQkJdXJsOiAnaHR0cDovL3RyYWNrZXJjZG4ua3Vnb3UuY29tL2kvP2NtZD00Jmhhc2g9JyArIGhhc2ggKyAnJmtleT0nICsga2V5ICsgJyZwaWQ9MSZmb3JjZURvd249MCZ2aXA9MScsCgkJCQlvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewoJCQkJCXZhciBzb25nID0gSlNPTi5wYXJzZShyZXNwb25zZS5yZXNwb25zZVRleHQpOwoJCQkJCWhhbmRsZV9kbChzb25nKTsKCQkJCQluZXh0KCk7CgkJCQl9LAoJCQkJb25lcnJvcjogZnVuY3Rpb24gKCkgewoJCQkJCUguZXJyb3IoJ0Vycm9yIHdoaWxlIGZldGNoaW5nIGRhdGEgZm9yICVzJywgaGFzaCk7CgkJCQkJbmV4dCgpOwoJCQkJfQoJCQl9KTsKCQl9CgoJCS8qIOWvvOWHuuWHveaVsCAqLwoJCWV4cG9ydEZ1bmN0aW9uKGhhbmRsZURvd25sb2FkLCB1bnNhZmVXaW5kb3csIHsKCQkJZGVmaW5lQXM6ICJkbF9qaXh1biIKCQl9KTsKCgkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoKSB7CgkJCWRvd25Mb2FkID0gZGxfaml4dW47CgkJfSk7Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIG11c2ljLm95aW55dWUuanMgKi8KewoJaWQ6ICdtdXNpYy5veWlueXVlJywKCW5hbWU6ICflmaLpn7PkuZDkuIvovb3op6PmnpAnLAoJaG9zdDogJ295aW55dWUuY29tJywKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5iZWdpbldpdGggKGxvY2F0aW9uLnBhdGhuYW1lLCAnL0Rvd24uYXNweCcpKSB7CgkJCXRoaXMuZG93blBhZ2UgKCk7CgkJCXJldHVybiA7CgkJfQoKCQlILndhaXRVbnRpbCAoJ3BsYXllci5zZXRVcmwnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCQlzZXRVcmw6IGZ1bmN0aW9uIChzb25nVXJsKSB7CgkJCQkJJCgnLmZ1bmNfaWNvbjQgPiBhJykuYXR0cih7CgkJCQkJCSdocmVmJzogc29uZ1VybCwKCQkJCQkJJ3RhcmdldCc6ICdfYmxhbmsnCgkJCQkJfSkuaHRtbCgnPGIvPuebtOmTvuS4i+i9vScpOwoKCQkJCQl0aHJvdyBuZXcgRXJyb3JVbnNhZmVTdWNjZXNzICgpOwoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cucGxheWVyLCAnLnBsYXllcicpCgkJfSk7Cgl9LAoKCWRvd25QYWdlOiBmdW5jdGlvbiAoKSB7CgkJdmFyICRkbCA9ICQoJzxwPicpLnByZXBlbmRUbyAoJCgnLnNpbmdfdmlldycpKS50ZXh0KCfmraPlnKjop6PmnpDpn7PkuZDlnLDlnYDigKYnKTsKCQl0aGlzLmZldGNoICgkX0dFVC5pZCwgZnVuY3Rpb24gKHNvbmdVcmwpIHsKCgkJCSRkbC50ZXh0KCfop6PmnpDlrozmr5U6ICcpLmFwcGVuZCAoJCgnPGE+JykuYXR0cih7CgkJCQlocmVmOiBzb25nVXJsLAoJCQkJdGFyZ2V0OiAnX2JsYW5rJwoJCQl9KS50ZXh0KCfngrnmiJHkuIvovb0nKSk7CgoJCX0sIGZ1bmN0aW9uICgpIHsKCQkJJGRsLnRleHQgKCcqIOS4i+i9veino+aekOWksei0pe+8jOivt+iuv+mXruatjOabsumhteino+aekOOAgicpCgkJCQkuY3NzICgnY29sb3InLCAncmVkJyk7CgkJfSk7Cgl9LAoKCWZldGNoOiBmdW5jdGlvbiAoc29uZ0lkLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWxDYWxsYmFjaykgewoJCSQuYWpheCAoewoJCQl1cmw6ICcvbG9hZC9sb2Fkc29uZy5hc2h4JywKCQkJbWV0aG9kOiAnUE9TVCcsCgkJCWRhdGE6IHsKCQkJCXNvbmdpZDogc29uZ0lkLAoJCQkJaWQ6IDMKCQkJfSwKCQkJZGF0YVR5cGU6ICd0ZXh0JwoJCX0pLnN1Y2Nlc3MgKGZ1bmN0aW9uICh1cmwpIHsKCQkJaWYgKHVybCAmJiB1cmwgIT0gJzAnKSB7CgkJCQlzdWNjZXNzQ2FsbGJhY2sgKHVybCk7CgkJCX0gZWxzZSB7CgkJCQlmYWlsQ2FsbGJhY2sgKCk7CgkJCX0KCQl9KS5lcnJvciAoZnVuY3Rpb24gKCkgewoJCQlmYWlsQ2FsbGJhY2sgKCk7CgkJfSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMucXEuaXBsaW1pdC5qcyAqLwooewoJaWQ6ICdtdXNpYy5xcS5pcGxpbWl0JywKCW5hbWU6ICdRUSDpn7PkuZDjgIHnlLXlj7DmtbflpJborr/pl67pmZDliLbop6PpmaQnLAoJaG9zdDogWyd5LnFxLmNvbScsICdpLnkucXEuY29tJywgJ2ZtLnFxLmNvbSddLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCS8vIE1WIOmhtemdouino+mUgQoJCWlmIChkb2N1bWVudC5jb29raWUuaW5kZXhPZignaXBfbGltaXQ9MScpID09IC0xKSB7CgkJCWRvY3VtZW50LmNvb2tpZSA9ICdpcF9saW1pdCA9IDE7IGV4cGlyZXM9JyArIChuZXcgRGF0ZSgnMjA5OS8wMS8wMScpKS50b0dNVFN0cmluZygpICsgIjsgZG9tYWluPS5xcS5jb207IjsKCQl9Cgl9LAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJSC5pbmZvICgn562J5YCZ5rW35aSW6K6/6Zeu6ZmQ5Yi25qih57uE5Yqg6L294oCmJyk7CgkJSC53YWl0VW50aWwgKCdNVVNJQy53aWRnZXQubWFpbi5JUF9saW1pdC5pc0xpbWl0JywgZnVuY3Rpb24gKCkgewoJCQlILmluZm8gKCfmtbflpJborr/pl67pmZDliLbop6PpmaQuJyk7CgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uICh7CgkJCQkvLyDop6PpmaTjgIxRUemfs+S5kOaaguaXtuS4jeiDveWvueaCqOaJgOWcqOeahOWbveWutuaIluWcsOWMuuaPkOS+m+acjeWKoeOAjemZkOWItgoJCQkJaXNMaW1pdDogZnVuY3Rpb24gKCkge30KCQkJfSwgdW5zYWZlV2luZG93Lk1VU0lDLndpZGdldC5tYWluLklQX2xpbWl0LCAnLk1VU0lDLndpZGdldC5tYWluLklQX2xpbWl0Jyk7CgkJfSk7Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIG11c2ljLnFxLnkuanMgKi8KewoJaWQ6ICdtdXNpYy5xcS55JywKCW5hbWU6ICdRUSDpn7PkuZDkuIvovb3op6PmnpAnLAoJaG9zdDogWyd5LnFxLmNvbScsICdzb3NvLm11c2ljLnFxLmNvbSddLAoJbm9TdWJIb3N0OiB0cnVlLAoKCWNzczogLyogUmVzb3VyY2U6IGNvbS5xcS55LmRsLmNzcyAqLwpILmV4dHJhY3QoZnVuY3Rpb24gKCkgeyAvKgpAbWVkaWEgc2NyZWVuIHsKCS5tX3BsYXllciAuYmFyX29wIHsKCQlsZWZ0OiAgMjA4cHg7CgkJd2lkdGg6IDMxMHB4OwoJfQoKCS5qeF9kbF9idCB7CgkJdHJhbnNmb3JtOiByb3RhdGUoOTBkZWcpOwoJfQoKCS5qeF9kbF9idCA+IGEgewoJCXdpZHRoOiAgIDEwMCU7CgkJaGVpZ2h0OiAgMTAwJTsKCQlkaXNwbGF5OiBibG9jazsKCQlvdXRsaW5lOiAwICFpbXBvcnRhbnQ7Cgl9Cn0KCiovfSksCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT0gMSkgewoJCQlILndhcm4gKAoJCQkJJyVzXG4lcycsCgkJCQkn5b2T5YmN54mI5pys55qE5Y2P6K6u5bCa5pyq5pSv5o+0IENvb2tpZSDovpPlhaUsIOWbnua7muiHs+i/nuaOpeeJiCcsCgkJCQkn5aaC5p6c5oKo56Gu5a6e6ZyA6KaB6Ieq5Yqo5aGr5YWl55So5oi35ZCNLCDor7fmlLnnlKggQXJpYTIg54mIJwoJCQkpOwoKCQkJSC5jb25maWcuZFVyaVR5cGUgPSAwOwoJCX0KCgkJdmFyIHN0eWxlVG9GaXggPSB0aGlzLnN0eWxlQmxvY2s7CgoJCUgud2FpdFVudGlsICgnTVVTSUMubW9kdWxlLndlYlBsYXllci5pbnRlckZhY2UuZ2V0U29uZ1VybCcsIGZ1bmN0aW9uICgpIHsKCQkJSC5maXhTdHlsZU9yZGVyIChzdHlsZVRvRml4KTsKCgkJCXZhciBkbEJ0biA9ICQoJzxhPicpCgkJCQkuYWRkQ2xhc3MoJ2FyaWEtY29va2llJykKCQkJCS5hdHRyKCd0aXRsZScsICfmkq3mlL7pn7PkuZAsIOWNs+WIu+S4i+i9vScpCgkJCQkuYXBwZW5kVG8gKAoJCQkJCSQoJzxzdHJvbmc+JykKCQkJCQkJLmFkZENsYXNzICgnbmV4dF9idCBqeF9kbF9idCcpCgkJCQkJCS5pbnNlcnRBZnRlciAoJy5uZXh0X2J0JykKCQkJCSk7CgoJCQl1bnNhZmVFeGVjIChmdW5jdGlvbiAoc2NyaXB0TmFtZSkgewoJCQkJdmFyIG9sZEdldFNvbmcgPSB3aW5kb3cuTVVTSUMubW9kdWxlLndlYlBsYXllci5pbnRlckZhY2UuZ2V0U29uZ1VybDsKCgkJCQl3aW5kb3cuTVVTSUMubW9kdWxlLndlYlBsYXllci5pbnRlckZhY2UuZ2V0U29uZ1VybCA9IGZ1bmN0aW9uIChzb25nT2JqLCBjYikgewoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQgKCBuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUsIHtkZXRhaWw6IHsKCQkJCQkJaG9zdDogJ2h0dHA6Ly9zdHJlYW0nICsgKHBhcnNlSW50KHNvbmdPYmoubXN0cmVhbSkgKyAxMCkgKyAnLnFxbXVzaWMucXEuY29tLycsCgkJCQkJCXBhdGg6ICJNODAwIiArIHNvbmdPYmoubW1pZCArICIubXAzIiwKCQkJCQkJbmFtZTogc29uZ09iai5tc29uZyArICdbJyArIHNvbmdPYmoubXNpbmdlciArICddJwoJCQkJCX0gfSkgKTsKCgkJCQkJcmV0dXJuIG9sZEdldFNvbmcuYXBwbHkgKHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQl9LCBILnNjcmlwdE5hbWUpOwoKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoSC5zY3JpcHROYW1lLCBmdW5jdGlvbiAoZSkgewoJCQkJdmFyIHNvbmdPYmogPSBlLmRldGFpbDsKCgkJCQlkbEJ0bi5hdHRyICh7CgkJCQkJaHJlZjogSC51cmkgKHNvbmdPYmouaG9zdCArIHNvbmdPYmoucGF0aCwgc29uZ09iai5uYW1lICsgJy5tcDMnKSwKCQkJCQl0aXRsZTogJ+S4i+i9vTogJyArIHNvbmdPYmoubmFtZQoJCQkJfSk7CgkJCX0sIGZhbHNlKTsKCQl9LCA3MDAwLCA1MDApOwoKCQlILndhaXRVbnRpbCAoJ01VU0lDLndpZGdldC50cmFja1NlcnYuZm9ybWF0TXVzaWMnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQkJdmFyIF9mb3JtYXRNdXNpYyA9IE1VU0lDLndpZGdldC50cmFja1NlcnYuZm9ybWF0TXVzaWM7CgkJCQlNVVNJQy53aWRnZXQudHJhY2tTZXJ2LmZvcm1hdE11c2ljID0gZnVuY3Rpb24gKCkgewoJCQkJCXZhciBfbXVzaWMgPSBfZm9ybWF0TXVzaWMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCgkJCQkJX211c2ljLm1zdGF0dXMgPSBwYXJzZUludChfbXVzaWMubXN0YXR1cykgfHwgMTsKCgkJCQkJX211c2ljLm1zaXplID0gX211c2ljLm1zaXplIHx8IDE7CgkJCQkJX211c2ljLm1pbnRlcnZhbCA9IF9tdXNpYy5taW50ZXJ2YWwgfHwgMTsKCgkJCQkJaWYgKF9tdXNpYy5tc29uZ3VybCkgewoJCQkJCQl2YXIgX3ByZTsKCQkJCQkJaWYgKF9tdXNpYy5zaXplMzIwKSB7CgkJCQkJCQlfcHJlID0gJ004MDAnOwoJCQkJCQl9IGVsc2UgaWYgKF9tdXNpYy5zaXplMTI4KSB7CgkJCQkJCQlfcHJlID0gJ001MDAnOwoJCQkJCQl9CgoJCQkJCQlpZiAoX3ByZSkgewoJCQkJCQkJX211c2ljLm1zb25ndXJsID0gJ2h0dHA6Ly9zdHJlYW0nICsgKHBhcnNlSW50KF9tdXNpYy5tc3RyZWFtKSArIDEwKSArCgkJCQkJCQkJCQkJCScucXFtdXNpYy5xcS5jb20vJyArIF9wcmUgKyBfbXVzaWMubW1pZCArICcubXAzJzsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIF9tdXNpYzsKCQkJCX07CgoJCQkJdmFyIGdldFZpcCA9IGdfdXNlci5nZXRWaXBJbmZvOwoJCQkJZ191c2VyLmdldFZpcEluZm8gPSBmdW5jdGlvbiAoc3VjY2Vzc0NiLCBmYWlsQ2IpIHsKCQkJCQlyZXR1cm4gZ191c2VyLmdldFZpcEluZm8gKGZ1bmN0aW9uIChpbmZvKSB7CgkJCQkJCWlmICgxICE9IGluZm8udmlwKSBpbmZvLnZpcCA9IDE7CgkJCQkJCWlmIChzdWNjZXNzQ2IpIHN1Y2Nlc3NDYiAoaW5mbyk7CgkJCQkJfSwgZmFpbENiKTsKCQkJCX07CgkJCX0pOwoJCX0sIDcwMDAsIDUwMCk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuc29uZ3Rhc3RlLmpzICovCnsKCWlkOiAnbXVzaWMuc29uZ3Rhc3RlJywKCW5hbWU6ICdTb25nVGFzdGUg5LiL6L296Kej5p6QJywKCWhvc3Q6IFsnc29uZ3Rhc3RlLmNvbSddLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBwYXRoID0gbG9jYXRpb24ucGF0aG5hbWU7CgkJaWYgKEguYmVnaW5XaXRoIChwYXRoLCAnL2FsYnVtLycpIHx8IEguYmVnaW5XaXRoIChwYXRoLCAnL211c2ljLycpKSB7CgkJCXRoaXMuYWxidW0gKCk7CgkJfSBlbHNlIGlmIChILmJlZ2luV2l0aCAocGF0aCwgJy9zb25nLycpKSB7CgkJCXRoaXMuc2luZ2xlICgpOwoJCX0gZWxzZSBpZiAoSC5iZWdpbldpdGggKHBhdGgsICcvcGxheW11c2ljLnBocCcpKSB7CgkJCXRoaXMucGxheWxpc3QgKCk7CgkJfQoJfSwKCgoJYWxidW06IGZ1bmN0aW9uICgpIHsKCQlILmxvZyAoJ1NUIDo6IOS4k+i+kemhtemdouiwg+aVtCcpOwoJCXZhciBidG5fcGxheUFsbCA9ICQoJCgnLnNvbmdfZnVuX2J0bicpLmNoaWxkcmVuKClbMV0pOwoJCXZhciBidG5fbm9Qb3BQbGF5ID0gYnRuX3BsYXlBbGwuY2xvbmUoKS5hdHRyKHsKCQkJJ3ZhbHVlJzogJ+W9k+WJjeeql+WPo+aSreaUvicsCgkJCSdvbmNsaWNrJzogJycKCQl9KS5pbnNlcnRBZnRlciAoYnRuX3BsYXlBbGwpOwoKCQlidG5fbm9Qb3BQbGF5LmNsaWNrKGZ1bmN0aW9uICgpIHsKCQkJdmFyIGlkcyA9IFtdLmZpbHRlci5jYWxsICh1bnNhZmVXaW5kb3cuY2hrQXJyYXksIGZ1bmN0aW9uIChlKSB7CgkJCQlyZXR1cm4gZS5jaGVja2VkOwoJCQl9KS5tYXAgKGZ1bmN0aW9uIChlKSB7CgkJCQlyZXR1cm4gZS52YWx1ZTsKCQkJfSkuam9pbignLCcpOwoKCQkJaWYgKCFpZHMpIHsKCQkJCWlkcyA9IFtdLm1hcC5jYWxsKHVuc2FmZVdpbmRvdy5jaGtBcnJheSwgZnVuY3Rpb24gKGUpIHsKCQkJCQlyZXR1cm4gZS52YWx1ZTsKCQkJCX0pLmpvaW4gKCcsJyk7CgkJCX0KCgkJCWxvY2F0aW9uLmhyZWYgPSAnL3BsYXltdXNpYy5waHA/c29uZ19pZD0nICsgaWRzOwoJCX0pOwoJfSwKCglzaW5nbGU6IGZ1bmN0aW9uICgpIHsKCQl2YXIgYXJncyAgICA9ICQoIiNwbGF5aWNvbiBhIikuYXR0cignaHJlZicpLnJlcGxhY2UoL1xzL2csICcnKS5yZXBsYWNlKC8iL2csICInIikuc3BsaXQoIiciKTsKCQl2YXIgc1VSTCAgICA9IGFyZ3MgWzA1XSwKCQkJc1R5cGUgICA9IGFyZ3MgWzExXSwKCQkJc0hlYWQgICA9IGFyZ3MgWzEzXSwKCQkJc29uZ0lkICA9IGFyZ3MgWzE1XSwKCQkJc0xlbmd0aCA9IGFyZ3MgWzE2XS5tYXRjaCAoL1xkezIsfS8pWzBdOwoKCQl2YXIgcSA9ICQuRGVmZXJyZWQoKTsKCQlxLnRoZW4gKGZ1bmN0aW9uIChzb25nVXJsKSB7CgkJCUgubG9nICgnU1QgOjog6Kej5p6Q6Z+z5LmQ5Zyw5Z2AIDo6ICVzJywgc29uZ1VybCk7CgkJCXZhciBzb25nTmFtZSA9ICQoJy5taWRfdGl0JykudGV4dCgpOwoKCQkJJCgnYSNjdXN0b21fMScpLmF0dHIoewoJCQkJJ2hyZWYnOiBILnVyaShzb25nVXJsLCBzb25nTmFtZSArIHNvbmdVcmwuc2xpY2UoLTQpKSwKCQkJCSd0aXRsZSc6ICfkuIvovb06ICcgKyBzb25nTmFtZQoJCQl9KS50ZXh0KCfnm7TmjqXkuIvovb0nKTsKCQl9KTsKCgkJaWYgKEguY29udGFpbnMoc1VSTCwgJ3JheWZpbGUnKSkgewoJCQlxLnJlc29sdmUgKHNIZWFkICsgc1VSTCArIHVuc2FmZVdpbmRvdy5HZXRTb25nVHlwZShzVHlwZSkpOwoJCX0gZWxzZSB7CgkJCSQuYWpheCh7CgkJCQl0eXBlOiAnUE9TVCcsCgkJCQl1cmw6ICcvdGltZS5waHAnLAoJCQkJY2FjaGU6IHRydWUsCgkJCQlkYXRhOiAnc3RyPScgKyBzVVJMICsgJyZzaWQ9JyArIHNvbmdJZCArICcmdD0nICsgc0xlbmd0aCwKCQkJCWRhdGFUeXBlOiAndGV4dCcsCgkJCX0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHIpIHsKCQkJCXEucmVzb2x2ZSAocik7CgkJCX0pOwoJCX0KCX0sCgoJcGxheWxpc3Q6IGZ1bmN0aW9uICgpIHsKCQkvLyDkuIvovb3op6PmnpAgLSBIb29rIOabtOaNouatjOabsueahOWHveaVsO+8jOmBv+WFjemHjeWkjeivu+WPluatjOabsiArIOS4jemcgOimgeWkmuasoeivt+axguacjeWKoeWZqOS4jeWuueaYk+aOiee6v+OAggoJCUgubG9nICgnU1QgOjog5YiX6KGo5qih5byP6Kej5p6QJyk7CgoJCXZhciBwRG93bmxvYWQgPSAkKCcjbGVmdF9tdXNpY19kaXYgPiAucF9mdW4gPiBhOmxhc3QnKQoJCQkudGV4dCgn55u05o6l5LiL6L29JykKCQkJLmF0dHIoJ3RhcmdldCcsICdfYmxhbmsnKTsKCgkJdW5zYWZlT3ZlcndyaXRlRnVuY3Rpb25TYWZlUHJveHkgKHsKCQkJY2hhbmdlU29uZzogZnVuY3Rpb24gKG5hbWUsIHVybCwgaXNMb2dvU2hvd24pIHsKCQkJCS8vIDIwMTMuMDMuMTkgJiAyMDEzLjA0LjA5IOS/ruatozoKCQkJCS8vICAg5bey57uP5Yig6Zmk55qE5q2M5puy6Ieq5Yqo6Lez5Yiw5LiL5LiA5puyCgkJCQlpZiAoIDAgPT0gbmFtZS50cmltKCkubGVuZ3RoICkgewoJCQkJCXVuc2FmZVdpbmRvdy5wdS5kb1BsYXlOZXh0KDIpOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJCUgubG9nICgn6K+35rGC5q2M5puyIDo6ICVzIDo6ICVzJywgbmFtZSwgdXJsKTsKCQkJCXBEb3dubG9hZC5hdHRyKHsKCQkJCQknaHJlZic6IEgudXJpKHVybCwgbmFtZSArIHVybC5zbGljZSgtNCkpLAoJCQkJCSd0aXRsZSc6ICfkuIvovb06ICcgKyBuYW1lCgkJCQl9KTsKCQkJCWRvY3VtZW50LnRpdGxlID0gJ1NUIC0gJyArIG5hbWU7CgoJCQkJLy8g6L2s5o6l57uZ5Y6f5Ye95pWwCgkJCQl0aHJvdyBuZXcgRXJyb3JVbnNhZmVTdWNjZXNzKCk7CgkJCX0sCgoJCQlkZWxTb25nRGl2OiBmdW5jdGlvbiAoc29uZ2lkLCBpc2JveCkgewoJCQkJSC5sb2cgKCfliKDpmaTmrYzmm7IgOjogJyArIHNvbmdpZC50b1N0cmluZygpKTsKCQkJCSQoJyMnICsgc29uZ2lkKS5oaWRlKCk7CgoJCQkJdmFyIG5ld19zb25nbGlzdCA9IFtdOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB1bnNhZmVXaW5kb3cuYXJyX2lkcy5sZW5ndGg7IGkrKykgewoJCQkJCWlmICh1bnNhZmVXaW5kb3cuYXJyX2lkc1tpXSA9PSBzb25naWQpIHsKCQkJCQkJaWYgKHNvbmdpZCA9PSB1bnNhZmVXaW5kb3cuY3VyX3NpZCkKCQkJCQkJCXVuc2FmZVdpbmRvdy5wdS5kb1BsYXlOZXh0KDEpOwoJCQkJCQl1bnNhZmVXaW5kb3cuYXJyX2lkc1tpXSA9IDA7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSk7CgoJCS8vIDIwMTMuMDMuMTkg5re75YqgOgoJCS8vICAg6YeN5bu65pKt5pS+5YiX6KGo5Zyw5Z2ACgkJJCgncC5wX2xpc3RfdHh0JykuYXBwZW5kKCQoJzxhPicpLnRleHQoJ+mHjeW7uuaSreaUvuWIl+ihqCcpLmNsaWNrKGZ1bmN0aW9uICgpIHsKCQkJbG9jYXRpb24uc2VhcmNoID0gJz9zb25nX2lkPScgKyB1bnNhZmVXaW5kb3cuYXJyX2lkcy5qb2luKCcsJyk7CgkJfSkuY3NzKCdjdXJzb3InLCAncG9pbnRlcicpKTsKCQkKCQlILmxvZyAoJ1NUIDo6IOetieW+hee9kemhteWKoOi9vS4uLicpOwoJCUgud2FpdFVudGlsICgncHUuZG9QbGF5TmV4dCcsIGZ1bmN0aW9uICgpIHsKCQkJSC5sb2cgKCdTVCA6OiDlrpjmlrnmkq3mlL7lmajliKDpmaTlip/og73kv67mraPlkK/liqgnKTsKCgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCQlkb1BsYXlOZXh0OiBmdW5jdGlvbiAodCkgewoJCQkJCXZhciBub3csIGF2bCwgaTsKCQkJCQlmb3IgKGkgPSAwOyBpIDwgdW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJaWYgKHVuc2FmZVdpbmRvdy5hcnJfaWRzW2ldID09IHVuc2FmZVdpbmRvdy5jdXJfc2lkKSB7CgkJCQkJCQlub3cgPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJLy8g5a+75om+5LiL5LiA6aaW5pyq5Yig6Zmk55qE5q2M5puy44CCCgkJCQkJLy8gICAqIDIwMTMuMDEuMjkg5L+u5q2jCgkJCQkJLy8JIDEuIOS4iuS4gOmmluafpeaJvuWksei0peeahOaDheWGteS4i+S8mua7muWbnuWIsOW9k+WJjemfs+S5kOeahOmUmeivr+OAggoJCQkJCS8vCSAyLiDlpoLmnpzmsqHmnInlj6/lkKzmrYzmm7Lmg4XlhrXkuIvml6DpmZDlvqrnjq/nmoTplJnor6/jgIIKCQkJCQkKCQkJCQlub3cgPSBNYXRoLmFicygobm93IHx8IDApICsgdCk7CgkJCQkJYXZsID0gMDsKCQkJCQkKCQkJCQkvLyDmo4Dmn6XmmK/lkKbmnInmrYzmm7LliankvZkKCQkJCQlmb3IgKGkgPSAwOyBpIDwgdW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJaWYgKHVuc2FmZVdpbmRvdy5hcnJfaWRzW2ldKSB7CgkJCQkJCQlhdmwrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoYXZsID09PSAwKSB7CgkJCQkJCWFsZXJ0KCfmrYzpg73ooqvliKDlhYnkuobov5jlkKzllaUuLi4nKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQkKCQkJCQkvLyDlr7vmib7nqbrkvY0KCQkJCQl3aGlsZSAodHJ1ZSkgewoJCQkJCQlpZiAodW5zYWZlV2luZG93LmFycl9pZHNbbm93XSkgewoJCQkJCQkJSC5sb2cgKCfliIfmjaLmrYzmm7IgOjogJyArIG5vdy50b1N0cmluZygpKTsKCQkJCQkJCXVuc2FmZVdpbmRvdy5wdS51dGlscyhub3cpOwoJCQkJCQkJdW5zYWZlV2luZG93LmN1cl9zaWQgPSB1bnNhZmVXaW5kb3cuYXJyX2lkc1tub3ddOwoJCQkJCQkJdW5zYWZlV2luZG93LnBsYXlTb25nUmlnaHQoKTsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCQlub3cgKz0gdCA+PSAwID8gMSA6IC0xOwoJCQkJCQlpZiAodW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoIDw9IG5vdykgewoJCQkJCQkJbm93ID0gMDsKCQkJCQkJfQoJCQkJCQlpZiAobm93IDwgMCkgewoJCQkJCQkJbm93ID0gdW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cucHUsICcucHUnKTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy54aWFtaS5qcyAqLwp7CglpZDogJ211c2ljLnhpYW1pJywKCW5hbWU6ICfomb7nsbPpn7PkuZAnLAoJaG9zdDogJ3d3dy54aWFtaS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJZGxfaWNvbjogdHJ1ZSwKCWNzczogLyogUmVzb3VyY2U6IGNvbS54aWFtaS5mbS5jc3MgKi8KSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsgLyoKLS0geGlhbWkgRk0gcGxheWVyIGNzcwoKLmp4X2RsIHsKCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCWNvbG9yOiAjZGRkOwoJcmlnaHQ6IDk5cHg7Cgl3aWR0aDogMThweDsKCWhlaWdodDogMThweDsKCWZvbnQtc2l6ZTogMThweDsKCXRyYW5zaXRpb246IGNvbG9yIC4zczsKfQoKLmp4X2RsOmhvdmVyIHsKCWNvbG9yOiAjYWFhOwp9CiovfSksCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXZhciB0aGF0ID0gdGhpczsKCQlILmhvb2tSZXF1aXJlICgnU0VJWUEnLCAnZG93bmxvYWQnLCBmdW5jdGlvbiAoc2NyaXB0TmFtZSwgX1NFSVlBLCBfZG93bmxvYWQsIHNvbmdJZCkgewoJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50IChuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUgKyAnLWRsQnlJZCcsIHsgZGV0YWlsOiBzb25nSWQgfSkpOwoKCQkJcmV0dXJuIHRydWU7CgkJfSwgSC5zY3JpcHROYW1lKTsKCgkJSC53YWl0VW50aWwgKCdLSVNTWS51c2UnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uIChzY3JpcHROYW1lKSB7CgkJCQl3aW5kb3cuS0lTU1kudXNlICgncGFnZS9tb2RzL3BsYXllcicsIGZ1bmN0aW9uIChfS0lTU1ksIG1QbGF5ZXIpIHsKCQkJCQl2YXIgX3NldE11c2ljSW5mbyA9IG1QbGF5ZXIucHJvdG90eXBlLnNldE11c2ljSW5mbzsKCQkJCQltUGxheWVyLnByb3RvdHlwZS5zZXRNdXNpY0luZm8gPSBmdW5jdGlvbiAoc29uZ09iaikgewoJCQkJCQl0aGlzLmlzVklQID0gdHJ1ZTsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAobmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lICsgJy1kbEJ5T2JqJywgeyBkZXRhaWw6IEpTT04ucGFyc2UgKHNvbmdPYmopIH0pKTsKCQkJCQkJcmV0dXJuIF9zZXRNdXNpY0luZm8uYXBwbHkgKHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfTsKCQkJCX0pOwoJCQl9LCBILnNjcmlwdE5hbWUpOwoJCX0pOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUgKyAnLWRsQnlJZCcsIGZ1bmN0aW9uIChlKSB7CgkJCXRoYXQuZmV0Y2ggKGUuZGV0YWlsLCBmdW5jdGlvbiAoc29uZ09iaikgewoJCQkJR01fb3BlbkluVGFiICggSC51cmkgKHNvbmdPYmouc3JjLCBzb25nT2JqLnRpdGxlICsgJ1snICsgc29uZ09iai5hcnRpc3QgKyAnXScgKyAnLm1wMycpLCBmYWxzZSApOwoJCQl9KTsKCQl9LCBmYWxzZSk7CgoJCXRoYXQuZGxCdG4gPSAkKCc8YT4nKQoJCQkuYWRkQ2xhc3MgKEguZGVmYXVsdERsSWNvbikKCQkJLmF0dHIoJ3RpdGxlJywgJ+etieW+heiOt+WPlumfs+S5kOS/oeaBr+KApicpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUgKyAnLWRsQnlPYmonLCBmdW5jdGlvbiAoZSkgewoJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoJCQl0aGF0LmRsQnRuCgkJCQkuYXR0ciAoJ2hyZWYnLCAgSC51cmkgKHRoYXQuZGVjcnlwdCAoIHNvbmdPYmoudXJsICksIHNvbmdPYmouc29uZyArICdbJyArIHNvbmdPYmouYXJ0aXN0ICsgJ10nICsgJy5tcDMnKSkKCQkJCS5hdHRyICgndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5zb25nICsgJyBbYnkgJyArIHNvbmdPYmouYXJ0aXN0ICsgJ10nKTsKCQl9LCBmYWxzZSk7Cgl9LAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCUgud2FpdFVudGlsIChmdW5jdGlvbiAoKSB7CgkJCXJldHVybiAkKCcjSl90cmFja0ZhdicpLmxlbmd0aDsKCQl9LCBmdW5jdGlvbiAoKSB7CgkJCXRoaXMuZGxCdG4uaW5zZXJ0QmVmb3JlICgkKCcjSl90cmFja0ZhdicpKTsKCQl9LmJpbmQgKHRoaXMpKTsKCX0sCgoJZmV0Y2g6IGZ1bmN0aW9uIChzb25nSWQsIGNhbGxiYWNrKSB7CgkJaWYgKCFjYWxsYmFjayB8fCAhY2FsbGJhY2suY2FsbCkKCQkJcmV0dXJuIDsKCgkJdmFyIHRoYXQgPSB0aGlzOwoJCSQuYWpheCh7CgkJCXR5cGU6ICdHRVQnLAoJCQl1cmw6ICcvc29uZy9wbGF5bGlzdC9pZC8nICsgc29uZ0lkICsgJy9vYmplY3RfbmFtZS9kZWZhdWx0L29iamVjdF9pZC8wJywKCQkJY2FjaGU6IHRydWUsCgkJCWRhdGFUeXBlOiAneG1sJwoJCX0pLnN1Y2Nlc3MgKGZ1bmN0aW9uICh4bWxEb2MpIHsKCQkJdmFyIHNvbmdPYmogPSB7fTsKCQkJW10uZm9yRWFjaC5jYWxsICh4bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUgKCd0cmFjaycpWzBdLmNoaWxkcmVuLCBmdW5jdGlvbiAoZSkgewoJCQkJLy8gY29uc29sZS5sb2cgKCclcyA9PiAlcycsIGUudGFnTmFtZSwgZS50ZXh0Q29udGVudCk7CgkJCQlzb25nT2JqW2UudGFnTmFtZV0gPSBlLnRleHRDb250ZW50OwoJCQl9KTsKCQkJc29uZ09iai5zcmMgPSB0aGF0LmRlY3J5cHQgKHNvbmdPYmoubG9jYXRpb24pOwoJCQljYWxsYmFjayAoIHNvbmdPYmogKTsKCQl9KTsKCX0sCgoJZGVjcnlwdDogZnVuY3Rpb24gKGVuY3J5cHRlZEFkZHJlc3MpIHsKCQl2YXIgc3BsaXRlciA9IHBhcnNlSW50KGVuY3J5cHRlZEFkZHJlc3NbMF0pLAoJCQlsaW5rID0gZW5jcnlwdGVkQWRkcmVzcy5zbGljZSgxKSwKCQkJcmVtYWluZGVyID0gbGluay5sZW5ndGggJSBzcGxpdGVyLAoJCQl0bXAgPSAwLAoJCQlyZXQgPSAnJywKCQkJYXJyID0gW107CgoJCWZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXRlcjsgaSsrKSB7CgkJCWFyci5wdXNoICgocmVtYWluZGVyID4gaSA/IDEgOiAwKSArIChsaW5rLmxlbmd0aCAtIHJlbWFpbmRlcikgLyBzcGxpdGVyKTsKCQl9CgoJCWZvciAoaSA9IDA7IGkgPCBhcnJbMV07IGkrKywgdG1wID0gMCkgewoJCQlmb3IgKHZhciBqID0gMDsgaiA8IHNwbGl0ZXI7IGorKykgewoJCQkJcmV0ICs9IGxpbmtbdG1wICsgaV07CgkJCQl0bXAgKz0gYXJyW2pdOwoJCQl9CgkJfQoJCXJldHVybiB1bmVzY2FwZShyZXQuc3Vic3RyKDAsIGxpbmsubGVuZ3RoKSkucmVwbGFjZSgvXF4vZywgJzAnKS5yZXBsYWNlKC9cKy9nLCAnICcpOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIG11c2ljLnlpbnl1ZXRhaS5qcyAqLwp7CglpZDogJ211c2ljLnlpbnl1ZXRhaScsCgluYW1lOiAn6Z+z5oKm5Y+w5LiL6L296Kej5p6QJywKCWhvc3Q6IFsneWlueXVldGFpLmNvbSddLAoKCV9saW5rSG9sZGVyOiBudWxsLAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguYmVnaW5XaXRoIChsb2NhdGlvbi5wYXRobmFtZSwgJy92aWRlby8nKSkgewoJCQl0aGlzLl9saW5rSG9sZGVyID0gJCgnPHNwYW4+JykuY3NzICh7CgkJCQljb2xvcjogJ3doaXRlJywKCQkJCWZvbnRTaXplOiAnc21hbGwnLAoJCQkJbWFyZ2luTGVmdDogJzEuNWVtJwoJCQl9KS5hcHBlbmRUbyAoJCgnLnZjaGFydCwgLnBsX3RpdGxlJykuZmlyc3QoKSk7CgoJCQl0aGlzLmZldGNoKGxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9cZCskLylbMF0pOwoJCX0gZWxzZSB7CgkJCUgud2FpdFVudGlsIChmdW5jdGlvbiAoKSB7CgkJCQlyZXR1cm4gJCgnLkpfdmlkZW9faW5mbycpLmxlbmd0aDsKCQkJfSwgdGhpcy5wcm9jTGlzdFBhZ2UuYmluZCAodGhpcykpOwoJCX0KCX0sCgoJcHJvY0xpc3RQYWdlOiBmdW5jdGlvbiAoKSB7CgkJSC5pbmZvICgn5bCx57uqLicpOwoKCQl2YXIgbW8gPSBuZXcgTXV0YXRpb25PYnNlcnZlciAoZnVuY3Rpb24gKCkgewoJCQlILmluZm8gKCdNViDlt7Lmm7TmlrAsIOaKk+WPluaWsOeahOS4i+i9veWcsOWdgC4uJyk7CgkJCXRoaXMuX2xpbmtIb2xkZXIgPSAkKCc8cD4nKS5wcmVwZW5kVG8gKCcuSl9tdl9jb250ZW50Jyk7CgkJCXRoaXMuZmV0Y2goJCgnLkpfdmlkZW9faW5mbyA+IGEnKS5hdHRyKCdocmVmJykubWF0Y2ggKC9cZCsvKSk7CgkJfS5iaW5kICh0aGlzKSk7CgoJCW1vLm9ic2VydmUgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5KX3ZpZGVvX2luZm8nKSwgewoJCQljaGlsZExpc3Q6IHRydWUKCQl9KTsKCX0sCgoJZmV0Y2g6IGZ1bmN0aW9uICh2aWRlb0lkKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCUdNX3htbGh0dHBSZXF1ZXN0ICh7CgkJCW1ldGhvZDogJ0dFVCcsCgkJCXVybDogJ2h0dHA6Ly93d3cueWlueXVldGFpLmNvbS9pbnNpdGUvZ2V0LXZpZGVvLWluZm8/anNvbj10cnVlJnZpZGVvSWQ9JyArIHZpZGVvSWQsCgkJCW9ubG9hZDogZnVuY3Rpb24gKHUpIHsKCQkJCXRyeSB7CgkJCQkJdmFyIHIgPSBKU09OLnBhcnNlICh1LnJlc3BvbnNlVGV4dCk7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdGhhdC5fbGlua0hvbGRlci50ZXh0KCfop6PmnpDlpLHotKXvvJrmlbDmja7moLzlvI/plJnor6/jgIInKTsKCQkJCQlyZXR1cm4gOwoJCQkJfQoKCQkJCWlmIChyLmVycm9yKSB7CgkJCQkJdGhhdC5fbGlua0hvbGRlci50ZXh0KCfop6PmnpDlpLHotKXvvJonICsgci5tZXNzYWdlKTsKCQkJCQlyZXR1cm4gOwoJCQkJfQoKCQkJCUguaW5mbyAoJ+ino+aekOWujOavlSwg5Yqg5YWl5LiL6L295Zyw5Z2ALi4nKTsKCQkJCXRoYXQuYWRkRG93bmxvYWQgKHIudmlkZW9JbmZvLmNvcmVWaWRlb0luZm8pOwoJCQl9LAoJCQlvbmVycm9yOiBmdW5jdGlvbiAocikgewoJCQkJdGhhdC5fbGlua0hvbGRlci50ZXh0KCflvojmirHmrYksIOino+aekOS4i+i9veWcsOWdgOWksei0pS4uJyk7CgkJCX0KCQl9KTsKCX0sCgoJYWRkRG93bmxvYWQ6IGZ1bmN0aW9uICh2aWRlb0luZm8pIHsKCQl0aGlzLl9saW5rSG9sZGVyLnRleHQoJ+S4i+i9vTogJyk7CgkJdmFyIHJhd0xpbmtzID0gdmlkZW9JbmZvLnZpZGVvVXJsTW9kZWxzOwoKCQlmb3IgKHZhciBpID0gcmF3TGlua3MubGVuZ3RoOyBpLS07ICkgewoJCQkkKCc8YT4nKS50ZXh0KHJhd0xpbmtzW2ldLlF1YWxpdHlMZXZlbE5hbWUpCgkJCQkvLyBUT0RPIGZpeCB0aGUgbmFtZQoJCQkJLmF0dHIoJ2hyZWYnLCBILnVyaSgKCQkJCQlyYXdMaW5rc1tpXS52aWRlb1VybCwgCgkJCQkJSC5zcHJpbnRmKCclcyBbJXNdWyVzXSVzJywKCQkJCQkJdmlkZW9JbmZvLnZpZGVvTmFtZSwKCQkJCQkJdmlkZW9JbmZvLmFydGlzdE5hbWUsCgoJCQkJCQlyYXdMaW5rc1tpXS5RdWFsaXR5TGV2ZWxOYW1lLAoJCQkJCQlILmdldExpbmtFeHQocmF3TGlua3NbaV0udmlkZW9VcmwpKQoJCQkJKSkKCQkJCS5hdHRyKCd0aXRsZScsICfkuIvovb06ICcgKyB2aWRlb0luZm8udmlkZW9OYW1lKS5hcHBlbmRUbyh0aGlzLl9saW5rSG9sZGVyKQoJCQkJLmFkZENsYXNzICgnY19jZjknKTsKCgkJCXRoaXMuX2xpbmtIb2xkZXIuYXBwZW5kKCcgfCAnKTsKCQl9CgoJCXRoaXMuX2xpbmtIb2xkZXIuYXBwZW5kKEguc3ByaW50ZiAoJ+aPkOS+mzogJXMgJXMgJywgSC5zY3JpcHROYW1lLCBILnZlcnNpb24pKTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBwaHBkaXNrLmEuanMgKi8KewoJaWQ6ICdwaHBkaXNrLmEnLAoJbmFtZTogJ+mAmueUqCBwaHBEaXNrLmEg572R55uY6KeE5YiZJywKCS8vIOebuOWFs+inhOWImTog6Lez6L2sIC9maWxlLXh4eCAtPiAvZG93bmxvYWQucGhwP2lkPXh4eCZrZXk9eHh4CgkKCWhvc3Q6IFsKCQknNzlwYW4uY29tJywgJzAzeGcuY29tJywKCQkKCQknN212LmNjJywgJ3Bhbi41Mnp6Lm9yZycsICcyNThwYW4uY29tJywgJ2h1aW1laWt1LmNvbScKCV0sCgoJaGlkZTogWycjY29kZV9ib3gnLCAnI2Rvd25fYm94MicsICcjY29kZWZybScsICcuYWQnLCAnW2NsYXNzXj0iYmFubmVyIl0nXSwKCXNob3c6ICcjZG93bl9ib3gnLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl1bnNhZmVPdmVyd3JpdGVGdW5jdGlvblNhZmVQcm94eSAoewoJCQlvcGVuOiB0RnVuYwoJCX0pOwoJfSwKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCUgud2FpdFVudGlsICgnZG93bl9maWxlX2xpbmsnLCBmdW5jdGlvbiAoKSB7CgkJCS8vIOmBv+WFjeWcsOWdgOiiq+imhueblgoJCQl1bnNhZmVXaW5kb3cudXBkYXRlX3NlYyA9IG51bGw7CgkJCS8vIOW8uuWItuaYvuekuuWcsOWdgAoJCQl1bnNhZmVXaW5kb3cuZG93bl9maWxlX2xpbmsgKCk7CgoJCQkvLyDlvLrliLbmmL7npLrkuIvovb3lnLDlnYAKCQkJaWYgKHVuc2FmZVdpbmRvdy5zaG93X2Rvd25fdXJsKQoJCQkJdW5zYWZlV2luZG93LnNob3dfZG93bl91cmwgKCdkb3duX2ExJyk7CgoJCQl2YXIganVtcFVybCA9ICQoJyNkb3duX2xpbmsnKS5maW5kKCdhJykuYXR0cignaHJlZicpOwoKCQkJLy8g54S25ZCO6Lez6L+H5Y67CgkJCWlmIChqdW1wVXJsKSB7CgkJCQlILnJlRGlyV2l0aFJlZiAoanVtcFVybCk7CgkJCX0gZWxzZSB7CgkJCQlhbGVydCAoSC5zcHJpbnRmKCdbJXNdOiDlupTnlKggJXMg5aSx6LSlOlxu5om+5LiN5Yiw6Lez6L2s5Zyw5Z2ALicsIEguc2NyaXB0TmFtZSwgdGhpcy5uYW1lKSk7CgkJCX0KCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBwaHBkaXNrLnouanMgKi8KewoJaWQ6ICdwaHBkaXNrLnonLAoJbmFtZTogJ+mAmueUqCBwaHBEaXNrLnog572R55uY6KeE5YiZJywKCS8vIOinhOWImTog55u05o6l6Lez6L2sIC9maWxlLXh4eCAtPiAvZG93bi14eHgKCS8vICAgICAgIOW5tumakOiXjyBkb3duX2JveDIsIOaYvuekuiBkb3duX2JveAoJCglob3N0OiBbCgkJJ3dwYW4uY2MnLCAneXBhbi5jYycsCgkJJ2F6cGFuLmNvbScsICdneGRpc2suY29tJywgJzJrdWFpLmNvbScsICcxd3AubWUnLCAKCQknNzdwYW4uY2MnLCAndnZwYW4uY29tJywgJ2ZtZGlzay5jb20nLCAnYngwNjM1LmNvbScsCgkJJzEwcGFuLmNjJywgJzFwYW4uY2MnLCAnMTIzd3p3cC5jb20nLCAnd3dwNS5jb20nLAoJCSdmeWRpc2suY29tJwoJXSwKCWhpZGU6IFsKCQkvLyBhenBhbiwgZ3hkaXNrCgkJJy5Eb3ducGFnZWJveCcsCgoJCScudGFsa19zaG93JywgJy5iYW5uZXJfMicsICcud18zMDUnLAoKCQkvLyAya3VhaS5jb20KCQknLmFkJywgJyN2Y29kZScsICcjdHVpJywgJy5kY29kZScsICcjZG93bl9ib3gyJywgJyNkbF90aXBzJywgJy5uYWwnLCAnLnNjYmFyX2hvdF90ZCcsICcjaW5jb2RlJwoJXSwKCXNob3c6IFsKCQkvLyAya3VhaS5jb20KCQknI2Rvd25fYm94JywgJyNkbF9hZGRyJwoJXSwKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl1bnNhZmVEZWZpbmVGdW5jdGlvbiAoJ2Rvd25fcHJvY2VzcycsIHRGdW5jKTsKCQlILnBocERpc2tBdXRvUmVkaXIgKCk7Cgl9Cn0KIF07CgoJaWYgKEguY29uZmlnLmJVc2VDdXN0b21SdWxlcykgewoJCXRyeSB7CgkJCVtdLnNwbGljZS5hcHBseSAoc2l0ZXMsIFswLCAwXS5jb25jYXQoZXZhbCAoSC5zcHJpbnRmKCdbJXNcbl0nLCBILmNvbmZpZy5zQ3VzdG9tUnVsZSkpKSk7CgkJfSBjYXRjaCAoZSkgewoJCQlILmluZm8gKCfop6PmnpDoh6rlrprkuYnop4TliJnml7blj5HnlJ/plJnor686ICVzJywgZS5tZXNzYWdlKTsKCQl9Cgl9CgoJdmFyIGhhbmRsZVNpdGUgPSAoZnVuY3Rpb24gKCkgewoJCS8vIOaJqeWxleinhOWImeWHveaVsApILnJ1bGUgPSB7CgljaGVja1BhdGg6IGZ1bmN0aW9uIChwYXRoLCBydWxlKSB7CgkJaWYgKHJ1bGUgaW5zdGFuY2VvZiBBcnJheSkgewoJCQlpZiAocnVsZS5sZW5ndGggPT09IDApCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQlmb3IgKHZhciBpID0gcnVsZS5sZW5ndGg7IGktLTsgKSB7CgkJCQlpZiAodGhpcy5jaGVja1BhdGgocGF0aCwgcnVsZVtpXSkpCgkJCQkJcmV0dXJuIHRydWU7CgkJCX0KCgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXJldHVybiAoCgkJCS8vIEZ1bmN0aW9uCgkJCShydWxlLmNhbGwgJiYgcnVsZShwYXRoKSkKCgkJCS8vIFN0cmluZwoJCQl8fCAodHlwZW9mIHJ1bGUgPT0gJ3N0cmluZycgJiYgSC5iZWdpbldpdGggKHBhdGgsIHJ1bGUpKQoKCQkJLy8gUmVnZXggbWF0Y2gKCQkJfHwgKHJ1bGUgaW5zdGFuY2VvZiBSZWdFeHAgJiYgcnVsZS50ZXN0IChwYXRoKSkKCgkJCS8vIEZhaWxlZCB0byBtYXRjaCBhbnl0aGluZyA6PAoJCQl8fCBmYWxzZQoJCSk7Cgl9LAoJCgljaGVjazogZnVuY3Rpb24gKHNpdGUsIGV2ZSkgewoJCS8vIOWtkOaooeWdlywg5peg5Z+f5ZCN57uR5a6aCgkJaWYgKCFzaXRlLmhvc3QpCgkJCXJldHVybiA7CgoJCWZvciAodmFyIGkgPSA1OyBpLS07ICkgewoJCQlpZiAodHlwZW9mIGV2ZSA9PSAnc3RyaW5nJykgewoJCQkJZXZlID0gc2l0ZVtldmVdOwoJCQl9IGVsc2UgewoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCWlmICh0eXBlb2YgZXZlID09ICdzdHJpbmcnKSB7CgkJCUguZXJyb3IgKCdSZXBldGl0aXZlICcgKyBldmVudCArICcgaGFuZGxlciAoJyArIGV2ZSArICcpLCBza2lwIC4uJyk7CgkJCWV2ZSA9IG51bGw7CgkJCXJldHVybiA7CgkJfQoJCQoJCS8vIE1ha2UgdGhpcyB0byBhbiBhcnJheS4KCQlpZiAodHlwZW9mIHNpdGUuaG9zdCA9PSAnc3RyaW5nJykKCQkJc2l0ZS5ob3N0ID0gWyBzaXRlLmhvc3QgXTsKCgkJLy8gU2hvdWxkIGhhdmUgYXQgbGVhc3Qgb25lIHNpdGUgc2V0dXAuCgkJaWYgKCFzaXRlLmhvc3QubGVuZ3RoKSB7CgkJCUguZXJyb3IgKCdSVUxFOiBrZXkgYGhvc3RgIGlzIG1pc3NpbmchJyk7CgkJCXJldHVybiA7CgkJfQoJCQoJCQoJCS8vIOajgOafpeWfn+WQjQoJCXZhciBob3N0TWF0Y2g7CgkJaWYgKCFILmNvbnRhaW5zIChzaXRlLmhvc3QsIEgubG93ZXJIb3N0KSkgewoJCQkvLyDmmK/lkKbmo4Dmn6XlrZDln5/lkI0/CgkJCWlmIChzaXRlLm5vU3ViSG9zdCkKCQkJCXJldHVybiA7CgoJCQlob3N0ID0gSC5sb3dlckhvc3Q7CgoJCQl3aGlsZSAoKGhvc3RNYXRjaCA9IGhvc3QubWF0Y2ggKC9eLis/XC4oLispLykpKSB7CgkJCQlpZiAoSC5jb250YWlucyAoc2l0ZS5ob3N0LCBob3N0ID0gaG9zdE1hdGNoWzFdKSkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgoJCQkvLyBObyBtYXRjaGluZyBob3N0IG5hbWUKCQkJaWYgKCFob3N0TWF0Y2gpIHJldHVybjsKCQl9CgkJCgkJLy8g5qOA5p+l6Lev5b6ECgkJaWYgKHNpdGUucGF0aCAmJiAhdGhpcy5jaGVja1BhdGgobG9jYXRpb24ucGF0aG5hbWUsIHNpdGUucGF0aCkpIHsKCQkJcmV0dXJuIDsKCQl9CgkJCgkJcmV0dXJuIHRydWU7Cgl9LAoKCXJ1bjogZnVuY3Rpb24gKHNpdGUsIGV2ZW50KSB7CgkJaWYgKCFzaXRlIHx8ICFldmVudCkKCQkJcmV0dXJuIDsKCQkKCQl2YXIgZXZlID0gc2l0ZVtldmVudF07CgoJCWlmIChzaXRlLl9zdHlsZUFwcGxpZWQpCgkJCS8vIOS/ruatoyBDU1Mg5Y+v6IO96KKr6KaG55uW55qE6ZSZ6K+vCgkJCUguZml4U3R5bGVPcmRlciAoc2l0ZS5zdHlsZUJsb2NrKTsKCgkJaWYgKCFzaXRlLl9zdHlsZUFwcGxpZWQpIHsKCQkJc2l0ZS5fc3R5bGVBcHBsaWVkID0gdHJ1ZTsKCQkJSC5sb2cgKCflupTnlKggWyVzXSDnmoTmoLflvI/ooajigKYnLCBzaXRlLm5hbWUgfHwgJ+aXoOWQjScpOwoKCQkJdmFyIHN0eWxlQmxvY2sgPSBILmluamVjdFN0eWxlICgpOwoJCQlILnN0eWxlQmxvY2sgPSBzdHlsZUJsb2NrOwoKCQkJaWYgKHR5cGVvZiBzaXRlLmhpZGUgPT0gJ3N0cmluZycpCgkJCQlILmZvcmNlSGlkZS5jYWxsICAoc3R5bGVCbG9jaywgc2l0ZS5oaWRlKTsKCQkJZWxzZSBpZiAoc2l0ZS5oaWRlICYmIHNpdGUuaGlkZS5sZW5ndGgpCgkJCQlILmZvcmNlSGlkZS5hcHBseSAoc3R5bGVCbG9jaywgc2l0ZS5oaWRlKTsKCgkJCWlmICh0eXBlb2Ygc2l0ZS5zaG93ID09ICdzdHJpbmcnKQoJCQkJSC5mb3JjZVNob3cuY2FsbCAgKHN0eWxlQmxvY2ssIHNpdGUuc2hvdyk7CgkJCWVsc2UgaWYgKHNpdGUuc2hvdyAmJiBzaXRlLnNob3cubGVuZ3RoKQoJCQkJSC5mb3JjZVNob3cuYXBwbHkgKHN0eWxlQmxvY2ssIHNpdGUuc2hvdyk7CgoJCQkvLyDoh6rlrprkuYkgY3NzIOazqOWFpQoJCQlpZiAodHlwZW9mIHNpdGUuY3NzID09ICdzdHJpbmcnKQoJCQkJSC5pbmplY3RTdHlsZS5jYWxsICAoc3R5bGVCbG9jaywgc2l0ZS5jc3MpOwoJCQllbHNlIGlmIChzaXRlLmNzcyAmJiBzaXRlLmNzcy5sZW5ndGgpCgkJCQlILmluamVjdFN0eWxlLmFwcGx5IChzdHlsZUJsb2NrLCBzaXRlLmNzcyk7CgoJCQkvLyDkuIvovb3mjInpkq4KCQkJaWYgKHNpdGUuZGxfaWNvbikgewoJCQkJaWYgKHNpdGUuZGxfaWNvbi5tYXApIHsKCQkJCQlzaXRlLmRsX2ljb24gPSBzaXRlLmRsX2ljb24uam9pbiAoJzo6YmVmb3JlLCAnKTsKCQkJCX0gZWxzZSBpZiAodHlwZW9mIHNpdGUuZGxfaWNvbiAhPSAnc3RyaW5nJykgewoJCQkJCXNpdGUuZGxfaWNvbiA9IEguZGVmYXVsdERsQ2xhc3M7CgkJCQl9CgoJCQkJSC5pbmplY3RTdHlsZS5jYWxsIChzdHlsZUJsb2NrLCBILnNwcmludGYoLyogUmVzb3VyY2U6IEFBLmRsX2J0bi5jc3MgKi8KSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsgLyoKQGZvbnQtZmFjZSB7Cglmb250LWZhbWlseTogY2NjOwoJc3JjOiB1cmwoaHR0cHM6Ly9jZG4uYm9vdGNzcy5jb20vZm9udC1hd2Vzb21lLzQuMi4wL2ZvbnRzL2ZvbnRhd2Vzb21lLXdlYmZvbnQud29mZikgZm9ybWF0KCd3b2ZmJyk7Cglmb250LXdlaWdodDogbm9ybWFsOwoJZm9udC1zdHlsZTogbm9ybWFsOwp9Cgolczo6YmVmb3JlIHsKCWZvbnQtZmFtaWx5OiBjY2M7Cgljb250ZW50OiAiXGYwMTkiOwoJcGFkZGluZy1yaWdodDogLjVlbTsKfQoKLmp4X2hpZGUgewoJZGlzcGxheTogbm9uZTsKfQoqL30pLCBzaXRlLmRsX2ljb24pKTsKCQkJfQoKCQkJc2l0ZS5zdHlsZUJsb2NrID0gc3R5bGVCbG9jazsKCQl9CgoJCWlmICghZXZlKSByZXR1cm4gOwoJCUguaW5mbyAoJ+aJp+ihjOinhOWImTogJXM8SUQ6ICVzPlvkuovku7Y6ICVzXScsIHNpdGUubmFtZSB8fCAnPOacquefpT4nLCBzaXRlLmlkIHx8ICfmnKrnn6UnLCBldmVudCk7CgoJCXJldHVybiBldmUuY2FsbCAoc2l0ZSk7Cgl9LAoKCS8qKgoJICogZ2V0IHJ1bGUgYnkgSUQKCSAqIEBwYXJhbSAge1N0cmluZ30gaWQgUnVsZSBpZAoJICogQHJldHVybiB7UnVsZX0gICAgICBSdWxlIE9iamVjdAoJICovCglnZXQ6IGZ1bmN0aW9uIChpZCkgewoJCXJldHVybiBzaXRlcy5maWx0ZXIoZnVuY3Rpb24gKHNpdGUpIHsgcmV0dXJuIHNpdGUuaWQgPT0gaWQ7IH0pLnBvcCgpOwoJfSwKCQoJZXhlYzogZnVuY3Rpb24gKGlkLCBldmVudCkgewoJCXJldHVybiB0aGlzLnJ1bih0aGlzLmdldChpZCksIGV2ZW50KTsKCX0KfTsKCnJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHsKCWZvciAodmFyIGkgPSBzaXRlcy5sZW5ndGg7IGktLTsgKSB7CgkJaWYgKEguaXNGcmFtZSAmJiBzaXRlc1tpXS5ub0ZyYW1lKQoJCQljb250aW51ZTsKCQkKCQlpZiAoSC5ydWxlLmNoZWNrKHNpdGVzW2ldLCBldmVudCkgJiYgSC5ydWxlLnJ1bihzaXRlc1tpXSwgZXZlbnQpKQoJCQlyZXR1cm4gdHJ1ZTsKCX0KfTsKCX0pKCk7CgoJdHJ5IHsKCQlHTV9yZWdpc3Rlck1lbnVDb21tYW5kIChILnNwcmludGYoJ+mFjee9riAlc1slc10nLCBILnNjcmlwdE5hbWUsIEgudmVyc2lvbiksIGZ1bmN0aW9uICgpIHsKCQkJR01fb3BlbkluVGFiKCdodHRwczovL2ppeHVubW9lLmdpdGh1Yi5pby9jdXdjbDRjL2NvbmZpZy8nLCBmYWxzZSk7CgkJfSk7CgoJCUgubG9nICgnb25TdGFydCDlh4blpIfpmLbmrrUgOjog5byA5aeLJyk7CgkJaGFuZGxlU2l0ZSAoJ29uU3RhcnQnKTsKCQlILmxvZyAoJ29uU3RhcnQg5YeG5aSH6Zi25q61IDo6IOe7k+adnycpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICgnRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHsKCQkJSC5sb2cgKCdvbkJvZHkg6Zi25q61IDo6IOW8gOWniycpOwoJCQloYW5kbGVTaXRlICgnb25Cb2R5Jyk7CgkJCUgubG9nICgnb25Cb2R5IOmYtuautSA6OiDnu5PmnZ8nKTsKCQl9LCBmYWxzZSk7CgoJfSBjYXRjaCAoZSkgewoJCWlmIChlLmlzRXhpdCkgewoJCQlILmxvZy5hcHBseSAoIDAsIFtdLmNvbmNhdC5hcHBseSAoIFsn6ISa5pys6YCA5Ye6LCDplJnor6/kv6Hmga8nXSwgZS5tZXNzYWdlICkgKTsKCQl9IGVsc2UgewoJCQlILmVycm9yICgn6K+35Yqh5b+F5bCG5LiL6L+w6ZSZ6K+v6L+96Liq5Luj56CB5o+Q5Lqk6IezICVzXG5cbiVzJywgSC5yZXBvcnRVcmwsIGUubWVzc2FnZSk7CgkJfQoJfQp9KSAoKTs="},{"name":"ç½‘ç›˜æå–å·¥å…·","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_excludes":[],"orig_includes":[],"orig_matches":["*://*/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630844},"enabled":true,"position":3,"file_url":"https://greasyfork.org/scripts/18733-%E7%BD%91%E7%9B%98%E6%8F%90%E5%8F%96%E5%B7%A5%E5%85%B7/code/%E7%BD%91%E7%9B%98%E6%8F%90%E5%8F%96%E5%B7%A5%E5%85%B7.user.js","uuid":"bb27ec9f-550c-4e85-b255-64011a62602d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDnvZHnm5jmj5Dlj5blt6XlhbcKLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vd3d3LmZpc2hsZWUubmV0LwovLyBAdmVyc2lvbiAgICAgIDIuNAovLyBAZGVzY3JpcHRpb24gIOWwveWPr+iDveWcqOaUr+aMgeeahOe9keebmO+8iOaWsOa1quW+ruebmOOAgeeZvuW6pue9keebmOOAgTM2MOS6keebmOetie+8ieiHquWKqOi+k+WFpeaPkOWPluegge+8jOecgeWOu+S4i+i9veeahOeDpuaBvOOAggovLyBAYXV0aG9yICAgICAgIOacqOmxvChpRmlzaCkKLy8gQG1hdGNoICAgICAgICAqOi8vKi8qCi8vIEBncmFudCAgICAgICAgdW5zYWZlV2luZG93Ci8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24od2luZG93LCBzZWxmLCB1bnNhZmVXaW5kb3cpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIHZhciB0aW1lU3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIHZhciBsb2NhdGlvbiA9IHNlbGYubG9jYXRpb247CiAgICB2YXIgaG9zdCA9IGxvY2F0aW9uLmhvc3Q7CiAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOwogICAgdmFyIGNvZGUsIGlucHV0OwogICAgdmFyIGdldENvZGUgPSBmdW5jdGlvbihydWxlKSB7CiAgICAgICAgY29kZSA9IGxvY2F0aW9uLmhhc2guc2xpY2UoMSwgNSk7CiAgICAgICAgaWYgKChydWxlIHx8IC8oW2EtelxkXXs0fSkvaS5leGVjKGNvZGUpKSkgewogICAgICAgICAgICBjb2RlID0gUmVnRXhwLiQxOwogICAgICAgIH0gZWxzZSBjb2RlID0gbnVsbDsKICAgICAgICByZXR1cm4gY29kZTsKICAgIH07CiAgICBpZiAoKGhvc3QgPT09ICdwYW4uYmFpZHUuY29tJyB8fCBob3N0ID09PSAneXVuLmJhaWR1LmNvbScpKSB7CiAgICAgICAgLy/nmb7luqbkupHnm5gKICAgICAgICBpZiAocGF0aC5pbmRleE9mKCIvc2hhcmUvIikgIT09IC0xICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhY2Nlc3NDb2RlIikgJiYgZ2V0Q29kZSgpKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhY2Nlc3NDb2RlIikudmFsdWUgPSBjb2RlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VibWl0QnRuIikuY2xpY2soKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKC9eLipcLnl1bnBhblwuY24kL2kudGVzdChob3N0KSkgewogICAgICAgIC8vMzYw5LqR55uYCiAgICAgICAgaWYgKHNlbGYubG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZigiL2xrLyIpICE9PSAtMSkgewogICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImlucHV0LnB3ZC1pbnB1dCIpOwogICAgICAgICAgICBpZiAoZ2V0Q29kZSgpICYmIGlucHV0KSB7CiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGNvZGU7CiAgICAgICAgICAgICAgICBpbnB1dC5uZXh0RWxlbWVudFNpYmxpbmcuY2xpY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy/lhbblroPnvZHnq5nvvIzmo4DmtYvpk77mjqUKICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJhW2hyZWYqPSdwYW4uYmFpZHUuY29tJ10sIGFbaHJlZio9J3l1bnBhbi5jbiddLCBhW2hyZWYqPSd2ZGlzay53ZWliby5jb20nXSIpKS5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAgICAgdmFyIHR4dCA9IGxpbmsubmV4dFNpYmxpbmcgJiYgbGluay5uZXh0U2libGluZy5ub2RlVmFsdWU7CiAgICAgICAgICAgIHZhciBsaW5rY29kZSA9IC/noIEuKj8oW2EtelxkXXs0fSkvaS5leGVjKHR4dCkgJiYgUmVnRXhwLiQxOwogICAgICAgICAgICBpZiAoIWxpbmtjb2RlKSB7CiAgICAgICAgICAgICAgICB0eHQgPSBsaW5rLnBhcmVudE5vZGUuaW5uZXJUZXh0OwogICAgICAgICAgICAgICAgbGlua2NvZGUgPSAv56CBLio/KFthLXpcZF17NH0pL2kuZXhlYyh0eHQpICYmIFJlZ0V4cC4kMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGlua2NvZGUpIHsKICAgICAgICAgICAgICAgIHZhciBocmVmID0gbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgaHJlZiArICIjIiArIGxpbmtjb2RlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgdmFyIHRpbWVFbmQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIGNvbnNvbGUubG9nKCJb572R55uY5o+Q5Y+W5bel5YW3XSDpk77mjqXlpITnkIblrozmiJDvvIzogJfml7bvvJoiICsgKHRpbWVFbmQgLSB0aW1lU3RhcnQpICsgIuavq+enki4g5aSE55CG5qih5byP77yaRE9N5aSE55CGIik7Cn0pKHdpbmRvdywgd2luZG93LnNlbGYsIHVuc2FmZVdpbmRvdyk7CihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIC8vY29uc3RzLi4uCiAgICB2YXIgQ09ERV9SVUxFX0JBSURVID0gL14oW2EtelxkXXs0fSkkL2k7CiAgICB2YXIgQ09ERV9SVUxFX1lVTlBBTiA9IC9eKFthLXpcZF17NH0pJC9pOwogICAgdmFyIE1BWF9TRUFSQ0hfQ09ERV9SQU5HRSA9IDU7CiAgICAvL2Z1bmN0aW9ucy4uLgogICAgdmFyIHRleHROb2Rlc1VuZGVyID0gZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgbiwgYSA9IFtdLAogICAgICAgICAgICB3YWxrID0gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihlbCwgTm9kZUZpbHRlci5TSE9XX1RFWFQsIG51bGwsIGZhbHNlKTsKICAgICAgICB3aGlsZSAoKG4gPSB3YWxrLm5leHROb2RlKCkpKSBhLnB1c2gobik7CiAgICAgICAgcmV0dXJuIGE7CiAgICB9OwogICAgdmFyIGdlbmVyYWxMaW5raWZ5VGV4dCA9IGZ1bmN0aW9uKHRleHQsIGVsZXMsIGluZGV4LCB0ZXN0UmVnLCB2YWxpZGF0ZVJ1bGUpIHsKICAgICAgICB2YXIgbG9vcENvdW50ID0gMCwKICAgICAgICAgICAgb3JpZ2luYWxUZXh0LCBjb2RlLCBtYXRjaCwgdXJsLAogICAgICAgICAgICBsaW5raWZpZWRUZXh0ID0gdGV4dDsKICAgICAgICB3aGlsZSAoKG1hdGNoID0gdGVzdFJlZy5leGVjKHRleHQpKSkgewogICAgICAgICAgICBsb29wQ291bnQrKzsKICAgICAgICAgICAgdXJsID0gKG1hdGNoWzFdIHx8ICJodHRwOi8vIikgKyBtYXRjaFsyXTsKICAgICAgICAgICAgb3JpZ2luYWxUZXh0ID0gbWF0Y2hbMV0gKyBtYXRjaFsyXTsKICAgICAgICAgICAgY29kZSA9IG1hdGNoWzNdIHx8IGZpbmRDb2RlRnJvbUVsZW1lbnRzKGVsZXMsIGluZGV4LCB2YWxpZGF0ZVJ1bGUpIHx8ICIiOwogICAgICAgICAgICBjb25zb2xlLmxvZygiW+e9keebmOaPkOWPluW3peWFt10g5bey5aSE55CG572R55uY5Zyw5Z2A77yMVVJMPSIgKyB1cmwgKyAi77yM5o+Q5Y+W56CBPSIgKyBjb2RlICsgIuaooeW8j++8mlRFWFROT0RFIik7CiAgICAgICAgICAgIGxpbmtpZmllZFRleHQgPSBsaW5raWZpZWRUZXh0LnJlcGxhY2Uob3JpZ2luYWxUZXh0LCAiPGEgaHJlZj0nIiArIHVybCArICIjIiArIGNvZGUgKyAiJyB0YXJnZXQ9J19ibGFuayc+IiArIHVybCArICc8L2E+Jyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbbG9vcENvdW50LCBsaW5raWZpZWRUZXh0XTsKICAgIH07CiAgICB2YXIgbGlua2lmeVRleHRCbG9ja0JhaWR1ID0gZnVuY3Rpb24odGV4dCwgZWxlcywgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZ2VuZXJhbExpbmtpZnlUZXh0KHRleHQsIGVsZXMsIGluZGV4LCAvKGh0dHA6XC9cLyk/KCg/OnBhbnx5dW4pXC5iYWlkdVwuY29tXC9zXC8oPzpbYS16XGRdKykpKD86Lio/56CBLio/KFthLXpcZF0rKSk/L2dpLCBDT0RFX1JVTEVfQkFJRFUpOwogICAgfTsKICAgIHZhciBsaW5raWZ5VGV4dEJsb2NrWXVucGFuID0gZnVuY3Rpb24odGV4dCwgZWxlcywgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZ2VuZXJhbExpbmtpZnlUZXh0KHRleHQsIGVsZXMsIGluZGV4LCAvKGh0dHA6XC9cLyk/KHl1bnBhblwuY25cLyg/OlthLXpcZF0rKSkoPzouKj/noIEuKj8oW2EtelxkXSspKT8vZ2ksIENPREVfUlVMRV9ZVU5QQU4pOwogICAgfTsKICAgIHZhciBmaW5kQ29kZUZyb21FbGVtZW50cyA9IGZ1bmN0aW9uKGVsZXMsIGluZGV4LCBydWxlKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBNQVhfU0VBUkNIX0NPREVfUkFOR0UgJiYgaSA8IGVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHR4dCA9IGVsZXNbaSArIGluZGV4XS50ZXh0Q29udGVudDsKICAgICAgICAgICAgdmFyIGNvZGVSZWcgPSAv56CBLio/KFthLXpcZF0rKS9naTsKICAgICAgICAgICAgdmFyIGNvZGVNYXRjaCA9IGNvZGVSZWcuZXhlYyh0ZXh0KSAmJiBSZWdFeHAuJDE7CiAgICAgICAgICAgIGlmICghY29kZU1hdGNoKSBjb250aW51ZTsKICAgICAgICAgICAgdmFyIGxpbmtUZXN0UmVnID0gLyhodHRwcz86fFwuKG5ldHxjbnxjb218Z292fGNjfG1lKSkvZ2k7CiAgICAgICAgICAgIGlmIChsaW5rVGVzdFJlZy5leGVjKHR4dCkgJiYgbGlua1Rlc3RSZWcubGFzdEluZGV4IDw9IGNvZGVSZWcubGFzdEluZGV4KSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocnVsZS50ZXN0KGNvZGVNYXRjaCkpIHJldHVybiBjb2RlTWF0Y2g7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIHZhciBsaW5raWZ5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGVsZXMgPSB0ZXh0Tm9kZXNVbmRlcihkb2N1bWVudC5ib2R5KTsKICAgICAgICB2YXIgZWxlLCB0eHQsIGxvb3BDb3VudDsKICAgICAgICB2YXIgcHJvY2Vzc29yID0gWwogICAgICAgICAgICBsaW5raWZ5VGV4dEJsb2NrQmFpZHUKICAgICAgICBdOwogICAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uKGZ1bikgewogICAgICAgICAgICB2YXIgZGF0YSA9IGZ1bih0eHQsIGVsZXMsIGkgKyAxKTsKICAgICAgICAgICAgbG9vcENvdW50ICs9IGRhdGFbMF07CiAgICAgICAgICAgIHR4dCA9IGRhdGFbMV07CiAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZWxlID0gZWxlc1tpXTsKICAgICAgICAgICAgaWYgKGVsZS5wYXJlbnROb2RlLnRhZ05hbWUgPT0gJ2EnKSBjb250aW51ZTsKICAgICAgICAgICAgdHh0ID0gZWxlLnRleHRDb250ZW50OwogICAgICAgICAgICBsb29wQ291bnQgPSAwOwogICAgICAgICAgICBwcm9jZXNzb3IuZm9yRWFjaChjYWxsYmFjayk7CiAgICAgICAgICAgIGlmIChsb29wQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gdHh0OwogICAgICAgICAgICAgICAgZWxlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHNwYW4sIGVsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHRpbWVTdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgbGlua2lmeSgpOwogICAgdmFyIHRpbWVFbmQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIGNvbnNvbGUubG9nKCJb572R55uY5o+Q5Y+W5bel5YW3XSDpk77mjqXlpITnkIblrozmiJDvvIzogJfml7bvvJoiICsgKHRpbWVFbmQgLSB0aW1lU3RhcnQpICsgIuavq+enki4g5aSE55CG5qih5byP77yaVEVYVE5PREXlpITnkIYiKTsKfSkoKTs="},{"name":"ç½‘é¡µé™åˆ¶è§£é™¤","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_excludes":[],"orig_includes":[],"orig_matches":["*://*/*"],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630849},"enabled":true,"position":4,"file_url":"https://greasyfork.org/scripts/14146-%E7%BD%91%E9%A1%B5%E9%99%90%E5%88%B6%E8%A7%A3%E9%99%A4/code/%E7%BD%91%E9%A1%B5%E9%99%90%E5%88%B6%E8%A7%A3%E9%99%A4.user.js","uuid":"eee3d782-8052-470d-b109-d919443041f9","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWVzcGFjZSAgICAgICAgIGh0dHBzOi8vd3d3LmdpdGh1Yi5jb20vQ2F0NzM3My8KCi8vIEBuYW1lICAgICAgICAgICAgICDnvZHpobXpmZDliLbop6PpmaQKLy8gQG5hbWU6ZW4gICAgICAgICAgIFJlbW92ZSB3ZWIgbGltaXRzCi8vIEBuYW1lOnpoICAgICAgICAgICDnvZHpobXpmZDliLbop6PpmaQKLy8gQG5hbWU6emgtQ04gICAgICAgIOe9kemhtemZkOWItuino+mZpAovLyBAbmFtZTp6aC1UVyAgICAgICAg57ay6aCB6ZmQ5Yi26Kej6ZmkCi8vIEBuYW1lOmphICAgICAgICAgICDjgqbjgqfjg5bjga7opo/liLbnt6nlkowKCi8vIEBkZXNjcmlwdGlvbiAgICAgICDpgJrmnYDlpKfpg6jliIbnvZHnq5nvvIzlj6/ku6Xop6PpmaTnpoHmraLlpI3liLbjgIHliarliIfjgIHpgInmi6nmlofmnKzjgIHlj7PplK7oj5zljZXnmoTpmZDliLbjgIIKLy8gQGRlc2NyaXB0aW9uOmVuICAgIFBhc3MgdG8ga2lsbCBtb3N0IG9mIHRoZSBzaXRlLCB5b3UgY2FuIGxpZnQgdGhlIHJlc3RyaWN0aW9ucyBwcm9oaWJpdGVkIHRvIGNvcHksIGN1dCwgc2VsZWN0IHRoZSB0ZXh0LCByaWdodC1jbGljayBtZW51LgovLyBAZGVzY3JpcHRpb246emggICAg6YCa5p2A5aSn6YOo5YiG572R56uZ77yM5Y+v5Lul6Kej6Zmk56aB5q2i5aSN5Yi244CB5Ymq5YiH44CB6YCJ5oup5paH5pys44CB5Y+z6ZSu6I+c5Y2V55qE6ZmQ5Yi244CCCi8vIEBkZXNjcmlwdGlvbjp6aC1DTiDpgJrmnYDlpKfpg6jliIbnvZHnq5nvvIzlj6/ku6Xop6PpmaTnpoHmraLlpI3liLbjgIHliarliIfjgIHpgInmi6nmlofmnKzjgIHlj7PplK7oj5zljZXnmoTpmZDliLbjgIIKLy8gQGRlc2NyaXB0aW9uOnpoLVRXIOmAmuauuuWkp+mDqOWIhue2suerme+8jOWPr+S7peino+mZpOemgeatouW+qeWItuOAgeWJquWIh+OAgemBuOaTh+aWh+acrOOAgeWPs+mNteiPnOWWrueahOmZkOWItuOAggovLyBAZGVzY3JpcHRpb246amEgICAg44K144Kk44OI44Gu44G744Go44KT44Gp44KS5q6644GZ44Gf44KB44Gr5rih44GX44CB44GC44Gq44Gf44Gv44CB44Kz44OU44O85YiH44KK5Y+W44KK44CB44OG44Kt44K544OI44CB5Y+z44Kv44Oq44OD44Kv44Oh44OL44Ol44O844KS6YG45oqe44GZ44KL44GT44Go44Gv56aB5q2i44Gu5Yi26ZmQ44KS6Kej6Zmk44GZ44KL44GT44Go44GM44Gn44GN44G+44GZ44CCCgovLyBAaG9tZXBhZ2VVUkwgICAgICAgaHR0cHM6Ly9jYXQ3MzczLmdpdGh1Yi5pby9yZW1vdmUtd2ViLWxpbWl0cy8KLy8gQHN1cHBvcnRVUkwgICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9DYXQ3MzczL3JlbW92ZS13ZWItbGltaXRzL2lzc3Vlcy8KCi8vIEBhdXRob3IgICAgICAgICAgICBDYXQ3MwovLyBAdmVyc2lvbiAgICAgICAgICAgMS4zCi8vIEBsaWNlbnNlICAgICAgICAgICBMR1BMdjMKCi8vIEBjb21wYXRpYmxlICAgICAgICBjaHJvbWUgQ2hyb21lXzQ2LjAuMjQ5MC44NiArIFRhbXBlck1vbmtleSArIOiEmuacrF8xLjMg5rWL6K+V6YCa6L+HCi8vIEBjb21wYXRpYmxlICAgICAgICBmaXJlZm94IEZpcmVmb3hfNDIuMCArIEdyZWFzZU1vbmtleSArIOiEmuacrF8xLjIuMSDmtYvor5XpgJrov4cKLy8gQGNvbXBhdGlibGUgICAgICAgIG9wZXJhIE9wZXJhXzMzLjAuMTk5MC4xMTUgKyBUYW1wZXJNb25rZXkgKyDohJrmnKxfMS4xLjMg5rWL6K+V6YCa6L+HCi8vIEBjb21wYXRpYmxlICAgICAgICBzYWZhcmkg5pyq5rWL6K+VCgovLyBAbWF0Y2ggICAgICAgICAgICAgKjovLyovKgovLyBAZ3JhbnQgICAgICAgICAgICAgbm9uZQovLyBAcnVuLWF0ICAgICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gPT0vVXNlclNjcmlwdD09Cid1c2Ugc3RyaWN0JzsKCi8vIOWfn+WQjeinhOWImeWIl+ihqAp2YXIgcnVsZXMgPSB7CiAgYmxhY2tfcnVsZTogewogICAgbmFtZTogImJsYWNrIiwKICAgIGhvb2tfZXZlbnROYW1lczogIiIsCiAgICB1bmhvb2tfZXZlbnROYW1lczogIiIKICB9LAogIGRlZmF1bHRfcnVsZTogewogICAgbmFtZTogImRlZmF1bHQiLAogICAgaG9va19ldmVudE5hbWVzOiAiY29udGV4dG1lbnV8c2VsZWN0fHNlbGVjdHN0YXJ0fGNvcHl8Y3V0fGRyYWdzdGFydCIsCiAgICB1bmhvb2tfZXZlbnROYW1lczogIm1vdXNlZG93bnxtb3VzZXVwfGtleWRvd258a2V5dXAiLAogICAgZG9tMDogdHJ1ZSwKICAgIGhvb2tfYWRkRXZlbnRMaXN0ZW5lcjogdHJ1ZSwKICAgIGhvb2tfcHJldmVudERlZmF1bHQ6IHRydWUsCiAgICBob29rX3NldF9yZXR1cm5WYWx1ZTogdHJ1ZSwKICAgIGFkZF9jc3M6IHRydWUKICB9Cn07Ci8vIOWfn+WQjeWIl+ihqAp2YXIgbGlzdHMgPSB7CiAgLy8g6buR5ZCN5Y2VCiAgYmxhY2tfbGlzdDogWwogICAgLy4qXC55b3V0dWJlXC5jb20uKi8sCiAgICAvLipcLndpa2lwZWRpYVwub3JnLiovLAogICAgL21haWxcLnFxXC5jb20uKi8sCiAgICAvdHJhbnNsYXRlXC5nb29nbGVcLi4qLwogIF0KfTsKCi8vIOimgeWkhOeQhueahCBldmVudCDliJfooagKdmFyIGhvb2tfZXZlbnROYW1lcywgdW5ob29rX2V2ZW50TmFtZXMsIGV2ZW50TmFtZXM7Ci8vIOWCqOWtmOWQjeensAp2YXIgc3RvcmFnZU5hbWUgPSBnZXRSYW5kU3RyKCdxd2VydHl1aW9wYXNkZmdoamtsenhjdmJubVFXRVJUWVVJT1BBU0RGR0hKS0xaWENWQk5NJywgcGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIDEyICsgOCkpOwovLyDlgqjlrZjooqsgSG9vayDnmoTlh73mlbAKdmFyIEV2ZW50VGFyZ2V0X2FkZEV2ZW50TGlzdGVuZXIgPSBFdmVudFRhcmdldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcjsKdmFyIGRvY3VtZW50X2FkZEV2ZW50TGlzdGVuZXIgPSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyOwp2YXIgRXZlbnRfcHJldmVudERlZmF1bHQgPSBFdmVudC5wcm90b3R5cGUucHJldmVudERlZmF1bHQ7CgovLyBIb29rIGFkZEV2ZW50TGlzdGVuZXIgcHJvYwpmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmMsIHVzZUNhcHR1cmUpIHsKICB2YXIgX2FkZEV2ZW50TGlzdGVuZXIgPSB0aGlzID09PSBkb2N1bWVudCA/IGRvY3VtZW50X2FkZEV2ZW50TGlzdGVuZXIgOiBFdmVudFRhcmdldF9hZGRFdmVudExpc3RlbmVyOwogIGlmKGhvb2tfZXZlbnROYW1lcy5pbmRleE9mKHR5cGUpID49IDApIHsKICAgIF9hZGRFdmVudExpc3RlbmVyLmFwcGx5KHRoaXMsIFt0eXBlLCByZXR1cm5UcnVlLCB1c2VDYXB0dXJlXSk7CiAgfSBlbHNlIGlmKHVuaG9va19ldmVudE5hbWVzLmluZGV4T2YodHlwZSkgPj0gMCkgewogICAgdmFyIGZ1bmNzTmFtZSA9IHN0b3JhZ2VOYW1lICsgdHlwZSArICh1c2VDYXB0dXJlID8gJ3QnIDogJ2YnKTsKCiAgICBpZih0aGlzW2Z1bmNzTmFtZV0gPT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzW2Z1bmNzTmFtZV0gPSBbXTsKICAgICAgX2FkZEV2ZW50TGlzdGVuZXIuYXBwbHkodGhpcywgW3R5cGUsIHVzZUNhcHR1cmUgPyB1bmhvb2tfdCA6IHVuaG9va19mLCB1c2VDYXB0dXJlXSk7CiAgICB9CgogICAgdGhpc1tmdW5jc05hbWVdLnB1c2goZnVuYykKICB9IGVsc2UgewogICAgX2FkZEV2ZW50TGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Cn0KCi8vIOa4heeQhuW+queOrwpmdW5jdGlvbiBjbGVhckxvb3AoKSB7CiAgdmFyIGVsZW1lbnRzID0gZ2V0RWxlbWVudHMoKTsKCiAgZm9yKHZhciBpIGluIGVsZW1lbnRzKSB7CiAgICBmb3IodmFyIGogaW4gZXZlbnROYW1lcykgewogICAgICB2YXIgbmFtZSA9ICdvbicgKyBldmVudE5hbWVzW2pdOwogICAgICBpZihlbGVtZW50c1tpXVtuYW1lXSAhPSBudWxsICYmIGVsZW1lbnRzW2ldW25hbWVdICE9IG9ueHh4KSB7CiAgICAgICAgaWYodW5ob29rX2V2ZW50TmFtZXMuaW5kZXhPZihldmVudE5hbWVzW2pdKSA+PSAwKSB7CiAgICAgICAgICBlbGVtZW50c1tpXVtzdG9yYWdlTmFtZSArIG5hbWVdID0gZWxlbWVudHNbaV1bbmFtZV07CiAgICAgICAgICBlbGVtZW50c1tpXVtuYW1lXSA9IG9ueHh4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbGVtZW50c1tpXVtuYW1lXSA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9CgovLyDov5Tlm550cnVl55qE5Ye95pWwCmZ1bmN0aW9uIHJldHVyblRydWUoZSkgewogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHVuaG9va190KGUpIHsKICByZXR1cm4gdW5ob29rKGUsIHRoaXMsIHN0b3JhZ2VOYW1lICsgZS50eXBlICsgJ3QnKTsKfQpmdW5jdGlvbiB1bmhvb2tfZihlKSB7CiAgcmV0dXJuIHVuaG9vayhlLCB0aGlzLCBzdG9yYWdlTmFtZSArIGUudHlwZSArICdmJyk7Cn0KZnVuY3Rpb24gdW5ob29rKGUsIHNlbGYsIGZ1bmNzTmFtZSkgewogIHZhciBsaXN0ID0gc2VsZltmdW5jc05hbWVdOwogIGZvcih2YXIgaSBpbiBsaXN0KSB7CiAgICBsaXN0W2ldKGUpOwogIH0KCiAgZS5yZXR1cm5WYWx1ZSA9IHRydWU7CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gb254eHgoZSkgewogIHZhciBuYW1lID0gc3RvcmFnZU5hbWUgKyAnb24nICsgZS50eXBlOwogIHRoaXNbbmFtZV0oZSk7CgogIGUucmV0dXJuVmFsdWUgPSB0cnVlOwogIHJldHVybiB0cnVlOwp9CgovLyDojrflj5bpmo/mnLrlrZfnrKbkuLIKZnVuY3Rpb24gZ2V0UmFuZFN0cihjaHMsIGxlbikgewogIHZhciBzdHIgPSAnJzsKCiAgd2hpbGUobGVuLS0pIHsKICAgIHN0ciArPSBjaHNbcGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIGNocy5sZW5ndGgpXTsKICB9CgogIHJldHVybiBzdHI7Cn0KCi8vIOiOt+WPluaJgOacieWFg+e0oCDljIXmi6xkb2N1bWVudApmdW5jdGlvbiBnZXRFbGVtZW50cygpIHsKICB2YXIgZWxlbWVudHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpKTsKICBlbGVtZW50cy5wdXNoKGRvY3VtZW50KTsKCiAgcmV0dXJuIGVsZW1lbnRzOwp9CgovLyDmt7vliqBjc3MKZnVuY3Rpb24gYWRkU3R5bGUoY3NzKSB7CiAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICBzdHlsZS5pbm5lckhUTUwgPSBjc3M7CiAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7Cn0KCi8vIOiOt+WPluebruagh+Wfn+WQjeW6lOivpeS9v+eUqOeahOinhOWImQpmdW5jdGlvbiBnZXRSdWxlKHVybCkgewogIGZ1bmN0aW9uIHRlc3RVcmwobGlzdCwgdXJsKSB7CiAgICBmb3IodmFyIGkgaW4gbGlzdCkgewogICAgICBpZihsaXN0W2ldLnRlc3QodXJsKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgaWYodGVzdFVybChsaXN0cy5ibGFja19saXN0LCB1cmwpKSB7CiAgICByZXR1cm4gcnVsZXMuYmxhY2tfcnVsZTsKICB9CgogIHJldHVybiBydWxlcy5kZWZhdWx0X3J1bGU7Cn0KCi8vIOWIneWni+WMlgpmdW5jdGlvbiBpbml0KCkgewogIC8vIOiOt+WPluW9k+WJjeWfn+WQjeeahOinhOWImQogIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaG9zdCArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsKICB2YXIgcnVsZSA9IGdldFJ1bGUodXJsKTsKCiAgLy8g6K6+572uIGV2ZW50IOWIl+ihqAogIGhvb2tfZXZlbnROYW1lcyA9IHJ1bGUuaG9va19ldmVudE5hbWVzLnNwbGl0KCJ8Iik7CiAgLy8gVE9ETyBBbGxvd2VkIHRvIHJldHVybiB2YWx1ZQogIHVuaG9va19ldmVudE5hbWVzID0gcnVsZS51bmhvb2tfZXZlbnROYW1lcy5zcGxpdCgifCIpOwogIGV2ZW50TmFtZXMgPSBob29rX2V2ZW50TmFtZXMuY29uY2F0KHVuaG9va19ldmVudE5hbWVzKTsKCiAgLy8g6LCD55So5riF55CGIERPTTAgZXZlbnQg5pa55rOV55qE5b6q546vCiAgaWYocnVsZS5kb20wKSB7CiAgICBzZXRJbnRlcnZhbChjbGVhckxvb3AsIDMwICogMTAwMCk7CiAgICBzZXRUaW1lb3V0KGNsZWFyTG9vcCwgMjUwMCk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGNsZWFyTG9vcCwgdHJ1ZSk7CiAgICBjbGVhckxvb3AoKTsKICB9CgogIC8vIGhvb2sgYWRkRXZlbnRMaXN0ZW5lcgogIGlmKHJ1bGUuaG9va19hZGRFdmVudExpc3RlbmVyKSB7CiAgICBFdmVudFRhcmdldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IGFkZEV2ZW50TGlzdGVuZXI7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyID0gYWRkRXZlbnRMaXN0ZW5lcjsKICB9CgogIC8vIGhvb2sgcHJldmVudERlZmF1bHQKICBpZihydWxlLmhvb2tfcHJldmVudERlZmF1bHQpIHsKICAgIEV2ZW50LnByb3RvdHlwZS5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uKCkgewogICAgICBpZihldmVudE5hbWVzLmluZGV4T2YodGhpcy50eXBlKSA8IDApIHsKICAgICAgICBFdmVudF9wcmV2ZW50RGVmYXVsdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSG9vayBzZXQgcmV0dXJuVmFsdWUKICBpZihydWxlLmhvb2tfc2V0X3JldHVyblZhbHVlKSB7CiAgICBFdmVudC5wcm90b3R5cGUuX19kZWZpbmVTZXR0ZXJfXygncmV0dXJuVmFsdWUnLCBmdW5jdGlvbigpIHsKICAgICAgaWYodGhpcy5yZXR1cm5WYWx1ZSAhPSB0cnVlICYmIGV2ZW50TmFtZXMuaW5kZXhPZih0aGlzLnR5cGUpID49IDApIHsKICAgICAgICB0aGlzLnJldHVyblZhbHVlID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgfQoKICBjb25zb2xlLmRlYnVnKCd1cmw6ICcgKyB1cmwsICdzdG9yYWdlTmFtZe+8micgKyBzdG9yYWdlTmFtZSwgJ3J1bGU6ICcgKyBydWxlLm5hbWUpOwoKICAvLyDmt7vliqBDU1MKICBpZihydWxlLmFkZF9jc3MpIHsKICAgIGFkZFN0eWxlKCdodG1sLCAqIHstd2Via2l0LXVzZXItc2VsZWN0OnRleHQhaW1wb3J0YW50OyAtbW96LXVzZXItc2VsZWN0OnRleHQhaW1wb3J0YW50O30nKTsKICB9Cn0KCmluaXQoKTsK"},{"name":"ç™¾åº¦ç½‘ç›˜åŠ©æ‰‹â€¢æ”¹","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":["http://yun.baidu.com","http://yun.baidu.com/#*","http://pan.baidu.com/share/manage*","http://pan.baidu.com/disk/recyclebin*","http://yun.baidu.com/pcloud/album/info*"],"orig_includes":["https://pan.baidu.com/*","http://pan.baidu.com/*","http://yun.baidu.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630857},"enabled":true,"position":5,"file_url":"https://greasyfork.org/scripts/17083-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E5%8A%A9%E6%89%8B-%E6%94%B9/code/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E5%8A%A9%E6%89%8B%E2%80%A2%E6%94%B9.user.js","uuid":"56ccc86f-00ef-43cb-a412-3d400a7323ce","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIOeZvuW6pue9keebmOWKqeaJi+KAouaUuQovLyBAYXV0aG9yICAgICAg5pyJ5LiA5Lu955SwCi8vIEBkZXNjcmlwdGlvbiDmmL7npLrnmb7luqbnvZHnm5jmlofku7bnmoTnm7TmjqXpk77mjqUs56qB56C05aSn5paH5Lu26ZyA6KaB5L2/55So55S16ISR566h5a6255qE6ZmQ5Yi2Ci8vIEBuYW1lc3BhY2UgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3poLUNOL3NjcmlwdHMvOTg2LeeZvuW6pue9keebmOWKqeaJiwovLyBAaWNvbiAgICAgICAgaHR0cDovL2ltZy5kdW9sdW9odWEuY29tL2FwcGltZy9zY3JpcHRfZHVwYW5saW5rX2ljb25fNDgucG5nCi8vIEBsaWNlbnNlICAgICBHUEwgdmVyc2lvbiAzCi8vIEBlbmNvZGluZyAgICB1dGYtOAovLyBAZGF0ZSAgICAgICAgMjYvMDgvMjAxMwovLyBAbW9kaWZpZWQgICAgMDcvMTgvMjAxNgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly9wYW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly9wYW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly95dW4uYmFpZHUuY29tLyoKLy8gQGV4Y2x1ZGUgICAgIGh0dHA6Ly95dW4uYmFpZHUuY29tCi8vIEBleGNsdWRlICAgICBodHRwOi8veXVuLmJhaWR1LmNvbS8jKgovLyBAZXhjbHVkZSAgICAgaHR0cDovL3Bhbi5iYWlkdS5jb20vc2hhcmUvbWFuYWdlKgovLyBAZXhjbHVkZSAgICAgaHR0cDovL3Bhbi5iYWlkdS5jb20vZGlzay9yZWN5Y2xlYmluKgovLyBAZXhjbHVkZSAgICAgaHR0cDovL3l1bi5iYWlkdS5jb20vcGNsb3VkL2FsYnVtL2luZm8qCi8vIEByZXF1aXJlICAgICBodHRwOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0yLjEuMS5taW4uanMKLy8gQGdyYW50ICAgICAgIHVuc2FmZVdpbmRvdwovLyBAZ3JhbnQgICAgICAgR01fc2V0Q2xpcGJvYXJkCi8vIEBydW4tYXQgICAgICBkb2N1bWVudC1lbmQKLy8gQHZlcnNpb24gICAgIDMuMS4wCi8vID09L1VzZXJTY3JpcHQ9PQoKCi8qCiAqID09PSDor7TmmI4gPT09CiAqQOS9nOiAhTrmnInkuIDku73nlLAKICpA5a6Y572ROmh0dHA6Ly93d3cuZHVvbHVvaHVhLmNvbS9kb3dubG9hZC8KICpARW1haWw6eW91eWlmZW50aWFuQGdtYWlsLmNvbQogKkBHaXQ6aHR0cDovL2dpdC5vc2NoaW5hLm5ldC95b3V5aWZlbnRpYW4KICpA6L2s6L296YeN55So6K+35L+d55WZ5q2k5L+h5oGvCiAqCiAqCiAqICovCgoKCgoKdmFyIFZFUlNJT04gPSAnMy4wLjInOwp2YXIgQVBQTkFNRSA9ICdcdTc2N2VcdTVlYTZcdTdmNTFcdTc2ZDhcdTUyYTlcdTYyNGInOwp2YXIgdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoKCiQgPSAkIHx8IHVuc2FmZVdpbmRvdy4kOwp2YXIgZGlzayA9IHVuc2FmZVdpbmRvdy5kaXNrOwp2YXIgRmlsZVV0aWxzID0gdW5zYWZlV2luZG93LkZpbGVVdGlsczsKdmFyIFBhZ2UgPSB1bnNhZmVXaW5kb3cuUGFnZTsKdmFyIFV0aWxpdGllcyA9IHVuc2FmZVdpbmRvdy5VdGlsaXRpZXM7CnZhciB5dW5EYXRhID0gdW5zYWZlV2luZG93Lnl1bkRhdGE7CnZhciByZXF1aXJlPSB1bnNhZmVXaW5kb3cucmVxdWlyZTsKCgooZnVuY3Rpb24gKCl7CiAgICB2YXIgaXNPdGhlciA9IGxvY2F0aW9uLmhyZWYuaW5kZXhPZignOi8vcGFuLmJhaWR1LmNvbS9kaXNrJyk9PS0xLAogICAgZG93blByb3h5ID0gbnVsbCxzaGFyZURhdGEgPSBudWxsLAogICAgQ2FudmFzLFBhbmNlbCxSZXN0QVBJLFRvYXN0PXt9LGVycm9yTXNnLAogICAgaWZyYW1lID0gJycsaHR0cEh3bmQgPSBudWxsLGluZGV4ID0gMCwKICAgIG1zZyA9IFsKICAgICAgICAnXHU1NGIxXHU4MGZkXHU0ZTBkXHU0ZThjXHU0ZTQ4LFx1NGUwMFx1NGUyYVx1NjU4N1x1NGVmNlx1OTBmZFx1NGUwZFx1OTAwOVx1NGY2MFx1OGJhOVx1NjIxMVx1NTQ4Ylx1NGUyYVx1NTI5ZS4uLicsIC8vMAogICAgICAgICdcdTVjM2NcdTczOWJcdTRlMDBcdTRlMmFcdTY1ODdcdTRlZjZcdTkwZmRcdTRlMGRcdTkwMDlcdTRmNjBcdTRlMGJcdTRlMmFcdTZiZGJcdTdlYmZcdTU1NGEuLi4nLCAvLzEKICAgICAgICAnXHU0ZjYwVE1cdTc3ZTVcdTkwNTNcdTRmNjBcdTkwMDlcdTRlODY8Yj45MDwvYj5cdTU5MWFcdTRlMmFcdTY1ODdcdTRlZjZcdTU0MTc/XHU2MGYzXHU3ZDJmXHU2YjdiXHU2MjExXHU1NTRhLi4uJywgLy8yCiAgICAgICAgJzxiPlx1OGJmN1x1NmM0Mlx1NWRmMlx1NTNkMVx1OTAwMVx1ZmYwY1x1NjU3MFx1NjM2ZVx1NGUwYlx1ODg0Y1x1NGUyZC4uLjwvYj4nLCAvLzMKICAgICAgICAnPGI+XHU4YmU1XHU5ODc1XHU5NzYyPC9iPlx1NGUwZFx1NjUyZlx1NjMwMVx1NjU4N1x1NGVmNlx1NTkzOVx1NTQ4Y1x1NTkxYVx1NjU4N1x1NGVmNlx1NzY4NDxmb250IGNvbG9yPSJyZWQiPjxiPlx1OTRmZVx1NjNhNVx1NTkwZFx1NTIzNlx1NTQ4Y1x1NjdlNVx1NzcwYjwvYj48L2ZvbnQ+XHVmZjAxJywgLy80CiAgICAgICAgJzxmb250IGNvbG9yPSJyZWQiPlx1OGJmN1x1NmM0Mlx1OGQ4NVx1NjVmNlx1NGU4Ni4uLjwvZm9udD4nLCAvLzUKICAgICAgICAnPGZvbnQgY29sb3I9InJlZCI+XHU4YmY3XHU2YzQyXHU1MWZhXHU5NTE5XHU0ZTg2Li4uPC9mb250PicsIC8vNgogICAgICAgICc8Zm9udCBjb2xvcj0icmVkIj5cdThmZDRcdTU2ZGVcdTY1NzBcdTYzNmVcdTY1ZTBcdTZjZDVcdTc2ZjRcdTg5YzYuLi48L2ZvbnQ+JywgLy83CiAgICAgICAgJ1x1OGJmN1x1OGY5M1x1NTE2NVx1OWE4Y1x1OGJjMVx1NzgwMScsIC8vOAogICAgICAgICdcdTlhOGNcdThiYzFcdTc4MDFcdThmOTNcdTUxNjVcdTk1MTlcdThiZWYsXHU4YmY3XHU5MWNkXHU2NWIwXHU4ZjkzXHU1MTY1JywgLy85CiAgICAgICAgJzxiPlx1OTRmZVx1NjNhNVx1NWRmMlx1NTkwZFx1NTIzNlx1NTIzMFx1NTI2YVx1NTIwN1x1Njc3Zlx1ZmYwMTwvYj4nLCAvLzEwCiAgICAgICAgJ1x1NjcyYVx1NzdlNVx1OTUxOVx1OGJlZlx1ZmYwY2Vycm5vOicsLy8xMQogICAgICAgICc8Zm9udCBjb2xvcj0icmVkIj48Yj5cdTVjM2NcdTczOWJcdTdhZGZcdTcxMzZcdThkZWFcdTRlODZcdTRlODZcdWZmMGNcdTRlMGRcdTg5ODFcdTU0NGFcdThiYzlcdTYyMTFcdTRmNjBcdTc2ODRcdTZjMzRcdTg4NjhcdTU3MjhcdTkxY2NcdTk3NjIuLi48L2I+PC9mb250PicsLy8xMgogICAgICAgICcnCiAgICAgICAgXSwKICAgIGJ0bkNsYXNzQXJyPVsKICAgICAgICB7Y3NzOidpY29uLWRvd25sb2FkJyx0YWc6J2EnLGlkOicnfSwKICAgICAgICB7Y3NzOidpY29uLWJ0bi1kb3dubG9hZCcsdGFnOidsaScsaWQ6Jyd9LAogICAgICAgIHtjc3M6J2ljb24tYnRuLWRvd25sb2FkJyx0YWc6JycsaWQ6Jyd9LAogICAgICAgIHtjc3M6J2Rvd25sb2FkLWJ0bicsdGFnOicnLGlkOicnfSwKICAgICAgICB7Y3NzOicnLHRhZzonJyxpZDonZG93bkZpbGVCdXR0b24nfQogICAgXTsKICAgIHRyeXsKICAgICAgICBkb3duUHJveHkgPSBpc090aGVyID8gZGlzay51dGlsLkRvd25sb2FkUHJveHkgfHwgbnVsbCA6IG51bGw7CiAgICAgICAgc2hhcmVEYXRhID0gaXNPdGhlciA/IGRpc2sudXRpbC5WaWV3U2hhcmVVdGlscyB8fCBudWxsIDogbnVsbDsKICAgIH1jYXRjaChlKXt9CiAgICBpZighaXNPdGhlciB8fCAoaXNPdGhlciAmJiAhRmlsZVV0aWxzKSl7CiAgICAgICAgUmVzdEFQST1yZXF1aXJlKCJjb21tb246d2lkZ2V0L3Jlc3RBcGkvcmVzdEFwaS5qcyIpOwogICAgICAgIENhbnZhcz1yZXF1aXJlKCJjb21tb246d2lkZ2V0L2NhbnZhc1BhbmVsL2NhbnZhc1BhbmVsLmpzIik7CiAgICAgICAgUGFuY2VsPXJlcXVpcmUoImNvbW1vbjp3aWRnZXQvcGFuZWwvcGFuZWwuanMiKTsKICAgICAgICBUb2FzdCA9IHJlcXVpcmUoImNvbW1vbjp3aWRnZXQvdG9hc3QvdG9hc3QuanMiKTsKICAgICAgICBlcnJvck1zZyA9IHJlcXVpcmUoImNvbW1vbjp3aWRnZXQvZXJyb3JNc2cvZXJyb3JNc2cuanMiKTsKICAgIH0KICAgIHZhciBoZWxwZXJNZW51QnRucz0oZnVuY3Rpb24oKXsKICAgICAgICB2YXIgbWVudVRpdGxlQXJyPVsnXHU3NmY0XHU2M2E1XHU0ZTBiXHU4ZjdkJywnXHU1OTBkXHU1MjM2XHU5NGZlXHU2M2E1JywnXHU2N2U1XHU3NzBiXHU5NGZlXHU2M2E1J10scGFuQnRuc0Fycj1bXSxodG1sPScnOwogICAgICAgIGZvcih2YXIgaT0wO2k8YnRuQ2xhc3NBcnIubGVuZ3RoO2krKyl7CiAgICAgICAgICAgIHZhciBpdGVtPWJ0bkNsYXNzQXJyW2ldOwogICAgICAgICAgICB2YXIgdG1wSXRlbT1pdGVtLmlkIT0nJyA/ICQoJyMnK2l0ZW0uaWQpIDogJCgnLicraXRlbS5jc3MpOwogICAgICAgICAgICB2YXIgdG1wQXJyPWl0ZW0udGFnIT0nJyA/IHRtcEl0ZW0ucGFyZW50KGl0ZW0udGFnKSA6IHRtcEl0ZW07CiAgICAgICAgICAgIHBhbkJ0bnNBcnI9JC5tZXJnZShwYW5CdG5zQXJyLHRtcEFyci50b0FycmF5KCkpOwogICAgICAgIH0KICAgICAgICBpZighcGFuQnRuc0Fyci5sZW5ndGgpe3JldHVybiBwYW5CdG5zQXJyO30KICAgICAgICBodG1sKz0nPGRpdiBpZD0icGFuSGVscGVyTWVudSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDt6LWluZGV4Ojk5OTk5OTsiPic7CiAgICAgICAgaHRtbCs9Jzx1bCBjbGFzcz0icHVsbC1kb3duLW1lbnUiIHN0eWxlPSJkaXNwbGF5OmJsb2NrO21hcmdpbjowcHg7cGFkZGluZzowcHg7bGVmdDowcHg7dG9wOjBweDtsaXN0LXN0eWxlOm5vbmU7Ij4nOwogICAgICAgIGZvcih2YXIgaT0wO2k8bWVudVRpdGxlQXJyLmxlbmd0aDtpKyspewogICAgICAgICAgICBodG1sKz0nPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6OyIgY2xhc3M9InBhbkhlbHBlck1lbnVCdG4iIHR5cGU9IicraSsnIj48Yj4nK21lbnVUaXRsZUFycltpXSsnPC9iPjwvYT48L2xpPic7CiAgICAgICAgfQogICAgICAgIGh0bWwrPSc8bGkgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxhIGhyZWY9IicgKyBnZXRBcGlVcmwoJ2dldG5ld3ZlcnNpb24nLCAxKSArICciIHRhcmdldD0iX2JsYW5rIj4nOwogICAgICAgIGh0bWwrPSc8aW1nIGlkPSJ1cGRhdGVpbWciIHRpdGxlPSJcdTY3MDlcdTRlMDBcdTRlZmRcdTc1MzAiIHN0eWxlPSJib3JkZXI6bm9uZTsiLz48L2E+PC9saT48L3VsPjwvZGl2Pic7CiAgICAgICAgJCgnPGRpdj4nKS5odG1sKGh0bWwpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFuQnRuc0Fyci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgaXRlbSA9IHBhbkJ0bnNBcnJbaV07CiAgICAgICAgICAgIGNyZWF0ZUhlbHBlckJ0bihpdGVtKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSGVscGVyQnRuKGJ0bikgewogICAgICAgICAgICB2YXIgbmV3bm9kZT1idG4uY2xvbmVOb2RlKHRydWUpLGh0bWw9bmV3bm9kZS5pbm5lckhUTUw7CiAgICAgICAgICAgICQobmV3bm9kZSkuYXR0cignaWQnLCcnKS5hdHRyKCdocmVmJywnamF2YXNjcmlwdDp2b2lkKDApJykuYXR0cignZGF0YS1rZXknLCdkb3duTG9hZGhlbHBlcicpLmF0dHIoJ25vZGUtdHlwZScsJ2J0bkhlbHBlcicpLmF0dHIoJ29uY2xpY2snLCcnKS5jc3Moe3dpZHRoOjYzfSkuaHRtbChodG1sLnJlcGxhY2UoL1tcdTRFMDAtXHU5RkE1XXsyLDR9KFwoLipcKXxcdWZmMDguKlx1ZmYwOSk/LywnXHU3ZjUxXHU3NmQ4XHU1MmE5XHU2MjRiJykpLnVuYmluZCgpOwogICAgICAgICAgICB2YXIgbz0kKCc8ZGl2IGNsYXNzPSJQYW5IZWxwZXJCdG4iIHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jazsiPicpLmFwcGVuZChuZXdub2RlKVswXTsKICAgICAgICAgICAgYnRuLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG8sIGJ0bi5uZXh0U2libGluZyk7CiAgICAgICAgICAgIHJldHVybiBvOwogICAgICAgIH0KICAgICAgICB2YXIgaGVscGVyQnRuID0gJCgnLlBhbkhlbHBlckJ0bicpLGhlbHBlck1lbnUgPSAkKCcjcGFuSGVscGVyTWVudScpLAogICAgICAgIG1lbnVGdW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaGVscGVyRG93bmxvYWQoJCh0aGlzKS5hdHRyKCd0eXBlJykgfHwgMCk7CiAgICAgICAgICAgIGhlbHBlck1lbnUuaGlkZSgpOwogICAgICAgIH07CiAgICAgICAgaGVscGVyQnRuLmNsaWNrKG1lbnVGdW4pLm1vdXNlZW50ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2ItaW1nLW92ZXInKTsKICAgICAgICAgICAgdmFyIG89JCh0aGlzKS5jaGlsZHJlbignYScpLG9mZnNldD1vLm9mZnNldCgpLHc9by5vdXRlcldpZHRoKCktcGFyc2VJbnQoby5jc3MoJ3BhZGRpbmdSaWdodCcpKTsKICAgICAgICAgICAgaGVscGVyTWVudS5jaGlsZHJlbigndWwnKS5jc3MoJ3dpZHRoJywgdy0yKTsKICAgICAgICAgICAgaGVscGVyTWVudS5jc3MoJ3RvcCcsIG9mZnNldC50b3AgKyBvLmhlaWdodCgpICsgcGFyc2VJbnQoby5jc3MoJ3BhZGRpbmdUb3AnKSkgLSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk7CiAgICAgICAgICAgIGhlbHBlck1lbnUuY3NzKCdsZWZ0Jywgb2Zmc2V0LmxlZnQpLnNob3coKTsKICAgICAgICB9KS5tb3VzZWxlYXZlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdiLWltZy1vdmVyJyk7CiAgICAgICAgICAgIGhlbHBlck1lbnUuaGlkZSgpOwogICAgICAgIH0pOwogICAgICAgICQoZG9jdW1lbnQpLnNjcm9sbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaGVscGVyTWVudS5oaWRlKCk7CiAgICAgICAgfSk7CiAgICAgICAgaGVscGVyTWVudS5tb3VzZWVudGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkKHRoaXMpLnNob3coKTsKICAgICAgICB9KS5tb3VzZWxlYXZlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTsKICAgICAgICB9KTsKICAgICAgICBoZWxwZXJNZW51LmZpbmQoJ2EnKS5jc3MoJ3RleHQtYWxpZ24nLCAnY2VudGVyJyk7CiAgICAgICAgcmV0dXJuIGhlbHBlck1lbnUuZmluZCgnYS5wYW5IZWxwZXJNZW51QnRuJykuY2xpY2sobWVudUZ1bikudG9BcnJheSgpOwogICAgfSkoKTsKICAgIGlmKCFoZWxwZXJNZW51QnRucy5sZW5ndGgpe3JldHVybjt9CiAgICBjaGVja1VwZGF0ZSgpOwogICAgZnVuY3Rpb24gaGVscGVyRG93bmxvYWQodHlwZSl7CiAgICAgICAgaWZyYW1lPWNyZWF0ZURvd25sb2FkSWZyYW1lKCk7CiAgICAgICAgaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0OjsnOwogICAgICAgIHZhciBpdGVtcyA9IGdldExpc3RWaWV3Q2hlY2tlZEl0ZW1zKCksbGVuID0gaXRlbXMubGVuZ3RoOwogICAgICAgIGlmKCFsZW4pIHsKICAgICAgICAgICAgaW5kZXggPSAxID09IGluZGV4ID8gMCA6IDE7CiAgICAgICAgICAgIHJldHVybiBteVRvYXN0KG1zZ1tpbmRleF0pOwogICAgICAgIH1lbHNlIGlmIChsZW4gPiA5MCkgewogICAgICAgICAgICByZXR1cm4gbXlUb2FzdChtc2dbMl0pOwogICAgICAgIH0KICAgICAgICBpZigxID09IGxlbikgewogICAgICAgICAgICB2YXIgdXJsID0gaXRlbXNbMF0uZGxpbms7CiAgICAgICAgICAgIGlmKGlzVXJsKHVybCkpIHsKICAgICAgICAgICAgICAgIGlmKDIgPT0gdHlwZSkgewogICAgICAgICAgICAgICAgICAgIHNob3dIZWxwZXJEaWFsb2codHlwZSwgaXRlbXMsIHsiZXJybm8iOiAwLCJkbGluayI6IHVybH0pOwogICAgICAgICAgICAgICAgfWVsc2UgaWYoMSA9PSB0eXBlKXsKICAgICAgICAgICAgICAgICAgICBjb3B5VGV4dCh1cmwpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgbXlUb2FzdChtc2dbM10sMSk7CiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLnNyYyA9IHVybDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBnZXREb3dubG9hZEluZm8odHlwZSwgaXRlbXMpOwogICAgICAgICAgICB9CiAgICAgICAgfWVsc2UgewogICAgICAgICAgICBnZXREb3dubG9hZEluZm8odHlwZSwgaXRlbXMpOwogICAgICAgIH0KICAgICAgICBkb3dubG9hZENvdW50ZXIoaXRlbXMpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0RG93bmxvYWRJbmZvKHR5cGUsIGl0ZW1zLCB2Y29kZSkgewogICAgICAgIGlmKCF2Y29kZSkgewogICAgICAgICAgICBzaG93SGVscGVyRGlhbG9nKGhlbHBlck1lbnVCdG5zLmxlbmd0aCsxLCBpdGVtcyk7CiAgICAgICAgICAgIHZjb2RlID0ge307CiAgICAgICAgfQogICAgICAgIHZhciB1cmwgPSAnJyxkYXRhID0ge30sZmlkbGlzdCA9ICcnLGZpZHMgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpZHMucHVzaChpdGVtc1tpXVsnZnNfaWQnXSk7CiAgICAgICAgfQogICAgICAgIGZpZGxpc3QgPSAnWycgKyBmaWRzLmpvaW4oJywnKSArICddJzsKICAgICAgICBpZihpc090aGVyKXsKICAgICAgICAgICAgaWYoRmlsZVV0aWxzKXsKICAgICAgICAgICAgICAgIHVybCA9IGRpc2suYXBpLlJlc3RBUEkuU0hBUkVfR0VUX0RMSU5LICsgJyZ1az0nICsgRmlsZVV0aWxzLnNoYXJlX3VrICsgJyZzaGFyZWlkPScgKyBGaWxlVXRpbHMuc2hhcmVfaWQgKyAnJnRpbWVzdGFtcD0nICsgRmlsZVV0aWxzLnNoYXJlX3RpbWVzdGFtcCArICcmc2lnbj0nICsgRmlsZVV0aWxzLnNoYXJlX3NpZ24gKyAnJmZpZF9saXN0PScgKyBmaWRsaXN0OwogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBzaGFyZWlkOkZpbGVVdGlscy5zaGFyZV9pZCwKICAgICAgICAgICAgICAgICAgICB1azpGaWxlVXRpbHMuc2hhcmVfdWssCiAgICAgICAgICAgICAgICAgICAgZmlkX2xpc3Q6ZmlkbGlzdAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB2YXIgY29udGV4dD15dW5EYXRhLmdldENvbnRleHQoKTsKICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB2Y29kZSA9PSdvYmplY3QnKXsKICAgICAgICAgICAgICAgICAgICB1cmwgPSAnL2FwaS9zaGFyZWRvd25sb2FkPycgKyAndWs9JyArIHl1bkRhdGEuU0hBUkVfVUsgKyAnJnNoYXJlaWQ9JyArIHl1bkRhdGEuU0hBUkVfSUQgKyAnJnRpbWVzdGFtcD0nICsgeXVuRGF0YS5USU1FU1RBTVAgKyAnJnNpZ249JyArIHl1bkRhdGEuU0lHTiArICcmZmlkX2xpc3Q9JyArIGZpZGxpc3Q7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICdlbmNyeXB0PTAmcHJvZHVjdD1zaGFyZSZwcmltYXJ5aWQ9JyArIHl1bkRhdGEuU0hBUkVfSUQgKyAnJnNoYXJlaWQ9JyArIHl1bkRhdGEuU0hBUkVfSUQgKyAnJnVrPScgKyB5dW5EYXRhLlNIQVJFX1VLICsgJyZmaWRfbGlzdD0nICsgZmlkbGlzdCsgJyZleHRyYT0nICsgJ3sic2VrZXkiOiInICsgY29udGV4dC5zZWtleSArICcifSc7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jcnlwdDowLAogICAgICAgICAgICAgICAgICAgICAgICBleHRyYToneyJzZWtleSI6IicgKyBjb250ZXh0LnNla2V5ICsgJyJ9JywKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdDonc2hhcmUnLAogICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5aWQ6eXVuRGF0YS5TSEFSRV9JRCwKICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVpZDp5dW5EYXRhLlNIQVJFX0lELAogICAgICAgICAgICAgICAgICAgICAgICB1azp5dW5EYXRhLlNIQVJFX1VLLAogICAgICAgICAgICAgICAgICAgICAgICBmaWRfbGlzdDpmaWRsaXN0CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIHVybCA9IFJlc3RBUEkuR0VUX0NBUFRDSEEgKyAnP3Byb2Q9c2hhcmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHR5cGVvZiB2Y29kZSA9PSdvYmplY3QnKXsKICAgICAgICAgICAgICAgIGRhdGEgPSAkLmV4dGVuZChkYXRhLHZjb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhLnR5cGU9KGl0ZW1zLmxlbmd0aCA+MSB8fCBpdGVtc1swXVsnaXNkaXInXSkgPyAiYmF0Y2giIDogImRsaW5rIjsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdXJsID0gUmVzdEFQSS5ET1dOX0dFVF9ETElOSzsKICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHl1bkRhdGEuc2lnbjIpIHRyeSB7CiAgICAgICAgICAgICAgICB5dW5EYXRhLnNpZ24yID0gbmV3IEZ1bmN0aW9uKCJyZXR1cm4gIiArIHl1bkRhdGEuc2lnbjIpKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKG8pIHt9CiAgICAgICAgICAgIGRhdGE9ewogICAgICAgICAgICAgICAgc2lnbjogYmFzZTY0RW5jb2RlKHl1bkRhdGEuc2lnbjIoeXVuRGF0YS5zaWduMywgeXVuRGF0YS5zaWduMSkpLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOiB5dW5EYXRhLnRpbWVzdGFtcCwKICAgICAgICAgICAgICAgIGJkc3Rva2VuOiB5dW5EYXRhLk1ZQkRTVE9LRU4sCiAgICAgICAgICAgICAgICBmaWRsaXN0OiBmaWRsaXN0LAogICAgICAgICAgICAgICAgdHlwZTogKGl0ZW1zLmxlbmd0aCA+MSB8fCBpdGVtc1swXVsnaXNkaXInXSkgPyAiYmF0Y2giIDogImRsaW5rIgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBodHRwSHduZCA9ICQucG9zdCh1cmwsIGRhdGEsCiAgICAgICAgICAgIGZ1bmN0aW9uKG8pIHsKICAgICAgICAgICAgICAgIHZhciBkbGluayA9IHR5cGVvZiBvLmRsaW5rID09J29iamVjdCcgPyBvLmRsaW5rWzBdWydkbGluayddIDogby5kbGluazsKICAgICAgICAgICAgICAgIGlmKC0yMCA9PT0gby5lcnJubyl7CiAgICAgICAgICAgICAgICAgICAgZ2V0RG93bmxvYWRJbmZvKHR5cGUsIGl0ZW1zLCBKU09OLnN0cmluZ2lmeSh2Y29kZSkgPT0ne30nID8gJ2dldHZjb2RlJyA6ICdzaG93dmNvZGUnKTsKICAgICAgICAgICAgICAgIH1lbHNlIGlmICgwID09PSBvLmVycm5vKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoby5saXN0IHx8IGRsaW5rKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWRsaW5rKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gby5saXN0LG9wdD1saXN0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGxpbms9b3B0LmRsaW5rOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRsaW5rID0gZGxpbmsgKyAnJnppcG5hbWU9JyArIGVuY29kZVVSSUNvbXBvbmVudChnZXREb3dubG9hZE5hbWUoaXRlbXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgby5kbGluayA9IGRsaW5rOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hhcmVEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShzaGFyZURhdGEudmlld1NoYXJlRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGxpbmsgPSBkbGluazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlRGF0YS52aWV3U2hhcmVEYXRhID0gSlNPTi5zdHJpbmdpZnkob2JqKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PSBpdGVtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zWzBdWydkbGluayddID0gZGxpbms7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtc1swXVsnaXRlbSddKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW1zWzBdWydpdGVtJ10pLmF0dHIoJ2RsaW5rJyxkbGluayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeXVuRGF0YS5TSEFSRVBBR0VUWVBFID09ICJzaW5nbGVfZmlsZV9wYWdlIil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl1bkRhdGEuRklMRUlORk8gPSBpdGVtczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZSl7fQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG8udmNvZGVfaW1nICYmIG8udmNvZGVfc3RyKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uZXJybm8gPSAtMjA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2Y29kZSA9PSAnZ2V0dmNvZGUnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybiBnZXREb3dubG9hZEluZm8odHlwZSwgaXRlbXMsIGdldFZDb2RlKCd0ZXN0JyxvLnZjb2RlX3N0cikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNob3dIZWxwZXJEaWFsb2codHlwZSwgaXRlbXMsIG8sIHZjb2RlKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIHNob3dIZWxwZXJEaWFsb2codHlwZSwgaXRlbXMsIG8sIHZjb2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBzaG93SGVscGVyRGlhbG9nKHR5cGUsIGl0ZW1zLCBvcHQsIHZjb2RlKSB7CiAgICAgICAgdmFyIGNhbnZhcyA9ZG9jdW1lbnQuY2FudmFzID8gZG9jdW1lbnQuY2FudmFzIDogQ2FudmFzID8gbmV3IENhbnZhcygpIDogbmV3IGRpc2sudWkuQ2FudmFzKCksCiAgICAgICAgXyA9IGRvY3VtZW50LmhlbHBlcmRpYWxvZyB8fCBjcmVhdGVIZWxwZXJEaWFsb2coKSxpc1Zpc2libGUgPSBfLmlzVmlzaWJsZSgpLHN0YXR1cz0wOwogICAgICAgIGRvY3VtZW50LmNhbnZhcyA9IGNhbnZhczsKICAgICAgICBfLmNhbnZhcyA9IGNhbnZhczsKICAgICAgICBfLnR5cGUgPSB0eXBlOwogICAgICAgIF8uaXRlbXMgPSBpdGVtczsKICAgICAgICBpZiAodHlwZSA8IGhlbHBlck1lbnVCdG5zLmxlbmd0aCkgewogICAgICAgICAgICBpZiAoMCA9PT0gb3B0LmVycm5vKSB7CiAgICAgICAgICAgICAgICBzdGF0dXM9MTsKICAgICAgICAgICAgICAgIGlmKHR5cGUgPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgXy5jYW52YXMuc2V0VmlzaWJsZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgXy5zZXRWaXNpYmxlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpZigwID09IHR5cGUpewogICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUuc3JjID0gb3B0LmRsaW5rOwogICAgICAgICAgICAgICAgICAgICAgICBteVRvYXN0KG1zZ1szXSwxKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb3B5VGV4dChvcHQuZGxpbmspOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfLnNoYXJlZmlsZW5hbWUuaW5uZXJIVE1MID0gZ2V0RG93bmxvYWROYW1lKGl0ZW1zKTsKICAgICAgICAgICAgICAgIF8uc2hhcmVkbGluay52YWx1ZSA9IG9wdC5kbGluazsKICAgICAgICAgICAgICAgIF8uZGxpbmsgPSBvcHQuZGxpbms7CiAgICAgICAgICAgICAgICAvL18uZG93bmxvYWRidG4uaHJlZj0gb3B0LmRsaW5rOwogICAgICAgICAgICAgICAgXy5mb2N1c29iaiA9IF8uc2hhcmVkbGluazsKICAgICAgICAgICAgfSBlbHNlIGlmKC0xOSA9PW9wdC5lcnJubykgewogICAgICAgICAgICAgICAgc3RhdHVzPTI7CiAgICAgICAgICAgICAgICBfLnZjb2RlaW1nLnNyYyA9IG9wdC5pbWc7CiAgICAgICAgICAgICAgICBfLnZjb2RlaW1nc3JjID0gb3B0LmltZzsKICAgICAgICAgICAgICAgIF8udmNvZGV2YWx1ZSA9IG9wdC52Y29kZTsKICAgICAgICAgICAgICAgIF8udmNvZGV0aXAuaW5uZXJIVE1MID0gdmNvZGUgPyBtc2dbOV0gOiAnJzsKICAgICAgICAgICAgICAgIF8udmNvZGVpbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgXy5mb2N1c29iaiA9IF8udmNvZGVpbnB1dDsKICAgICAgICAgICAgfWVsc2UgaWYoLTIwID09b3B0LmVycm5vKSB7CiAgICAgICAgICAgICAgICBzdGF0dXM9MjsKICAgICAgICAgICAgICAgIF8udmNvZGVpbWcuc3JjID0gb3B0LnZjb2RlX2ltZzsKICAgICAgICAgICAgICAgIF8udmNvZGVpbWdzcmMgPSBvcHQudmNvZGVfaW1nOwogICAgICAgICAgICAgICAgXy52Y29kZXZhbHVlID0gb3B0LnZjb2RlX3N0cjsKICAgICAgICAgICAgICAgIF8udmNvZGV0aXAuaW5uZXJIVE1MID0gdmNvZGUgJiYgdmNvZGUhPSdnZXR2Y29kZScgPyBtc2dbOV0gOiAnJzsKICAgICAgICAgICAgICAgIF8udmNvZGVpbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgXy5mb2N1c29iaiA9IF8udmNvZGVpbnB1dDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF8uY2FudmFzLnNldFZpc2libGUoZmFsc2UpOwogICAgICAgICAgICAgICAgXy5zZXRWaXNpYmxlKGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBteVRvYXN0KGVycm9yTXNnID8gZXJyb3JNc2cuRXJyb3JNZXNzYWdlW29wdC5lcnJub10gOiBkaXNrLnV0aWwuc2hhcmVFcnJvck1lc3NhZ2Vbb3B0LmVycm5vXSB8fCAobXNnWzExXSArIG9wdC5lcnJubykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF8ubG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gMD09c3RhdHVzID8gJycgOiAnbm9uZSc7CiAgICAgICAgXy5zaG93ZGxpbmsuc3R5bGUuZGlzcGxheSA9IDE9PXN0YXR1cyA/ICcnIDogJ25vbmUnOwogICAgICAgIF8uc2hvd3Zjb2RlLnN0eWxlLmRpc3BsYXkgPSAyPT1zdGF0dXMgPyAnJyA6ICdub25lJzsKICAgICAgICBfLmNvcHl0ZXh0LnN0eWxlLmRpc3BsYXkgPSAxPT1zdGF0dXMgPyAnJyA6ICdub25lJzsKICAgICAgICBpZiAoIWlzVmlzaWJsZSkgewogICAgICAgICAgICBfLmNhbnZhcy5zZXRWaXNpYmxlKHRydWUpOwogICAgICAgICAgICBfLnNldFZpc2libGUodHJ1ZSk7CiAgICAgICAgfQogICAgICAgIF8uc2V0R3Jhdml0eShQYW5jZWwgPyBQYW5jZWwuQ0VOVEVSIDogZGlzay51aS5QYW5lbC5DRU5URVIpOwogICAgICAgIF8uZm9jdXNvYmouZm9jdXMoKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNyZWF0ZUhlbHBlckRpYWxvZygpIHsKICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGNsYXNzPSJkbGctaGQgYi1ybHYidGl0bGU9Ilx1NjcwOVx1NGUwMFx1NGVmZFx1NzUzMCI+PHNwYW4gdGl0bGU9Ilx1NTE3M1x1OTVlZCJpZD0iaGVscGVyZGlhbG9nY2xvc2UiY2xhc3M9ImRsZy1jbnIgZGxnLWNuci1yIj48L3NwYW4+PGgzPjxhIGhyZWY9IicrZ2V0QXBpVXJsKCdnZXRuZXd2ZXJzaW9uJywxKSsnInRhcmdldD0iX2JsYW5rInN0eWxlPSJjb2xvcjojMDAwOyI+JytBUFBOQU1FKycmbmJzcDsnICsgVkVSU0lPTiArICc8L2E+PGEgaHJlZj0iamF2YXNjcmlwdDo7InRpdGxlPSJcdTcwYjlcdTZiNjRcdTU5MGRcdTUyMzYiaWQ9ImNvcHl0ZXh0InN0eWxlPSJmbG9hdDpyaWdodDttYXJnaW4tcmlnaHQ6MjQwcHg7ZGlzcGxheTpub25lOyI+XHU3MGI5XHU2YjY0XHU1OTBkXHU1MjM2PC9hPjwvaDM+PC9kaXY+PGRpdiBjbGFzcz0iZG93bmxvYWQtbWdyLWRpYWxvZy1tc2cgY2VudGVyImlkPSJoZWxwZXJsb2FkaW5nIj48Yj5cdTY1NzBcdTYzNmVcdThkNzZcdTY3NjVcdTRlMmQuLi48L2I+PC9kaXY+PGRpdiBpZD0ic2hvd3Zjb2RlInN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtkaXNwbGF5Om5vbmU7Ij48ZGl2IGNsYXNzPSJkbGctYmQgZG93bmxvYWQtdmVyaWZ5InN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjttYXJnaW4tdG9wOjI1cHg7Ij48ZGl2IGNsYXNzPSJ2ZXJpZnktYm9keSI+XHU4YmY3XHU4ZjkzXHU1MTY1XHU5YThjXHU4YmMxXHU3ODAxXHVmZjFhPGlucHV0IHR5cGU9InRleHQibWF4bGVuZ3RoPSI0ImNsYXNzPSJpbnB1dC1jb2RlIHZjb2RlIj48aW1nIHdpZHRoPSIxMDAiaGVpZ2h0PSIzMCJzcmM9IiJhbHQ9Ilx1OWE4Y1x1OGJjMVx1NzgwMVx1ODNiN1x1NTNkNlx1NGUyZCJjbGFzcz0iaW1nLWNvZGUiPjxhIGNsYXNzPSJ1bmRlcmxpbmUiaHJlZj0iamF2YXNjcmlwdDo7Ij5cdTYzNjJcdTRlMDBcdTVmMjA8L2E+PC9kaXY+PGRpdiBjbGFzcz0idmVyaWZ5LWVycm9yInN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7bWFyZ2luLWxlZnQ6ODRweDsiPjwvZGl2PjwvZGl2Pjxicj48ZGl2PjxkaXYgY2xhc3M9ImFsZXJ0LWRpYWxvZy1jb21tYW5kcyBjbGVhcmZpeCI+PGEgaHJlZj0iamF2YXNjcmlwdDo7ImNsYXNzPSJzYnRuIG9rYXkgcG9zdHZjb2RlIj48Yj5cdTc4NmVcdTViOWE8L2I+PC9hPjxhIGhyZWY9ImphdmFzY3JpcHQ6OyJjbGFzcz0iZGJ0biBjYW5jZWwiPjxiPlx1NTE3M1x1OTVlZDwvYj48L2E+PC9kaXY+PC9kaXY+PC9kaXY+PGRpdiBpZD0ic2hvd2RsaW5rInN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtkaXNwbGF5Om5vbmU7Ij48ZGl2IGNsYXNzPSJkbGctYmQgZG93bmxvYWQtdmVyaWZ5Ij48ZGl2IHN0eWxlPSJwYWRkaW5nOjVweCAwcHg7Ij48Yj48c3BhbiBpZD0ic2hhcmVmaWxlbmFtZSI+PC9zcGFuPjwvYj48L2Rpdj48aW5wdXQgdHlwZT0idGV4dCJuYW1lPSJzaGFyZWRsaW5rImlkPSJzaGFyZWRsaW5rImNsYXNzPSJpbnB1dC1jb2RlIm1heGxlbmd0aD0iMTAyNCJ2YWx1ZT0iInN0eWxlPSJ3aWR0aDo1MDBweDtib3JkZXI6MXB4IHNvbGlkICM3RkFEREM7cGFkZGluZzozcHg7aGVpZ2h0OjI0cHg7Ij48L2Rpdj48YnI+PGRpdj48ZGl2IGNsYXNzPSJhbGVydC1kaWFsb2ctY29tbWFuZHMgY2xlYXJmaXgiPjxhIGhyZWY9ImphdmFzY3JpcHQ6OyJjbGFzcz0ic2J0biBva2F5IHBvc3Rkb3dubG9hZCI+PGI+XHU3NmY0XHU2M2E1XHU0ZTBiXHU4ZjdkPC9iPjwvYT48YSBocmVmPSJqYXZhc2NyaXB0OjsiY2xhc3M9ImRidG4gY2FuY2VsIj48Yj5cdTUxNzNcdTk1ZWQ8L2I+PC9hPjwvZGl2PjwvZGl2PjwvZGl2PicsCiAgICAgICAgbz0kKCc8ZGl2IGNsYXNzPSJiLXBhbmVsIGRvd25sb2FkLW1nci1kaWFsb2cgaGVscGVyZGlhbG9nIiBzdHlsZT0id2lkdGg6NTUwcHg7Ij4nKS5odG1sKGh0bWwpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogICAgICAgIG9bMF0ucGFuZSA9IG9bMF07CiAgICAgICAgdmFyIF8gPSBQYW5jZWwgPyBuZXcgUGFuY2VsKG9bMF0pIDogbmV3IGRpc2sudWkuUGFuZWwob1swXSksdmNvZGVpbWcgPSBvLmZpbmQoJ2ltZycpWzBdLHZjb2RlaW5wdXQgPSBvLmZpbmQoJy52Y29kZScpWzBdLAogICAgICAgIHNoYXJlZGxpbmsgPSBvLmZpbmQoJyNzaGFyZWRsaW5rJylbMF0sdmNvZGV0aXAgPSBvLmZpbmQoJy52ZXJpZnktZXJyb3InKVswXSwKICAgICAgICBjb3B5dGV4dD0gby5maW5kKCcjY29weXRleHQnKVswXSxwb3N0ZG93bmxvYWRCdG49by5maW5kKCcucG9zdGRvd25sb2FkJylbMF0sCiAgICAgICAgZGlhbG9nQ2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmNvZGVpbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICB2Y29kZXRpcC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgdmNvZGVpbWcuc3JjID0gJyc7CiAgICAgICAgICAgIF8uY2FudmFzLnNldFZpc2libGUoZmFsc2UpOwogICAgICAgICAgICBfLnNldFZpc2libGUoZmFsc2UpOwogICAgICAgICAgICBpZiAoaHR0cEh3bmQpIHtodHRwSHduZC5hYm9ydCgpO30KICAgICAgICB9LAogICAgICAgIHBvc3R2Y29kZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoaHR0cEh3bmQpIHtodHRwSHduZC5hYm9ydCgpO30KICAgICAgICAgICAgdmFyIHYgPSB2Y29kZWlucHV0LnZhbHVlLGxlbiA9IHYubGVuZ3RoLG1heCA9IG1zZy5sZW5ndGggLSAxLGkgPSBtYXgsCiAgICAgICAgICAgIHZjb2RlID0gZ2V0VkNvZGUodixfLnZjb2RldmFsdWUpOwogICAgICAgICAgICBpID0gMCA9PSBsZW4gPyA4IDogKGxlbiA8IDQgPyA5IDogaSk7CiAgICAgICAgICAgIHZjb2RldGlwLmlubmVySFRNTCA9IG1zZ1tpXTsKICAgICAgICAgICAgaWYgKGkgIT0gbWF4KSB7cmV0dXJuIHZjb2RlaW5wdXQuZm9jdXMoKTt9CiAgICAgICAgICAgIGdldERvd25sb2FkSW5mbyhfLnR5cGUsIF8uaXRlbXMsIHZjb2RlKTsKICAgICAgICB9LAogICAgICAgIHBvc3Rkb3dubG9hZCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgLy9pZighZSl7aWZyYW1lLnNyYyA9IF8uZGxpbms7fQogICAgICAgICAgICBpZnJhbWUuc3JjID0gXy5kbGluazsKICAgICAgICAgICAgZGlhbG9nQ2xvc2UoKTsKICAgICAgICAgICAgbXlUb2FzdChtc2dbM10sMSk7CiAgICAgICAgfTsKICAgICAgICBfLl9tVUkucGFuZSA9IG9bMF07CiAgICAgICAgXy5sb2FkaW5nID0gby5maW5kKCcjaGVscGVybG9hZGluZycpWzBdOwogICAgICAgIF8uc2hvd3Zjb2RlID0gby5maW5kKCcjc2hvd3Zjb2RlJylbMF07CiAgICAgICAgXy5zaG93ZGxpbmsgPSBvLmZpbmQoJyNzaG93ZGxpbmsnKVswXTsKICAgICAgICBfLmNvcHl0ZXh0PSBjb3B5dGV4dDsKICAgICAgICBfLmRvd25sb2FkYnRuPXBvc3Rkb3dubG9hZEJ0bjsKICAgICAgICBfLnZjb2RlaW5wdXQgPSB2Y29kZWlucHV0OwogICAgICAgIF8uc2hhcmVkbGluayA9IHNoYXJlZGxpbms7CiAgICAgICAgXy5zaGFyZWZpbGVuYW1lID0gby5maW5kKCcjc2hhcmVmaWxlbmFtZScpWzBdOwogICAgICAgIF8udmNvZGVpbWcgPSB2Y29kZWltZzsKICAgICAgICBfLnZjb2RldGlwID0gdmNvZGV0aXA7CiAgICAgICAgXy52Y29kZWltZ3NyYyA9ICcnOwogICAgICAgIF8udmNvZGV2YWx1ZSA9ICcnOwogICAgICAgIF8uZm9jdXNvYmogPSBzaGFyZWRsaW5rOwogICAgICAgICQoY29weXRleHQpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGNvcHlUZXh0KF8uZGxpbmspOwogICAgICAgICAgICB0aGlzLmJsdXIoKTsKICAgICAgICB9KTsKICAgICAgICAkKHZjb2RlaW1nKS5zaWJsaW5ncygnYScpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2Y29kZWltZy5zcmMgPSBfLnZjb2RlaW1nc3JjICsgJyYnICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICAgIHZjb2RlaW5wdXQuZm9jdXMoKTsKICAgICAgICB9KTsKICAgICAgICB2Y29kZWlucHV0Lm9ua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgaWYgKDEzID09IGUua2V5Q29kZSkge3Bvc3R2Y29kZSgpO30KICAgICAgICB9OwogICAgICAgIG8uZmluZCgnLnBvc3R2Y29kZScpLmNsaWNrKHBvc3R2Y29kZSk7CiAgICAgICAgJChwb3N0ZG93bmxvYWRCdG4pLmNsaWNrKHBvc3Rkb3dubG9hZCk7CiAgICAgICAgJCgnI3NoYXJlZGxpbmsnKS5mb2N1c2luKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLnN0eWxlLmJveFNoYWRvdyA9ICcwIDAgM3B4ICM3RkFEREMnOwogICAgICAgICAgICB0aGlzLnNlbGVjdCgpOwogICAgICAgIH0pLmZvY3Vzb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLnN0eWxlLmJveFNoYWRvdyA9ICcnOwogICAgICAgIH0pLm1vdXNlb3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5zZWxlY3QoKTsKICAgICAgICAgICAgdGhpcy5mb2N1cygpOwogICAgICAgIH0pLmtleWRvd24oZnVuY3Rpb24oZSkgewogICAgICAgICAgICBpZiAoMTMgPT0gZS5rZXlDb2RlKSB7cG9zdGRvd25sb2FkKCk7fQogICAgICAgIH0pOwogICAgICAgICQod2luZG93KS5iaW5kKCJyZXNpemUiLGZ1bmN0aW9uKCkgewogICAgICAgICAgICBfLnNldEdyYXZpdHkoUGFuY2VsID8gUGFuY2VsLkNFTlRFUiA6IGRpc2sudWkuUGFuZWwuQ0VOVEVSKTsKICAgICAgICB9KTsKICAgICAgICBvLmZpbmQoJyNoZWxwZXJkaWFsb2djbG9zZScpLmNsaWNrKGRpYWxvZ0Nsb3NlKTsKICAgICAgICBvLmZpbmQoJy5kYnRuJykuY2xpY2soZGlhbG9nQ2xvc2UpOwogICAgICAgIF8uc2V0VmlzaWJsZShmYWxzZSk7CiAgICAgICAgZG9jdW1lbnQuaGVscGVyZGlhbG9nID0gXzsKICAgICAgICByZXR1cm4gXzsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFZDb2RlKHYsayl7CiAgICAgICAgcmV0dXJuIEZpbGVVdGlscyA/IHtpbnB1dDp2LHZjb2RlOl8ua30gOiB7dmNvZGVfaW5wdXQ6dix2Y29kZV9zdHI6a307CiAgICB9CiAgICBmdW5jdGlvbiBteVRvYXN0KG1zZywgdHlwZSkgewogICAgICAgIHRyeXsKICAgICAgICAgICAgdW5zYWZlV2luZG93Lm15VG9hc3RJbmplY3Rpb24obXNnLHR5cGUsaXNPdGhlcik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Y2F0Y2goZSl7fQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBUb2FzdCA9IHt9LCBvYnRhaW4sUGFuY2VsID0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzT3RoZXIgJiYgZGlzay51aSkgewogICAgICAgICAgICAgICAgb2J0YWluID0gZGlzay51aS5Ub2FzdDsKICAgICAgICAgICAgICAgIFRvYXN0Lm9idGFpbiA9IHt9OwogICAgICAgICAgICAgICAgVG9hc3Qub2J0YWluLnVzZVRvYXN0ID0gVXRpbGl0aWVzLnVzZVRvYXN0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgVG9hc3QgPSByZXF1aXJlKCJjb21tb246d2lkZ2V0L3RvYXN0L3RvYXN0LmpzIik7CiAgICAgICAgICAgICAgICBQYW5jZWw9cmVxdWlyZSgiY29tbW9uOndpZGdldC9wYW5lbC9wYW5lbC5qcyIpOwogICAgICAgICAgICAgICAgb2J0YWluID0gVG9hc3Qub2J0YWluOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBvID0gVG9hc3Qub2J0YWluLnVzZVRvYXN0KHsKICAgICAgICAgICAgICAgIHRvYXN0TW9kZTp0eXBlID8gb2J0YWluLk1PREVfU1VDQ0VTUyA6b2J0YWluLk1PREVfRkFJTFVSRSwKICAgICAgICAgICAgICAgIG1zZzptc2csCiAgICAgICAgICAgICAgICBzdGlja3k6ZmFsc2UsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjpQYW5jZWwgPyBQYW5jZWwuVE9QIDogKGRpc2sudWkgPyBkaXNrLnVpLlBhbmVsLlRPUCA6IHVuZGVmaW5lZCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkKG8uX21VSS5wYW5lKS5jc3MoewogICAgICAgICAgICAgICAgICAgICJ6LWluZGV4Ijo5OTk5OTkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBpZiAoIXR5cGUpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KG1zZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBjb3B5VGV4dCh0ZXh0KXsKICAgICAgICBHTV9zZXRDbGlwYm9hcmQodGV4dCk7CiAgICAgICAgbXlUb2FzdChtc2dbMTBdLDEpOwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlRG93bmxvYWRJZnJhbWUoKXsKICAgICAgICBpZihpZnJhbWUpe3JldHVybiBpZnJhbWU7fQogICAgICAgIHZhciBvID0gJCgnI2hlbHBlcmRvd25sb2FkaWZyYW1lJyk7CiAgICAgICAgaWZyYW1lPW8ubGVuZ3RoID8gb1swXSA6ICcnOwogICAgICAgIGlmKCFpZnJhbWUpIHsKICAgICAgICAgICAgaWZyYW1lID0gJCgnPGRpdiBzdHlsZT0iZGlzcGxheTpub25lOyI+JykuaHRtbCgnPGlmcmFtZSBzcmM9IiIgaWQ9ImhlbHBlcmRvd25sb2FkaWZyYW1lIiBuYW1lPSJoZWxwZXJkb3dubG9hZGlmcmFtZSI+PC9pZnJhbWU+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuZmluZCgnI2hlbHBlcmRvd25sb2FkaWZyYW1lJylbMF07CiAgICAgICAgfQogICAgICAgICQoaWZyYW1lKS5sb2FkKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmKHRoaXMuc3JjPT0namF2YXNjcmlwdDo7Jyl7cmV0dXJuO30KICAgICAgICAgICAgbXlUb2FzdChtc2dbMTJdLDApOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBpZnJhbWU7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRMaXN0Vmlld0NoZWNrZWRJdGVtcygpewogICAgICAgIHZhciBpdGVtcz1bXTsKICAgICAgICBpZihzaGFyZURhdGEpewogICAgICAgICAgICBpdGVtcy5wdXNoKEpTT04ucGFyc2Uoc2hhcmVEYXRhLnZpZXdTaGFyZURhdGEpKTsKICAgICAgICB9ZWxzZSBpZihpc090aGVyKSB7CiAgICAgICAgICAgIGlmKEZpbGVVdGlscyl7CiAgICAgICAgICAgICAgICBpdGVtcyA9IEZpbGVVdGlscy5nZXRMaXN0Vmlld0NoZWNrZWRJdGVtcygpOwogICAgICAgICAgICB9ZWxzZSBpZih5dW5EYXRhKXsKICAgICAgICAgICAgICAgIGlmKHl1bkRhdGEuU0hBUkVQQUdFVFlQRSA9PSAibXVsdGlfZmlsZSIpewogICAgICAgICAgICAgICAgICAgIGl0ZW1zPWdldENoZWNrSXRlbXMoKTsKICAgICAgICAgICAgICAgIH1lbHNlIGlmKHl1bkRhdGEuU0hBUkVQQUdFVFlQRSA9PSAic2luZ2xlX2ZpbGVfcGFnZSIpewogICAgICAgICAgICAgICAgICAgIGl0ZW1zPXl1bkRhdGEuRklMRUlORk87CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgaXRlbXM9Z2V0Q2hlY2tJdGVtcygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaXRlbXM7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRDaGVja0l0ZW1zKCl7CiAgICAgICAgdmFyIGl0ZW1zPVtdLGJveENzcz0kKCcubGlzdC1zZWxlY3RlZCcpLmxlbmd0aCA/ICdtb2R1bGUtbGlzdC12aWV3JyA6ICdtb2R1bGUtZ3JpZC12aWV3JzsKICAgICAgICAkKCdkaXYuJyArIGJveENzcykuZmluZCgnLml0ZW0tYWN0aXZlJykuZWFjaChmdW5jdGlvbihpLG8pewogICAgICAgICAgICBpdGVtcy5wdXNoKGdldExpc3RWaWV3Q2hlY2tlZEl0ZW1JbmZvKG8pKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaXRlbXM7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRMaXN0Vmlld0NoZWNrZWRJdGVtSW5mbyhvYmopewogICAgICAgIHZhciBvPSQob2JqKSxmc19pZD1vLmF0dHIoJ2RhdGEtaWQnKSxjYXRlZ29yeT1vLmF0dHIoJ2RhdGEtY2F0ZWdvcnknKSwKICAgICAgICAgICAgaXNkaXI9by5hdHRyKCdkYXRhLWV4dG5hbWUnKT09J2RpcicgPyAxIDogMCwKICAgICAgICAgICAgc2VydmVyX2ZpbGVuYW1lPW8uZmluZCgnW25vZGUtdHlwZT0ibmFtZSJdJykuYXR0cigndGl0bGUnKSwKICAgICAgICAgICAgZGxpbms9by5hdHRyKCdkbGluaycpIHx8ICcnOwogICAgICAgIHJldHVybiB7J2ZzX2lkJzpmc19pZCwnY2F0ZWdvcnknOmNhdGVnb3J5LCdpc2Rpcic6aXNkaXIsJ3NlcnZlcl9maWxlbmFtZSc6c2VydmVyX2ZpbGVuYW1lLCdkbGluayc6ZGxpbmssJ2l0ZW0nOm9ian07CiAgICB9CiAgICBmdW5jdGlvbiBnZXREb3dubG9hZE5hbWUoaXRlbXMpIHsKICAgICAgICB2YXIgcGFja05hbWU9aXRlbXNbMF1bJ3NlcnZlcl9maWxlbmFtZSddOwogICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAxIHx8IDEgPT0gaXRlbXNbMF1bJ2lzZGlyJ10pIHsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgZG93blByb3h5LnByb3RvdHlwZS5zZXRQYWNrTmFtZShGaWxlVXRpbHMucGFyc2VEaXJGcm9tUGF0aChpdGVtc1swXVsncGF0aCddKSwgIWl0ZW1zWzBdWydpc2RpciddKTsKICAgICAgICAgICAgICAgIHBhY2tOYW1lPSBkb3duUHJveHkucHJvdG90eXBlLl9tUGFja05hbWU7CiAgICAgICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgICAgICAgIHBhY2tOYW1lPSdcdTMwMTBcdTYyNzlcdTkxY2ZcdTRlMGJcdThmN2RcdTMwMTEnK3BhY2tOYW1lKydcdTdiNDkuemlwJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGFja05hbWU7CiAgICB9CiAgICBmdW5jdGlvbiBkb3dubG9hZENvdW50ZXIoQykgeyAvL0M6aXRlbXMsQjppc09uZUZpbGUKICAgICAgICBpZiAoIWlzT3RoZXIpIHtyZXR1cm47fQogICAgICAgIHZhciBGID0gRmlsZVV0aWxzID8gRmlsZVV0aWxzLnNoYXJlX3VrIHx8IGRpc2sudXRpbC5WaWV3U2hhcmVVdGlscy51ayA6IHl1bkRhdGEuU0hBUkVfVUssCiAgICAgICAgRCA9IEZpbGVVdGlscyA/IEZpbGVVdGlscy5zaGFyZV9pZCA6IHl1bkRhdGEuU0hBUkVfSUQsCiAgICAgICAgQSA9IFtdLEIgPSAoMSA9PSBDLmxlbmd0aCAmJiAwID09IENbMF0uaXNkaXIpLAogICAgICAgIEcgPSBzaGFyZURhdGEgPyBkaXNrLnV0aWwuVmlld1NoYXJlVXRpbHMuYWxidW1JZDogJyc7CiAgICAgICAgZm9yICh2YXIgXyBpbiBDKSB7CiAgICAgICAgICAgIGlmIChDLmhhc093blByb3BlcnR5KF8pKSB7CiAgICAgICAgICAgICAgICB2YXIgRSA9IHsKICAgICAgICAgICAgICAgICAgICBmaWQ6IENbX10uZnNfaWQsCiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IENbX10uY2F0ZWdvcnkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBBLnB1c2goRSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRyAmJiBCICYmICQucG9zdChkaXNrLmFwaS5SZXN0QVBJLlBDTE9VRF9BTEJVTV9ET1dOTE9BRF9DT1VOVEVSLCB7CiAgICAgICAgICAgIHVrOiBGLAogICAgICAgICAgICBhbGJ1bV9pZDogRywKICAgICAgICAgICAgZnNfaWQ6IENbX10uZnNfaWQKICAgICAgICB9KTsKICAgICAgICAhRyAmJiAkLnBvc3QoRmlsZVV0aWxzID8gZGlzay5hcGkuUmVzdEFQSS5NSVNfQ09VTlRFUiA6IFJlc3RBUEkuTUlTX0NPVU5URVIsIHsKICAgICAgICAgICAgdWs6IEYsCiAgICAgICAgICAgIGZpbGVsaXN0OiBKU09OLnN0cmluZ2lmeShBKSwKICAgICAgICAgICAgc2lkOiBELAogICAgICAgICAgICBjdGltZTogRmlsZVV0aWxzID8gRmlsZVV0aWxzLnNoYXJlX2N0aW1lIDogeXVuRGF0YS5TSEFSRV9USU1FLAogICAgICAgICAgICAicHVibGljIjogRmlsZVV0aWxzID8gRmlsZVV0aWxzLnNoYXJlX3B1YmxpY190eXBlIDogeXVuRGF0YS5TSEFSRVBBR0VUWVBFLAogICAgICAgICAgICB0OiAobmV3IERhdGUpLmdldFRpbWUoKSwKICAgICAgICAgICAgXzogTWF0aC5yYW5kb20oKQogICAgICAgIH0pOwogICAgICAgICFHICYmIEIgJiYgJC5nZXQoRmlsZVV0aWxzID8gZGlzay5hcGkuUmVzdEFQSS5TSEFSRV9DT1VOVEVSIDogUmVzdEFQSS5TSEFSRV9DT1VOVEVSLCB7CiAgICAgICAgICAgIHR5cGU6IDEsCiAgICAgICAgICAgIHNoYXJlaWQ6IEQsCiAgICAgICAgICAgIHVrOiBGLAogICAgICAgICAgICBzaWduOiBGaWxlVXRpbHMgPyBGaWxlVXRpbHMuc2hhcmVfc2lnbiA6IHl1bkRhdGEuU0lHTiwKICAgICAgICAgICAgdGltZXN0YW1wOiBGaWxlVXRpbHMgPyBGaWxlVXRpbHMuc2hhcmVfdGltZXN0YW1wIDogeXVuRGF0YS5USU1FU1RBTVAsICAgICAgICAgICAgCiAgICAgICAgICAgIHQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICBfOiBNYXRoLnJhbmRvbSgpCiAgICAgICAgfSk7CiAgICB9Cn0pKCk7CmxvYWRKcygnZnVuY3Rpb24gbXlUb2FzdEluamVjdGlvbihtc2csdHlwZSxpc090aGVyKXt0cnl7dmFyIFRvYXN0PXt9LG9idGFpbixQYW5jZWw9bnVsbDtpZihpc090aGVyJiZkaXNrLnVpKXtvYnRhaW49ZGlzay51aS5Ub2FzdDtUb2FzdC5vYnRhaW49e307VG9hc3Qub2J0YWluLnVzZVRvYXN0PVV0aWxpdGllcy51c2VUb2FzdH1lbHNle1RvYXN0PXJlcXVpcmUoImNvbW1vbjp3aWRnZXQvdG9hc3QvdG9hc3QuanMiKTtQYW5jZWw9cmVxdWlyZSgiY29tbW9uOndpZGdldC9wYW5lbC9wYW5lbC5qcyIpO29idGFpbj1Ub2FzdC5vYnRhaW59dmFyIG89VG9hc3Qub2J0YWluLnVzZVRvYXN0KHt0b2FzdE1vZGU6dHlwZT9vYnRhaW4uTU9ERV9TVUNDRVNTOm9idGFpbi5NT0RFX0ZBSUxVUkUsbXNnOm1zZyxzdGlja3k6ZmFsc2UscG9zaXRpb246UGFuY2VsP1BhbmNlbC5UT1A6KGRpc2sudWk/ZGlzay51aS5QYW5lbC5UT1A6dW5kZWZpbmVkKX0pO3RyeXskKG8uX21VSS5wYW5lKS5jc3MoeyJ6LWluZGV4Ijo5OTk5OTl9KX1jYXRjaChlKXt9fWNhdGNoKGVycil7aWYoIXR5cGUpe2FsZXJ0KG1zZyl9fX0nKTsKZnVuY3Rpb24gYmFzZTY0RW5jb2RlKGEpe3ZhciBiLGMsZCxlLGYsZyxoPSJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIjtmb3IoZD1hLmxlbmd0aCxjPTAsYj0iIjtkPmM7KXtpZihlPTI1NSZhLmNoYXJDb2RlQXQoYysrKSxjPT1kKXtiKz1oLmNoYXJBdChlPj4yKSxiKz1oLmNoYXJBdCgoMyZlKTw8NCksYis9Ij09IjticmVha31pZihmPWEuY2hhckNvZGVBdChjKyspLGM9PWQpe2IrPWguY2hhckF0KGU+PjIpLGIrPWguY2hhckF0KCgzJmUpPDw0fCgyNDAmZik+PjQpLGIrPWguY2hhckF0KCgxNSZmKTw8MiksYis9Ij0iO2JyZWFrfWc9YS5jaGFyQ29kZUF0KGMrKyksYis9aC5jaGFyQXQoZT4+MiksYis9aC5jaGFyQXQoKDMmZSk8PDR8KDI0MCZmKT4+NCksYis9aC5jaGFyQXQoKDE1JmYpPDwyfCgxOTImZyk+PjYpLGIrPWguY2hhckF0KDYzJmcpfXJldHVybiBiO30KZnVuY3Rpb24gaXNVcmwodXJsKSB7CiAgICByZXR1cm4gL14oaHR0cHxodHRwcyk6XC9cLyhbXHctXSsoOltcdy1dKyk/QCk/W1x3LV0rKFwuW1x3LV0rKSsoOltcZF0rKT8oWyNcL1w/XVteXHM8PjsiXCddKik/JC8udGVzdCh1cmwpOwp9CmZ1bmN0aW9uIGNoZWNrVXBkYXRlKCkgewogICAgdmFyIGpzID0gJ3ZhciB1cGluZm89ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVwZGF0ZWltZyIpOyc7CiAgICBqcyArPSAndXBpbmZvLnNyYz0iJyArIGdldEFwaVVybCgnY2hlY2t1cGRhdGUnLCAxKSArICciOyc7CiAgICBqcyArPSAndXBpbmZvLm9ubG9hZD1mdW5jdGlvbigpeyc7CiAgICBqcyArPSAndXBpbmZvLnBhcmVudE5vZGUucGFyZW50Tm9kZS5zdHlsZS5kaXNwbGF5PSIiOyc7CiAgICBqcyArPSAnfSc7CiAgICBsb2FkSnMoanMpOwp9CmZ1bmN0aW9uIGdldEFwaVVybChhY3Rpb24sIHR5cGUpIHsKICAgIHJldHVybiAnaHR0cDovL2FwcC5kdW9sdW9odWEuY29tL3VwZGF0ZT9hY3Rpb249JyArIGFjdGlvbiArICcmc3lzdGVtPXNjcmlwdCZhcHBuYW1lPWR1cGFubGluayZhcHBwb3Q9c2NyaXB0anMmZnJvbXBvdD1kdXBhbiZ0eXBlPScgKyB0eXBlICsgJyZ2ZXJzaW9uPScgKyBWRVJTSU9OICsgJyZ0PScgKyB0Owp9CmZ1bmN0aW9uIGxvYWRKcyhqcykgewogICAgdmFyIG9IZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0hFQUQnKVswXSwKICAgIG9TY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgIG9TY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwogICAgb1NjcmlwdC50ZXh0ID0ganM7CiAgICBvSGVhZC5hcHBlbmRDaGlsZChvU2NyaXB0KTsKfQpmdW5jdGlvbiBnb29nbGVBbmFseXRpY3MoKSB7CiAgICB2YXIganMgPSAidmFyIF9nYXEgPSBfZ2FxIHx8IFtdOyI7CiAgICBqcyArPSAiX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNDM4NTk3NjQtMSddKTsiOwogICAganMgKz0gIl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pOyI7CiAgICBqcyArPSAiZnVuY3Rpb24gZ29vZ2xlQW5hbHl0aWNzKCl7IjsKICAgIGpzICs9ICIJdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7Z2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyI7CiAgICBqcyArPSAiCWdhLmFzeW5jID0gdHJ1ZTtnYS5zcmMgPSAnaHR0cHM6Ly9zc2wuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnOyI7CiAgICBqcyArPSAiCXZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyI7CiAgICBqcyArPSAiCXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpIjsKICAgIGpzICs9ICJ9IjsKICAgIGpzICs9ICJnb29nbGVBbmFseXRpY3MoKTsiOwogICAganMgKz0gIl9nYXEucHVzaChbJ190cmFja0V2ZW50JywnZHVwYW5saW5rX3NjcmlwdCcsU3RyaW5nKCciICsgVkVSU0lPTiArICInKV0pOyI7CiAgICBsb2FkSnMoanMpOwp9Cmdvb2dsZUFuYWx5dGljcygpOw=="},{"name":"ç™¾åº¦äº‘æ’ä»¶+APIKey","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/https?\\:\\/\\/(pan|yun)\\.baidu\\.com.*/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630864},"enabled":true,"position":6,"file_url":"https://greasyfork.org/scripts/496-%E7%99%BE%E5%BA%A6%E4%BA%91%E6%8F%92%E4%BB%B6-apikey/code/%E7%99%BE%E5%BA%A6%E4%BA%91%E6%8F%92%E4%BB%B6+APIKey.user.js","uuid":"c5fdd2d4-1576-4d9e-b142-198b815cb5b6","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAg55m+5bqm5LqR5o+S5Lu2K0FQSUtleQovLyBAbmFtZXNwYWNlICAKLy8gQHZlcnNpb24gICAgNS4wLjIuMQovLyBAZGVzY3JpcHRpb24gIOWcqOeZvuW6puS6kee9keebmOeahOmhtemdoua3u+WKoOS4gOS4quaQnOe0ouahhu+8jOiwg+eUqOaQnOe0okFQSeaQnOe0ouaJgOacieWFrOW8gOWIhuS6q+aWh+S7ti8vIFRvIGFkZCBhIHNlYXJjaCBmcmFtZSB0aGF0IGNhbGxzIHNvbWUgYXBpIGZvciBzZWFyY2hpbmcgc29tZSBwdWJsaWMgc2hhcmVkIGZpbGVzIGluIEJhaWR1WXVuIGNsb3VkIG5ldGRpc2suIAovLyBAZGVzY3JpcHRpb24gIEZvciBtb3JlIGltZm9ybWF0aW9uLHBsZWFzZSBlbWFpbCBtZSBhdCB3YW5naHNpbmNoZUBob3RtYWlsLmNvbS4gCi8vIEBpbmNsdWRlICAgICAgIC9odHRwcz9cOlwvXC8ocGFufHl1bilcLmJhaWR1XC5jb20uKi8KLy8gQGdyYW50ICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBydW4tYXQgZG9jdW1lbnQtZW5kCi8vIEBjb3B5cmlnaHQgIDIwMTQsMDQsMjAgX19CeSBXYW5nIEhzaW4tY2hlICAgCi8vID09L1VzZXJTY3JpcHQ9PQoKLyp0aGFua3MgdG8gdGhlIHR1dG9yaWFsIG9mIG12YyAgYXQgCmh0dHBzOi8vYWxleGF0bmV0LmNvbS9hcnRpY2xlcy9tb2RlbC12aWV3LWNvbnRyb2xsZXItbXZjLWphdmFzY3JpcHQqLwoKCi8vRXZlbnQgaXMgYSBzaW1wbGUgY2xhc3MgZm9yIGltcGxlbWVudGluZyB0aGUgT2JzZXJ2ZXIgcGF0dGVybjoKZnVuY3Rpb24gRXZlbnQoc2VuZGVyKSB7CiAgICB0aGlzLl9zZW5kZXIgPSBzZW5kZXI7CiAgICB0aGlzLl9saXN0ZW5lcnMgPSBbXTsKfQoKRXZlbnQucHJvdG90eXBlID0gewogICAgYXR0YWNoIDogZnVuY3Rpb24gKGxpc3RlbmVyKSB7Ly9wdXNoIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBpbnRvIF9saXN0ZW5lcnNbXTsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICB9LAogICAgbm90aWZ5IDogZnVuY3Rpb24gKGFyZ3MpIHsvL3BvcCBhbGwgdGhlIGNhbGxiYWNrIGZ1bmN0aW9ucyBhbmQgZXhlY3V0ZSB0aGUgZnVuY3Rpb25zIHdpdGggc2FtZSBhcmdzPwogICAgICAgIHZhciBpbmRleDsKCiAgICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNbaW5kZXhdKHRoaXMuX3NlbmRlciwgYXJncyk7Ly9hdXRvIHBhc3Mgc2VuZGVyIGFuZCBhcmdzIGludG8gY2FsbGJhY2sgZnVuY3Rpb24sIHNvIHRoZSBkZWZhdWx0IGZvcm0gb2YgY2FsbGJhY2sgZnVuY3Rpb24gaXMgZnVuY3Rpb24oc2VuZGVyLGFyZ3Mpe30KICAgICAgICB9CiAgICB9Cn07CgovL0phdmFzY3JpcHQtdGVtcGxhdGUtZW5naW5lLWluLWp1c3QtMjAtbGluZQovL2J5IGJ5IEtyYXNpbWlyIGh0dHA6Ly9rcmFzaW1pcnRzb25ldi5jb20vYmxvZy9hcnRpY2xlL0phdmFzY3JpcHQtdGVtcGxhdGUtZW5naW5lLWluLWp1c3QtMjAtbGluZQp2YXIgVGVtcGxhdGVFbmdpbmUgPSBmdW5jdGlvbihodG1sLCBvcHRpb25zKSB7CiAgICB2YXIgcmUgPSAvPCUoW14lPl0rKT8lPi9nLCByZUV4cCA9IC8oXiggKT8oaWZ8Zm9yfGVsc2V8c3dpdGNofGNhc2V8YnJlYWt8e3x9KSkoLiopPy9nLCBjb2RlID0gJ3ZhciByPVtdO1xuJywgY3Vyc29yID0gMCwgbWF0Y2g7CiAgICB2YXIgYWRkID0gZnVuY3Rpb24obGluZSwganMpIHsKICAgICAgICBqcz8gKGNvZGUgKz0gbGluZS5tYXRjaChyZUV4cCkgPyBsaW5lICsgJ1xuJyA6ICdyLnB1c2goJyArIGxpbmUgKyAnKTtcbicpIDoKICAgICAgICAgICAgKGNvZGUgKz0gbGluZSAhPSAnJyA/ICdyLnB1c2goIicgKyBsaW5lLnJlcGxhY2UoLyIvZywgJ1xcIicpICsgJyIpO1xuJyA6ICcnKTsKICAgICAgICByZXR1cm4gYWRkOwogICAgfTsKICAgIHdoaWxlKG1hdGNoID0gcmUuZXhlYyhodG1sKSkgewogICAgICAgIGFkZChodG1sLnNsaWNlKGN1cnNvciwgbWF0Y2guaW5kZXgpKShtYXRjaFsxXSwgdHJ1ZSk7CiAgICAgICAgY3Vyc29yID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7CiAgICB9CiAgICBhZGQoaHRtbC5zdWJzdHIoY3Vyc29yLCBodG1sLmxlbmd0aCAtIGN1cnNvcikpOwogICAgY29kZSArPSAncmV0dXJuIHIuam9pbigiIik7JzsKICAgIHJldHVybiBuZXcgRnVuY3Rpb24oY29kZS5yZXBsYWNlKC9bXHJcdFxuXS9nLCAnJykpLmFwcGx5KG9wdGlvbnMpOwp9OwoKLyoqCiAqIFRoZSBNb2RlbC4gTW9kZWwgc3RvcmVzIGl0ZW1zIGFuZCBub3RpZmllcwogKiBvYnNlcnZlcnMgYWJvdXQgY2hhbmdlcy4KICovCgogdmFyIEJhc2VNb2RlbD1mdW5jdGlvbihlbmdpbmVMc3QpewogICAgdGhpcy5rZXl3b3JkPSIiOwogICAgdGhpcy5lbmdpbmU9ImRlZmF1bHQiOwogICAgdGhpcy5lbmdpbmVMc3Q9ZW5naW5lTHN0OwogICAgdGhpcy5qc29uT2JqPXsgCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiB7IAogICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRSZXN1bHRDb3VudDogMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENvdW50OiAwIH0sIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgdGhpcy5jdXJyPTE7CiAgICB0aGlzLnRvdGFsUGFnZT0xOwogICAgdGhpcy51cmxzPXtkZWZhdWx0OidodHRwOi8vJyx9OwogICAgdGhpcy5zdGF0ZT1mYWxzZTsKICAgIHRoaXMuY29udGVudFVwZGF0ZWQ9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5yZXF1ZXN0RXZlbnQ9bmV3IEV2ZW50KHRoaXMpOwogfTsKIEJhc2VNb2RlbC5wcm90b3R5cGU9ewogICAgc2V0RW5naW5lOmZ1bmN0aW9uKGVuZ2luZSl7CiAgICAJdmFyIHRlbXBPYmogPSB7fTsKICAgICAgICB0aGlzLmVuZ2luZT1lbmdpbmU7CiAgICAgICAgdGVtcE9ialsnZW5naW5lJ10gPSBlbmdpbmU7CiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCd3eHpZdW5wYW5TZWFyY2hlcicsSlNPTi5zdHJpbmdpZnkodGVtcE9iaikpOwogICAgICAgIHRlbXBPYmogPSBudWxsOwogICAgfSwKICAgIHVwZGF0ZUN1cnI6ZnVuY3Rpb24oY3Vycil7CiAgICAgICAgdGhpcy5jdXJyPWN1cnI7CiAgICB9LAogICAgdXBkYXRlS2V5d29yZDpmdW5jdGlvbihrZXl3b3JkKXsKICAgICAgICB0aGlzLmtleXdvcmQ9a2V5d29yZDsKICAgIH0sCiAgICByZXF1ZXN0OmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5yZXF1ZXN0RXZlbnQubm90aWZ5KCk7CiAgICAgICAgdmFyIF90aGlzPXRoaXM7CiAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdGhpcy5jb21waWxlVXJsW190aGlzLmVuZ2luZV0oX3RoaXMpLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAiLCAvLyBJZiBub3Qgc3BlY2lmaWVkLCBuYXZpZ2F0b3IudXNlckFnZW50IHdpbGwgYmUgdXNlZC4KICAgICAgICAgICAgICAgICAgICAgICAgIkFjY2VwdCI6ICJ0ZXh0L3htbCIgLy8gSWYgbm90IHNwZWNpZmllZCwgYnJvd3NlciBkZWZhdWx0cyB3aWxsIGJlIHVzZWQuCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmpzb25PYmo9X3RoaXMudG9Kc29uW190aGlzLmVuZ2luZV0ocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG90YWxQYWdlPShwYXJzZUludChfdGhpcy5qc29uT2JqLmN1cnNvci5yZXN1bHRDb3VudCktcGFyc2VJbnQoX3RoaXMuanNvbk9iai5jdXJzb3IucmVzdWx0Q291bnQpJTEwKS8xMCsxOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdGF0ZT10cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3NlbGY9X3RoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRlbnRVcGRhdGVkLm5vdGlmeShfc2VsZi5zdGF0ZSk7ICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25lcnJvcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmpzb25PYmo9eyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZFJlc3VsdENvdW50OiAwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q291bnQ6IDAgfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvdGFsUGFnZT0xOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdGF0ZT1mYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9zZWxmPV90aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZW50VXBkYXRlZC5ub3RpZnkoX3NlbGYuc3RhdGUpOyAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICB9LAogICAgZGVzdG9yeTpmdW5jdGlvbigpewogICAgICAgIHRoaXMuanNvbk9iaj17fTsKICAgICAgICB0aGlzLnRvdGFsUGFnZT0wOwogICAgICAgIHRoaXMuc3RhdGU9ZmFsc2U7IAogICAgICAgIHRoaXMuY3Vycj0wOwogICAgICAgIHRoaXMua2V5d29yZD0iIjsKICAgIH0sCiAgICB0b0pzb246ewogICAgICAgIGRlZmF1bHQ6ZnVuY3Rpb24odGV4dCl7CiAgICAgICAgICAgIHZhciBqc29uT2JqID0geyAKICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZFJlc3VsdENvdW50OiAwLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q291bnQ6IDAgfSwgCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW10KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4ganNvbk9iajsKICAgICAgICB9LAogICAgfSwKICAgIGNvbXBpbGVVcmw6ewogICAgICAgIGRlZmF1bHQ6ZnVuY3Rpb24oX3RoaXMpewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnVybCArIF90aGlzLmtleXdvcmQgKyAnK3NpdGUlM0FwYW4uYmFpZHUuY29tJyArICcmZmlyc3Q9JyArIF90aGlzLmN1cnI7CiAgICAgICAgICAgIH0sICAgICAgICAKICAgIH0sCiB9OwoKIHZhciBWaWV3ZXI9ZnVuY3Rpb24obW9kZWwsVUllbGVtZW50cyl7CiAgICB0aGlzLm1vZGVsPW1vZGVsOwogICAgdGhpcy5VST1VSWVsZW1lbnRzOwogICAgdGhpcy5zZWFyY2hDbGljaz1uZXcgRXZlbnQodGhpcyk7CiAgICB0aGlzLmNsb3NlQ2xpY2s9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5uZXh0Q2xpY2s9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5wcmVDbGljaz1uZXcgRXZlbnQodGhpcyk7CiAgICB0aGlzLnRvUGFnZUNsaWNrPW5ldyBFdmVudCh0aGlzKTsKICAgIHRoaXMuZW5naW5lT3B0Q2hhbmdlPW5ldyBFdmVudCh0aGlzKTsKICAgIHZhciBib2R5Tm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTsKICAgIHZhciBfc2VsZj10aGlzOwogICAgdGhpcy5VSS5zZWFyY2hCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgLyogQWN0IG9uIHRoZSBldmVudCAqLwogICAgICAgIHZhciBjdXJyPTE7CiAgICAgICAgdmFyIGtleXdvcmQ9X3NlbGYuVUkuaW5wdXRFbGUudmFsdWU7CiAgICAgICAgaWYoa2V5d29yZC5yZXBsYWNlKC9ccyovLCcnKSE9PScnKXsKICAgICAgICAgICAgX3NlbGYuc2VhcmNoQ2xpY2subm90aWZ5KHtjdXJyOmN1cnIsa2V5d29yZDprZXl3b3JkfSk7CiAgICAgICAgfQogICAgfSk7CiAgICB0aGlzLlVJLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbihldmVudCkgewogICAgICAgIC8qIEFjdCBvbiB0aGUgZXZlbnQgKi8KICAgICAgICBfc2VsZi5jbG9zZUNsaWNrLm5vdGlmeSgpOwogICAgfSk7CiAgICAvLyB0aGlzLlVJLmlucHV0RWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJyxmdW5jdGlvbihldmVudCkgewogICAgLy8gICAgICAgICB2YXIgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KCJjbGljayIpOyAgICAgICAgICAgIAogICAgLy8gICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT0gMTMpIHsKICAgIC8vICAgICAgICAgICAgIF9zZWxmLlVJLnNlYXJjaEJ0bi5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICAgIGNsaWNrRXZlbnQgPSBudWxsOwogICAgLy8gICAgIH0pOwogICAgYm9keU5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKF9zZWxmLlVJLmVuZ2luZUJ0bkNsYXNzTmFtZSkgIT09IC0xICkgewogICAgICAgICAgICBfc2VsZi5lbmdpbmVPcHRDaGFuZ2Uubm90aWZ5KGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZW5naW5lJykpOyAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKF9zZWxmLlVJLnRvUGFnZUJ0bkNsYXNzTmFtZSkgIT09IC0xICkgewogICAgICAgICAgICBfc2VsZi50b1BhZ2VDbGljay5ub3RpZnkocGFyc2VJbnQoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1wYWdlJyksMTApKTsKICAgICAgICB9CiAgICB9KTsKICAgICAgICAgICAgICAgICAgCiB9OwogVmlld2VyLnByb3RvdHlwZT17CiAgICByZWZsZXNoRW5naW5lTHN0OmZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIHRlbXBsYXRlPSc8JWZvcih2YXIgaSBpbiB0aGlzKXslPicrCiAgICAgICAgICAgICAgICAgICAgJzxsaSBub2RlLXR5cGU9ImNsaWNrLWVsZSIgZGF0YS1lbmdpbmU9IjwldGhpc1tpXSU+IiBjbGFzcz0ibGkgd3h6LW1lbnUtb3B0aW9uIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2J5IDwldGhpc1tpXSU+JysKICAgICAgICAgICAgICAgICAgICAnPC9saT4nKwogICAgICAgICAgICAgICAgICAgICc8JX0lPic7CiAgICAgICAgdmFyIGh0bWw9VGVtcGxhdGVFbmdpbmUodGVtcGxhdGUsdGhpcy5tb2RlbC5lbmdpbmVMc3QpOwogICAgICAgIHRoaXMuVUkuZW5naW5lTHN0LmlubmVySFRNTCA9IGh0bWw7CiAgICB9LAogICAgdXBkYXRlRW5naW5lOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5VSS5tZW51LnRleHRDb250ZW50ID0gdGhpcy5tb2RlbC5lbmdpbmU7CiAgICB9LAogICAgc2hvdzpmdW5jdGlvbigpewogICAgICAgIHRoaXMuVUkubXlEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgdGhpcy5VSS5iZ05vZGUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgdGhpcy5VSS5teURpdi5zdHlsZS50b3AgPSAnNTAlJzsKICAgICAgICB0aGlzLlVJLm15RGl2LnN0eWxlLm1hcmdpblRvcCA9ICh0aGlzLlVJLm15RGl2LmNsaWVudEhlaWdodCAvIDIgKiAtMSkgKyAncHgnOyAgICAKICAgIH0sCiAgICByZWZsZXNoOmZ1bmN0aW9uKHN1Y2Nlc3MpewogICAgICAgIHZhciB0ZW1wbGF0ZT0iPHAgYWxpZ249J3JpZ2h0Jz4tLS0tIGJ5IDwldGhpcy5lbmdpbmUlPi5jb20gU2VhcmNoIDwvcD48cCB3aGl0ZS1zcGFjZT0nbm9ybWFsJyBjbGFzcz0ndGVtcCcgPmtleXdvcmQgaXMgICAgJzwldGhpcy5rZXl3b3JkJT4nICAgIGZvdW5kICAnPCV0aGlzLmpzb25PYmouY3Vyc29yLnJlc3VsdENvdW50JT4nICBSZXN1bHRzPC9wPjxwPi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tPHA+IjsKICAgICAgICAKICAgICAgICB0ZW1wbGF0ZSs9JzwlZm9yKHZhciBpIGluIHRoaXMuanNvbk9iai5yZXN1bHRzKXslPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+PHAgY2xhc3M9Im15VGl0bGUiPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgaHJlZj0iPCV0aGlzLmpzb25PYmoucmVzdWx0c1tpXS51bmVzY2FwZWRVcmwlPiJ0YXJnZXQ9Il9ibGFuayI+PCV0aGlzLmpzb25PYmoucmVzdWx0c1tpXS50aXRsZU5vRm9ybWF0dGluZyU+PC9hPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAnPC9wPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAnPHAgY2xhc3M9Im15U25pcHBldCI+PCV0aGlzLmpzb25PYmoucmVzdWx0c1tpXS5jb250ZW50Tm9Gb3JtYXR0aW5nJT48L3A+JysKICAgICAgICAgICAgICAgICc8JX0lPic7CiAgICAgICAgdGVtcGxhdGUrPSc8cD48cD4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tPHAgY2xhc3M9InRlbXAiIG1hcmdpbi1sZWZ0PSIyMHB4Ij4iIDwldGhpcy5qc29uT2JqLnJlc3VsdHMubGVuZ3RoJT4gIiAgaXRlbXMgaGF2ZSBiZWVuIGxvYWQgPC9wPic7CiAgICAgICAgdmFyIGh0bWw7CiAgICAgICAgaWYoc3VjY2Vzcz09PWZhbHNlKXsKICAgICAgICAgICAgaHRtbD0nPGRpdiBjbGFzcz0ibG9hZGluZy10aXBzIiBhbGlnbj0iY2VudGVyIj7lh7rplJnkuoYuLi4uLi48L2Rpdj4nOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBpZih0aGlzLm1vZGVsLmpzb25PYmoucmVzdWx0cy5sZW5ndGg9PT0wKXsKICAgICAgICAgICAgICAgIGh0bWw9JzxkaXYgY2xhc3M9ImxvYWRpbmctdGlwcyIgYWxpZ249ImNlbnRlciI+5peg5pCc57Si57uT5p6cLi4u5o2i5Liq5YWz6ZSu6K+N6YeN5paw6K+V6K+V77yfPC9kaXY+JzsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBodG1sPVRlbXBsYXRlRW5naW5lKHRlbXBsYXRlLHRoaXMubW9kZWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLlVJLm15Q29udGVudC5pbm5lckhUTUwgPSBodG1sOwogICAgfSwKICAgIGNsb3NlOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5VSS5teURpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHRoaXMuVUkuYmdOb2RlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgdGhpcy5VSS5pbnB1dEVsZS52YWx1ZSA9ICcnOwogICAgfSwKICAgIGxvYWRpbmc6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLlVJLm15Q29udGVudC5pbm5lckhUTUwgPSAnPGltZyAgd2lkdGg9IjYwMHB4IiBzcmM9ImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEpnSnVBY1FRQVArS0FDRk1kbHg4bTVlcnY4VFAyakJZZjlQYjVFMXdrYWEzeUxYRDBUOWtpSW1ndG11SXBIcVVyZkR6OXYvLy93QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQ0gvQzA1RlZGTkRRVkJGTWk0d0F3RUFBQUFoK1FRRk1nQVFBQ3dBQUFBQUpnSnVBUUFGLytBamptUnBubWlxcm16cnZuQXN6M1J0MzNpdTczenYvOENnY0Vnc0dvL0lwSExKYkRxZjBLaDBTcTFhcjlpc2RzdnRlci9nc0hoTUxwdlA2TFI2elc2NzMvQzRmRTZ2MisvNHZIN1A3L3YvZ0lHQ2c0U0Zob2VJaVlxTGpJMk9qNUNSa3BPVWxaYVhtSm1hbTV5ZG5wK2dvYUtqcEtXbXA2aXBxcXVzcmE2dnNMR3lzN1MxdHJlNHVicTd2TDIrdjhEQndzUEV4Y2JIeU1uS3k4ek56cy9RMGRMVDFOWFcxOWpaMnR2YzNkN2Y0T0hpNCtUbDV1Zm82ZXJyN08zdTcvRHg4dlAwOWZiMytQbjYrL3o5L3Y4QUF3b2NTTENnd1lNSUV5cGN5TENodzRjUUkwcWNTTEdpeFlzWU0ycmN5TEdqeDQ4Z1E0b2NTYktreVpNb1UvK3FYTW15cGN1WE1HUEtuRW16cHMyYk9IUHEzTW16cDgrZlFJTUtIVXEwcU5HalNKTXFYY3EwcWRPblVLTktuVXExcXRXcldMTnEzY3ExcTlldllNT0tIVXUyck5temFOT3FYY3UycmR1M2NPUEtuVXUzcnQyN2VQUHEzY3UzcjkrL2dBTUxIa3k0c09IRGlCTXJYc3k0c2VQSGtDTkxua3k1c3VYTG1ETnIzc3k1cytmUG9FT0xIazI2dE9uVHFGT3JYczI2dGV2WHNHUExuazI3dHUzYnVIUHIzczI3dCsvZndJTUxIMDY4dUhFckJnZ1FDS1A4T0JJQkFRU3dHRkFnZ1BVQURBeWtPQkNnQUlvQjE2OGZHR0FDdXZRUjBBTm9SeC9kQkFJRjRSVWtjRTdFL0FydTRhMFhXRzdDd0hVRUo0Q1huM1VIbEdBZmV3RVV5TjcvZVNNME1LQjFBTklYeElIZldaZmRBdzRnVUoxM0ppeHdIWU1rQ0tnY0FRaWt0d0FKRkQ2UVhnRGtpWkNpZ0FLc3A2RjFFazdZWGdyVmdmZ0FBZGExU0VKMStBVklJd2tNRE9uaWpVZnF0K0NQU0lxQWdIWHoxZWhEaWlYd0dFQ1VKSENuWXdMV0dWRGRpU1VJV0lKL1Z5N0pYblhZSGNtZ2xWaU9zSjZVVXpZWnBwRWgwdmxBa1FWNnFJQUpZcGJRbzVscWVoakFjaFQyQ1djUlZOWVpnSkNMa3ZBbm1XMCtZT2dJZjZxSlludlY3VmtvbmZuNWVHZ09pWTR3cWFoMENvaUFjdFUxTUdlampySUlxSXJ0UGNuaXBxdyswT21uTzRRcUFwZGxsc0NkZ2lMZ04rQ3FZMEw1Nm9IcHdiZW1zU0tNV0NtdU9PZ3FRbzVWUGt2bS80TVJpakNxZzdXbVNHRjRJQUpwd3JQUTJnRGRBU09PcUdpTUdGTFhIUW1DK3BxZ29pTW13QzJZbGdJcVlKTXdycGRBZXA0TzRDa0JBcE9Bd0FEWmxndnJnNTZ1R0Y0QmJWYkhRQW15dnJsdmZzRG1xL0VEOE1uSjdZQUZ2R2tsZjVMU0tTMmNEb2ZucWFRZFcvam1BN3dtTElKMStGNU00TXF3Z3BpaWxUbys4RjU4SzQ5TWFyZHlLdnhDY2lSNzBaelJURGZ0OU5OUVJ5MzExRlJYYmZYVldHZXQ5ZFpjZCszMTEyQ0hMWFl6QUpSdDl0bG1xNEQyMm1XcnpUYmFicitkZGdweW54MTMzWGZMbmZmYm1OVTlOd3ArdDAxMzRIdXpYZmphaDhNOXVOK0oyMzFaNEFDNFBiamtnRWMrZWVXVW55QTQ1cHgzYnNMbW1sc2Vldi9maEY4K3V1bWZpMzc2NnF5WEFIcnFxTVB1dWV5dFR3WjU1clRYUHNMcnJxdmVPKzYveDA0Qzc4UDdYanp3eHo5ZSt1ekpNNys3OGMzbkxuMzAweitQdlBYQ1kyL1o3ZG1MUUx6MjFZTWZ2UFBlUXk4KzllT0hYMzcza0hGUC9nUGZyLzgrL09iVGY3Mzg3OGR2Ly96eDYrK1krN3JEWHdEM2w3LzZFVkI5QjB5Zit2VFhQd1ArYjNtaFk5emk4RFpCdlZXUWJ4YzBYQVlSdDBIRmJRK0NxWk5nNVVRWVFRcU8wSVFsdE9BSlZaaENESTd0aFRDTW9ReG5TTU1hMnZDR09NeWhEbmZJd3g3NjhJZEFES0lRaDBqRUlocnhpRWhNb2hLWHlNUW1PdkdKVUl5aUZLZEl4U3BhOFlwWXpLSVd0OGpGTG5yeGkyQU1veGpIU01hV01wcnhqR2hNb3hyWHlNWTJ1dkdOY0l5akhPZEl4enJhOFk1NHpLTWU5OGpIUHZyeGo0QU1wQ0FIU2NoQ0d2S1FpRXlrSWhmSnlFWTY4cEdRaktRa0owbkpTbHJ5a3BqTXBDWTN5Y2xPZXZLVG9BeWxLRWRKeWxLYThwU29US1VxVjhuS1ZycnlsYkNNcFN4blNjdGEydktXdU15bExuZkp5MTc2OHBmQURLWXdoMG5NWWhyem1NaE1waktYeWN4bU92T1phQWdCQUNINUJBVXlBQkFBTE5nQXhnQUpBQWNBQUFVS0lDQ09aR21lYUtxaUlRQWgrUVFGTWdBUUFDenZBTVlBQ1FBSEFBQUZDaUFnam1ScG5taXFvaUVBSWZrRUJUSUFFQUFzQmdIR0FBa0FCd0FBQlFvZ0lJNWthWjVvcXFJaEFDSDVCQVV5QUJBQUxCMEJ4Z0FKQUFjQUFBVUtJQ0NPWkdtZWFLcWlJUUFoK1FRRk1nQVFBQ3cwQWNZQUNRQUhBQUFGQ2lBZ2ptUnBubWlxb2lFQUlma0VCVElBRUFBc1N3SEdBQWtBQndBQUJRb2dJSTVrYVo1b3FxSWhBQ0g1QkFVeUFCQUFMR0lCeGdBSkFBY0FBQVVLSUNDT1pHbWVhS3FpSVFBNyIgLz4nOwogICAgfSwKICAgIHJlZmxlc2hQYWdlTmF2aTpmdW5jdGlvbigpewogICAgICAgIHZhciBwYWdlPXtjdXJyOjEsdG90YWxQYWdlOjEscHJlOnRydWUsbmV4dDp0cnVlLGxzdDpbXX07CiAgICAgICAgcGFnZS5jdXJyPXRoaXMubW9kZWwuY3VycjsKICAgICAgICBwYWdlLnRvdGFsUGFnZT10aGlzLm1vZGVsLnRvdGFsUGFnZT49MTA/MTA6dGhpcy5tb2RlbC50b3RhbFBhZ2U7CiAgICAgICAgcGFnZS5wcmU9cGFnZS5jdXJyPjE/dHJ1ZTpmYWxzZTsKICAgICAgICBwYWdlLm5leHQ9cGFnZS50b3RhbFBhZ2U+cGFnZS5jdXJyP3RydWU6ZmFsc2U7CiAgICAgICAgZm9yKHZhciBpPTE7aTw9cGFnZS50b3RhbFBhZ2U7aSsrKXsKICAgICAgICAgICAgcGFnZS5sc3QucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdmFyIHRlbXBsYXRlPSAnXAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icGFnZXNlICJpZD0id3h6LXBhZ2VzZSI+XAogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBhZ2UtY29udGVudCI+XAogICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iIDwlIGlmKHRoaXMucHJlKXsgJT4gcGFnZS1udW1iZXIgPCV9ZWxzZXslPiBnbG9iYWwtZGlzYWJsZWQgPCV9JT4gbW91LWV2dCIgZGF0YS1wYWdlPSI8JXRoaXMuY3Vyci0xJT4iPuS4iuS4gOmhtTwvYT5cCiAgICAgICAgICAgICAgICA8JWZvcih2YXIgaSBpbiB0aGlzLmxzdCl7JT5cCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBhZ2UtbnVtYmVyIDwlaWYodGhpcy5sc3RbaV09PXRoaXMuY3Vycil7JT4gZ2xvYmFsLWRpc2FibGVkIDwlfSU+IiBkYXRhLXBhZ2U9IjwldGhpcy5sc3RbaV0lPiI+PCV0aGlzLmxzdFtpXSU+PC9zcGFuPlwKICAgICAgICAgICAgICAgIDwlfSU+XAogICAgICAgICAgICAgICAgPC9zcGFuPlwKICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9IiA8JSBpZih0aGlzLm5leHQpeyAlPiBwYWdlLW51bWJlciA8JX1lbHNleyU+IGdsb2JhbC1kaXNhYmxlZCA8JX0lPiBtb3UtZXZ0IiBkYXRhLXBhZ2U9IjwldGhpcy5jdXJyKzElPiI+5LiL5LiA6aG1PC9hPlwKICAgICAgICAgICAgICAgIDwvZGl2PlwKICAgICAgICAgICAgICAgICc7CiAgICAgICAgdmFyIGh0bWw9VGVtcGxhdGVFbmdpbmUodGVtcGxhdGUscGFnZSk7CiAgICAgICAgdGhpcy5VSS5wYWdlc2UuaW5uZXJIVE1MID0gaHRtbDsKICAgIH0KIH07CgoKIHZhciBDb250cm9sbGVyPWZ1bmN0aW9uKG1vZGVsLHZpZXdlcil7CiAgICB0aGlzLm1vZGVsPW1vZGVsOwogICAgdGhpcy52aWV3ZXI9dmlld2VyOwoKICAgIHZhciBfc2VsZj10aGlzOwoKICAgIHRoaXMudmlld2VyLnNlYXJjaENsaWNrLmF0dGFjaChmdW5jdGlvbihzZW5kZXIsYXJncyl7CiAgICAgICAgX3NlbGYuc2VhcmNoKGFyZ3MuY3VycixhcmdzLmtleXdvcmQpOwogICAgfSk7CiAgICB0aGlzLnZpZXdlci5jbG9zZUNsaWNrLmF0dGFjaChmdW5jdGlvbigpewogICAgICAgIF9zZWxmLmNsb3NlKCk7CiAgICB9KTsKICAgIHRoaXMudmlld2VyLmVuZ2luZU9wdENoYW5nZS5hdHRhY2goZnVuY3Rpb24oc2VuZGVyLGFyZ3MpewogICAgICAgIF9zZWxmLnNldEVuZ2luZShhcmdzKTsKICAgIH0pOwogICAgdGhpcy52aWV3ZXIudG9QYWdlQ2xpY2suYXR0YWNoKGZ1bmN0aW9uKHNlbmRlcixhcmdzKXsKICAgICAgICBfc2VsZi50b1BhZ2UoYXJncyk7CiAgICB9KTsKCiAgICB0aGlzLm1vZGVsLnJlcXVlc3RFdmVudC5hdHRhY2goZnVuY3Rpb24oKXsKICAgICAgICBfc2VsZi5sb2FkaW5nKCk7CiAgICB9KTsgCiAgICB0aGlzLm1vZGVsLmNvbnRlbnRVcGRhdGVkLmF0dGFjaChmdW5jdGlvbihzdGF0ZSl7CiAgICAgICAgX3NlbGYucmVmbGVzaChzdGF0ZSk7CiAgICB9KTsKCiB9OwogQ29udHJvbGxlci5wcm90b3R5cGU9ewogICAgc2VhcmNoOmZ1bmN0aW9uKGN1cnIsYXJncyl7CiAgICAgICAgdGhpcy5tb2RlbC51cGRhdGVDdXJyKGN1cnIpOwogICAgICAgIHRoaXMubW9kZWwudXBkYXRlS2V5d29yZChhcmdzKTsKICAgICAgICB0aGlzLm1vZGVsLnJlcXVlc3QoKTsKICAgICAgICB0aGlzLnZpZXdlci5zaG93KCk7CiAgICB9LAogICAgc2V0RW5naW5lOmZ1bmN0aW9uKGVuZ2luZSl7CiAgICAgICAgdGhpcy5tb2RlbC5zZXRFbmdpbmUoZW5naW5lKTsKICAgICAgICB0aGlzLnZpZXdlci51cGRhdGVFbmdpbmUoKTsKICAgIH0sCiAgICB0b1BhZ2U6ZnVuY3Rpb24odG9QYWdlTnVtKXsKICAgICAgICB0aGlzLm1vZGVsLnVwZGF0ZUN1cnIodG9QYWdlTnVtKTsKICAgICAgICB0aGlzLm1vZGVsLnJlcXVlc3QoKTsKICAgIH0sCiAgICBjbG9zZTpmdW5jdGlvbigpewogICAgICAgIHRoaXMubW9kZWwuZGVzdG9yeSgpOwogICAgICAgIHRoaXMudmlld2VyLmNsb3NlKCk7CiAgICB9LAogICAgbG9hZGluZzpmdW5jdGlvbigpewogICAgICAgIHRoaXMudmlld2VyLmxvYWRpbmcoKTsKICAgIH0sCiAgICByZWZsZXNoOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy52aWV3ZXIucmVmbGVzaCgpOwogICAgICAgIHRoaXMudmlld2VyLnJlZmxlc2hQYWdlTmF2aSgpOwogICAgfSwKICAgIHJlZmxlc2hFbmdpbmVMc3Q6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLnZpZXdlci5yZWZsZXNoRW5naW5lTHN0KCk7CiAgICB9LAogfTsKCgoKZnVuY3Rpb24gbmV3SW5pdCAoKSB7CiAgICAvL3JlbW92ZSBhZHZzCiAgICAvL2NyZWF0ZSBzZWFyY2ggYmFyCiAgICBpZihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyLXVuaW9uJykpewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXItdW5pb24nKS5yZW1vdmUoKTsKICAgIH0KICAgIHZhciB0YXJnZXROb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlci1pbmZvJyk7CiAgICB2YXIgd3h6U2VhcmNoQmFyTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RkJyk7CiAgICB3eHpTZWFyY2hCYXJOb2RlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCdoZWFkZXItd3h6YmFyIGhlYWRlci1pbmZvJyk7CiAgICAvL3d4elNlYXJjaEJhck5vZGUuc2V0QXR0cmlidXRlKCdub2RlLXR5cGUnLCdoZWFkZXItYXBwcycpOwogICAgd3h6U2VhcmNoQmFyTm9kZS5pbm5lckhUTUwgPQogICAgICAgICAgICAnPHNwYW4gY2xhc3M9Ind4ei1tZW51IHd4ei1kcm9wZG93biI+XAogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InVzZXItbmFtZSIgaWQ9Ind4ek1lbnVEaXNwbGF5Ij5nb29nbGU8L3NwYW4+XAogICAgICAgICAgICAgICAgPGVtIGNsYXNzPSJpY29uIGljb24tZHJvcGRvd24tYXJyb3ciPjwvZW0+XAogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJ3eHotbWVudS1jb250ZW50IiBpZD0id3h6X2VuZ2luZUxzdCI+XAogICAgICAgICAgICAgICAgPC91bD5cCiAgICAgICAgICAgIDwvc3Bhbj5cCiAgICAgICAgICAgIDxmb3JtIGNsYXNzPSJzZWFyY2gtZm9ybSIgaWQ9Ind4el9zZWFyY2hGb3JtIj5cCiAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9InNlYXJjaC1xdWVyeSIgcGxhY2Vob2xkZXI9IiDmkJzntKLlhazlvIDliIbkuqvmlofku7YiIGlkPSJ3eHpfaW5wdXQiPlwKICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIHZhbHVlPSJHTyIgY2xhc3M9InNlYXJjaC1idXR0b24iIGlkPSJ3eHpfc2VhcmNoQnV0dG9uIj5cCiAgICAgICAgICAgIDwvZm9ybT4nOwogICAgLy9pbnNlcnQgYWZ0ZXIgdGFyZ2V0IG5vZGUKICAgIHRhcmdldE5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod3h6U2VhcmNoQmFyTm9kZSx0YXJnZXROb2RlLm5leHRTbGliaW5nKTsKICAgIC8vYmFja2dyb3VuZAogICAgdmFyIHd4emJnTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgd3h6YmdOb2RlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCd3eHotYmcnKTsKICAgIHd4emJnTm9kZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKHd4emJnTm9kZSk7CgogICAgLy9jcmVhdGUgZGlzcGxheSBmcmFtZQogICAgdmFyIHd4ekRpYWxvZ05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHd4ekRpYWxvZ05vZGUuc2V0QXR0cmlidXRlKCdjbGFzcycsJ2RpYWxvZyBkaWFsb2ctZ3JheScpOwogICAgd3h6RGlhbG9nTm9kZS5zZXRBdHRyaWJ1dGUoJ2lkJywnd3h6X215RGl2Jyk7CiAgICB3eHpEaWFsb2dOb2RlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCd6LWluZGV4Ojk5O3Bvc3Rpb246YWJzb2x1dGU7Jyk7CiAgICB3eHpEaWFsb2dOb2RlLnN0eWxlLndpZHRoID0gd2luZG93LmlubmVyV2lkdGggLyAzICogMiArICdweCc7CiAgICB3eHpEaWFsb2dOb2RlLnN0eWxlLmxlZnQgPSAnNTAlJzsgICAgCiAgICB3eHpEaWFsb2dOb2RlLnN0eWxlLm1hcmdpbkxlZnQgPSAoLTEgKiB3aW5kb3cuaW5uZXJXaWR0aCAvIDMpICsgJ3B4JzsgCiAgICB3eHpEaWFsb2dOb2RlLmlubmVySFRNTCA9IAogICAgICAgICdcCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRpYWxvZy1oZWFkZXIiIGlkPSJ3eHpfbXlEaXZfdGl0bGUiPlwKICAgICAgICAgICAgICAgIDxoMyA+PHNwYW4gY2xhc3M9ImRpYWxvZy1oZWFkZXItdGl0bGUiPuaQnOe0ojwvc3Bhbj48L2gzPlwKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRpYWxvZy1jb250cm9sIiBpZD0id3h6X2Nsb3NlQnV0dG9uIj48c3BhbiBjbGFzcz0iZGlhbG9nLWljb24gZGlhbG9nLWNsb3NlIGljb24gaWNvbi1jbG9zZSI+PHNwYW4gY2xhc3M9InNpY29uIj7Dlzwvc3Bhbj48L3NwYW4+PC9kaXY+XAogICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRsZy1iZCBnLWNsZWFyZml4IG9mZmxpbmUtbGlzdC1kaWFsb2ciPlwKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Ind4ei1jb250ZW50Ij5cCiAgICAgICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvZmZsaW5lLWJvdHRvbSI+XAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9mZmxpbmUtcGFnZWluZyI+XAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwYWdlc2UgIiBpZD0id3h6LXBhZ2VzZSI+XAogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XAogICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgJzsKCiAgICAvL2FwcGVuZCB0byBib2R5CgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKHd4ekRpYWxvZ05vZGUpOwoKCiAgICB2YXIgd3h6U3R5bGVOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgIHd4elN0eWxlTm9kZS50ZXh0Q29udGVudCA9IAogICAgJ1wKICAgIC53eHotbWVudXtjdXJzb3I6cG9pbnRlcjsgaGVpZ2h0OjEwMCU7IGRpc3BsYXk6aW5saW5lLWJsb2NrOyB2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7cG9zaXRpb246cmVsYXRpdmU7fVwKICAgIC53eHotbWVudTpob3ZlciAud3h6LW1lbnUtY29udGVudHtkaXNwbGF5OmJsb2NrOyB6LWluZGV4Ojk5fVwKICAgIC53eHotbWVudTpob3ZlciAuaWNvbi1kcm9wZG93bi1hcnJvd3t0cmFuc2Zvcm06cm90YXRlKDE4MCk7fVwKICAgIC53eHotbWVudS1vcHRpb257dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MzBweDtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOndoaXRlO2NvbG9yOmJsYWNrO2JvcmRlcjoxcHggc29saWQgI2VmZjRmODtib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlO31cCiAgICAjd3h6X3NlYXJjaEZvcm17ZGlzcGxheTppbmxpbmUtYmxvY2s7IHZlcnRpY2FsLWFsaWduOm1pZGRsZTt9XAogICAgI3d4el9pbnB1dHtwYWRkaW5nOjAgNHB4OyBib3JkZXI6IDFweCBzb2xpZCAjYzBkOWZlO2JvcmRlci1yYWRpdXM6IDRweDtsaW5lLWhlaWdodDogMjJweDt9XAogICAgI3d4el9zZWFyY2hCdXR0b257Y3Vyc29yOnBvaW50ZXI7IGJhY2tncm91bmQ6ICMzYjhjZmY7Ym9yZGVyOiAycHggc29saWQgIzNiOGNmZjtjb2xvcjogI2Y4ZmJmZjtib3JkZXItcmFkaXVzOiA2cHg7fVwKICAgIC53eHotbWVudS1jb250ZW50e2Rpc3BsYXk6bm9uZTsgcG9zaXRpb246YWJzb2x1dGU7dG9wOjEwMCU7bGVmdDowO3dpZHRoOjgwcHg7fVwKICAgICN3eHpNZW51RGlzcGxheXtsaW5lLWhlaWdodDogNDBweDsgZGlzcGxheTppbmxpbmUtYmxvY2s7IHdpZHRoOjQwcHg7fVwKICAgIC53eHotYmd7cG9zaXRpb246IGZpeGVkOyBsZWZ0OiAwcHg7IHRvcDogMHB4OyBib3R0b206IDBweDsgcmlnaHQ6IDBweDsgei1pbmRleDogNTA7IGJhY2tncm91bmQ6IHJnYigwLCAwLCAwKTsgb3BhY2l0eTogMC41O31cCiAgICAud3h6LWNvbnRlbnR7aGVpZ2h0OiA1MDBweDtsaW5lLWhlaWdodDogMjAwJTt0ZXh0LWFsaWduOiBsZWZ0O3doaXRlLXNwYWNlOiBub3JtYWw7cGFkZGluZzowIDEwcHg7b3ZlcmZsb3c6YXV0bzt9XAogICAgLnd4ei1jbG9zZXttYXJnaW4tcmlnaHQ6MjBweDtpbXBvcnRhbnQ7aGVpZ2h0OjIwcHg7Y3Vyc29yOnBvaW50ZXJ9XAogICAgLnd4ei1uZXh0e21hcmdpbi1yaWdodDoyMHB4O2Zsb2F0OnJpZ2h0O2hlaWdodDoyMHB4O2N1cnNvcjpwb2ludGVyfVwKICAgIC53eHotZnJvbnR7bWFyZ2luLXJpZ2h0OjQwcHg7ZmxvYXQ6cmlnaHQ7aGVpZ2h0OjIwcHg7Y3Vyc29yOnBvaW50ZXJ9XAogICAgLnd4ei1jb250ZW50IGF7Y29sb3I6IzAwNjZGRiFpbXBvcnRhbnQ7Zm9udDogMTRweC8xLjUgYXJpYWwsc2Fucy1zZXJpZiFpbXBvcnRhbnQ7fVwKICAgICc7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQod3h6U3R5bGVOb2RlKTsgICAgCgoKCgogICAgdmFyIGJkTW9kZWw9bmV3IEJhc2VNb2RlbChbJ2JpbmcnLCdnb29nbGUnXSk7CgogICAgYmRNb2RlbC51cmxzLmJpbmc9J2h0dHA6Ly9jbi5iaW5nLmNvbS9zZWFyY2g/cT0nOwogICAgYmRNb2RlbC51cmxzLmdvb2dsZT0naHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vY3VzdG9tc2VhcmNoL3YxZWxlbWVudD9rZXk9QUl6YVN5Q1ZBWGlVelJZc01MMVB2NlJ3U0cxZ3VubU1pa1R6UXFZJnJzej1maWx0ZXJlZF9jc2UmbnVtPTEwJmhsPWVuJnByZXR0eVByaW50PXRydWUmc291cmNlPWdjc2MmZ3NzPS5jb20mc2lnPWVlOTNmOWFhZTljOWU5ZGJhNWVlYTgzMWQ1MDZlNjlhJmN4PTAxODE3NzE0MzM4MDg5MzE1MzMwNTp5azBxcGd5ZHhfZSZxPSc7CgogICAgYmRNb2RlbC50b0pzb24uYmluZz1mdW5jdGlvbihodG1sKXsKICAgICAgICB2YXIgZGF0YSA9IHsgY3Vyc29yOiB7IGVzdGltYXRlZFJlc3VsdENvdW50OiAwLCByZXN1bHRDb3VudDogMCB9LCByZXN1bHRzOiBbXSB9OwogICAgICAgIC8v5YW25Lit5LiA5p2h57uT5p6c77yaCiAgICAgICAgLy88bGkgY2xhc3M9ImJfYWxnbyI+PGgyPgogICAgICAgIC8vPGEgaHJlZj0iaHR0cDovL3Bhbi5iYWlkdS5jb20vd2FwL2xpbms/dWs9MjkyMzExMDY1OCZhbXA7c2hhcmVpZD0zNDY4ODE1ODM0JmFtcDt0aGlyZD0zIiB0YXJnZXQ9Il9ibGFuayIgaD0iSUQ9U0VSUCw1MTAxLjEiPllGSy08c3Ryb25nPlJLMzM2ODwvc3Ryb25nPi04MTg5LTIwMTUwODIxLnJhcl/lhY3otLnpq5jpgJ/kuIvovb1855m+5bqm5LqRIOe9keebmCAuLi48L2E+PC9oMj4KICAgICAgICAvLzxkaXYgY2xhc3M9ImJfY2FwdGlvbiI+PHA+5paH5Lu25ZCNOllGSy08c3Ryb25nPlJLMzM2ODwvc3Ryb25nPi04MTg5LTIwMTUwODIxLnJhciDmlofku7blpKflsI86NDk3LjU1TSDliIbkuqvogIU65pmo6IqvRkFFIOWIhuS6q+aXtumXtDoyMDE1LTgtMjEgMTQ6MDcg5LiL6L295qyh5pWwOjUgLi4uIOeZu+W9leeZvuW6puS6keWuouaIt+err+mAgTJU56m66Ze0IOeUteiEkeeJiDwvcD4KICAgICAgICAvLzxkaXYgY2xhc3M9ImJfYXR0cmlidXRpb24iIHU9IjB8NTA1OHw0ODM1MjcxMzg2OTkxMjQ4fDhPTWhjR0lJajhHVzA4STQxUjVVb1N5SnBsMl81UG55Ij48Y2l0ZT48c3Ryb25nPnBhbi5iYWlkdS5jb208L3N0cm9uZz4vd2FwL2xpbms/dWs9MjkyMzExMDY1OCZhbXA7c2hhcmVpZD0zNDY4ODE1ODM0JmFtcDsuLi48L2NpdGU+PHNwYW4gY2xhc3M9ImNfdGxieFRyZyI+CiAgICAgICAgLy88c3BhbiBjbGFzcz0iY190bGJ4SCIgSD0iQkFTRTpDQUNIRURQQUdFREVGQVVMVCIgSz0iU0VSUCw1MTAyLjEiPjwvc3Bhbj48L3NwYW4+PC9kaXY+PC9kaXY+PC9saT4KICAgICAgICAvL2h0dHA6Ly93d3cuamI1MS5uZXQvYXJ0aWNsZS80OTA4My5odG3lnKhKU+S4reino+aekEhUTUzlrZfnrKbkuLLnpLrkvovku6PnoIHvvJoKICAgICAgICB2YXIgcmF3UmVzdWx0SFRNTCA9IGh0bWwubWF0Y2goLzxsaVxzY2xhc3M9ImJfYWxnbyI+KC4qPyk8XC9saT4vZyk7CiAgICAgICAgdmFyIGJfcmVzdWx0cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgICAgICAgYl9yZXN1bHRzLmlubmVySFRNTCA9IHJhd1Jlc3VsdEhUTUw7CiAgICAgICAgdmFyIGJfYWxnb19BcnJ5ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYl9yZXN1bHRzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2JfYWxnbycpKTsKICAgICAgICBiX2FsZ29fQXJyeS5mb3JFYWNoKGZ1bmN0aW9uKGVsZSwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHRlbXBSZXN1bHQgPSB7CiAgICAgICAgICAgICAgICB1bmVzY2FwZWRVcmw6ICIiLAogICAgICAgICAgICAgICAgdGl0bGVOb0Zvcm1hdHRpbmc6ICIiLAogICAgICAgICAgICAgICAgY29udGVudE5vRm9ybWF0dGluZzogIiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGVtcFJlc3VsdC51bmVzY2FwZWRVcmwgPSBlbGUucXVlcnlTZWxlY3RvcignaDIgYScpLmdldEF0dHJpYnV0ZSgnaHJlZicpOwogICAgICAgICAgICB0ZW1wUmVzdWx0LnRpdGxlTm9Gb3JtYXR0aW5nID0gZWxlLnF1ZXJ5U2VsZWN0b3IoJ2gyIGEnKS50ZXh0Q29udGVudDsKICAgICAgICAgICAgdGVtcFJlc3VsdC5jb250ZW50Tm9Gb3JtYXR0aW5nID0gZWxlLnF1ZXJ5U2VsZWN0b3IoJy5iX2NhcHRpb24gcCcpLnRleHRDb250ZW50OwogICAgICAgICAgICBkYXRhLnJlc3VsdHMucHVzaCh0ZW1wUmVzdWx0KTsKICAgICAgICB9KTsKICAgICAgICAvLy8v5aSE55CG57uf6K6h57uT5p6cCiAgICAgICAgdmFyIHJhd1Jlc3VsdENvdW50PWh0bWwubWF0Y2goLzxzcGFuLio/c2JfY291bnQuKj8+KC4qPyk8XC9zcGFuPi8pWzFdOwogICAgICAgIHZhciBtYXRjaExzdD1bXTsgICAgCiAgICAgICAgbWF0Y2hMc3Q9cmF3UmVzdWx0Q291bnQubWF0Y2goLyhbMC05XXsxLDN9KCxbMC05XXszfSkrKS9nKTsKICAgICAgICBpZihtYXRjaExzdCE9PW51bGwpey8v5Yy56YWNMTAwLDAwMCwxMTHkuYvnsbvnmoTmg4XlhrUKICAgICAgICAgICAgZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ9bWF0Y2hMc3RbMF0ucmVwbGFjZSgnLCcsJycpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBtYXRjaExzdD1yYXdSZXN1bHRDb3VudC5tYXRjaCgvXGQrL2cpOwogICAgICAgICAgICBpZihtYXRjaExzdCE9PW51bGwpey8v5Yy56YWNMTAg5Liq57uT5p6c5LmL57G755qE5oOF5Ya177yM5Lul5Y+KMS0xMe+8jOWFsTEx5Liq55qE5oOF5Ya1CiAgICAgICAgICAgIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50PW1hdGNoTHN0LnBvcCgpOwogICAgICAgICAgICB9ZWxzZXsvL+WMuemFjeaXoOeahOaDheWGtQogICAgICAgICAgICBkYXRhLmN1cnNvci5yZXN1bHRDb3VudD0wOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50ID0gcGFyc2VJbnQoIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50LnRvU3RyaW5nKCksMTApOwogICAgICAgIGRhdGEuY3Vyc29yLmVzdGltYXRlZFJlc3VsdENvdW50ID0gZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ7CiAgICAgICAgcmV0dXJuIGRhdGE7ICAgICAgICAKICAgIH07CiAgICBiZE1vZGVsLnRvSnNvbi5nb29nbGU9ZnVuY3Rpb24ocmVzcG9uc2VUZXh0KXsKICAgICAgICB2YXIgZGF0YT1KU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CiAgICAgICAgZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ9cGFyc2VJbnQoZGF0YS5jdXJzb3IucmVzdWx0Q291bnQuc3BsaXQoJywnKS5qb2luKCcnKSk7CiAgICAgICAgcmV0dXJuIGRhdGE7ICAgICAgICAKICAgIH07CgogICAgYmRNb2RlbC5jb21waWxlVXJsLmJpbmc9ZnVuY3Rpb24oX3NlbGYpewogICAgICAgIHJldHVybiBfc2VsZi51cmxzLmJpbmcgKyBfc2VsZi5rZXl3b3JkICsgJytzaXRlJTNBcGFuLmJhaWR1LmNvbScgKyAnJmZpcnN0PScgKyAoX3NlbGYuY3Vyci0xKSoxMDsKICAgIH07CiAgICBiZE1vZGVsLmNvbXBpbGVVcmwuZ29vZ2xlPWZ1bmN0aW9uKF9zZWxmKXsKICAgICAgICByZXR1cm4gX3NlbGYudXJscy5nb29nbGUgKyBfc2VsZi5rZXl3b3JkICsgJyZzdGFydD0nICsgKF9zZWxmLmN1cnItMSkqMTA7CiAgICB9OwoKICAgIHZhciBiZFZpZXc9bmV3IFZpZXdlcihiZE1vZGVsLHsKICAgICAgICBpbnB1dEVsZTpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6X2lucHV0JyksCiAgICAgICAgc2VhcmNoQnRuOmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfc2VhcmNoQnV0dG9uJyksCiAgICAgICAgY2xvc2VCdG46ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3d4el9jbG9zZUJ1dHRvbicpLAogICAgICAgIG15RGl2OmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfbXlEaXYnKSwKICAgICAgICBteUNvbnRlbnQ6ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnd4ei1jb250ZW50JyksCiAgICAgICAgbWVudTpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6TWVudURpc3BsYXknKSwKICAgICAgICBlbmdpbmVCdG5DbGFzc05hbWU6J3d4ei1tZW51LW9wdGlvbicsCiAgICAgICAgZW5naW5lTHN0OmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfZW5naW5lTHN0JyksCiAgICAgICAgcGFnZXNlOmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHotcGFnZXNlJyksCiAgICAgICAgdG9QYWdlQnRuQ2xhc3NOYW1lOidwYWdlLW51bWJlcicsCiAgICAgICAgYmdOb2RlOnd4emJnTm9kZQogICAgfSk7CiAgICB2YXIgYmRDb250cm9sbGVyPW5ldyBDb250cm9sbGVyKGJkTW9kZWwsYmRWaWV3KTsKICAgIGJkQ29udHJvbGxlci5yZWZsZXNoRW5naW5lTHN0KCk7CgkvL+i/memHjOWGmeeahOS4jeWlvQogICAgdmFyIHRlbXBTdHIgPSAnJzsKICAgIHZhciB0ZW1wT2JqOwogICAgdGVtcFN0ciA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnd3h6WXVucGFuU2VhcmNoZXInKTsKICAgIGlmICh0ZW1wU3RyKSB7CiAgICAJdGVtcE9iaiA9IEpTT04ucGFyc2UodGVtcFN0cik7CiAgICAJYmRDb250cm9sbGVyLnNldEVuZ2luZSh0ZW1wT2JqLmVuZ2luZSk7CiAgICB9CiAgICBlbHNlewogICAgCWJkQ29udHJvbGxlci5zZXRFbmdpbmUoJ2JpbmcnKTsKICAgIH0KICAgIAoKfQoKdmFyIGNvdW50ZXIgPSAwOwoKdmFyCnQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7IC8v55m+5bqm5LqR5oqK5LiA5Lqb5YaF5a655pS+5Yiw5ZCO6Z2i5Yqg6L29LOWboOatpOaIkeiuvue9ruS6huS4gOS4quW7tuaXtuW+queOr++8jOavj+malDIwMG1z6YCJ5oup5LiA5LiL5omA6ZyA55qE5YWD57Sg77yM5b2T5omA6ZyA55qE5YWD57Sg5a2Y5Zyo5pe277yM5byA5aeL6ISa5pys77yM5ZCM5pe25YGc5q2i5bu25pe25b6q546vIAogICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5oZWFkZXItaW5mbyIpICE9PSBudWxsKSB7CiAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodCk7CiAgICAgICAgbmV3SW5pdCgpOwogICAgfQogICAgZWxzZXsKICAgICAgICBpZihjb3VudGVyIDwgMTAwKXsKICAgICAgICAgICAgY29uc29sZS5sb2coJ3dhaXRpbmcnKTsKICAgICAgICAgICAgY291bnRlciArKzsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvdXQgb2YgdGltZScpOwogICAgICAgIH0KICAgIH0KfSwgMjAwKTsK"},{"name":"ç§»é™¤ç™¾åº¦æœç´¢çš„å¹¿å‘Š","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_excludes":[],"orig_includes":[],"orig_matches":["http://www.baidu.com/s*","https://www.baidu.com/s*"],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630871},"enabled":true,"position":7,"file_url":"https://greasyfork.org/scripts/18288-%E7%A7%BB%E9%99%A4%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2%E7%9A%84%E5%B9%BF%E5%91%8A/code/%E7%A7%BB%E9%99%A4%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2%E7%9A%84%E5%B9%BF%E5%91%8A.user.js","uuid":"994c2937-b0f5-4dbe-ae99-ab9c7f14751a","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWVzcGFjZSAgICAgICAgIGh0dHBzOi8vd3d3LmdpdGh1Yi5jb20vQ2F0NzM3My8KCi8vIEBuYW1lICAgICAgICAgICAgICDnp7vpmaTnmb7luqbmkJzntKLnmoTlub/lkYoKLy8gQG5hbWU6ZW4gICAgICAgICAgIFJlbW92ZSBCYWlkdSBTZWFyY2ggQUQKLy8gQG5hbWU6emggICAgICAgICAgIOenu+mZpOeZvuW6puaQnOe0oueahOW5v+WRigovLyBAbmFtZTp6aC1DTiAgICAgICAg56e76Zmk55m+5bqm5pCc57Si55qE5bm/5ZGKCgovLyBAZGVzY3JpcHRpb24gICAgICAg56e76Zmk55m+5bqm5pCc57Si55qE5bm/5ZGK5aaC5pCc57Si57uT5p6c6YeM55qE55m+5bqm5o6o5bm/Ci8vIEBkZXNjcmlwdGlvbjplbiAgICBSZW1vdmUgQmFpZHUgc2VhcmNoIGFkdmVydGlzaW5nIHN1Y2ggYXMgc2VhcmNoIHJlc3VsdHMsIEJhaWR1IFByb21vdGlvbgovLyBAbmFtZTp6aCAgICAgICAgICAg56e76Zmk55m+5bqm5pCc57Si55qE5bm/5ZGK5aaC5pCc57Si57uT5p6c6YeM55qE55m+5bqm5o6o5bm/Ci8vIEBuYW1lOnpoLUNOICAgICAgICDnp7vpmaTnmb7luqbmkJzntKLnmoTlub/lkYrlpoLmkJzntKLnu5Pmnpzph4znmoTnmb7luqbmjqjlub8KCi8vIEBob21lcGFnZVVSTCAgICAgICBodHRwczovL2dpdGh1Yi5jb20vQ2F0NzM3My9yZW1vdmUtYmFpZHUtc2VhcmNoLWFkLwovLyBAc3VwcG9ydFVSTCAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL0NhdDczNzMvcmVtb3ZlLWJhaWR1LXNlYXJjaC1hZC9pc3N1ZXMvCgovLyBAY29tcGF0aWJsZSAgICAgICAgY2hyb21lIDQ5LjAuMjYyMy43NSArIFRhbXBlck1vbmtleSArIOiEmuacrCAwLjEuNSDmtYvor5XpgJrov4cKLy8gQGNvbXBhdGlibGUgICAgICAgIGZpcmVmb3gg5pyq5rWL6K+VCi8vIEBjb21wYXRpYmxlICAgICAgICBvcGVyYSDmnKrmtYvor5UKLy8gQGNvbXBhdGlibGUgICAgICAgIHNhZmFyaSDmnKrmtYvor5UKCi8vIEBhdXRob3IgICAgICAgICAgICBDYXQ3MwovLyBAdmVyc2lvbiAgICAgICAgICAgMC4xLjUKLy8gQGxpY2Vuc2UgICAgICAgICAgIExHUEx2MwoKLy8gQG1hdGNoICAgICAgICAgICAgIGh0dHA6Ly93d3cuYmFpZHUuY29tL3MqCi8vIEBtYXRjaCAgICAgICAgICAgICBodHRwczovL3d3dy5iYWlkdS5jb20vcyoKLy8gQGdyYW50ICAgICAgICAgICAgIG5vbmUKLy8gQHJ1bi1hdCAgICAgICAgICAgIGRvY3VtZW50LWVuZAovLyA9PS9Vc2VyU2NyaXB0PT0KJ3VzZSBzdHJpY3QnOwoKZnVuY3Rpb24gY2xlYXJCYWlkdVNlYXJjaEFEICgpIHsKICAgIC8vIOenu+mZpOe9kemhteWPs+i+ueeahOaOqOW5vwogICAgdmFyIGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlY19pbV9jb250YWluZXIiKTsKICAgIGlmIChkaXYpIHsKICAgICAgICBkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkaXYpOwogICAgfQoKICAgIC8vIOenu+mZpOaQnOe0oue7k+aenOWktOmDqOS4juWwvumDqOeahOaOqOW5vwogICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoIiNjb250ZW50X2xlZnQ+ZGl2LCNjb250ZW50X2xlZnQ+dGFibGUiKSwgZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBhID0gZS5nZXRBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgaWYgKGEgJiYgL2Rpc3BsYXk6KHRhYmxlfGJsb2NrKVxzIWltcG9ydGFudC8udGVzdChhKSkgewogICAgICAgICAgICBlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZSk7CiAgICAgICAgfQogICAgfSk7Cn0KCmNsZWFyQmFpZHVTZWFyY2hBRCgpOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3UiKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgc2V0VGltZW91dChjbGVhckJhaWR1U2VhcmNoQUQsIDgwMCk7Cn0sIGZhbHNlKTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImt3IikuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbigpIHsKICAgIHNldFRpbWVvdXQoY2xlYXJCYWlkdVNlYXJjaEFELCA4MDApOwp9LCBmYWxzZSk7"},{"name":"ç™¾åº¦åŽ»å¹¿å‘Š","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["*www.baidu.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1477008630876},"enabled":true,"position":8,"file_url":"https://greasyfork.org/scripts/20092-baidu-ad-blocker/code/Baidu%20AD%20Blocker.user.js","uuid":"b860a96b-1b30-4b9b-9071-2af8e89fc5ed","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDnmb7luqbljrvlub/lkYoKLy8gQHZlcnNpb24gICAgICAwLjIxCi8vIEBkZXNjcmlwdGlvbiAgRnVjayBCYWlkdSdzIFRyYXNoIE9mZiEKLy8gQGF1dGhvciAgICAgICBFcmltdXMKLy8gQG1hdGNoICAgICAgICAqd3d3LmJhaWR1LmNvbS8qCi8vIEBncmFudCAgICAgICAgbm9uZQovLyBAbmFtZXNwYWNlIGh0dHA6Ly9lcmltdXMuY2MvCi8vID09L1VzZXJTY3JpcHQ9PQoKKGZ1bmN0aW9uKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8vIFlvdXIgY29kZSBoZXJlLi4uCiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpewogICAgICAgIHZhciBzcGFuQWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNwYW4iKTsKICAgICAgICBmb3IodmFyIGk9MDtpPHNwYW5BbGwubGVuZ3RoO2krKyl7CiAgICAgICAgICAgIGlmKHNwYW5BbGxbaV0uaW5uZXJIVE1MID09ICLlub/lkYoiKXsKICAgICAgICAgICAgICAgIHZhciBsYWppID0gc3BhbkFsbFtpXS5wYXJlbnROb2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBqPTA7IGo8OTk7IGorKyl7CiAgICAgICAgICAgICAgICAgICAgaWYobGFqaS5wYXJlbnROb2RlLmlkPT0iY29udGVudF9sZWZ0Iil7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBsYWppPWxhamkucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2xhamkuc3R5bGUub3BhY2l0eSA9IDAuNTsKICAgICAgICAgICAgICAgIGxhamkucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsYWppKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sIDEwMCk7Cn0pKCk7"},{"name":"Download YouTube Videos as MP4","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["http://www.youtube.com/*","https://www.youtube.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":["http://www.youtube.com/*","https://www.youtube.com/*","http://s.ytimg.com/yts/jsbin/html5player*","https://s.ytimg.com/yts/jsbin/html5player*","http://manifest.googlevideo.com/*","https://manifest.googlevideo.com/*","http://*.googlevideo.com/videoplayback*","https://*.googlevideo.com/videoplayback*","http://*.youtube.com/videoplayback*","https://*.youtube.com/videoplayback*"],"merge_matches":true,"use_excludes":[],"orig_excludes":["http://www.youtube.com/embed/*","https://www.youtube.com/embed/*"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null,"orig_connects":["googlevideo.com","ytimg.com"]}},"storage":{"ts":1483669224949,"data":{}},"enabled":true,"position":9,"file_url":"https://greasyfork.org/scripts/1317-download-youtube-videos-as-mp4/code/Download%20YouTube%20Videos%20as%20MP4.user.js","uuid":"1d7e344f-be41-494c-96d9-4a3535899c1f","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgRG93bmxvYWQgWW91VHViZSBWaWRlb3MgYXMgTVA0Ci8vIEBkZXNjcmlwdGlvbiBBZGRzIGEgYnV0dG9uIHRoYXQgbGV0cyB5b3UgZG93bmxvYWQgWW91VHViZSB2aWRlb3MuCi8vIEBob21lcGFnZVVSTCBodHRwczovL2dpdGh1Yi5jb20vZ2FudHQvZG93bmxvYWR5b3V0dWJlCi8vIEBhdXRob3IgR2FudHQKLy8gQHZlcnNpb24gMS44LjgKLy8gQGRhdGUgMjAxNi0wOS0wMgovLyBAbmFtZXNwYWNlIGh0dHA6Ly9nb29nbGVzeXN0ZW0uYmxvZ3Nwb3QuY29tCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cueW91dHViZS5jb20vKgovLyBAaW5jbHVkZSBodHRwczovL3d3dy55b3V0dWJlLmNvbS8qCi8vIEBleGNsdWRlIGh0dHA6Ly93d3cueW91dHViZS5jb20vZW1iZWQvKgovLyBAZXhjbHVkZSBodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8qCi8vIEBtYXRjaCBodHRwOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQG1hdGNoIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQG1hdGNoIGh0dHA6Ly9zLnl0aW1nLmNvbS95dHMvanNiaW4vaHRtbDVwbGF5ZXIqCi8vIEBtYXRjaCBodHRwczovL3MueXRpbWcuY29tL3l0cy9qc2Jpbi9odG1sNXBsYXllcioKLy8gQG1hdGNoIGh0dHA6Ly9tYW5pZmVzdC5nb29nbGV2aWRlby5jb20vKgovLyBAbWF0Y2ggaHR0cHM6Ly9tYW5pZmVzdC5nb29nbGV2aWRlby5jb20vKgovLyBAbWF0Y2ggaHR0cDovLyouZ29vZ2xldmlkZW8uY29tL3ZpZGVvcGxheWJhY2sqCi8vIEBtYXRjaCBodHRwczovLyouZ29vZ2xldmlkZW8uY29tL3ZpZGVvcGxheWJhY2sqCi8vIEBtYXRjaCBodHRwOi8vKi55b3V0dWJlLmNvbS92aWRlb3BsYXliYWNrKgovLyBAbWF0Y2ggaHR0cHM6Ly8qLnlvdXR1YmUuY29tL3ZpZGVvcGxheWJhY2sqCi8vIEBjb25uZWN0IGdvb2dsZXZpZGVvLmNvbQovLyBAY29ubmVjdCB5dGltZy5jb20KLy8gQGdyYW50IEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgR01fc2V0VmFsdWUKLy8gQHJ1bi1hdCBkb2N1bWVudC1lbmQKLy8gQGxpY2Vuc2UgTUlUIExpY2Vuc2UKLy8gQGljb24gZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFFQUFBQUJBQ0FNQUFBQ2R0NEhzQUFBQUIzUkpUVVVIMndNT0NnSW9HVVlFQVFBQUFBbHdTRmx6QUFBTEVnQUFDeElCMHQxKy9BQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBR1NVRXhVUmZpL0pPL3Y3OTdlM3NiR3hxMnRyYVdscFpTVWxKeWNuTmJXMW95RWhJUmFXb3c1T1pRaElad1lHS1VRRUtVSUNLMElDSlF4TVl4S1NveHpjNHg3ZTRSQ1FwUVlHS1VBQUswQUFMVUFBTDBBQUswUUVJeHJhNVFwS2EwWUdJeFNVc1lBQUtVaElaUjdlODdPenIwSUNKUlNVcjI5dll4alk2VTVPYVVwS2EwaEliMjF0WndBQUxVSUNPL096dS9HeHFVeE1aU0VoTFVZR08vVzFyMFlHS1ZDUXBRUUVMMHBLZmZlM3ZmVzFweHJhNVE1T2NaQ1F2Zm41ODVDUXIydHJaeDdlOFpTVXM1U1VxMDVPYzVqWTlaalk4NEFBS1dNak01emM5NTdlNjBwS2RhTWpPZWxwYldjbkxXVWxMVkNRc1lZR01ZSUNOYk96cFFJQ01ZaEliVjdlNXhhV3Q2Y25QZnY3OWJHeHQ2bHBlKzl2YzVLU3M2bHBiMHhNYzZFaE02OXZiVXhNYlVoSWIxYVdzNjF0Y1phV3VlY25NWXhNYjFLU3Naalk5NlVsTmExdGQ3VzFyMTdlOWE5dlp3UUVONnRyYjFqWThZUUVOWnJhK2ZPenIxemM4NWFXdWZlM3Q2TWpNWTVPZFphV3Q2MXRkWjdlKy9uNStlOXZjNk1qTVpyYSsvZTN1ZTF0ZGFscGQ3R3hyVXBLYWxMNGFBQUFBQUJkRkpPVXdCQTV0aG1BQUFDeGtsRVFWUjQydVhYLzEvU1FCZ0g4TnVBb0VRMmlqZ2JCaXZKTHpuQkFpVVVLaXlKU2dPVkFrMHRLWkt3NzVtUlJ0Lzd2NE1CWThlempXMzlWczh2OHJxSHovdTFqYnZiaWRDL1hMOEttY3BPcVZUNm5Talhqb29HdzhXZkZkK1FXR2ZFNG9MYnRicisrUGRNT3kwQkRZTGpFai8weGV2ZldJeVZBSTdiL2FJai85V0hzUnJBOFlmOWJxU2V4VmdENExpYzlrV0UvTGdQd1BHZk5mSkhETzRQOEl1cStTMk05UUQ4b1VwK254RUFjRkN0ZmdJQS8xNHgvOUVsQUtEUWJOUUF3TjlWQWlZRUFCeTBPZ3NBV0FuQi9BY0JBdFZXYXdrQWZKNENEMEJRQURaYXZZY1FnSTloM0NDUWpwRDVQY0Vnd0crU3dMUmhJTDB2ejc4U2pBUEVVM2hySE9EZnlYNEk2clVKSVAwRzNvRXhvTndGWHBvQitId1htREVGcEY5SXdLQTVZSytUcDlmTUFkVU9zQzZZQTU1M2dLY21nZFRmQWhWMW9NUXFBRG5kUURtSjBBWkxBc0ZuQ0lWM1ZZREhKTEFqRGtaS2NpQWFGei9sQ2VCSkIxZ2xnWEJyTkxuZEJXTEo5dVpHQUkra2VUQkxBTkw4U25XQXpXUm5pQUMycEcrNmxRRjBoZmpUcUNJQnJFdmpEd2lnZ0ZTTHVJVW9MWTB2RXdBYlVjc25jL0xsbk8wMkhHdkV6K2hYRWVKNVlqKzRMMnZOa3hPSkRTbmxRemxpSXEyc3lucjNlbWJpVUJqbXcwRnlVODNLWDA0T2IrOWFBSy9QcGQ1ZGVabG96NEhGbENIenQzc1gweDJhNkxjdlFiNGFiOHI3aStEVmRxdm5DcS9ENVp6cWRoZkFjcjVCOXdEMFBOd1BFdTBabkx3SzlvUGdOZkNRSjJmaGhoSVRKM0U4QmplVU9YQStRTlFsQmg1eExqZW1WQ2dLanpnek5JSkZqV0Y0eUpvS2hhZmdJV3Q2VkhHbWpnUjBIdk11VGlwUGRXUUo2QUltYkJSU0U4YVkvc0M0ZXI1eEZ4NXZIeUI0WVJScEZXVWYwQUw0YytkSGtIWlJGbzlURGVCOUFhM0xsd2pyOEZsRndCK3dPL3JIbTBWYlBhZTltUGluaS9PNWgvWEd4YXR3Mkk2ZkdIQU91aGlHWlZ4Tzk4bFRkZ3V0UDk0eWFJdlZkcXhaZHB2RllUVDlYOVVmcVFRbFRYbG04d2tBQUFBQVNVVk9SSzVDWUlJPQovLyA9PS9Vc2VyU2NyaXB0PT0KCgooZnVuY3Rpb24gKCkgewogIHZhciBGT1JNQVRfTEFCRUw9eycxOCc6J01QNCAzNjBwJywnMjInOidNUDQgNzIwcCcsJzQzJzonV2ViTSAzNjBwJywnNDQnOidXZWJNIDQ4MHAnLCc0NSc6J1dlYk0gNzIwcCcsJzQ2JzonV2ViTSAxMDgwcCcsJzEzNSc6J01QNCA0ODBwIC0gbm8gYXVkaW8nLCcxMzcnOidNUDQgMTA4MHAgLSBubyBhdWRpbycsJzEzOCc6J01QNCAyMTYwcCAtIG5vIGF1ZGlvJywnMTQwJzonTTRBIDEyOGticHMgLSBhdWRpbycsJzI2NCc6J01QNCAxNDQwcCAtIG5vIGF1ZGlvJywnMjY2JzonTVA0IDIxNjBwIC0gbm8gYXVkaW8nLCcyOTgnOidNUDQgNzIwcDYwIC0gbm8gYXVkaW8nLCcyOTknOidNUDQgMTA4MHA2MCAtIG5vIGF1ZGlvJ307CiAgdmFyIEZPUk1BVF9UWVBFPXsnMTgnOidtcDQnLCcyMic6J21wNCcsJzQzJzond2VibScsJzQ0Jzond2VibScsJzQ1Jzond2VibScsJzQ2Jzond2VibScsJzEzNSc6J21wNCcsJzEzNyc6J21wNCcsJzEzOCc6J21wNCcsJzE0MCc6J200YScsJzI2NCc6J21wNCcsJzI2Nic6J21wNCcsJzI5OCc6J21wNCcsJzI5OSc6J21wNCd9OwogIHZhciBGT1JNQVRfT1JERVI9WycxOCcsJzQzJywnMTM1JywnNDQnLCcyMicsJzI5OCcsJzQ1JywnMTM3JywnMjk5JywnNDYnLCcyNjQnLCcxMzgnLCcyNjYnLCcxNDAnXTsKICB2YXIgRk9STUFUX1JVTEU9eydtcDQnOidhbGwnLCd3ZWJtJzonbm9uZScsJ200YSc6J2FsbCd9OwogIC8vIGFsbD1kaXNwbGF5IGFsbCB2ZXJzaW9ucywgbWF4PW9ubHkgaGlnaGVzdCBxdWFsaXR5IHZlcnNpb24sIG5vbmU9bm8gdmVyc2lvbiAgCiAgLy8gdGhlIGRlZmF1bHQgc2V0dGluZ3Mgc2hvdyBhbGwgTVA0IHZpZGVvcwogIHZhciBTSE9XX0RBU0hfRk9STUFUUz1mYWxzZTsKICB2YXIgQlVUVE9OX1RFWFQ9eydhcic6J9iq2YbYstmK2YQnLCdjcyc6J1N0w6Fobm91dCcsJ2RlJzonSGVydW50ZXJsYWRlbicsJ2VuJzonRG93bmxvYWQnLCdlcyc6J0Rlc2NhcmdhcicsJ2ZyJzonVMOpbMOpY2hhcmdlcicsJ2hpJzon4KSh4KS+4KSJ4KSo4KSy4KWL4KShJywnaHUnOidMZXTDtmx0w6lzJywnaWQnOidVbmR1aCcsJ2l0JzonU2NhcmljYScsJ2phJzon44OA44Km44Oz44Ot44O844OJJywna28nOifrgrTroKTrsJvquLAnLCdwbCc6J1BvYmllcnonLCdwdCc6J0JhaXhhcicsJ3JvJzonRGVzY8SDcmNhyJtpJywncnUnOifQodC60LDRh9Cw0YLRjCcsJ3RyJzonxLBuZGlyJywnemgnOifkuIvovb0nLCd6aC1UVyc6J+S4i+i8iSd9OwogIHZhciBCVVRUT05fVE9PTFRJUD17J2FyJzon2KrZhtiy2YrZhCDZh9iw2Kcg2KfZhNmB2YrYr9mK2YgnLCdjcyc6J1N0w6Fobm91dCB0b3RvIHZpZGVvJywnZGUnOidEaWVzZXMgVmlkZW8gaGVydW50ZXJsYWRlbicsJ2VuJzonRG93bmxvYWQgdGhpcyB2aWRlbycsJ2VzJzonRGVzY2FyZ2FyIGVzdGUgdsOtZGVvJywnZnInOidUw6lsw6ljaGFyZ2VyIGNldHRlIHZpZMOpbycsJ2hpJzon4KS14KWA4KSh4KS/4KSv4KWLIOCkoeCkvuCkieCkqOCksuCli+CkoSDgpJXgpLDgpYfgpIInLCdodSc6J1ZpZGXDsyBsZXTDtmx0w6lzZScsJ2lkJzonVW5kdWggdmlkZW8gaW5pJywnaXQnOidTY2FyaWNhIHF1ZXN0byB2aWRlbycsJ2phJzon44GT44Gu44OT44OH44Kq44KS44OA44Km44Oz44Ot44O844OJ44GZ44KLJywna28nOifsnbQg67mE65SU7Jik66W8IOuCtOugpOuwm+q4sCcsJ3BsJzonUG9iaWVyeiBwbGlrIHdpZGVvJywncHQnOidCYWl4YXIgZXN0ZSB2w61kZW8nLCdybyc6J0Rlc2PEg3JjYcibaSBhY2VzdCB2aWRlb2NsaXAnLCdydSc6J9Ch0LrQsNGH0LDRgtGMINGN0YLQviDQstC40LTQtdC+JywndHInOiAnQnUgdmlkZW95dSBpbmRpcicsJ3poJzon5LiL6L295q2k6KeG6aKRJywnemgtVFcnOifkuIvovInmraTlvbHniYcnfTsKICB2YXIgREVDT0RFX1JVTEU9W107CiAgdmFyIFJBTkRPTT03NDg5MjM1MTc5OyAvLyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTIzNDU2Nzg5MCk7CiAgdmFyIENPTlRBSU5FUl9JRD0nZG93bmxvYWQteW91dHViZS12aWRlbycrUkFORE9NOwogIHZhciBMSVNUSVRFTV9JRD0nZG93bmxvYWQteW91dHViZS12aWRlby1mbXQnK1JBTkRPTTsKICB2YXIgQlVUVE9OX0lEPSdkb3dubG9hZC15b3V0dWJlLXZpZGVvLWJ1dHRvbicrUkFORE9NOwogIHZhciBERUJVR19JRD0nZG93bmxvYWQteW91dHViZS12aWRlby1kZWJ1Zy1pbmZvJzsKICB2YXIgU1RPUkFHRV9VUkw9J2Rvd25sb2FkLXlvdXR1YmUtc2NyaXB0LXVybCc7CiAgdmFyIFNUT1JBR0VfQ09ERT0nZG93bmxvYWQteW91dHViZS1zaWduYXR1cmUtY29kZSc7CiAgdmFyIFNUT1JBR0VfREFTSD0nZG93bmxvYWQteW91dHViZS1kYXNoLWVuYWJsZWQnOwogIHZhciBpc0RlY29kZVJ1bGVVcGRhdGVkPWZhbHNlOyAgCiAgICAKICBzdGFydCgpOwogICAgICAgICAgCmZ1bmN0aW9uIHN0YXJ0KCkgewogIHZhciBwYWdlY29udGFpbmVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlLWNvbnRhaW5lcicpOwogIGlmICghcGFnZWNvbnRhaW5lcikgcmV0dXJuOwogIGlmICgvXmh0dHBzPzpcL1wvd3d3XC55b3V0dWJlLmNvbVwvd2F0Y2hcPy8udGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpIHJ1bigpOyAgICAgICAKICB2YXIgaXNBamF4PS9jbGFzc1tcd1xzIictPV0rc3BmXC1saW5rLy50ZXN0KHBhZ2Vjb250YWluZXIuaW5uZXJIVE1MKTsKICB2YXIgbG9nb2NvbnRhaW5lcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nby1jb250YWluZXInKTsgIAogIGlmIChsb2dvY29udGFpbmVyICYmICFpc0FqYXgpIHsgLy8gZml4IGZvciBibG9ja2VkIHZpZGVvcwogICAgaXNBamF4PSgnICcrbG9nb2NvbnRhaW5lci5jbGFzc05hbWUrJyAnKS5pbmRleE9mKCcgc3BmLWxpbmsgJyk+PTA7CiAgfQogIHZhciBjb250ZW50PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50Jyk7CiAgaWYgKGlzQWpheCAmJiBjb250ZW50KSB7IC8vIEFqYXggVUkKICAgICAgdmFyIG1vPXdpbmRvdy5NdXRhdGlvbk9ic2VydmVyfHx3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjsKICAgICAgaWYodHlwZW9mIG1vIT09J3VuZGVmaW5lZCcpIHsKICAgICAgICB2YXIgb2JzZXJ2ZXI9bmV3IG1vKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICBpZihtdXRhdGlvbi5hZGRlZE5vZGVzIT09bnVsbCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24uYWRkZWROb2Rlc1tpXS5pZD09J3dhdGNoNy1jb250YWluZXInIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0aW9uLmFkZGVkTm9kZXNbaV0uaWQ9PSd3YXRjaDctbWFpbi1jb250YWluZXInKSB7IC8vIG9sZCB2YWx1ZTogbW92aWVfcGxheWVyCiAgICAgICAgICAgICAgICAgICAgICBydW4oKTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGNvbnRlbnQsIHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9KTsgLy8gb2xkIHZhbHVlOiBwYWdlY29udGFpbmVyCiAgICAgIH0gZWxzZSB7IC8vIE11dGF0aW9uT2JzZXJ2ZXIgZmFsbGJhY2sgZm9yIG9sZCBicm93c2VycwogICAgICAgIHBhZ2Vjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgb25Ob2RlSW5zZXJ0ZWQsIGZhbHNlKTsKICAgICAgfQogIH0gCn0KCmZ1bmN0aW9uIG9uTm9kZUluc2VydGVkKGUpIHsgCiAgICBpZiAoZSAmJiBlLnRhcmdldCAmJiAoZS50YXJnZXQuaWQ9PSd3YXRjaDctY29udGFpbmVyJyB8fCAKICAgICAgICBlLnRhcmdldC5pZD09J3dhdGNoNy1tYWluLWNvbnRhaW5lcicpKSB7IC8vIG9sZCB2YWx1ZTogbW92aWVfcGxheWVyCiAgICAgIHJ1bigpOwogIH0KfQogIApmdW5jdGlvbiBydW4oKSB7CiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENPTlRBSU5FUl9JRCkpIHJldHVybjsgLy8gY2hlY2sgZG93bmxvYWQgY29udGFpbmVyCiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwJykgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvJykpIHJldHVybjsgLy8gRmVhdGhlciBub3Qgc3VwcG9ydGVkCgogIHZhciB2aWRlb0lELCB2aWRlb0Zvcm1hdHMsIHZpZGVvQWRhcHRGb3JtYXRzLCB2aWRlb01hbmlmZXN0VVJMLCBzY3JpcHRVUkw9bnVsbDsKICB2YXIgaXNTaWduYXR1cmVVcGRhdGluZ1N0YXJ0ZWQ9ZmFsc2U7CiAgdmFyIG9wZXJhVGFibGU9bmV3IEFycmF5KCk7CiAgdmFyIGxhbmd1YWdlPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xhbmcnKTsKICB2YXIgdGV4dERpcmVjdGlvbj0nbGVmdCc7CiAgaWYgKGRvY3VtZW50LmJvZHkuZ2V0QXR0cmlidXRlKCdkaXInKT09J3J0bCcpIHsKICAgIHRleHREaXJlY3Rpb249J3JpZ2h0JzsKICB9CiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaDctYWN0aW9uLWJ1dHRvbnMnKSkgeyAgLy8gb2xkIFVJCiAgICBmaXhUcmFuc2xhdGlvbnMobGFuZ3VhZ2UsIHRleHREaXJlY3Rpb24pOwogIH0KICAgICAgICAKICAvLyBvYnRhaW4gdmlkZW8gSUQsIGZvcm1hdHMgbWFwICAgCiAgCiAgdmFyIGFyZ3M9bnVsbDsKICB2YXIgdXN3PSh0eXBlb2YgdGhpcy51bnNhZmVXaW5kb3cgIT09ICd1bmRlZmluZWQnKT90aGlzLnVuc2FmZVdpbmRvdzp3aW5kb3c7IC8vIEZpcmVmb3gsIE9wZXJhPDE1CiAgaWYgKHVzdy55dHBsYXllciAmJiB1c3cueXRwbGF5ZXIuY29uZmlnICYmIHVzdy55dHBsYXllci5jb25maWcuYXJncykgewogICAgYXJncz11c3cueXRwbGF5ZXIuY29uZmlnLmFyZ3M7CiAgfQogIGlmIChhcmdzKSB7CiAgICB2aWRlb0lEPWFyZ3NbJ3ZpZGVvX2lkJ107CiAgICB2aWRlb0Zvcm1hdHM9YXJnc1sndXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXAnXTsKICAgIHZpZGVvQWRhcHRGb3JtYXRzPWFyZ3NbJ2FkYXB0aXZlX2ZtdHMnXTsKICAgIHZpZGVvTWFuaWZlc3RVUkw9YXJnc1snZGFzaG1wZCddOwogICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogU3RhbmRhcmQgbW9kZS4gdmlkZW9JRCAnKyh2aWRlb0lEP3ZpZGVvSUQ6J25vbmUnKSsnOyAnKTsKICB9CiAgaWYgKHVzdy55dHBsYXllciAmJiB1c3cueXRwbGF5ZXIuY29uZmlnICYmIHVzdy55dHBsYXllci5jb25maWcuYXNzZXRzKSB7CiAgICBzY3JpcHRVUkw9dXN3Lnl0cGxheWVyLmNvbmZpZy5hc3NldHMuanM7CiAgfSAgCiAgCiAgaWYgKHZpZGVvSUQ9PW51bGwpIHsgLy8gdW5zYWZlV2luZG93IHdvcmthcm91bmQgKENocm9tZSwgT3BlcmEgMTUrKQogICAgdmFyIGJ1ZmZlcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChERUJVR19JRCsnMicpOwogICAgaWYgKGJ1ZmZlcikgewogICAgICB3aGlsZSAoYnVmZmVyLmZpcnN0Q2hpbGQpIHsKICAgICAgICBidWZmZXIucmVtb3ZlQ2hpbGQoYnVmZmVyLmZpcnN0Q2hpbGQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBidWZmZXI9Y3JlYXRlSGlkZGVuRWxlbSgncHJlJywgREVCVUdfSUQrJzInKTsKICAgIH0gICAgCiAgICBpbmplY3RTY3JpcHQgKCdpZih5dHBsYXllciYmeXRwbGF5ZXIuY29uZmlnJiZ5dHBsYXllci5jb25maWcuYXJncyl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIicrREVCVUdfSUQrJzIiKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcJyJ2aWRlb19pZCI6IlwnK3l0cGxheWVyLmNvbmZpZy5hcmdzLnZpZGVvX2lkK1wnIiwgImpzIjoiXCcreXRwbGF5ZXIuY29uZmlnLmFzc2V0cy5qcytcJyIsICJkYXNobXBkIjoiXCcreXRwbGF5ZXIuY29uZmlnLmFyZ3MuZGFzaG1wZCtcJyIsICJ1cmxfZW5jb2RlZF9mbXRfc3RyZWFtX21hcCI6IlwnK3l0cGxheWVyLmNvbmZpZy5hcmdzLnVybF9lbmNvZGVkX2ZtdF9zdHJlYW1fbWFwK1wnIiwgImFkYXB0aXZlX2ZtdHMiOiJcJyt5dHBsYXllci5jb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzK1wnIlwnKSk7fScpOwogICAgdmFyIGNvZGU9YnVmZmVyLmlubmVySFRNTDsKICAgIGlmIChjb2RlKSB7CiAgICAgIHZpZGVvSUQ9ZmluZE1hdGNoKGNvZGUsIC9cInZpZGVvX2lkXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICAgIHZpZGVvRm9ybWF0cz1maW5kTWF0Y2goY29kZSwgL1widXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXBcIjpccypcIihbXlwiXSspXCIvKTsKICAgICAgdmlkZW9Gb3JtYXRzPXZpZGVvRm9ybWF0cy5yZXBsYWNlKC8mYW1wOy9nLCdcXHUwMDI2Jyk7CiAgICAgIHZpZGVvQWRhcHRGb3JtYXRzPWZpbmRNYXRjaChjb2RlLCAvXCJhZGFwdGl2ZV9mbXRzXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICAgIHZpZGVvQWRhcHRGb3JtYXRzPXZpZGVvQWRhcHRGb3JtYXRzLnJlcGxhY2UoLyZhbXA7L2csJ1xcdTAwMjYnKTsKICAgICAgdmlkZW9NYW5pZmVzdFVSTD1maW5kTWF0Y2goY29kZSwgL1wiZGFzaG1wZFwiOlxzKlwiKFteXCJdKylcIi8pOwogICAgICBzY3JpcHRVUkw9ZmluZE1hdGNoKGNvZGUsIC9cImpzXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICB9CiAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBJbmplY3Rpb24gbW9kZS4gdmlkZW9JRCAnKyh2aWRlb0lEP3ZpZGVvSUQ6J25vbmUnKSsnOyAnKTsKICB9CiAgICAgCiAgaWYgKHZpZGVvSUQ9PW51bGwpIHsgLy8gaWYgYWxsIGVsc2UgZmFpbHMKICAgIHZhciBib2R5Q29udGVudD1kb2N1bWVudC5ib2R5LmlubmVySFRNTDsgIAogICAgaWYgKGJvZHlDb250ZW50IT1udWxsKSB7CiAgICAgIHZpZGVvSUQ9ZmluZE1hdGNoKGJvZHlDb250ZW50LCAvXCJ2aWRlb19pZFwiOlxzKlwiKFteXCJdKylcIi8pOwogICAgICB2aWRlb0Zvcm1hdHM9ZmluZE1hdGNoKGJvZHlDb250ZW50LCAvXCJ1cmxfZW5jb2RlZF9mbXRfc3RyZWFtX21hcFwiOlxzKlwiKFteXCJdKylcIi8pOwogICAgICB2aWRlb0FkYXB0Rm9ybWF0cz1maW5kTWF0Y2goYm9keUNvbnRlbnQsIC9cImFkYXB0aXZlX2ZtdHNcIjpccypcIihbXlwiXSspXCIvKTsKICAgICAgdmlkZW9NYW5pZmVzdFVSTD1maW5kTWF0Y2goYm9keUNvbnRlbnQsIC9cImRhc2htcGRcIjpccypcIihbXlwiXSspXCIvKTsKICAgICAgaWYgKHNjcmlwdFVSTD09bnVsbCkgewogICAgICAgIHNjcmlwdFVSTD1maW5kTWF0Y2goYm9keUNvbnRlbnQsIC9cImpzXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICAgICAgaWYgKHNjcmlwdFVSTCkgewogICAgICAgICAgc2NyaXB0VVJMPXNjcmlwdFVSTC5yZXBsYWNlKC9cXC9nLCcnKTsKICAgICAgICB9CiAgICAgIH0gICAgICAKICAgIH0KICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IEJydXRlIG1vZGUuIHZpZGVvSUQgJysodmlkZW9JRD92aWRlb0lEOidub25lJykrJzsgJyk7CiAgfQogIAogIGRlYnVnKCdEWVZBTSAtIEluZm86IHVybCAnK3dpbmRvdy5sb2NhdGlvbi5ocmVmKyc7IHVzZXJhZ2VudCAnK3dpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTsgIAogIAogIGlmICh2aWRlb0lEPT1udWxsIHx8IHZpZGVvRm9ybWF0cz09bnVsbCB8fCB2aWRlb0lELmxlbmd0aD09MCB8fCB2aWRlb0Zvcm1hdHMubGVuZ3RoPT0wKSB7CiAgIGRlYnVnKCdEWVZBTSAtIEVycm9yOiBObyBjb25maWcgaW5mb3JtYXRpb24gZm91bmQuIFlvdVR1YmUgbXVzdCBoYXZlIGNoYW5nZWQgdGhlIGNvZGUuJyk7CiAgIHJldHVybjsKICB9CiAgCiAgLy8gT3BlcmEgMTIgZXh0ZW5zaW9uIG1lc3NhZ2UgaGFuZGxlcgogIGlmICh0eXBlb2Ygd2luZG93Lm9wZXJhICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cub3BlcmEgJiYgdHlwZW9mIG9wZXJhLmV4dGVuc2lvbiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIG9wZXJhLmV4dGVuc2lvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCkgewogICAgICB2YXIgaW5kZXg9ZmluZE1hdGNoKGV2ZW50LmRhdGEuYWN0aW9uLCAveGhyXC0oWzAtOV0rKVwtcmVzcG9uc2UvKTsKICAgICAgaWYgKGluZGV4ICYmIG9wZXJhVGFibGVbcGFyc2VJbnQoaW5kZXgsMTApXSkgewogICAgICAgIGluZGV4PXBhcnNlSW50KGluZGV4LDEwKTsKICAgICAgICB2YXIgdHJpZ2dlcj0ob3BlcmFUYWJsZVtpbmRleF0pWydvbmxvYWQnXTsKICAgICAgICBpZiAodHlwZW9mIHRyaWdnZXIgPT09ICdmdW5jdGlvbicgJiYgZXZlbnQuZGF0YS5yZWFkeVN0YXRlID09IDQpIHsKICAgICAgICAgIGlmICh0cmlnZ2VyKSB7CiAgICAgICAgICAgICAgdHJpZ2dlcihldmVudC5kYXRhKTsgICAgICAgICAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgICAKICBpZiAoIWlzRGVjb2RlUnVsZVVwZGF0ZWQpIHsKICAgIERFQ09ERV9SVUxFPWdldERlY29kZVJ1bGVzKERFQ09ERV9SVUxFKTsKICAgIGlzRGVjb2RlUnVsZVVwZGF0ZWQ9dHJ1ZTsKICB9CiAgaWYgKHNjcmlwdFVSTCkgewogICAgaWYgKHNjcmlwdFVSTC5pbmRleE9mKCcvLycpPT0wKSB7CiAgICAgIHZhciBwcm90b2NvbD0oZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2w9PSdodHRwOicpPydodHRwOic6J2h0dHBzOic7CiAgICAgIHNjcmlwdFVSTD1wcm90b2NvbCtzY3JpcHRVUkw7CiAgICB9CiAgICBmZXRjaFNpZ25hdHVyZVNjcmlwdChzY3JpcHRVUkwpOwogIH0KICAKICAgLy8gdmlkZW8gdGl0bGUKICAgdmFyIHZpZGVvVGl0bGU9ZG9jdW1lbnQudGl0bGUgfHwgJ3ZpZGVvJzsKICAgdmlkZW9UaXRsZT12aWRlb1RpdGxlLnJlcGxhY2UoL1xzKlwtXHMqWW91VHViZSQvaSwgJycpLnJlcGxhY2UoLycvZywgJ1wnJykucmVwbGFjZSgvXlxzK3xccyskL2csICcnKS5yZXBsYWNlKC9cLiskL2csICcnKTsKICAgdmlkZW9UaXRsZT12aWRlb1RpdGxlLnJlcGxhY2UoL1s6Ilw/XCpdL2csICcnKS5yZXBsYWNlKC9bXHxcXFwvXS9nLCAnXycpOyAvLyBNYWMsIExpbnV4LCBXaW5kb3dzCiAgIGlmICgoKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50IHx8ICcnKS50b0xvd2VyQ2FzZSgpKS5pbmRleE9mKCd3aW5kb3dzJykgPj0gMCkgewogICAgICB2aWRlb1RpdGxlPXZpZGVvVGl0bGUucmVwbGFjZSgvIy9nLCAnJykucmVwbGFjZSgvJi9nLCAnXycpOyAvLyBXaW5kb3dzCiAgIH0gZWxzZSB7CiAgICAgIHZpZGVvVGl0bGU9dmlkZW9UaXRsZS5yZXBsYWNlKC8jL2csICclMjMnKS5yZXBsYWNlKC8mL2csICclMjYnKTsgLy8gIE1hYywgTGludXgKICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAvLyBwYXJzZSB0aGUgZm9ybWF0cyBtYXAKICB2YXIgc2VwMT0nJTJDJywgc2VwMj0nJTI2Jywgc2VwMz0nJTNEJzsKICBpZiAodmlkZW9Gb3JtYXRzLmluZGV4T2YoJywnKT4tMSkgeyAKICAgIHNlcDE9JywnOyAKICAgIHNlcDI9KHZpZGVvRm9ybWF0cy5pbmRleE9mKCcmJyk+LTEpPycmJzonXFx1MDAyNic7IAogICAgc2VwMz0nPSc7CiAgfQogIHZhciB2aWRlb1VSTD1uZXcgQXJyYXkoKTsKICB2YXIgdmlkZW9TaWduYXR1cmU9bmV3IEFycmF5KCk7CiAgaWYgKHZpZGVvQWRhcHRGb3JtYXRzKSB7CiAgICB2aWRlb0Zvcm1hdHM9dmlkZW9Gb3JtYXRzK3NlcDErdmlkZW9BZGFwdEZvcm1hdHM7CiAgfQogIHZhciB2aWRlb0Zvcm1hdHNHcm91cD12aWRlb0Zvcm1hdHMuc3BsaXQoc2VwMSk7CiAgZm9yICh2YXIgaT0wO2k8dmlkZW9Gb3JtYXRzR3JvdXAubGVuZ3RoO2krKykgewogICAgdmFyIHZpZGVvRm9ybWF0c0VsZW09dmlkZW9Gb3JtYXRzR3JvdXBbaV0uc3BsaXQoc2VwMik7CiAgICB2YXIgdmlkZW9Gb3JtYXRzUGFpcj1uZXcgQXJyYXkoKTsKICAgIGZvciAodmFyIGo9MDtqPHZpZGVvRm9ybWF0c0VsZW0ubGVuZ3RoO2orKykgewogICAgICB2YXIgcGFpcj12aWRlb0Zvcm1hdHNFbGVtW2pdLnNwbGl0KHNlcDMpOwogICAgICBpZiAocGFpci5sZW5ndGg9PTIpIHsKICAgICAgICB2aWRlb0Zvcm1hdHNQYWlyW3BhaXJbMF1dPXBhaXJbMV07CiAgICAgIH0KICAgIH0KICAgIGlmICh2aWRlb0Zvcm1hdHNQYWlyWyd1cmwnXT09bnVsbCkgY29udGludWU7CiAgICB2YXIgdXJsPXVuZXNjYXBlKHVuZXNjYXBlKHZpZGVvRm9ybWF0c1BhaXJbJ3VybCddKSkucmVwbGFjZSgvXFxcLy9nLCcvJykucmVwbGFjZSgvXFx1MDAyNi9nLCcmJyk7CiAgICBpZiAodmlkZW9Gb3JtYXRzUGFpclsnaXRhZyddPT1udWxsKSBjb250aW51ZTsKICAgIHZhciBpdGFnPXZpZGVvRm9ybWF0c1BhaXJbJ2l0YWcnXTsKICAgIHZhciBzaWc9dmlkZW9Gb3JtYXRzUGFpclsnc2lnJ118fHZpZGVvRm9ybWF0c1BhaXJbJ3NpZ25hdHVyZSddOwogICAgaWYgKHNpZykgewogICAgICB1cmw9dXJsKycmc2lnbmF0dXJlPScrc2lnOwogICAgICB2aWRlb1NpZ25hdHVyZVtpdGFnXT1udWxsOwogICAgfSBlbHNlIGlmICh2aWRlb0Zvcm1hdHNQYWlyWydzJ10pIHsKICAgICAgdXJsPXVybCsnJnNpZ25hdHVyZT0nK2RlY3J5cHRTaWduYXR1cmUodmlkZW9Gb3JtYXRzUGFpclsncyddKTsKICAgICAgdmlkZW9TaWduYXR1cmVbaXRhZ109dmlkZW9Gb3JtYXRzUGFpclsncyddOwogICAgfQogICAgaWYgKHVybC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ3JhdGVieXBhc3MnKT09LTEpIHsgLy8gc3BlZWQgdXAgZG93bmxvYWQgZm9yIGRhc2gKICAgICAgdXJsPXVybCsnJnJhdGVieXBhc3M9eWVzJzsKICAgIH0KICAgIGlmICh1cmwudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdodHRwJyk9PTApIHsgLy8gdmFsaWRhdGUgVVJMCiAgICAgIHZpZGVvVVJMW2l0YWddPXVybCsnJnRpdGxlPScrdmlkZW9UaXRsZTsKICAgIH0KICB9CiAgICAKICB2YXIgc2hvd0Zvcm1hdD1uZXcgQXJyYXkoKTsKICBmb3IgKHZhciBjYXRlZ29yeSBpbiBGT1JNQVRfUlVMRSkgewogICAgdmFyIHJ1bGU9Rk9STUFUX1JVTEVbY2F0ZWdvcnldOwogICAgZm9yICh2YXIgaW5kZXggaW4gRk9STUFUX1RZUEUpewogICAgICBpZiAoRk9STUFUX1RZUEVbaW5kZXhdPT1jYXRlZ29yeSkgewogICAgICAgIHNob3dGb3JtYXRbaW5kZXhdPShydWxlPT0nYWxsJyk7CiAgICAgIH0KICAgIH0KICAgIGlmIChydWxlPT0nbWF4JykgewogICAgICBmb3IgKHZhciBpPUZPUk1BVF9PUkRFUi5sZW5ndGgtMTtpPj0wO2ktLSkgewogICAgICAgIHZhciBmb3JtYXQ9Rk9STUFUX09SREVSW2ldOwogICAgICAgIGlmIChGT1JNQVRfVFlQRVtmb3JtYXRdPT1jYXRlZ29yeSAmJiB2aWRlb1VSTFtmb3JtYXRdIT11bmRlZmluZWQpIHsKICAgICAgICAgIHNob3dGb3JtYXRbZm9ybWF0XT10cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIAogIHZhciBkYXNoUHJlZj1nZXRQcmVmKFNUT1JBR0VfREFTSCk7CiAgaWYgKGRhc2hQcmVmPT0nMScpIHsKICAgIFNIT1dfREFTSF9GT1JNQVRTPXRydWU7CiAgfSBlbHNlIGlmIChkYXNoUHJlZiE9JzAnKSB7CiAgICBzZXRQcmVmKFNUT1JBR0VfREFTSCwnMCcpOwogIH0KICAKICB2YXIgZG93bmxvYWRDb2RlTGlzdD1bXTsKICBmb3IgKHZhciBpPTA7aTxGT1JNQVRfT1JERVIubGVuZ3RoO2krKykgewogICAgdmFyIGZvcm1hdD1GT1JNQVRfT1JERVJbaV07CiAgICBpZiAoZm9ybWF0PT0nMzcnICYmIHZpZGVvVVJMW2Zvcm1hdF09PXVuZGVmaW5lZCkgeyAvLyBoYWNrIGZvciBkYXNoIDEwODBwCiAgICAgIGlmICh2aWRlb1VSTFsnMTM3J10pIHsKICAgICAgIGZvcm1hdD0nMTM3JzsKICAgICAgfQogICAgICBzaG93Rm9ybWF0W2Zvcm1hdF09c2hvd0Zvcm1hdFsnMzcnXTsKICAgIH0gZWxzZSBpZiAoZm9ybWF0PT0nMzgnICYmIHZpZGVvVVJMW2Zvcm1hdF09PXVuZGVmaW5lZCkgeyAvLyBoYWNrIGZvciBkYXNoIDRLCiAgICAgIGlmICh2aWRlb1VSTFsnMTM4J10gJiYgIXZpZGVvVVJMWycyNjYnXSkgewogICAgICAgZm9ybWF0PScxMzgnOwogICAgICB9CiAgICAgIHNob3dGb3JtYXRbZm9ybWF0XT1zaG93Rm9ybWF0WyczOCddOwogICAgfSAgICAKICAgIGlmICghU0hPV19EQVNIX0ZPUk1BVFMgJiYgZm9ybWF0Lmxlbmd0aD4yKSBjb250aW51ZTsKICAgIGlmICh2aWRlb1VSTFtmb3JtYXRdIT11bmRlZmluZWQgJiYgRk9STUFUX0xBQkVMW2Zvcm1hdF0hPXVuZGVmaW5lZCAmJiBzaG93Rm9ybWF0W2Zvcm1hdF0pIHsKICAgICAgZG93bmxvYWRDb2RlTGlzdC5wdXNoKHt1cmw6dmlkZW9VUkxbZm9ybWF0XSxzaWc6dmlkZW9TaWduYXR1cmVbZm9ybWF0XSxmb3JtYXQ6Zm9ybWF0LGxhYmVsOkZPUk1BVF9MQUJFTFtmb3JtYXRdfSk7CiAgICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IGl0YWcnK2Zvcm1hdCsnIHVybDonK3ZpZGVvVVJMW2Zvcm1hdF0pOwogICAgfQogIH0gIAogIAogIGlmIChkb3dubG9hZENvZGVMaXN0Lmxlbmd0aD09MCkgewogICAgZGVidWcoJ0RZVkFNIC0gRXJyb3I6IE5vIGRvd25sb2FkIFVSTCBmb3VuZC4gUHJvYmFibHkgWW91VHViZSB1c2VzIGVuY3J5cHRlZCBzdHJlYW1zLicpOwogICAgcmV0dXJuOyAvLyBubyBmb3JtYXQKICB9IAogICAgCiAgLy8gZmluZCBwYXJlbnQgY29udGFpbmVyCiAgdmFyIG5ld1dhdGNoUGFnZT1mYWxzZTsKICB2YXIgcGFyZW50RWxlbWVudD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2F0Y2g3LWFjdGlvbi1idXR0b25zJyk7CiAgaWYgKHBhcmVudEVsZW1lbnQ9PW51bGwpIHsKICAgIHBhcmVudEVsZW1lbnQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhdGNoOC1zZWNvbmRhcnktYWN0aW9ucycpOwogICAgaWYgKHBhcmVudEVsZW1lbnQ9PW51bGwpIHsKICAgICAgZGVidWcoJ0RZVkFNIEVycm9yIC0gTm8gY29udGFpbmVyIGZvciBhZGRpbmcgdGhlIGRvd25sb2FkIGJ1dHRvbi4gWW91VHViZSBtdXN0IGhhdmUgY2hhbmdlZCB0aGUgY29kZS4nKTsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgbmV3V2F0Y2hQYWdlPXRydWU7CiAgICB9CiAgfQogIAogIC8vIGdldCBidXR0b24gbGFiZWxzCiAgdmFyIGJ1dHRvblRleHQ9KEJVVFRPTl9URVhUW2xhbmd1YWdlXSk/QlVUVE9OX1RFWFRbbGFuZ3VhZ2VdOkJVVFRPTl9URVhUWydlbiddOwogIHZhciBidXR0b25MYWJlbD0oQlVUVE9OX1RPT0xUSVBbbGFuZ3VhZ2VdKT9CVVRUT05fVE9PTFRJUFtsYW5ndWFnZV06QlVUVE9OX1RPT0xUSVBbJ2VuJ107CiAgICAKICAvLyBnZW5lcmF0ZSBkb3dubG9hZCBjb2RlIGZvciByZWd1bGFyIGludGVyZmFjZQogIHZhciBtYWluU3Bhbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgogIGlmIChuZXdXYXRjaFBhZ2UpIHsKICAgIHZhciBzcGFuSWNvbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICBzcGFuSWNvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24taWNvbi13cmFwcGVyJyk7CiAgICB2YXIgaW1hZ2VJY29uPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgaW1hZ2VJY29uLnNldEF0dHJpYnV0ZSgnc3JjJywgJy8vcy55dGltZy5jb20veXQvaW1nL3BpeGVsLXZmbDN6NVdmVy5naWYnKTsKICAgIGltYWdlSWNvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24taWNvbicpOwogICAgaW1hZ2VJY29uLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnd2lkdGg6MjBweDtoZWlnaHQ6MjBweDtiYWNrZ3JvdW5kLXNpemU6MjBweCAyMHB4O2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FZQUFBQnplbnIwQUFBQkcwbEVRVlJZUisyVzBRM0NNQXhFMndrWUFkaUVFV0FEbUl4dUFDTXdDbXpBQnBDVEVtUlNPN1lUUVgrQ2hFQ1Y0M3QybkY3R1llSFB1TEQrMEFLd0MvRG5XTUFwL041cWlta0J1QWZCZFJURi8rMi9BVjZaWUZVeFZZdWljQWZvSGVnZDZCM29IZmhaQitCeUYrSnlWOEZrckFCNzRwcUgzRFU1TDNpR29CVVJoZFZPRElRRjRFakVrV0xtbWhZQUxPUWdOSUJjSEhrZTRidWh4WEFBYUZuYUFocWJRNVFBT0hIa3doWjhiYWxreDFJQ0NpRUJXTlorQ2l2ZEI3UkVISUMyWmpaSzJvV2tsRERkQjFOU2RDZC9KczJQcVFNcFNJS1lWY004a0U2UUN3REJOUkNxT0JKclcwQ0w4a0NZeEwwQTFrNll4V3NBTkFpWGVDMkFCT0VXYndIQVdyd3hwemdrbUEvSnRJcW54VE9FbG1Qbmpsa2M0QTNGeWtBaEE0MkF4d0FBQUFCSlJVNUVya0pnZ2c9PSk7Jyk7CiAgICBzcGFuSWNvbi5hcHBlbmRDaGlsZChpbWFnZUljb24pOwogICAgbWFpblNwYW4uYXBwZW5kQ2hpbGQoc3Bhbkljb24pOwogIH0KCiAgdmFyIHNwYW5CdXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIHNwYW5CdXR0b24uc2V0QXR0cmlidXRlKCdjbGFzcycsICd5dC11aXgtYnV0dG9uLWNvbnRlbnQnKTsKICBzcGFuQnV0dG9uLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGJ1dHRvblRleHQrJyAnKSk7CiAgbWFpblNwYW4uYXBwZW5kQ2hpbGQoc3BhbkJ1dHRvbik7CiAgCiAgaWYgKCFuZXdXYXRjaFBhZ2UpIHsgLy8gb2xkIFVJCiAgICB2YXIgaW1nQnV0dG9uPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgaW1nQnV0dG9uLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneXQtdWl4LWJ1dHRvbi1hcnJvdycpOwogICAgaW1nQnV0dG9uLnNldEF0dHJpYnV0ZSgnc3JjJywgJy8vcy55dGltZy5jb20veXQvaW1nL3BpeGVsLXZmbDN6NVdmVy5naWYnKTsKICAgIG1haW5TcGFuLmFwcGVuZENoaWxkKGltZ0J1dHRvbik7CiAgfQoKICB2YXIgbGlzdEl0ZW1zPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29sJyk7CiAgbGlzdEl0ZW1zLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnZGlzcGxheTpub25lOycpOwogIGxpc3RJdGVtcy5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24tbWVudScpOwogIGZvciAodmFyIGk9MDtpPGRvd25sb2FkQ29kZUxpc3QubGVuZ3RoO2krKykgewogICAgdmFyIGxpc3RJdGVtPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICB2YXIgbGlzdExpbms9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgbGlzdExpbmsuc2V0QXR0cmlidXRlKCdzdHlsZScsICd0ZXh0LWRlY29yYXRpb246bm9uZTsnKTsKICAgIGxpc3RMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIGRvd25sb2FkQ29kZUxpc3RbaV0udXJsKTsKICAgIGxpc3RMaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCB2aWRlb1RpdGxlKycuJytGT1JNQVRfVFlQRVtkb3dubG9hZENvZGVMaXN0W2ldLmZvcm1hdF0pOwogICAgdmFyIGxpc3RCdXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgbGlzdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24tbWVudS1pdGVtJyk7CiAgICBsaXN0QnV0dG9uLnNldEF0dHJpYnV0ZSgnbG9vcCcsIGkrJycpOwogICAgbGlzdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgTElTVElURU1fSUQrZG93bmxvYWRDb2RlTGlzdFtpXS5mb3JtYXQpOwogICAgbGlzdEJ1dHRvbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkb3dubG9hZENvZGVMaXN0W2ldLmxhYmVsKSk7CiAgICBsaXN0TGluay5hcHBlbmRDaGlsZChsaXN0QnV0dG9uKTsKICAgIGxpc3RJdGVtLmFwcGVuZENoaWxkKGxpc3RMaW5rKTsKICAgIGxpc3RJdGVtcy5hcHBlbmRDaGlsZChsaXN0SXRlbSk7CiAgfQogIG1haW5TcGFuLmFwcGVuZENoaWxkKGxpc3RJdGVtcyk7CiAgdmFyIGJ1dHRvbkVsZW1lbnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgQlVUVE9OX0lEKTsKICBpZiAobmV3V2F0Y2hQYWdlKSB7CiAgICBidXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneXQtdWl4LWJ1dHRvbiAgeXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQgeXQtdWl4LWJ1dHRvbi1vcGFjaXR5IHl0LXVpeC10b29sdGlwJyk7CiAgfSBlbHNlIHsgLy8gb2xkIFVJCiAgICBidXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneXQtdWl4LWJ1dHRvbiB5dC11aXgtdG9vbHRpcCB5dC11aXgtYnV0dG9uLWVtcHR5IHl0LXVpeC1idXR0b24tdGV4dCcpOwogICAgYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ21hcmdpbi10b3A6NHB4OyBtYXJnaW4tbGVmdDonKygodGV4dERpcmVjdGlvbj09J2xlZnQnKT81OjEwKSsncHg7Jyk7CiAgfQogIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXRvb2x0aXAtdGV4dCcsIGJ1dHRvbkxhYmVsKTsgIAogIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2J1dHRvbicpOwogIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpOwogIGJ1dHRvbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpe3JldHVybiBmYWxzZTt9LCBmYWxzZSk7CiAgYnV0dG9uRWxlbWVudC5hcHBlbmRDaGlsZChtYWluU3Bhbik7CiAgdmFyIGNvbnRhaW5lclNwYW49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIGNvbnRhaW5lclNwYW4uc2V0QXR0cmlidXRlKCdpZCcsIENPTlRBSU5FUl9JRCk7CiAgY29udGFpbmVyU3Bhbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpKTsKICBjb250YWluZXJTcGFuLmFwcGVuZENoaWxkKGJ1dHRvbkVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogIC8vIGFkZCB0aGUgYnV0dG9uCiAgaWYgKCFuZXdXYXRjaFBhZ2UpIHsgLy8gd2F0Y2g3CiAgICBwYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNvbnRhaW5lclNwYW4pOwogIH0gZWxzZSB7IC8vIHdhdGNoOAogICAgcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoY29udGFpbmVyU3BhbiwgcGFyZW50RWxlbWVudC5maXJzdENoaWxkKTsKICB9CiAgICAKICAvLyBSRVBMQUNFV0lUSCBpZiAoIWlzU2lnbmF0dXJlVXBkYXRpbmdTdGFydGVkKSB7CiAgICBmb3IgKHZhciBpPTA7aTxkb3dubG9hZENvZGVMaXN0Lmxlbmd0aDtpKyspIHsgCiAgICAgIGFkZEZpbGVTaXplKGRvd25sb2FkQ29kZUxpc3RbaV0udXJsLCBkb3dubG9hZENvZGVMaXN0W2ldLmZvcm1hdCk7CiAgICB9CiAgLy8gfSAKICAKICBpZiAodHlwZW9mIEdNX2Rvd25sb2FkICE9PSAndW5kZWZpbmVkJykgewogICAgZm9yICh2YXIgaT0wO2k8ZG93bmxvYWRDb2RlTGlzdC5sZW5ndGg7aSsrKSB7CiAgICAgIHZhciBkb3dubG9hZEZNVD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChMSVNUSVRFTV9JRCtkb3dubG9hZENvZGVMaXN0W2ldLmZvcm1hdCk7CiAgICAgIHZhciB1cmw9KGRvd25sb2FkQ29kZUxpc3RbaV0udXJsKS50b0xvd2VyQ2FzZSgpOwogICAgICBpZiAodXJsLmluZGV4T2YoJ2NsZW49Jyk+MCAmJiB1cmwuaW5kZXhPZignZHVyPScpPjAgJiYgdXJsLmluZGV4T2YoJ2dpcj0nKT4wCiAgICAgICAgICAmJiB1cmwuaW5kZXhPZignbG10PScpPjApIHsKICAgICAgICBkb3dubG9hZEZNVC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRvd25sb2FkVmlkZW9OYXRpdmVseSwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgfQogIAogIGFkZEZyb21NYW5pZmVzdCgpOwogIAogIGZ1bmN0aW9uIGRvd25sb2FkVmlkZW9OYXRpdmVseShlKSB7CiAgICB2YXIgZWxlbT1lLmN1cnJlbnRUYXJnZXQ7CiAgICBlLnJldHVyblZhbHVlPWZhbHNlOyAgICAKICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIH0KICAgIHZhciBsb29wPWVsZW0uZ2V0QXR0cmlidXRlKCdsb29wJyk7CiAgICBpZiAobG9vcCkgewogICAgICBHTV9kb3dubG9hZChkb3dubG9hZENvZGVMaXN0W2xvb3BdLnVybCwgdmlkZW9UaXRsZSsnLicrRk9STUFUX1RZUEVbZG93bmxvYWRDb2RlTGlzdFtsb29wXS5mb3JtYXRdKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgCiAgZnVuY3Rpb24gYWRkRnJvbU1hbmlmZXN0KCkgeyAvLyBhZGQgRGFzaCBVUkxzIGZyb20gbWFuaWZlc3QgZmlsZQogICAgdmFyIGZvcm1hdHM9WycxMzcnLCAnMTM4JywgJzE0MCddOyAvLyAxMzc9MTA4MHAsIDEzOD00aywgMTQwPW00YQogICAgdmFyIGlzTmVjZXNzYXJ5PXRydWU7CiAgICBmb3IgKHZhciBpPTA7aTxmb3JtYXRzLmxlbmd0aDtpKyspIHsKICAgICAgaWYgKHZpZGVvVVJMW2Zvcm1hdHNbaV1dKSB7CiAgICAgICAgaXNOZWNlc3Nhcnk9ZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICh2aWRlb01hbmlmZXN0VVJMICYmIFNIT1dfREFTSF9GT1JNQVRTICYmIGlzTmVjZXNzYXJ5KSB7CiAgICAgIHZhciBtYXRjaFNpZz1maW5kTWF0Y2godmlkZW9NYW5pZmVzdFVSTCwgL1wvc1wvKFthLXpBLVowLTlcLl0rKVwvL2kpOwogICAgICBpZiAobWF0Y2hTaWcpIHsKICAgICAgICB2YXIgZGVjcnlwdGVkU2lnPWRlY3J5cHRTaWduYXR1cmUobWF0Y2hTaWcpOwogICAgICAgIGlmIChkZWNyeXB0ZWRTaWcpIHsKICAgICAgICAgIHZpZGVvTWFuaWZlc3RVUkw9dmlkZW9NYW5pZmVzdFVSTC5yZXBsYWNlKCcvcy8nK21hdGNoU2lnKycvJywnL3NpZ25hdHVyZS8nK2RlY3J5cHRlZFNpZysnLycpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodmlkZW9NYW5pZmVzdFVSTC5pbmRleE9mKCcvLycpPT0wKSB7CiAgICAgICAgdmFyIHByb3RvY29sPShkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbD09J2h0dHA6Jyk/J2h0dHA6JzonaHR0cHM6JzsKICAgICAgICB2aWRlb01hbmlmZXN0VVJMPXByb3RvY29sK3ZpZGVvTWFuaWZlc3RVUkw7CiAgICAgIH0KICAgICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogbWFuaWZlc3RVUkwgJyt2aWRlb01hbmlmZXN0VVJMKTsKICAgICAgY3Jvc3NYbWxIdHRwUmVxdWVzdCh7CiAgICAgICAgICBtZXRob2Q6J0dFVCcsCiAgICAgICAgICB1cmw6dmlkZW9NYW5pZmVzdFVSTCwgLy8gY2hlY2sgaWYgVVJMIGV4aXN0cwogICAgICAgICAgb25sb2FkOmZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZWFkeVN0YXRlID09PSA0ICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwICYmIHJlc3BvbnNlLnJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IG1hbmllc3RGaWxlQ29udGVudHMgJytyZXNwb25zZS5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgIHZhciBsYXN0Rm9ybWF0RnJvbUxpc3Q9ZG93bmxvYWRDb2RlTGlzdFtkb3dubG9hZENvZGVMaXN0Lmxlbmd0aC0xXS5mb3JtYXQ7CiAgICAgICAgICAgICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogbGFzdGZvcm1hdDogJytsYXN0Rm9ybWF0RnJvbUxpc3QpOwogICAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPGZvcm1hdHMubGVuZ3RoO2krKykgewogICAgICAgICAgICAgICAgaz1mb3JtYXRzW2ldOwogICAgICAgICAgICAgICAgaWYgKHZpZGVvVVJMW2tdIHx8IHNob3dGb3JtYXRba109PWZhbHNlKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHZhciByZWdleHAgPSBuZXcgUmVnRXhwKCc8QmFzZVVSTD4oaHR0cFtePF0raXRhZ1xcLycraysnW148XSspPFxcL0Jhc2VVUkw+JywnaScpOwogICAgICAgICAgICAgICAgdmFyIG1hdGNoVVJMPWZpbmRNYXRjaChyZXNwb25zZS5yZXNwb25zZVRleHQsIHJlZ2V4cCk7CiAgICAgICAgICAgICAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBtYXRjaFVSTCBpdGFnPSAnK2srJyB1cmw9ICcrbWF0Y2hVUkwpOwogICAgICAgICAgICAgICAgaWYgKCFtYXRjaFVSTCkgY29udGludWU7CiAgICAgICAgICAgICAgICBtYXRjaFVSTD1tYXRjaFVSTC5yZXBsYWNlKC8mYW1wXDsvZywnJicpOwogICAgICAgICAgICAgICAgLy8gLi4uCiAgICAgICAgICAgICAgICBkb3dubG9hZENvZGVMaXN0LnB1c2goCiAgICAgICAgICAgICAgICAgIHt1cmw6bWF0Y2hVUkwsc2lnOnZpZGVvU2lnbmF0dXJlW2tdLGZvcm1hdDprLGxhYmVsOkZPUk1BVF9MQUJFTFtrXX0pOwogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkRk1UPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKExJU1RJVEVNX0lEK2xhc3RGb3JtYXRGcm9tTGlzdCk7CiAgICAgICAgICAgICAgICB2YXIgY2xvbmU9ZG93bmxvYWRGTVQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICAgICAgICAgIGNsb25lLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoJ2lkJywgTElTVElURU1fSUQrayk7CiAgICAgICAgICAgICAgICBjbG9uZS5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSgnaHJlZicsIG1hdGNoVVJMKTsKICAgICAgICAgICAgICAgIGRvd25sb2FkRk1ULnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGNsb25lKTsKICAgICAgICAgICAgICAgIGRvd25sb2FkRk1UPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKExJU1RJVEVNX0lEK2spOwogICAgICAgICAgICAgICAgZG93bmxvYWRGTVQuZmlyc3RDaGlsZC5ub2RlVmFsdWU9Rk9STUFUX0xBQkVMW2tdOwogICAgICAgICAgICAgICAgYWRkRmlsZVNpemUobWF0Y2hVUkwsIGspOwogICAgICAgICAgICAgICAgbGFzdEZvcm1hdEZyb21MaXN0PWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IAogICAgICAgIH0pOwogICAgfSAgCiAgfQogIAogIGZ1bmN0aW9uIGluamVjdFN0eWxlKGNvZGUpIHsKICAgIHZhciBzdHlsZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgc3R5bGUudHlwZT0ndGV4dC9jc3MnOwogICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29kZSkpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzdHlsZSk7CiAgfQogIAogIGZ1bmN0aW9uIGluamVjdFNjcmlwdChjb2RlKSB7CiAgICB2YXIgc2NyaXB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgc2NyaXB0LnR5cGU9J2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnOwogICAgc2NyaXB0LnRleHRDb250ZW50PWNvZGU7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcmlwdCk7CiAgfSAgICAKICAKICBmdW5jdGlvbiBkZWJ1ZyhzdHIpIHsKICAgIHZhciBkZWJ1Z0VsZW09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoREVCVUdfSUQpOwogICAgaWYgKCFkZWJ1Z0VsZW0pIHsKICAgICAgZGVidWdFbGVtPWNyZWF0ZUhpZGRlbkVsZW0oJ2RpdicsIERFQlVHX0lEKTsKICAgIH0KICAgIGRlYnVnRWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzdHIrJyAnKSk7CiAgfQogIAogIGZ1bmN0aW9uIGNyZWF0ZUhpZGRlbkVsZW0odGFnLCBpZCkgewogICAgdmFyIGVsZW09ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwogICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpOwogICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ2Rpc3BsYXk6bm9uZTsnKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbSk7CiAgICByZXR1cm4gZWxlbTsKICB9CiAgCiAgZnVuY3Rpb24gZml4VHJhbnNsYXRpb25zKGxhbmd1YWdlLCB0ZXh0RGlyZWN0aW9uKSB7ICAKICAgIGlmICgvXmFmfGJnfGJufGNhfGNzfGRlfGVsfGVzfGV0fGV1fGZhfGZpfGZpbHxmcnxnbHxoaXxocnxodXxpZHxpdHxpd3xrbnxsdnxsdHxtbHxtcnxtc3xubHxwbHxyb3xydXxzbHxza3xzcnxzd3x0YXx0ZXx0aHx1a3x1cnx2aXx6dSQvLnRlc3QobGFuZ3VhZ2UpKSB7IC8vIGZpeCBpbnRlcm5hdGlvbmFsIFVJCiAgICAgIHZhciBsaWtlQnV0dG9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaC1saWtlJyk7CiAgICAgIGlmIChsaWtlQnV0dG9uKSB7CiAgICAgICAgdmFyIHNwYW5FbGVtZW50cz1saWtlQnV0dG9uLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3l0LXVpeC1idXR0b24tY29udGVudCcpOwogICAgICAgIGlmIChzcGFuRWxlbWVudHMpIHsKICAgICAgICAgIHNwYW5FbGVtZW50c1swXS5zdHlsZS5kaXNwbGF5PSdub25lJzsgLy8gaGlkZSBsaWtlIHRleHQKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIG1hcmdpblBpeGVscz0xMDsKICAgICAgaWYgKC9eYmd8Y2F8Y3N8ZWx8ZXV8aHJ8aXR8bWx8bXN8cGx8c2x8c3d8dGUkLy50ZXN0KGxhbmd1YWdlKSkgewogICAgICAgIG1hcmdpblBpeGVscz0xOwogICAgICB9CiAgICAgIGluamVjdFN0eWxlKCcjd2F0Y2g3LXNlY29uZGFyeS1hY3Rpb25zIC55dC11aXgtYnV0dG9ue21hcmdpbi0nK3RleHREaXJlY3Rpb24rJzonK21hcmdpblBpeGVscysncHghaW1wb3J0YW50fScpOwogICAgfQogIH0KICAKICBmdW5jdGlvbiBmaW5kTWF0Y2godGV4dCwgcmVnZXhwKSB7CiAgICB2YXIgbWF0Y2hlcz10ZXh0Lm1hdGNoKHJlZ2V4cCk7CiAgICByZXR1cm4gKG1hdGNoZXMpP21hdGNoZXNbMV06bnVsbDsKICB9CiAgCiAgZnVuY3Rpb24gaXNTdHJpbmcocykgewogICAgcmV0dXJuICh0eXBlb2Ygcz09PSdzdHJpbmcnIHx8IHMgaW5zdGFuY2VvZiBTdHJpbmcpOwogIH0KICAgIAogIGZ1bmN0aW9uIGlzSW50ZWdlcihuKSB7CiAgICByZXR1cm4gKHR5cGVvZiBuPT09J251bWJlcicgJiYgbiUxPT0wKTsKICB9CiAgCiAgZnVuY3Rpb24gZ2V0UHJlZihuYW1lKSB7IC8vIGNyb3NzLWJyb3dzZXIgR01fZ2V0VmFsdWUKICAgIHZhciBhPScnLCBiPScnOwogICAgdHJ5IHthPXR5cGVvZiBHTV9nZXRWYWx1ZS50b1N0cmluZzsgYj1HTV9nZXRWYWx1ZS50b1N0cmluZygpfSBjYXRjaChlKXt9ICAgIAogICAgaWYgKHR5cGVvZiBHTV9nZXRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiAKICAgIChhID09PSAndW5kZWZpbmVkJyB8fCBiLmluZGV4T2YoJ25vdCBzdXBwb3J0ZWQnKSA9PT0gLTEpKSB7CiAgICAgIHJldHVybiBHTV9nZXRWYWx1ZShuYW1lLCBudWxsKTsgLy8gR3JlYXNlbW9ua2V5LCBUYW1wZXJtb25rZXksIEZpcmVmb3ggZXh0ZW5zaW9uCiAgICB9IGVsc2UgewogICAgICAgIHZhciBscz1udWxsOwogICAgICAgIHRyeSB7bHM9d2luZG93LmxvY2FsU3RvcmFnZXx8bnVsbH0gY2F0Y2goZSl7fQogICAgICAgIGlmIChscykgewogICAgICAgICAgcmV0dXJuIGxzLmdldEl0ZW0obmFtZSk7IC8vIENocm9tZSBzY3JpcHQsIE9wZXJhIGV4dGVuc2lvbnMKICAgICAgICB9CiAgICB9CiAgICByZXR1cm47CiAgfQogIAogIGZ1bmN0aW9uIHNldFByZWYobmFtZSwgdmFsdWUpIHsgLy8gIGNyb3NzLWJyb3dzZXIgR01fc2V0VmFsdWUKICAgIHZhciBhPScnLCBiPScnOwogICAgdHJ5IHthPXR5cGVvZiBHTV9zZXRWYWx1ZS50b1N0cmluZzsgYj1HTV9zZXRWYWx1ZS50b1N0cmluZygpfSBjYXRjaChlKXt9ICAgIAogICAgaWYgKHR5cGVvZiBHTV9zZXRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiAKICAgIChhID09PSAndW5kZWZpbmVkJyB8fCBiLmluZGV4T2YoJ25vdCBzdXBwb3J0ZWQnKSA9PT0gLTEpKSB7CiAgICAgIEdNX3NldFZhbHVlKG5hbWUsIHZhbHVlKTsgLy8gR3JlYXNlbW9ua2V5LCBUYW1wZXJtb25rZXksIEZpcmVmb3ggZXh0ZW5zaW9uCiAgICB9IGVsc2UgewogICAgICAgIHZhciBscz1udWxsOwogICAgICAgIHRyeSB7bHM9d2luZG93LmxvY2FsU3RvcmFnZXx8bnVsbH0gY2F0Y2goZSl7fQogICAgICAgIGlmIChscykgewogICAgICAgICAgcmV0dXJuIGxzLnNldEl0ZW0obmFtZSwgdmFsdWUpOyAvLyBDaHJvbWUgc2NyaXB0LCBPcGVyYSBleHRlbnNpb25zCiAgICAgICAgfQogICAgfQogIH0KICAKICBmdW5jdGlvbiBjcm9zc1htbEh0dHBSZXF1ZXN0KGRldGFpbHMpIHsgLy8gY3Jvc3MtYnJvd3NlciBHTV94bWxodHRwUmVxdWVzdAogICAgaWYgKHR5cGVvZiBHTV94bWxodHRwUmVxdWVzdCA9PT0gJ2Z1bmN0aW9uJykgeyAvLyBHcmVhc2Vtb25rZXksIFRhbXBlcm1vbmtleSwgRmlyZWZveCBleHRlbnNpb24sIENocm9tZSBzY3JpcHQKICAgICAgR01feG1saHR0cFJlcXVlc3QoZGV0YWlscyk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cub3BlcmEgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5vcGVyYSAmJiB0eXBlb2Ygb3BlcmEuZXh0ZW5zaW9uICE9PSAndW5kZWZpbmVkJyAmJiAKICAgICAgICAgICAgICAgdHlwZW9mIG9wZXJhLmV4dGVuc2lvbi5wb3N0TWVzc2FnZSAhPT0gJ3VuZGVmaW5lZCcpIHsgLy8gT3BlcmEgMTIgZXh0ZW5zaW9uCiAgICAgICAgdmFyIGluZGV4PW9wZXJhVGFibGUubGVuZ3RoOwogICAgICAgIG9wZXJhLmV4dGVuc2lvbi5wb3N0TWVzc2FnZSh7J2FjdGlvbic6J3hoci0nK2luZGV4LCAndXJsJzpkZXRhaWxzLnVybCwgJ21ldGhvZCc6ZGV0YWlscy5tZXRob2R9KTsKICAgICAgICBvcGVyYVRhYmxlW2luZGV4XT1kZXRhaWxzOwogICAgfSBlbHNlIGlmICh0eXBlb2Ygd2luZG93Lm9wZXJhID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgWE1MSHR0cFJlcXVlc3QgPT09ICdmdW5jdGlvbicpIHsgLy8gT3BlcmEgMTUrIGV4dGVuc2lvbgogICAgICAgIHZhciB4aHI9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHsKICAgICAgICAgICAgaWYgKGRldGFpbHNbJ29ubG9hZCddKSB7CiAgICAgICAgICAgICAgZGV0YWlsc1snb25sb2FkJ10oeGhyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB4aHIub3BlbihkZXRhaWxzLm1ldGhvZCwgZGV0YWlscy51cmwsIHRydWUpOwogICAgICAgIHhoci5zZW5kKCk7CiAgICB9CiAgfQogICAKICBmdW5jdGlvbiBhZGRGaWxlU2l6ZSh1cmwsIGZvcm1hdCkgewogIAogICAgZnVuY3Rpb24gdXBkYXRlVmlkZW9MYWJlbChzaXplLCBmb3JtYXQpIHsKICAgICAgdmFyIGVsZW09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoTElTVElURU1fSUQrZm9ybWF0KTsKICAgICAgaWYgKGVsZW0pIHsKICAgICAgICBzaXplPXBhcnNlSW50KHNpemUsMTApOwogICAgICAgIGlmIChzaXplPj0xMDczNzQxODI0KSB7CiAgICAgICAgICBzaXplPXBhcnNlRmxvYXQoKHNpemUvMTA3Mzc0MTgyNCkudG9GaXhlZCgxKSkrJyBHQic7CiAgICAgICAgfSBlbHNlIGlmIChzaXplPj0xMDQ4NTc2KSB7CiAgICAgICAgICBzaXplPXBhcnNlRmxvYXQoKHNpemUvMTA0ODU3NikudG9GaXhlZCgxKSkrJyBNQic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNpemU9cGFyc2VGbG9hdCgoc2l6ZS8xMDI0KS50b0ZpeGVkKDEpKSsnIEtCJzsKICAgICAgICB9CiAgICAgICAgaWYgKGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg+MSkgewogICAgICAgICAgICBlbGVtLmxhc3RDaGlsZC5ub2RlVmFsdWU9JyAoJytzaXplKycpJzsKICAgICAgICB9IGVsc2UgaWYgKGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg9PTEpIHsKICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICgnK3NpemUrJyknKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAgICAgCiAgICB2YXIgbWF0Y2hTaXplPWZpbmRNYXRjaCh1cmwsIC9bJlw/XWNsZW49KFswLTldKykmL2kpOwogICAgaWYgKG1hdGNoU2l6ZSkgewogICAgICB1cGRhdGVWaWRlb0xhYmVsKG1hdGNoU2l6ZSwgZm9ybWF0KTsKICAgIH0gZWxzZSB7CiAgICAgIHRyeSB7CiAgICAgICAgY3Jvc3NYbWxIdHRwUmVxdWVzdCh7CiAgICAgICAgICBtZXRob2Q6J0hFQUQnLAogICAgICAgICAgdXJsOnVybCwKICAgICAgICAgIG9ubG9hZDpmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UucmVhZHlTdGF0ZSA9PSA0ICYmIHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsgLy8gYWRkIHNpemUKICAgICAgICAgICAgICB2YXIgc2l6ZT0wOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2UuZ2V0UmVzcG9uc2VIZWFkZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHNpemU9cmVzcG9uc2UuZ2V0UmVzcG9uc2VIZWFkZXIoJ0NvbnRlbnQtbGVuZ3RoJyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5yZXNwb25zZUhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ15Db250ZW50XC1sZW5ndGg6ICguKikkJywnaW0nKTsKICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gcmVnZXhwLmV4ZWMocmVzcG9uc2UucmVzcG9uc2VIZWFkZXJzKTsKICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgc2l6ZT1tYXRjaFsxXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2l6ZSkgewogICAgICAgICAgICAgICAgdXBkYXRlVmlkZW9MYWJlbChzaXplLCBmb3JtYXQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGNhdGNoKGUpIHsgfQogICAgfQogIH0KICAKICBmdW5jdGlvbiBmaW5kU2lnbmF0dXJlQ29kZShzb3VyY2VDb2RlKSB7CiAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBzaWduYXR1cmUgc3RhcnQgJytnZXRQcmVmKFNUT1JBR0VfQ09ERSkpOwogICAgdmFyIHNpZ25hdHVyZUZ1bmN0aW9uTmFtZSA9IAogICAgZmluZE1hdGNoKHNvdXJjZUNvZGUsIAogICAgL1wuc2V0XHMqXCgic2lnbmF0dXJlIlxzKixccyooW2EtekEtWjAtOV8kXVtcdyRdKilcKC8pCiAgICB8fCBmaW5kTWF0Y2goc291cmNlQ29kZSwgCiAgICAvXC5zaWdccypcfFx8XHMqKFthLXpBLVowLTlfJF1bXHckXSopXCgvKQogICAgfHwgZmluZE1hdGNoKHNvdXJjZUNvZGUsIAogICAgL1wuc2lnbmF0dXJlXHMqPVxzKihbYS16QS1aXyRdW1x3JF0qKVwoW2EtekEtWl8kXVtcdyRdKlwpLyk7IC8vb2xkCiAgICBpZiAoc2lnbmF0dXJlRnVuY3Rpb25OYW1lID09IG51bGwpIHJldHVybiBzZXRQcmVmKFNUT1JBR0VfQ09ERSwgJ2Vycm9yJyk7CiAgICBzaWduYXR1cmVGdW5jdGlvbk5hbWU9c2lnbmF0dXJlRnVuY3Rpb25OYW1lLnJlcGxhY2UoJyQnLCdcXCQnKTsgICAgCiAgICB2YXIgcmVnQ29kZSA9IG5ldyBSZWdFeHAoc2lnbmF0dXJlRnVuY3Rpb25OYW1lICsgJ1xccyo9XFxzKmZ1bmN0aW9uJyArCiAgICAnXFxzKlxcKFtcXHckXSpcXClcXHMqe1tcXHckXSo9W1xcdyRdKlxcLnNwbGl0XFwoIiJcXCk7XG4qKC4rKTtyZXR1cm4gW1xcdyRdKlxcLmpvaW4nKTsKICAgIHZhciByZWdDb2RlMiA9IG5ldyBSZWdFeHAoJ2Z1bmN0aW9uIFxccyonICsgc2lnbmF0dXJlRnVuY3Rpb25OYW1lICsKICAgICdcXHMqXFwoW1xcdyRdKlxcKVxccyp7W1xcdyRdKj1bXFx3JF0qXFwuc3BsaXRcXCgiIlxcKTtcbiooLispO3JldHVybiBbXFx3JF0qXFwuam9pbicpOyAgICAKICAgIHZhciBmdW5jdGlvbkNvZGUgPSBmaW5kTWF0Y2goc291cmNlQ29kZSwgcmVnQ29kZSkgfHwgZmluZE1hdGNoKHNvdXJjZUNvZGUsIHJlZ0NvZGUyKTsKICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IHNpZ25hdHVyZWZ1bmN0aW9uICcgKyBzaWduYXR1cmVGdW5jdGlvbk5hbWUgKyAnIC0tICcgKyBmdW5jdGlvbkNvZGUpOyAgICAgICAgICAgIAogICAgaWYgKGZ1bmN0aW9uQ29kZSA9PSBudWxsKSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgCiAgICB2YXIgcmV2ZXJzZUZ1bmN0aW9uTmFtZSA9IGZpbmRNYXRjaChzb3VyY2VDb2RlLCAKICAgIC8oW1x3JF0qKVxzKjpccypmdW5jdGlvblxzKlwoXHMqW1x3JF0qXHMqXClccyp7XHMqKD86cmV0dXJuXHMqKT9bXHckXSpcLnJldmVyc2VccypcKFxzKlwpXHMqfS8pOwogICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogcmV2ZXJzZWZ1bmN0aW9uICcgKyByZXZlcnNlRnVuY3Rpb25OYW1lKTsKICAgIGlmIChyZXZlcnNlRnVuY3Rpb25OYW1lKSByZXZlcnNlRnVuY3Rpb25OYW1lPXJldmVyc2VGdW5jdGlvbk5hbWUucmVwbGFjZSgnJCcsJ1xcJCcpOyAgICAgICAgCiAgICB2YXIgc2xpY2VGdW5jdGlvbk5hbWUgPSBmaW5kTWF0Y2goc291cmNlQ29kZSwgCiAgICAvKFtcdyRdKilccyo6XHMqZnVuY3Rpb25ccypcKFxzKltcdyRdKlxzKixccypbXHckXSpccypcKVxzKntccyooPzpyZXR1cm5ccyopP1tcdyRdKlwuKD86c2xpY2V8c3BsaWNlKVwoLitcKVxzKn0vKTsKICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IHNsaWNlZnVuY3Rpb24gJyArIHNsaWNlRnVuY3Rpb25OYW1lKTsKICAgIGlmIChzbGljZUZ1bmN0aW9uTmFtZSkgc2xpY2VGdW5jdGlvbk5hbWU9c2xpY2VGdW5jdGlvbk5hbWUucmVwbGFjZSgnJCcsJ1xcJCcpOyAgICAKICAgIAogICAgdmFyIHJlZ1NsaWNlID0gbmV3IFJlZ0V4cCgnXFwuKD86Jysnc2xpY2UnKyhzbGljZUZ1bmN0aW9uTmFtZT8nfCcrc2xpY2VGdW5jdGlvbk5hbWU6JycpKwogICAgJylcXHMqXFwoXFxzKig/OlthLXpBLVpfJF1bXFx3JF0qXFxzKiwpP1xccyooWzAtOV0rKVxccypcXCknKTsgLy8gLnNsaWNlKDUpIHNhdSAuSGYoYSw1KQogICAgdmFyIHJlZ1JldmVyc2UgPSBuZXcgUmVnRXhwKCdcXC4oPzonKydyZXZlcnNlJysocmV2ZXJzZUZ1bmN0aW9uTmFtZT8nfCcrcmV2ZXJzZUZ1bmN0aW9uTmFtZTonJykrCiAgICAnKVxccypcXChbXlxcKV0qXFwpJyk7ICAvLyAucmV2ZXJzZSgpIHNhdSAuR2YoYSw0NSkKICAgIHZhciByZWdTd2FwID0gbmV3IFJlZ0V4cCgnW1xcdyRdK1xccypcXChcXHMqW1xcdyRdK1xccyosXFxzKihbMC05XSspXFxzKlxcKScpOwogICAgdmFyIHJlZ0lubGluZSA9IG5ldyBSZWdFeHAoJ1tcXHckXStcXFswXFxdXFxzKj1cXHMqW1xcdyRdK1xcWyhbMC05XSspXFxzKiVcXHMqW1xcdyRdK1xcLmxlbmd0aFxcXScpOwogICAgdmFyIGZ1bmN0aW9uQ29kZVBpZWNlcz1mdW5jdGlvbkNvZGUuc3BsaXQoJzsnKTsKICAgIHZhciBkZWNvZGVBcnJheT1bXTsKICAgIGZvciAodmFyIGk9MDsgaTxmdW5jdGlvbkNvZGVQaWVjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgZnVuY3Rpb25Db2RlUGllY2VzW2ldPWZ1bmN0aW9uQ29kZVBpZWNlc1tpXS50cmltKCk7CiAgICAgIHZhciBjb2RlTGluZT1mdW5jdGlvbkNvZGVQaWVjZXNbaV07CiAgICAgIGlmIChjb2RlTGluZS5sZW5ndGg+MCkgewogICAgICAgIHZhciBhcnJTbGljZT1jb2RlTGluZS5tYXRjaChyZWdTbGljZSk7CiAgICAgICAgdmFyIGFyclJldmVyc2U9Y29kZUxpbmUubWF0Y2gocmVnUmV2ZXJzZSk7CiAgICAgICAgZGVidWcoaSsnOiAnK2NvZGVMaW5lKycgLS0nKyhhcnJTbGljZT8nIHNsaWNlIGxlbmd0aCAnK2FyclNsaWNlLmxlbmd0aDonJykgKycgJysoYXJyUmV2ZXJzZT8ncmV2ZXJzZSc6JycpKTsKICAgICAgICBpZiAoYXJyU2xpY2UgJiYgYXJyU2xpY2UubGVuZ3RoID49IDIpIHsgLy8gc2xpY2UKICAgICAgICB2YXIgc2xpY2U9cGFyc2VJbnQoYXJyU2xpY2VbMV0sIDEwKTsKICAgICAgICBpZiAoaXNJbnRlZ2VyKHNsaWNlKSl7IAogICAgICAgICAgZGVjb2RlQXJyYXkucHVzaCgtc2xpY2UpOwogICAgICAgIH0gZWxzZSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgICB9IGVsc2UgaWYgKGFyclJldmVyc2UgJiYgYXJyUmV2ZXJzZS5sZW5ndGggPj0gMSkgeyAvLyByZXZlcnNlCiAgICAgICAgZGVjb2RlQXJyYXkucHVzaCgwKTsKICAgICAgfSBlbHNlIGlmIChjb2RlTGluZS5pbmRleE9mKCdbMF0nKSA+PSAwKSB7IC8vIGlubGluZSBzd2FwCiAgICAgICAgICBpZiAoaSsyPGZ1bmN0aW9uQ29kZVBpZWNlcy5sZW5ndGggJiYKICAgICAgICAgIGZ1bmN0aW9uQ29kZVBpZWNlc1tpKzFdLmluZGV4T2YoJy5sZW5ndGgnKSA+PSAwICYmCiAgICAgICAgICBmdW5jdGlvbkNvZGVQaWVjZXNbaSsxXS5pbmRleE9mKCdbMF0nKSA+PSAwKSB7CiAgICAgICAgICAgIHZhciBpbmxpbmU9ZmluZE1hdGNoKGZ1bmN0aW9uQ29kZVBpZWNlc1tpKzFdLCByZWdJbmxpbmUpOwogICAgICAgICAgICBpbmxpbmU9cGFyc2VJbnQoaW5saW5lLCAxMCk7CiAgICAgICAgICAgIGRlY29kZUFycmF5LnB1c2goaW5saW5lKTsKICAgICAgICAgICAgaSs9MjsKICAgICAgICAgIH0gZWxzZSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgICB9IGVsc2UgaWYgKGNvZGVMaW5lLmluZGV4T2YoJywnKSA+PSAwKSB7IC8vIHN3YXAKICAgICAgICB2YXIgc3dhcD1maW5kTWF0Y2goY29kZUxpbmUsIHJlZ1N3YXApOyAgICAgIAogICAgICAgIHN3YXA9cGFyc2VJbnQoc3dhcCwgMTApOwogICAgICAgIGlmIChpc0ludGVnZXIoc3dhcCkgJiYgc3dhcD4wKXsKICAgICAgICAgIGRlY29kZUFycmF5LnB1c2goc3dhcCk7CiAgICAgICAgfSBlbHNlIHJldHVybiBzZXRQcmVmKFNUT1JBR0VfQ09ERSwgJ2Vycm9yJyk7CiAgICAgIH0gZWxzZSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgICB9CiAgICB9CiAgICAKICAgIGlmIChkZWNvZGVBcnJheSkgewogICAgICBzZXRQcmVmKFNUT1JBR0VfVVJMLCBzY3JpcHRVUkwpOwogICAgICBzZXRQcmVmKFNUT1JBR0VfQ09ERSwgZGVjb2RlQXJyYXkudG9TdHJpbmcoKSk7CiAgICAgIERFQ09ERV9SVUxFPWRlY29kZUFycmF5OwogICAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBzaWduYXR1cmUgJytkZWNvZGVBcnJheS50b1N0cmluZygpKycgJytzY3JpcHRVUkwpOwogICAgICAvLyB1cGRhdGUgZG93bmxvYWQgbGlua3MgYW5kIGFkZCBmaWxlIHNpemVzCiAgICAgIGZvciAodmFyIGk9MDtpPGRvd25sb2FkQ29kZUxpc3QubGVuZ3RoO2krKykgeyAgICAgICAgCiAgICAgICAgdmFyIGVsZW09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoTElTVElURU1fSUQrZG93bmxvYWRDb2RlTGlzdFtpXS5mb3JtYXQpOwogICAgICAgIHZhciB1cmw9ZG93bmxvYWRDb2RlTGlzdFtpXS51cmw7CiAgICAgICAgdmFyIHNpZz1kb3dubG9hZENvZGVMaXN0W2ldLnNpZzsKICAgICAgICBpZiAoZWxlbSAmJiB1cmwgJiYgc2lnKSB7CiAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoL1wmc2lnbmF0dXJlPVtcd1wuXSsvLCAnJnNpZ25hdHVyZT0nK2RlY3J5cHRTaWduYXR1cmUoc2lnKSk7CiAgICAgICAgICBlbGVtLnBhcmVudE5vZGUuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsKTsKICAgICAgICAgIGFkZEZpbGVTaXplKHVybCwgZG93bmxvYWRDb2RlTGlzdFtpXS5mb3JtYXQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICAKICBmdW5jdGlvbiBpc1ZhbGlkU2lnbmF0dXJlQ29kZShhcnIpIHsgLy8gdmFsaWQgdmFsdWVzOiAnNSwtMywwLDIsNScsICdlcnJvcicKICAgIGlmICghYXJyKSByZXR1cm4gZmFsc2U7CiAgICBpZiAoYXJyPT0nZXJyb3InKSByZXR1cm4gdHJ1ZTsKICAgIGFycj1hcnIuc3BsaXQoJywnKTsKICAgIGZvciAodmFyIGk9MDtpPGFyci5sZW5ndGg7aSsrKSB7CiAgICAgIGlmICghaXNJbnRlZ2VyKHBhcnNlSW50KGFycltpXSwxMCkpKSByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCiAgZnVuY3Rpb24gZmV0Y2hTaWduYXR1cmVTY3JpcHQoc2NyaXB0VVJMKSB7CiAgICB2YXIgc3RvcmFnZVVSTD1nZXRQcmVmKFNUT1JBR0VfVVJMKTsKICAgIHZhciBzdG9yYWdlQ29kZT1nZXRQcmVmKFNUT1JBR0VfQ09ERSk7CiAgICBpZiAoISgvLDAsfF4wLHwsMCR8XC0vLnRlc3Qoc3RvcmFnZUNvZGUpKSkgc3RvcmFnZUNvZGU9bnVsbDsgLy8gaGFjayBmb3Igb25seSBwb3NpdGl2ZSBpdGVtcwogICAgaWYgKHN0b3JhZ2VDb2RlICYmIGlzVmFsaWRTaWduYXR1cmVDb2RlKHN0b3JhZ2VDb2RlKSAmJiBzdG9yYWdlVVJMICYmCiAgICAgICAgc2NyaXB0VVJMLnJlcGxhY2UoL15odHRwcz8vaSwnJyk9PXN0b3JhZ2VVUkwucmVwbGFjZSgvXmh0dHBzPy9pLCcnKSkgcmV0dXJuOwogICAgdHJ5IHsKICAgICAgZGVidWcoJ0RZVkFNIGZldGNoICcrc2NyaXB0VVJMKTsKICAgICAgaXNTaWduYXR1cmVVcGRhdGluZ1N0YXJ0ZWQ9dHJ1ZTsgICAgCiAgICAgIGNyb3NzWG1sSHR0cFJlcXVlc3QoewogICAgICAgIG1ldGhvZDonR0VUJywKICAgICAgICB1cmw6c2NyaXB0VVJMLAogICAgICAgIG9ubG9hZDpmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgZGVidWcoJ0RZVkFNIGZldGNoIHN0YXR1cyAnK3Jlc3BvbnNlLnN0YXR1cyk7CiAgICAgICAgICBpZiAocmVzcG9uc2UucmVhZHlTdGF0ZSA9PT0gNCAmJiByZXNwb25zZS5zdGF0dXMgPT09IDIwMCAmJiByZXNwb25zZS5yZXNwb25zZVRleHQpIHsKICAgICAgICAgICAgZmluZFNpZ25hdHVyZUNvZGUocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgIH0KICAgICAgICB9IAogICAgICB9KTsKICAgIH0gY2F0Y2goZSkgeyB9CiAgfQogIAogIGZ1bmN0aW9uIGdldERlY29kZVJ1bGVzKHJ1bGVzKSB7CiAgICB2YXIgc3RvcmFnZUNvZGU9Z2V0UHJlZihTVE9SQUdFX0NPREUpOyAgICAKICAgIGlmIChzdG9yYWdlQ29kZSAmJiBzdG9yYWdlQ29kZSE9J2Vycm9yJyAmJiBpc1ZhbGlkU2lnbmF0dXJlQ29kZShzdG9yYWdlQ29kZSkpIHsKICAgICAgdmFyIGFycj1zdG9yYWdlQ29kZS5zcGxpdCgnLCcpOwogICAgICBmb3IgKHZhciBpPTA7IGk8YXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYXJyW2ldPXBhcnNlSW50KGFycltpXSwgMTApOwogICAgICB9CiAgICAgIHJ1bGVzPWFycjsKICAgICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogc2lnbmF0dXJlICcrYXJyLnRvU3RyaW5nKCkrJyAnK3NjcmlwdFVSTCk7CiAgICB9CiAgICByZXR1cm4gcnVsZXM7CiAgfQogIAogIGZ1bmN0aW9uIGRlY3J5cHRTaWduYXR1cmUoc2lnKSB7CiAgICBmdW5jdGlvbiBzd2FwKGEsYil7dmFyIGM9YVswXTthWzBdPWFbYiVhLmxlbmd0aF07YVtiXT1jO3JldHVybiBhfTsKICAgIGZ1bmN0aW9uIGRlY29kZShzaWcsIGFycikgeyAvLyBlbmNvZGVkIGRlY3J5cHRpb24KICAgICAgaWYgKCFpc1N0cmluZyhzaWcpKSByZXR1cm4gbnVsbDsKICAgICAgdmFyIHNpZ0E9c2lnLnNwbGl0KCcnKTsKICAgICAgZm9yICh2YXIgaT0wO2k8YXJyLmxlbmd0aDtpKyspIHsKICAgICAgICB2YXIgYWN0PWFycltpXTsKICAgICAgICBpZiAoIWlzSW50ZWdlcihhY3QpKSByZXR1cm4gbnVsbDsKICAgICAgICBzaWdBPShhY3Q+MCk/c3dhcChzaWdBLCBhY3QpOigoYWN0PT0wKT9zaWdBLnJldmVyc2UoKTpzaWdBLnNsaWNlKC1hY3QpKTsKICAgICAgfQogICAgICB2YXIgcmVzdWx0PXNpZ0Euam9pbignJyk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIGlmIChzaWc9PW51bGwpIHJldHVybiAnJzsgICAgCiAgICB2YXIgYXJyPURFQ09ERV9SVUxFOwogICAgaWYgKGFycikgewogICAgICB2YXIgc2lnMj1kZWNvZGUoc2lnLCBhcnIpOwogICAgICBpZiAoc2lnMikgcmV0dXJuIHNpZzI7CiAgICB9IGVsc2UgewogICAgICBzZXRQcmVmKFNUT1JBR0VfVVJMLCAnJyk7CiAgICAgIHNldFByZWYoU1RPUkFHRV9DT0RFLCAnJyk7CiAgICB9CiAgICByZXR1cm4gc2lnOyAKICB9ICAKICAgICAgCiAgfQogCn0pKCk7"},{"name":"ç™¾åº¦ç½‘ç›˜ç›´æŽ¥ä¸‹è½½åŠ©æ‰‹","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://pan.baidu.com/disk/home*","*://yun.baidu.com/disk/home*","*://pan.baidu.com/s/*","*://yun.baidu.com/s/*","*://pan.baidu.com/share/link*","*://yun.baidu.com/share/link*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1483669225110,"data":{}},"enabled":true,"position":10,"file_url":"https://greasyfork.org/scripts/23635-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B/code/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B.user.js","uuid":"1c073f9d-d75a-4063-8479-21929f3f22cd","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDnmb7luqbnvZHnm5jnm7TmjqXkuIvovb3liqnmiYsKLy8gQG5hbWVzcGFjZSAgICB1bmRlZmluZWQKLy8gQHZlcnNpb24gICAgICAwLjkuMTUKLy8gQGRlc2NyaXB0aW9uICDnm7TmjqXkuIvovb3nmb7luqbnvZHnm5jlkoznmb7luqbnvZHnm5jliIbkuqvnmoTmlofku7bvvIzpgb/lhY3kuIvovb3mlofku7bml7bosIPnlKjnmb7luqbnvZHnm5jlrqLmiLfnq6/vvIzojrflj5bnvZHnm5jmlofku7bnmoTnm7TmjqXkuIvovb3lnLDlnYAKLy8gQGF1dGhvciAgICAgICBpdmVzamF5Ci8vIEBtYXRjaCAgICAgICAgKjovL3Bhbi5iYWlkdS5jb20vZGlzay9ob21lKgovLyBAbWF0Y2ggICAgICAgICo6Ly95dW4uYmFpZHUuY29tL2Rpc2svaG9tZSoKLy8gQG1hdGNoICAgICAgICAqOi8vcGFuLmJhaWR1LmNvbS9zLyoKLy8gQG1hdGNoICAgICAgICAqOi8veXVuLmJhaWR1LmNvbS9zLyoKLy8gQG1hdGNoICAgICAgICAqOi8vcGFuLmJhaWR1LmNvbS9zaGFyZS9saW5rKgovLyBAbWF0Y2ggICAgICAgICo6Ly95dW4uYmFpZHUuY29tL3NoYXJlL2xpbmsqCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9jb2RlLmpxdWVyeS5jb20vanF1ZXJ5LWxhdGVzdC5qcwovLyBAcnVuLWF0ICAgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEBncmFudCAgICAgICAgdW5zYWZlV2luZG93Ci8vIEBncmFudCAgICAgICAgR01fc2V0Q2xpcGJvYXJkCi8vID09L1VzZXJTY3JpcHQ9PQoKKGZ1bmN0aW9uKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIHZhciAkID0gJCB8fCB3aW5kb3cuJDsKCiAgICAkKGZ1bmN0aW9uKCl7CiAgICAgICAgc3dpdGNoKGRldGVjdFBhZ2UoKSl7CiAgICAgICAgICAgIGNhc2UgJ2Rpc2snOgogICAgICAgICAgICAgICAgdmFyIHBhbkhlbHBlciA9IG5ldyBQYW5IZWxwZXIoKTsKICAgICAgICAgICAgICAgIHBhbkhlbHBlci5pbml0KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNhc2UgJ3NoYXJlJzoKICAgICAgICAgICAgY2FzZSAncyc6CiAgICAgICAgICAgICAgICB2YXIgcGFuU2hhcmVIZWxwZXIgPSBuZXcgUGFuU2hhcmVIZWxwZXIoKTsKICAgICAgICAgICAgICAgIHBhblNoYXJlSGVscGVyLmluaXQoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9KTsKCiAgICAvL+e9keebmOmhtemdoueahOS4i+i9veWKqeaJiwogICAgZnVuY3Rpb24gUGFuSGVscGVyKCl7CiAgICAgICAgdmFyIHl1bkRhdGEsc2lnbix0aW1lc3RhbXAsYmRzdG9rZW4sbG9naWQsZmlkX2xpc3Q7CiAgICAgICAgdmFyIGZpbGVMaXN0PVtdLHNlbGVjdEZpbGVMaXN0PVtdLGJhdGNoTGlua0xpc3Q9W10sYmF0Y2hMaW5rTGlzdEFsbD1bXSxsaW5rTGlzdD1bXSwKICAgICAgICAgICAgbGlzdF9ncmlkX3N0YXR1cz0nbGlzdCc7CiAgICAgICAgdmFyIG9ic2VydmVyLGN1cnJlbnRQYWdlLGN1cnJlbnRQYXRoLGN1cnJlbnRDYXRlZ29yeSxkaWFsb2c7CiAgICAgICAgdmFyIHBhbkFQSVVybCA9IGxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGxvY2F0aW9uLmhvc3QgKyAiL2FwaS8iOwogICAgICAgIHZhciByZXN0QVBJVXJsID0gbG9jYXRpb24ucHJvdG9jb2wgKyAiLy9wY3MuYmFpZHUuY29tL3Jlc3QvMi4wL3Bjcy8iOwogICAgICAgIHZhciBjbGllbnRBUElVcmwgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvL2QucGNzLmJhaWR1LmNvbS9yZXN0LzIuMC9wY3MvIjsKCiAgICAgICAgdGhpcy5pbml0ID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgeXVuRGF0YSA9IHVuc2FmZVdpbmRvdy55dW5EYXRhOwogICAgICAgICAgICBjb25zb2xlLmxvZygneXVuRGF0YTonLHl1bkRhdGEpOwogICAgICAgICAgICBpZih5dW5EYXRhID09PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+mhtemdouacquato+W4uOWKoOi9ve+8jOaIluiAheeZvuW6puW3sue7j+abtOaWsO+8gScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluaXRQYXJhbXMoKTsKICAgICAgICAgICAgcmVnaXN0ZXJFdmVudExpc3RlbmVyKCk7CiAgICAgICAgICAgIGNyZWF0ZU9ic2VydmVyKCk7CiAgICAgICAgICAgIGFkZEJ1dHRvbigpOwogICAgICAgICAgICBjcmVhdGVJZnJhbWUoKTsKICAgICAgICAgICAgZGlhbG9nID0gbmV3IERpYWxvZyh7YWRkQ29weTp0cnVlfSk7CgogICAgICAgICAgICBjb25zb2xlLmxvZygn572R55uY55u05o6l5LiL6L295Yqp5omL5Yqg6L295oiQ5Yqf77yBJyk7CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdFBhcmFtcygpewogICAgICAgICAgICBzaWduID0gZ2V0U2lnbigpOwogICAgICAgICAgICB0aW1lc3RhbXAgPSBnZXRUaW1lc3RhbXAoKTsKICAgICAgICAgICAgYmRzdG9rZW4gPSBnZXRCRFN0b2tlbigpOwogICAgICAgICAgICBsb2dpZCA9IGdldExvZ0lEKCk7CiAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gZ2V0Q3VycmVudFBhZ2UoKTsKCiAgICAgICAgICAgIGlmKGN1cnJlbnRQYWdlID09ICdsaXN0JykKICAgICAgICAgICAgICAgIGN1cnJlbnRQYXRoID0gZ2V0UGF0aCgpOwoKICAgICAgICAgICAgaWYoY3VycmVudFBhZ2UgPT0gJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIGN1cnJlbnRDYXRlZ29yeSA9IGdldENhdGVnb3J5KCk7CgogICAgICAgICAgICByZWZyZXNoTGlzdEdyaWRTdGF0dXMoKTsKICAgICAgICAgICAgcmVmcmVzaEZpbGVMaXN0KCk7CiAgICAgICAgICAgIHJlZnJlc2hTZWxlY3RMaXN0KCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZWZyZXNoRmlsZUxpc3QoKXsKICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlID09ICdsaXN0JykgewogICAgICAgICAgICAgICAgZmlsZUxpc3QgPSBnZXRGaWxlTGlzdCgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRQYWdlID09ICdjYXRlZ29yeScpewogICAgICAgICAgICAgICAgZmlsZUxpc3QgPSBnZXRDYXRlZ29yeUZpbGVMaXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlZnJlc2hTZWxlY3RMaXN0KCl7CiAgICAgICAgICAgIHNlbGVjdEZpbGVMaXN0ID0gW107CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZWZyZXNoTGlzdEdyaWRTdGF0dXMoKXsKICAgICAgICAgICAgbGlzdF9ncmlkX3N0YXR1cyA9IGdldExpc3RHcmlkU3RhdHVzKCk7CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPluW9k+WJjeeahOinhuWbvuaooeW8jwogICAgICAgIGZ1bmN0aW9uIGdldExpc3RHcmlkU3RhdHVzKCl7CiAgICAgICAgICAgIHJldHVybiAkKCdkaXYubGlzdC1ncmlkLXN3aXRjaCcpLmhhc0NsYXNzKCdsaXN0LXN3aXRjaGVkLW9uJyk/J2xpc3QnOigkKCdkaXYubGlzdC1ncmlkLXN3aXRjaCcpLmhhc0NsYXNzKCdncmlkLXN3aXRjaGVkLW9uJyk/J2dyaWQnOidsaXN0Jyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZWdpc3RlckV2ZW50TGlzdGVuZXIoKXsKICAgICAgICAgICAgcmVnaXN0ZXJIYXNoQ2hhbmdlKCk7CiAgICAgICAgICAgIHJlZ2lzdGVyTGlzdEdyaWRTdGF0dXMoKTsKICAgICAgICAgICAgcmVnaXN0ZXJDaGVja2JveCgpOwogICAgICAgICAgICByZWdpc3RlckFsbENoZWNrYm94KCk7CiAgICAgICAgICAgIHJlZ2lzdGVyRmlsZVNlbGVjdCgpOwogICAgICAgIH0KCiAgICAgICAgLy/nm5Hop4blnLDlnYDmoI8j5qCH562+55qE5Y+Y5YyWCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJIYXNoQ2hhbmdlKCl7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIHJlZnJlc2hMaXN0R3JpZFN0YXR1cygpOwogICAgICAgICAgICAgICAgaWYoZ2V0Q3VycmVudFBhZ2UoKSA9PSAnbGlzdCcpIHsKICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW50UGFnZSA9PSBnZXRDdXJyZW50UGFnZSgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY3VycmVudFBhdGggPT0gZ2V0UGF0aCgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXRoID0gZ2V0UGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEZpbGVMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoU2VsZWN0TGlzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBnZXRDdXJyZW50UGFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGF0aCA9IGdldFBhdGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEZpbGVMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hTZWxlY3RMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnZXRDdXJyZW50UGFnZSgpID09ICdjYXRlZ29yeScpIHsKICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW50UGFnZSA9PSBnZXRDdXJyZW50UGFnZSgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY3VycmVudENhdGVnb3J5ID09IGdldENhdGVnb3J5KCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBnZXRDdXJyZW50UGFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENhdGVnb3J5ID0gZ2V0Q2F0ZWdvcnkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hGaWxlTGlzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFNlbGVjdExpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gZ2V0Q3VycmVudFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENhdGVnb3J5ID0gZ2V0Q2F0ZWdvcnkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEZpbGVMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hTZWxlY3RMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8v55uR6KeG6KeG5Zu+5Y+Y5YyWCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJMaXN0R3JpZFN0YXR1cygpewogICAgICAgICAgICB2YXIgJGFfbGlzdCA9ICQoJ2Fbbm9kZS10eXBlPWxpc3Qtc3dpdGNoXScpOwogICAgICAgICAgICAkYV9saXN0LmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBsaXN0X2dyaWRfc3RhdHVzID0gJ2xpc3QnOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciAkYV9ncmlkID0gJCgnYVtub2RlLXR5cGU9Z3JpZC1zd2l0Y2hdJyk7CiAgICAgICAgICAgICRhX2dyaWQuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGxpc3RfZ3JpZF9zdGF0dXMgPSAnZ3JpZCc7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/mlofku7bpgInmi6nmoYYKICAgICAgICBmdW5jdGlvbiByZWdpc3RlckNoZWNrYm94KCl7CiAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSAkKCdzcGFuLmNoZWNrYm94Jyk7CiAgICAgICAgICAgICRjaGVja2JveC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS5iaW5kKCdjbGljaycsZnVuY3Rpb24oZSl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRwYXJlbnQgPSAkKHRoaXMpLnBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZTsKICAgICAgICAgICAgICAgICAgICBpZihsaXN0X2dyaWRfc3RhdHVzID09ICdsaXN0JykgewogICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZSA9ICQoJ2Rpdi5maWxlLW5hbWUgZGl2LnRleHQgYScsJHBhcmVudCkuYXR0cigndGl0bGUnKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihsaXN0X2dyaWRfc3RhdHVzID09ICdncmlkJyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gJCgnZGl2LmZpbGUtbmFtZSBhJywkcGFyZW50KS5hdHRyKCd0aXRsZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZigkcGFyZW50Lmhhc0NsYXNzKCdpdGVtLWFjdGl2ZScpKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WPlua2iOmAieS4reaWh+S7tu+8micrZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGk9MDtpPHNlbGVjdEZpbGVMaXN0Lmxlbmd0aDtpKyspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3RbaV0uZmlsZW5hbWUgPT0gZmlsZW5hbWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdEZpbGVMaXN0LnNwbGljZShpLDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfpgInkuK3mlofku7Y6JytmaWxlbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChmaWxlTGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQuc2VydmVyX2ZpbGVuYW1lID09IGZpbGVuYW1lKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTplbGVtZW50LnNlcnZlcl9maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDplbGVtZW50LnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZzX2lkOmVsZW1lbnQuZnNfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzZGlyOmVsZW1lbnQuaXNkaXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdEZpbGVMaXN0LnB1c2gob2JqKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdW5yZWdpc3RlckNoZWNrYm94KCl7CiAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSAkKCdzcGFuLmNoZWNrYm94Jyk7CiAgICAgICAgICAgICRjaGVja2JveC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/lhajpgInmoYYKICAgICAgICBmdW5jdGlvbiByZWdpc3RlckFsbENoZWNrYm94KCl7CiAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSAkKCdkaXYuY29sLWl0ZW0uY2hlY2snKTsKICAgICAgICAgICAgJGNoZWNrYm94LmVhY2goZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJHBhcmVudCA9ICQodGhpcykucGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJHBhcmVudC5oYXNDbGFzcygnY2hlY2tlZCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WPlua2iOWFqOmAiScpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflhajpg6jpgInkuK0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0RmlsZUxpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZpbGVMaXN0LGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTplbGVtZW50LnNlcnZlcl9maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOmVsZW1lbnQucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19pZDplbGVtZW50LmZzX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzZGlyOmVsZW1lbnQuaXNkaXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdC5wdXNoKG9iaik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJBbGxDaGVja2JveCgpewogICAgICAgICAgICB2YXIgJGNoZWNrYm94ID0gJCgnZGl2LmNvbC1pdGVtLmNoZWNrJyk7CiAgICAgICAgICAgICRjaGVja2JveC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/ljZXkuKrmlofku7bpgInkuK3vvIzngrnlh7vmlofku7bkuI3mmK/ngrnlh7vpgInkuK3moYbvvIzkvJrlj6rpgInkuK3or6Xmlofku7YKICAgICAgICBmdW5jdGlvbiByZWdpc3RlckZpbGVTZWxlY3QoKXsKICAgICAgICAgICAgdmFyICRkZCA9ICQoJ2Rpdi5saXN0LXZpZXcgZGQnKTsKICAgICAgICAgICAgJGRkLmVhY2goZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBlLnRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKG5vZGVOYW1lICE9ICdzcGFuJyAmJiBub2RlTmFtZSAhPSAnYScgJiYgbm9kZU5hbWUgIT0gJ2VtJykgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSAkKCdkaXYuZmlsZS1uYW1lIGRpdi50ZXh0IGEnLCQodGhpcykpLmF0dHIoJ3RpdGxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfpgInkuK3mlofku7bvvJonICsgZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmlsZUxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihlbGVtZW50LnNlcnZlcl9maWxlbmFtZSA9PSBmaWxlbmFtZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ZWxlbWVudC5zZXJ2ZXJfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ZWxlbWVudC5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19pZDplbGVtZW50LmZzX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc2RpcjplbGVtZW50LmlzZGlyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdC5wdXNoKG9iaik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJGaWxlU2VsZWN0KCl7CiAgICAgICAgICAgIHZhciAkZGQgPSAkKCdkaXYubGlzdC12aWV3IGRkJyk7CiAgICAgICAgICAgICRkZC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/nm5Hop4bmlofku7bliJfooajmmL7npLrlj5jljJYKICAgICAgICBmdW5jdGlvbiBjcmVhdGVPYnNlcnZlcigpewogICAgICAgICAgICB2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyOwogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICdjaGlsZExpc3QnOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24obXV0YXRpb25zKXsKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJDaGVja2JveCgpOwogICAgICAgICAgICAgICAgdW5yZWdpc3RlckFsbENoZWNrYm94KCk7CiAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyRmlsZVNlbGVjdCgpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJDaGVja2JveCgpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJBbGxDaGVja2JveCgpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJGaWxlU2VsZWN0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbGlzdF92aWV3ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxpc3QtdmlldycpOwogICAgICAgICAgICB2YXIgZ3JpZF92aWV3ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQtdmlldycpOwoKICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShsaXN0X3ZpZXcsb3B0aW9ucyk7CiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoZ3JpZF92aWV3LG9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgLy/mt7vliqDliqnmiYvmjInpkq4KICAgICAgICBmdW5jdGlvbiBhZGRCdXR0b24oKXsKICAgICAgICAgICAgJCgnZGl2LmJhci1zZWFyY2gnKS5jc3MoJ3dpZHRoJywnMTglJyk7Ly/kv67mlLnmkJzntKLmoYbnmoTlrr3luqbvvIzpgb/lhY3pga7mjKEKICAgICAgICAgICAgdmFyICRkcm9wZG93bmJ1dHRvbiA9ICQoJzxzcGFuIGNsYXNzPSJnLWRyb3Bkb3duLWJ1dHRvbiI+PC9zcGFuPicpOwogICAgICAgICAgICB2YXIgJGRyb3Bkb3duYnV0dG9uX2EgPSAkKCc8YSBjbGFzcz0iZy1idXR0b24iIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPjxzcGFuIGNsYXNzPSJnLWJ1dHRvbi1yaWdodCI+PGVtIGNsYXNzPSJpY29uIGljb24tZG93bmxvYWQiIHRpdGxlPSLnmb7luqbnvZHnm5jkuIvovb3liqnmiYsiPjwvZW0+PHNwYW4gY2xhc3M9InRleHQiIHN0eWxlPSJ3aWR0aDogYXV0bzsiPuS4i+i9veWKqeaJizwvc3Bhbj48L3NwYW4+PC9hPicpOwogICAgICAgICAgICB2YXIgJGRyb3Bkb3duYnV0dG9uX3NwYW4gPSAkKCc8c3BhbiBjbGFzcz0ibWVudSIgc3R5bGU9IndpZHRoOjk2cHgiPjwvc3Bhbj4nKTsKCiAgICAgICAgICAgIHZhciAkZGlyZWN0YnV0dG9uID0gJCgnPHNwYW4gY2xhc3M9ImctYnV0dG9uLW1lbnUiIHN0eWxlPSJkaXNwbGF5OmJsb2NrIj48L3NwYW4+Jyk7CiAgICAgICAgICAgIHZhciAkZGlyZWN0YnV0dG9uX3NwYW4gPSAkKCc8c3BhbiBjbGFzcz0iZy1kcm9wZG93bi1idXR0b24gZy1kcm9wZG93bi1idXR0b24tc2Vjb25kIiBtZW51bGV2ZWw9IjIiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgdmFyICRkaXJlY3RidXR0b25fYSA9ICQoJzxhIGNsYXNzPSJnLWJ1dHRvbiIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+PHNwYW4gY2xhc3M9ImctYnV0dG9uLXJpZ2h0Ij48c3BhbiBjbGFzcz0idGV4dCIgc3R5bGU9IndpZHRoOmF1dG8iPuebtOaOpeS4i+i9vTwvc3Bhbj48L3NwYW4+PC9hPicpOwogICAgICAgICAgICB2YXIgJGRpcmVjdGJ1dHRvbl9tZW51ID0gJCgnPHNwYW4gY2xhc3M9Im1lbnUiIHN0eWxlPSJ3aWR0aDoxMjBweDtsZWZ0Ojc5cHgiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgdmFyICRkaXJlY3RidXR0b25fZG93bmxvYWRfYnV0dG9uID0gJCgnPGEgaWQ9ImRvd25sb2FkLWRpcmVjdCIgY2xhc3M9ImctYnV0dG9uLW1lbnUiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPuS4i+i9vTwvYT4nKTsKICAgICAgICAgICAgdmFyICRkaXJlY3RidXR0b25fbGlua19idXR0b24gPSAkKCc8YSBpZD0ibGluay1kaXJlY3QiIGNsYXNzPSJnLWJ1dHRvbi1tZW51IiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7Ij7mmL7npLrpk77mjqU8L2E+Jyk7CiAgICAgICAgICAgIHZhciAkZGlyZWN0YnV0dG9uX2JhdGNoaHR0cGxpbmtfYnV0dG9uID0gJCgnPGEgaWQ9ImJhdGNoaHR0cGxpbmstZGlyZWN0IiBjbGFzcz0iZy1idXR0b24tbWVudSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+5om56YeP6ZO+5o6lKEhUVFApPC9hPicpOwogICAgICAgICAgICB2YXIgJGRpcmVjdGJ1dHRvbl9iYXRjaGh0dHBzbGlua19idXR0b24gPSAkKCc8YSBpZD0iYmF0Y2hodHRwc2xpbmstZGlyZWN0IiBjbGFzcz0iZy1idXR0b24tbWVudSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+5om56YeP6ZO+5o6lKEhUVFBTKTwvYT4nKTsKICAgICAgICAgICAgJGRpcmVjdGJ1dHRvbl9tZW51LmFwcGVuZCgkZGlyZWN0YnV0dG9uX2Rvd25sb2FkX2J1dHRvbikuYXBwZW5kKCRkaXJlY3RidXR0b25fbGlua19idXR0b24pLmFwcGVuZCgkZGlyZWN0YnV0dG9uX2JhdGNoaHR0cGxpbmtfYnV0dG9uKS5hcHBlbmQoJGRpcmVjdGJ1dHRvbl9iYXRjaGh0dHBzbGlua19idXR0b24pOwogICAgICAgICAgICAkZGlyZWN0YnV0dG9uLmFwcGVuZCgkZGlyZWN0YnV0dG9uX3NwYW4uYXBwZW5kKCRkaXJlY3RidXR0b25fYSkuYXBwZW5kKCRkaXJlY3RidXR0b25fbWVudSkpOwogICAgICAgICAgICAkZGlyZWN0YnV0dG9uLmhvdmVyKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAkZGlyZWN0YnV0dG9uX3NwYW4udG9nZ2xlQ2xhc3MoJ2J1dHRvbi1vcGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkZGlyZWN0YnV0dG9uX2Rvd25sb2FkX2J1dHRvbi5jbGljayhkb3dubG9hZENsaWNrKTsKICAgICAgICAgICAgJGRpcmVjdGJ1dHRvbl9saW5rX2J1dHRvbi5jbGljayhsaW5rQ2xpY2spOwogICAgICAgICAgICAkZGlyZWN0YnV0dG9uX2JhdGNoaHR0cGxpbmtfYnV0dG9uLmNsaWNrKGJhdGNoQ2xpY2spOwogICAgICAgICAgICAkZGlyZWN0YnV0dG9uX2JhdGNoaHR0cHNsaW5rX2J1dHRvbi5jbGljayhiYXRjaENsaWNrKTsKCiAgICAgICAgICAgIHZhciAkYXBpYnV0dG9uID0gJCgnPHNwYW4gY2xhc3M9ImctYnV0dG9uLW1lbnUiIHN0eWxlPSJkaXNwbGF5OmJsb2NrIj48L3NwYW4+Jyk7CiAgICAgICAgICAgIHZhciAkYXBpYnV0dG9uX3NwYW4gPSAkKCc8c3BhbiBjbGFzcz0iZy1kcm9wZG93bi1idXR0b24gZy1kcm9wZG93bi1idXR0b24tc2Vjb25kIiBtZW51bGV2ZWw9IjIiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgdmFyICRhcGlidXR0b25fYSA9ICQoJzxhIGNsYXNzPSJnLWJ1dHRvbiIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+PHNwYW4gY2xhc3M9ImctYnV0dG9uLXJpZ2h0Ij48c3BhbiBjbGFzcz0idGV4dCIgc3R5bGU9IndpZHRoOmF1dG8iPkFQSeS4i+i9vTwvc3Bhbj48L3NwYW4+PC9hPicpOwogICAgICAgICAgICB2YXIgJGFwaWJ1dHRvbl9tZW51ID0gJCgnPHNwYW4gY2xhc3M9Im1lbnUiIHN0eWxlPSJ3aWR0aDoxMjBweDtsZWZ0Ojc3cHgiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgdmFyICRhcGlidXR0b25fZG93bmxvYWRfYnV0dG9uID0gJCgnPGEgaWQ9ImRvd25sb2FkLWFwaSIgY2xhc3M9ImctYnV0dG9uLW1lbnUiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPuS4i+i9vTwvYT4nKTsKICAgICAgICAgICAgdmFyICRhcGlidXR0b25fbGlua19idXR0b24gPSAkKCc8YSBpZD0iaHR0cGxpbmstYXBpIiBjbGFzcz0iZy1idXR0b24tbWVudSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+5pi+56S66ZO+5o6lPC9hPicpOwogICAgICAgICAgICB2YXIgJGFwaWJ1dHRvbl9iYXRjaGh0dHBsaW5rX2J1dHRvbiA9ICQoJzxhIGlkPSJiYXRjaGh0dHBsaW5rLWFwaSIgY2xhc3M9ImctYnV0dG9uLW1lbnUiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPuaJuemHj+mTvuaOpShIVFRQKTwvYT4nKTsKICAgICAgICAgICAgdmFyICRhcGlidXR0b25fYmF0Y2hodHRwc2xpbmtfYnV0dG9uID0gJCgnPGEgaWQ9ImJhdGNoaHR0cHNsaW5rLWFwaSIgY2xhc3M9ImctYnV0dG9uLW1lbnUiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPuaJuemHj+mTvuaOpShIVFRQUyk8L2E+Jyk7CiAgICAgICAgICAgICRhcGlidXR0b25fbWVudS5hcHBlbmQoJGFwaWJ1dHRvbl9kb3dubG9hZF9idXR0b24pLmFwcGVuZCgkYXBpYnV0dG9uX2xpbmtfYnV0dG9uKS5hcHBlbmQoJGFwaWJ1dHRvbl9iYXRjaGh0dHBsaW5rX2J1dHRvbikuYXBwZW5kKCRhcGlidXR0b25fYmF0Y2hodHRwc2xpbmtfYnV0dG9uKTsKICAgICAgICAgICAgJGFwaWJ1dHRvbi5hcHBlbmQoJGFwaWJ1dHRvbl9zcGFuLmFwcGVuZCgkYXBpYnV0dG9uX2EpLmFwcGVuZCgkYXBpYnV0dG9uX21lbnUpKTsKICAgICAgICAgICAgJGFwaWJ1dHRvbi5ob3ZlcihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgJGFwaWJ1dHRvbl9zcGFuLnRvZ2dsZUNsYXNzKCdidXR0b24tb3BlbicpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGFwaWJ1dHRvbl9kb3dubG9hZF9idXR0b24uY2xpY2soZG93bmxvYWRDbGljayk7CiAgICAgICAgICAgICRhcGlidXR0b25fbGlua19idXR0b24uY2xpY2sobGlua0NsaWNrKTsKICAgICAgICAgICAgJGFwaWJ1dHRvbl9iYXRjaGh0dHBsaW5rX2J1dHRvbi5jbGljayhiYXRjaENsaWNrKTsKICAgICAgICAgICAgJGFwaWJ1dHRvbl9iYXRjaGh0dHBzbGlua19idXR0b24uY2xpY2soYmF0Y2hDbGljayk7CgogICAgICAgICAgICB2YXIgJG91dGVybGlua2J1dHRvbiA9ICQoJzxzcGFuIGNsYXNzPSJnLWJ1dHRvbi1tZW51IiBzdHlsZT0iZGlzcGxheTpibG9jayI+PC9zcGFuPicpOwogICAgICAgICAgICB2YXIgJG91dGVybGlua2J1dHRvbl9zcGFuID0gJCgnPHNwYW4gY2xhc3M9ImctZHJvcGRvd24tYnV0dG9uIGctZHJvcGRvd24tYnV0dG9uLXNlY29uZCIgbWVudWxldmVsPSIyIj48L3NwYW4+Jyk7CiAgICAgICAgICAgIHZhciAkb3V0ZXJsaW5rYnV0dG9uX2EgPSAkKCc8YSBjbGFzcz0iZy1idXR0b24iIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPjxzcGFuIGNsYXNzPSJnLWJ1dHRvbi1yaWdodCI+PHNwYW4gY2xhc3M9InRleHQiIHN0eWxlPSJ3aWR0aDphdXRvIj7lpJbpk77kuIvovb08L3NwYW4+PC9zcGFuPjwvYT4nKTsKICAgICAgICAgICAgdmFyICRvdXRlcmxpbmtidXR0b25fbWVudSA9ICQoJzxzcGFuIGNsYXNzPSJtZW51IiBzdHlsZT0id2lkdGg6MTIwcHg7bGVmdDo3OXB4Ij48L3NwYW4+Jyk7CiAgICAgICAgICAgIHZhciAkb3V0ZXJsaW5rYnV0dG9uX2Rvd25sb2FkX2J1dHRvbiA9ICQoJzxhIGlkPSJkb3dubG9hZC1vdXRlcmxpbmsiIGNsYXNzPSJnLWJ1dHRvbi1tZW51IiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7Ij7kuIvovb08L2E+Jyk7CiAgICAgICAgICAgIHZhciAkb3V0ZXJsaW5rYnV0dG9uX2xpbmtfYnV0dG9uID0gJCgnPGEgaWQ9Imxpbmstb3V0ZXJsaW5rIiBjbGFzcz0iZy1idXR0b24tbWVudSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+5pi+56S66ZO+5o6lPC9hPicpOwogICAgICAgICAgICB2YXIgJG91dGVybGlua2J1dHRvbl9iYXRjaGxpbmtfYnV0dG9uID0gJCgnPGEgaWQ9ImJhdGNobGluay1vdXRlcmxpbmsiIGNsYXNzPSJnLWJ1dHRvbi1tZW51IiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7Ij7mibnph4/pk77mjqU8L2E+Jyk7CiAgICAgICAgICAgICRvdXRlcmxpbmtidXR0b25fbWVudS5hcHBlbmQoJG91dGVybGlua2J1dHRvbl9kb3dubG9hZF9idXR0b24pLmFwcGVuZCgkb3V0ZXJsaW5rYnV0dG9uX2xpbmtfYnV0dG9uKS5hcHBlbmQoJG91dGVybGlua2J1dHRvbl9iYXRjaGxpbmtfYnV0dG9uKTsKICAgICAgICAgICAgJG91dGVybGlua2J1dHRvbi5hcHBlbmQoJG91dGVybGlua2J1dHRvbl9zcGFuLmFwcGVuZCgkb3V0ZXJsaW5rYnV0dG9uX2EpLmFwcGVuZCgkb3V0ZXJsaW5rYnV0dG9uX21lbnUpKTsKICAgICAgICAgICAgJG91dGVybGlua2J1dHRvbi5ob3ZlcihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgJG91dGVybGlua2J1dHRvbl9zcGFuLnRvZ2dsZUNsYXNzKCdidXR0b24tb3BlbicpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJG91dGVybGlua2J1dHRvbl9kb3dubG9hZF9idXR0b24uY2xpY2soZG93bmxvYWRDbGljayk7CiAgICAgICAgICAgICRvdXRlcmxpbmtidXR0b25fbGlua19idXR0b24uY2xpY2sobGlua0NsaWNrKTsKICAgICAgICAgICAgJG91dGVybGlua2J1dHRvbl9iYXRjaGxpbmtfYnV0dG9uLmNsaWNrKGJhdGNoQ2xpY2spOwoKICAgICAgICAgICAgJGRyb3Bkb3duYnV0dG9uX3NwYW4uYXBwZW5kKCRkaXJlY3RidXR0b24pLmFwcGVuZCgkYXBpYnV0dG9uKS5hcHBlbmQoJG91dGVybGlua2J1dHRvbik7CiAgICAgICAgICAgICRkcm9wZG93bmJ1dHRvbi5hcHBlbmQoJGRyb3Bkb3duYnV0dG9uX2EpLmFwcGVuZCgkZHJvcGRvd25idXR0b25fc3Bhbik7CgogICAgICAgICAgICAkZHJvcGRvd25idXR0b24uaG92ZXIoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICRkcm9wZG93bmJ1dHRvbi50b2dnbGVDbGFzcygnYnV0dG9uLW9wZW4nKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkKCdkaXYuZGVmYXVsdC1kb20gZGl2LmJhciBkaXYubGlzdC10b29scycpLmFwcGVuZCgkZHJvcGRvd25idXR0b24pOwogICAgICAgIH0KCiAgICAgICAgLy/mmoLml7bmsqHnlKgKICAgICAgICAvLyBmdW5jdGlvbiBhZGRMb2FkaW5nKCl7CiAgICAgICAgLy8gICAgIHZhciBzY3JlZW5XaWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7CiAgICAgICAgLy8gICAgIHZhciBzY3JlZW5IZWlnaHQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodDsKICAgICAgICAvLyAgICAgdmFyIGxlZnQgPSAoc2NyZWVuV2lkdGgtMTApLzI7CiAgICAgICAgLy8gICAgIHZhciB0b3AgPSBzY3JlZW5IZWlnaHQvMjsKICAgICAgICAvLyAgICAgdmFyICRsb2FkaW5nID0gJCgnPGRpdiBpZD0iZGlhbG9nLWxvYWRpbmciIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OicrbGVmdCsncHg7dG9wOicrdG9wKydweDtkaXNwbGF5Om5vbmU7ei1pbmRleDo1Mjtjb2xvcjp3aGl0ZTtmb250LXNpemU6MTZweCI+5aSE55CG5LitPC9kaXY+Jyk7CiAgICAgICAgLy8gICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRpbmcpOwogICAgICAgIC8vIH0KCiAgICAgICAgZnVuY3Rpb24gZG93bmxvYWRDbGljayhldmVudCl7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfpgInkuK3mlofku7bliJfooajvvJonLHNlbGVjdEZpbGVMaXN0KTsKICAgICAgICAgICAgdmFyIGlkID0gZXZlbnQudGFyZ2V0LmlkOwogICAgICAgICAgICB2YXIgZG93bmxvYWRMaW5rOwoKICAgICAgICAgICAgaWYoaWQgPT0gJ2Rvd25sb2FkLWRpcmVjdCcpewogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkVHlwZTsKICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCLojrflj5bpgInkuK3mlofku7blpLHotKXvvIzor7fliLfmlrDph43or5XvvIEiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdEZpbGVMaXN0WzBdLmlzZGlyID09PSAxKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZFR5cGUgPSAnYmF0Y2gnOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdEZpbGVMaXN0WzBdLmlzZGlyID09PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZFR5cGU9ICdkbGluayc7CiAgICAgICAgICAgICAgICAgICAgLy9kb3dubG9hZFR5cGUgPSBzZWxlY3RGaWxlTGlzdFswXS5pc2Rpcj09MT8nYmF0Y2gnOihzZWxlY3RGaWxlTGlzdFswXS5pc2Rpcj09PTA/J2RsaW5rJzonYmF0Y2gnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzZWxlY3RGaWxlTGlzdC5sZW5ndGggPiAxKXsKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZFR5cGUgPSAnYmF0Y2gnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmlkX2xpc3QgPSBnZXRGaWRMaXN0KHNlbGVjdEZpbGVMaXN0KTsKICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBnZXREb3dubG9hZExpbmtXaXRoUGFuQVBJKGRvd25sb2FkVHlwZSk7CiAgICAgICAgICAgICAgICBpZihyZXN1bHQuZXJybm8gPT09IDApewogICAgICAgICAgICAgICAgICAgIGlmKGRvd25sb2FkVHlwZSA9PSAnZGxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZExpbmsgPSByZXN1bHQuZGxpbmtbMF0uZGxpbms7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihkb3dubG9hZFR5cGUgPT0gJ2JhdGNoJyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkTGluayA9IHJlc3VsdC5kbGluazsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID09PSAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rID0gZG93bmxvYWRMaW5rICsgJyZ6aXBuYW1lPScgKyBlbmNvZGVVUklDb21wb25lbnQoc2VsZWN0RmlsZUxpc3RbMF0uZmlsZW5hbWUpICsgJy56aXAnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgi5Y+R55Sf6ZSZ6K+v77yBIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYocmVzdWx0LmVycm5vID09IC0xKXsKICAgICAgICAgICAgICAgICAgICBhbGVydCgn5paH5Lu25LiN5a2Y5Zyo5oiW5bey6KKr55m+5bqm5ZKM6LCQ77yM5peg5rOV5LiL6L2977yBJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfWVsc2UgaWYocmVzdWx0LmVycm5vID09IDExMil7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoIumhtemdoui/h+acn++8jOivt+WIt+aWsOmHjeivle+8gSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCLlj5HnlJ/plJnor6/vvIEiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoIuiOt+WPlumAieS4reaWh+S7tuWksei0pe+8jOivt+WIt+aWsOmHjeivle+8gSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCLor6Xmlrnms5XkuI3mlK/mjIHlpJrmlofku7bkuIvovb3vvIEiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0WzBdLmlzZGlyID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgi6K+l5pa55rOV5LiN5pSv5oyB55uu5b2V5LiL6L2977yBIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihpZCA9PSAnZG93bmxvYWQtYXBpJyl7CiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rID0gZ2V0RG93bmxvYWRMaW5rV2l0aFJFU1RBUElCYWlkdShzZWxlY3RGaWxlTGlzdFswXS5wYXRoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaWQgPT0gJ2Rvd25sb2FkLW91dGVybGluaycpewogICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBnZXREb3dubG9hZExpbmtXaXRoQ2xpZW50QVBJKHNlbGVjdEZpbGVMaXN0WzBdLnBhdGgpOwogICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5lcnJubyA9PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rID0gcmVzdWx0LnVybHNbMF0udXJsOwogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHJlc3VsdC5lcnJubyA9PSAxKXsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ+aWh+S7tuS4jeWtmOWcqO+8gScpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYocmVzdWx0LmVycm5vID09IDIpewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5paH5Lu25LiN5a2Y5Zyo5oiW6ICF5bey6KKr55m+5bqm5ZKM6LCQ77yM5peg5rOV5LiL6L2977yBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ+WPkeeUn+mUmeivr++8gScpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4ZWNEb3dubG9hZChkb3dubG9hZExpbmspOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbGlua0NsaWNrKGV2ZW50KXsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+mAieS4reaWh+S7tuWIl+ihqO+8micsc2VsZWN0RmlsZUxpc3QpOwogICAgICAgICAgICB2YXIgaWQgPSBldmVudC50YXJnZXQuaWQ7CiAgICAgICAgICAgIHZhciBsaW5rTGlzdCx0aXA7CgogICAgICAgICAgICBpZihpZC5pbmRleE9mKCdkaXJlY3QnKSAhPSAtMSl7CiAgICAgICAgICAgICAgICB2YXIgZG93bmxvYWRUeXBlOwogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkTGluazsKICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCLojrflj5bpgInkuK3mlofku7blpLHotKXvvIzor7fliLfmlrDph43or5XvvIEiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdEZpbGVMaXN0WzBdLmlzZGlyID09PSAxKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZFR5cGUgPSAnYmF0Y2gnOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdEZpbGVMaXN0WzBdLmlzZGlyID09PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZFR5cGU9ICdkbGluayc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID4gMSl7CiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRUeXBlID0gJ2JhdGNoJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpZF9saXN0ID0gZ2V0RmlkTGlzdChzZWxlY3RGaWxlTGlzdCk7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZ2V0RG93bmxvYWRMaW5rV2l0aFBhbkFQSShkb3dubG9hZFR5cGUpOwogICAgICAgICAgICAgICAgaWYocmVzdWx0LmVycm5vID09PSAwKXsKICAgICAgICAgICAgICAgICAgICBpZihkb3dubG9hZFR5cGUgPT0gJ2RsaW5rJykKICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rID0gcmVzdWx0LmRsaW5rWzBdLmRsaW5rOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoZG93bmxvYWRUeXBlID09ICdiYXRjaCcpewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RGaWxlTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkTGluayA9IHJlc3VsdC5kbGluazsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID09PSAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rID0gZG93bmxvYWRMaW5rICsgJyZ6aXBuYW1lPScgKyBlbmNvZGVVUklDb21wb25lbnQoc2VsZWN0RmlsZUxpc3RbMF0uZmlsZW5hbWUpICsgJy56aXAnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgi5Y+R55Sf6ZSZ6K+v77yBIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihyZXN1bHQuZXJybm8gPT0gLTEpewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfmlofku7bkuI3lrZjlnKjmiJblt7Looqvnmb7luqblkozosJDvvIzml6Dms5XkuIvovb3vvIEnKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9ZWxzZSBpZihyZXN1bHQuZXJybm8gPT0gMTEyKXsKICAgICAgICAgICAgICAgICAgICBhbGVydCgi6aG16Z2i6L+H5pyf77yM6K+35Yi35paw6YeN6K+V77yBIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoIuWPkeeUn+mUmeivr++8gSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBodHRwbGluayA9IGRvd25sb2FkTGluay5yZXBsYWNlKC9eKFtBLVphLXpdKyk6LywnaHR0cDonKTsKICAgICAgICAgICAgICAgIHZhciBodHRwc2xpbmsgPSBkb3dubG9hZExpbmsucmVwbGFjZSgvXihbQS1aYS16XSspOi8sJ2h0dHBzOicpOwogICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gJyc7CiAgICAgICAgICAgICAgICAkLmVhY2goc2VsZWN0RmlsZUxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZWxlbWVudC5maWxlbmFtZTsKICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCA9PTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGVsZW1lbnQuZmlsZW5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZmlsZW5hbWUgKyAnLCcgKyBlbGVtZW50LmZpbGVuYW1lOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbGlua0xpc3QgPSB7CiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgdXJsczpbCiAgICAgICAgICAgICAgICAgICAgICAgIHt1cmw6aHR0cGxpbmsscmFuazoxfSwKICAgICAgICAgICAgICAgICAgICAgICAge3VybDpodHRwc2xpbmsscmFuazoyfQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aXAgPSAn5pi+56S65qih5ouf55m+5bqm572R55uY572R6aG16I635Y+W55qE6ZO+5o6l77yM5Y+v5Lul5L2/55So5Y+z6ZSu6L+F6Zu35LiL6L2977yM5aSN5Yi25Yiw5LiL6L295bel5YW36ZyA6KaB5Lyg6YCSY29va2ll77yM5aSa5paH5Lu25omT5YyF5LiL6L2955qE6ZO+5o6l5Y+v5Lul55u05o6l5aSN5Yi25L2/55SoJzsKICAgICAgICAgICAgICAgIGRpYWxvZy5vcGVuKHt0aXRsZTon5LiL6L296ZO+5o6lJyx0eXBlOidsaW5rJyxsaXN0OmxpbmtMaXN0LHRpcDp0aXB9KTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBpZihzZWxlY3RGaWxlTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgi6I635Y+W6YCJ5Lit5paH5Lu25aSx6LSl77yM6K+35Yi35paw6YeN6K+V77yBIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RGaWxlTGlzdC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoIuivpeaWueazleS4jeaUr+aMgeWkmuaWh+S7tuS4i+i9ve+8gSIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3RbMF0uaXNkaXIgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCLor6Xmlrnms5XkuI3mlK/mjIHnm67lvZXkuIvovb3vvIEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGlkLmluZGV4T2YoJ2FwaScpICE9IC0xKXsKICAgICAgICAgICAgICAgICAgICB2YXIgZG93bmxvYWRMaW5rID0gZ2V0RG93bmxvYWRMaW5rV2l0aFJFU1RBUElCYWlkdShzZWxlY3RGaWxlTGlzdFswXS5wYXRoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaHR0cGxpbmsgPSBkb3dubG9hZExpbmsucmVwbGFjZSgvXihbQS1aYS16XSspOi8sJ2h0dHA6Jyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGh0dHBzbGluayA9IGRvd25sb2FkTGluay5yZXBsYWNlKC9eKFtBLVphLXpdKyk6LywnaHR0cHM6Jyk7CiAgICAgICAgICAgICAgICAgICAgbGlua0xpc3QgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOnNlbGVjdEZpbGVMaXN0WzBdLmZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICB1cmxzOlsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt1cmw6aHR0cGxpbmsscmFuazoxfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt1cmw6aHR0cHNsaW5rLHJhbms6Mn0KICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaHR0cGxpbmsgPSBodHRwbGluay5yZXBsYWNlKCcyNTA1MjgnLCcyNjY3MTknKTsKICAgICAgICAgICAgICAgICAgICBodHRwc2xpbmsgPSBodHRwc2xpbmsucmVwbGFjZSgnMjUwNTI4JywnMjY2NzE5Jyk7CiAgICAgICAgICAgICAgICAgICAgbGlua0xpc3QudXJscy5wdXNoKHt1cmw6aHR0cGxpbmsscmFuazozfSk7CiAgICAgICAgICAgICAgICAgICAgbGlua0xpc3QudXJscy5wdXNoKHt1cmw6aHR0cHNsaW5rLHJhbms6NH0pOwogICAgICAgICAgICAgICAgICAgIHRpcCA9ICfmmL7npLrmqKHmi59BUFDojrflj5bnmoTpk77mjqUo5L2/55So55m+5bqm5LqRSUQp77yM5Y+v5Lul5L2/55So5Y+z6ZSu6L+F6Zu35LiL6L2977yM5aSN5Yi25Yiw5LiL6L295bel5YW36ZyA6KaB5Lyg6YCSY29va2llJzsKICAgICAgICAgICAgICAgICAgICBkaWFsb2cub3Blbih7dGl0bGU6J+S4i+i9vemTvuaOpScsdHlwZTonbGluaycsbGlzdDpsaW5rTGlzdCx0aXA6dGlwfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlkLmluZGV4T2YoJ291dGVybGluaycpICE9IC0xKXsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZ2V0RG93bmxvYWRMaW5rV2l0aENsaWVudEFQSShzZWxlY3RGaWxlTGlzdFswXS5wYXRoKTsKICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZXJybm8gPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtMaXN0ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6c2VsZWN0RmlsZUxpc3RbMF0uZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxzOnJlc3VsdC51cmxzCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYocmVzdWx0LmVycm5vID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5paH5Lu25LiN5a2Y5Zyo77yBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihyZXN1bHQuZXJybm8gPT0gMil7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfmlofku7bkuI3lrZjlnKjmiJbogIXlt7Looqvnmb7luqblkozosJDvvIzml6Dms5XkuIvovb3vvIEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5Y+R55Sf6ZSZ6K+v77yBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGlwID0gJ+aYvuekuuaooeaLn+eZvuW6pue9keebmOWuouaIt+err+iOt+WPlueahOmTvuaOpe+8jOWPr+S7peebtOaOpeWkjeWItuWIsOS4i+i9veW3peWFt+S9v+eUqO+8jOS4jemcgOimgWNvb2tpZSc7CiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLm9wZW4oe3RpdGxlOifkuIvovb3pk77mjqUnLHR5cGU6J2xpbmsnLGxpc3Q6bGlua0xpc3QsdGlwOnRpcCxzaG93Y29weTp0cnVlLHNob3dlZGl0OnRydWV9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvL2RpYWxvZy5vcGVuKHt0aXRsZTon5LiL6L296ZO+5o6lJyx0eXBlOidsaW5rJyxsaXN0OmxpbmtMaXN0LHRpcDp0aXB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGJhdGNoQ2xpY2soZXZlbnQpewogICAgICAgICAgICBjb25zb2xlLmxvZygn6YCJ5Lit5paH5Lu25YiX6KGo77yaJyxzZWxlY3RGaWxlTGlzdCk7CiAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgICAgICBhbGVydCgn6I635Y+W6YCJ5Lit5paH5Lu25aSx6LSl77yM6K+35Yi35paw6YeN6K+V77yBJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGlkID0gZXZlbnQudGFyZ2V0LmlkOwogICAgICAgICAgICB2YXIgbGlua1R5cGUsdGlwOwogICAgICAgICAgICBsaW5rVHlwZSA9IGlkLmluZGV4T2YoJ2h0dHBzJykgPT0gLTEgPyAoaWQuaW5kZXhPZignaHR0cCcpID09IC0xID8gbG9jYXRpb24ucHJvdG9jb2wrJzonIDogJ2h0dHA6JykgOiAnaHR0cHM6JzsKICAgICAgICAgICAgYmF0Y2hMaW5rTGlzdCA9IFtdOwogICAgICAgICAgICBiYXRjaExpbmtMaXN0QWxsID0gW107CiAgICAgICAgICAgIGlmKGlkLmluZGV4T2YoJ2RpcmVjdCcpICE9IC0xKXsKICAgICAgICAgICAgICAgIGJhdGNoTGlua0xpc3QgPSBnZXREaXJlY3RCYXRjaExpbmsobGlua1R5cGUpOwogICAgICAgICAgICAgICAgdGlwID0gJ+aYvuekuuaJgOaciemAieS4reaWh+S7tueahOebtOaOpeS4i+i9vemTvuaOpe+8jOaWh+S7tuWkueaYvuekuuS4uuaJk+WMheS4i+i9veeahOmTvuaOpSc7CiAgICAgICAgICAgICAgICBpZihiYXRjaExpbmtMaXN0Lmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ+ayoeaciemTvuaOpeWPr+S7peaYvuekuu+8jEFQSemTvuaOpeS4jeimgeWFqOmDqOmAieS4reaWh+S7tuWkue+8gScpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRpYWxvZy5vcGVuKHt0aXRsZTon5om56YeP6ZO+5o6lJyx0eXBlOidiYXRjaCcsbGlzdDpiYXRjaExpbmtMaXN0LHRpcDp0aXAsc2hvd2NvcHk6dHJ1ZX0pOwogICAgICAgICAgICB9IGVsc2UgaWYoaWQuaW5kZXhPZignYXBpJykgIT0gLTEpewogICAgICAgICAgICAgICAgYmF0Y2hMaW5rTGlzdCA9IGdldEFQSUJhdGNoTGluayhsaW5rVHlwZSk7CiAgICAgICAgICAgICAgICB0aXAgPSAn5pi+56S65omA5pyJ6YCJ5Lit5paH5Lu255qEQVBJ5LiL6L296ZO+5o6l77yM5LiN5pi+56S65paH5Lu25aS5JzsKICAgICAgICAgICAgICAgIGlmKGJhdGNoTGlua0xpc3QubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgICAgICAgICBhbGVydCgn5rKh5pyJ6ZO+5o6l5Y+v5Lul5pi+56S677yMQVBJ6ZO+5o6l5LiN6KaB5YWo6YOo6YCJ5Lit5paH5Lu25aS577yBJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGlhbG9nLm9wZW4oe3RpdGxlOifmibnph4/pk77mjqUnLHR5cGU6J2JhdGNoJyxsaXN0OmJhdGNoTGlua0xpc3QsdGlwOnRpcCxzaG93Y29weTp0cnVlfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZihpZC5pbmRleE9mKCdvdXRlcmxpbmsnKSAhPSAtMSl7CiAgICAgICAgICAgICAgICBiYXRjaExpbmtMaXN0QWxsID0gZ2V0T3V0ZXJsaW5rQmF0Y2hMaW5rQWxsKCk7CiAgICAgICAgICAgICAgICBiYXRjaExpbmtMaXN0ID0gZ2V0T3V0ZXJsaW5rQmF0Y2hMaW5rRmlyc3QoYmF0Y2hMaW5rTGlzdEFsbCk7CiAgICAgICAgICAgICAgICB0aXAgPSAn5pi+56S65omA5pyJ6YCJ5Lit5paH5Lu255qE5aSW6YOo5LiL6L296ZO+5o6l77yM5LiN5pi+56S65paH5Lu25aS5JzsKICAgICAgICAgICAgICAgIGlmKGJhdGNoTGlua0xpc3QubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgICAgICAgICBhbGVydCgn5rKh5pyJ6ZO+5o6l5Y+v5Lul5pi+56S677yMQVBJ6ZO+5o6l5LiN6KaB5YWo6YOo6YCJ5Lit5paH5Lu25aS577yBJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRpYWxvZy5vcGVuKHt0aXRsZTon5om56YeP6ZO+5o6lJyx0eXBlOidiYXRjaCcsbGlzdDpiYXRjaExpbmtMaXN0LHRpcDp0aXAsc2hvd2NvcHk6dHJ1ZSxhbGxsaXN0OmJhdGNoTGlua0xpc3RBbGwsc2hvd2FsbDp0cnVlfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vZGlhbG9nLm9wZW4oe3RpdGxlOifmibnph4/pk77mjqUnLHR5cGU6J2JhdGNoJyxsaXN0OmJhdGNoTGlua0xpc3QsdGlwOnRpcCxzaG93Y29weTp0cnVlfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXREaXJlY3RCYXRjaExpbmsobGlua1R5cGUpewogICAgICAgICAgICB2YXIgbGlzdCA9IFtdOwogICAgICAgICAgICAkLmVhY2goc2VsZWN0RmlsZUxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICB2YXIgZG93bmxvYWRUeXBlLGRvd25sb2FkTGluayxyZXN1bHQ7CiAgICAgICAgICAgICAgICBpZihlbGVtZW50LmlzZGlyID09IDApCiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRUeXBlID0gJ2RsaW5rJzsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZFR5cGUgPSAnYmF0Y2gnOwogICAgICAgICAgICAgICAgZmlkX2xpc3QgPSBnZXRGaWRMaXN0KFtlbGVtZW50XSk7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBnZXREb3dubG9hZExpbmtXaXRoUGFuQVBJKGRvd25sb2FkVHlwZSk7CiAgICAgICAgICAgICAgICBpZihyZXN1bHQuZXJybm8gPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgaWYoZG93bmxvYWRUeXBlID09ICdkbGluaycpCiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkTGluayA9IHJlc3VsdC5kbGlua1swXS5kbGluazsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGRvd25sb2FkVHlwZSA9PSAnYmF0Y2gnKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZExpbmsgPSByZXN1bHQuZGxpbms7CiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRMaW5rID0gZG93bmxvYWRMaW5rLnJlcGxhY2UoL14oW0EtWmEtel0rKTovLGxpbmtUeXBlKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGRvd25sb2FkTGluayA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsaXN0LnB1c2goe2ZpbGVuYW1lOmVsZW1lbnQuZmlsZW5hbWUsZG93bmxvYWRsaW5rOmRvd25sb2FkTGlua30pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGxpc3Q7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRBUElCYXRjaExpbmsobGlua1R5cGUpewogICAgICAgICAgICB2YXIgbGlzdCA9IFtdOwogICAgICAgICAgICAkLmVhY2goc2VsZWN0RmlsZUxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICBpZihlbGVtZW50LmlzZGlyID09IDEpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkTGluazsKICAgICAgICAgICAgICAgIGRvd25sb2FkTGluayA9IGdldERvd25sb2FkTGlua1dpdGhSRVNUQVBJQmFpZHUoZWxlbWVudC5wYXRoKTsKICAgICAgICAgICAgICAgIGRvd25sb2FkTGluayA9IGRvd25sb2FkTGluay5yZXBsYWNlKC9eKFtBLVphLXpdKyk6LyxsaW5rVHlwZSk7CiAgICAgICAgICAgICAgICBsaXN0LnB1c2goe2ZpbGVuYW1lOmVsZW1lbnQuZmlsZW5hbWUsZG93bmxvYWRsaW5rOmRvd25sb2FkTGlua30pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGxpc3Q7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRPdXRlcmxpbmtCYXRjaExpbmtBbGwoKXsKICAgICAgICAgICAgdmFyIGxpc3QgPSBbXTsKICAgICAgICAgICAgJC5lYWNoKHNlbGVjdEZpbGVMaXN0LGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQuaXNkaXIgPT0gMSkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICByZXN1bHQgPSBnZXREb3dubG9hZExpbmtXaXRoQ2xpZW50QVBJKGVsZW1lbnQucGF0aCk7CiAgICAgICAgICAgICAgICBpZihyZXN1bHQuZXJybm8gPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgLy9kb3dubG9hZExpbmsgPSByZXN1bHQudXJsc1swXS51cmw7CiAgICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKHtmaWxlbmFtZTplbGVtZW50LmZpbGVuYW1lLGxpbmtzOnJlc3VsdC51cmxzfSk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAvL2Rvd25sb2FkTGluayA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKHtmaWxlbmFtZTplbGVtZW50LmZpbGVuYW1lLGxpbmtzOlt7cmFuazoxLHVybDonZXJyb3InfV19KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vbGlzdC5wdXNoKHtmaWxlbmFtZTplbGVtZW50LmZpbGVuYW1lLGRvd25sb2FkbGluazpkb3dubG9hZExpbmt9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBsaXN0OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0T3V0ZXJsaW5rQmF0Y2hMaW5rRmlyc3QobGlzdCl7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICAgICAgJC5lYWNoKGxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7ZmlsZW5hbWU6ZWxlbWVudC5maWxlbmFtZSxkb3dubG9hZGxpbms6ZWxlbWVudC5saW5rc1swXS51cmx9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRTaWduKCl7CiAgICAgICAgICAgIHZhciBzaWduRm5jOwogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICBzaWduRm5jID0gbmV3IEZ1bmN0aW9uKCJyZXR1cm4gIiArIHl1bkRhdGEuc2lnbjIpKCk7CiAgICAgICAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZS5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYmFzZTY0RW5jb2RlKHNpZ25GbmMoeXVuRGF0YS5zaWduNSx5dW5EYXRhLnNpZ24xKSk7CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPluW9k+WJjeebruW9lQogICAgICAgIGZ1bmN0aW9uIGdldFBhdGgoKXsKICAgICAgICAgICAgdmFyIGhhc2ggPSBsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICB2YXIgcmVneCA9IC8oXnwmfFwvKXBhdGg9KFteJl0qKSgmfCQpL2k7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBoYXNoLm1hdGNoKHJlZ3gpOwogICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdFsyXSk7CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPluWIhuexu+aYvuekuueahOexu+WIq++8jOWNs+WcsOWdgOagj+S4reeahHR5cGUKICAgICAgICBmdW5jdGlvbiBnZXRDYXRlZ29yeSgpewogICAgICAgICAgICB2YXIgaGFzaCA9IGxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgIHZhciByZWd4ID0gLyhefCZ8XC8pdHlwZT0oW14mXSopKCZ8JCkvaTsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGhhc2gubWF0Y2gocmVneCk7CiAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0WzJdKTsKICAgICAgICB9CgogICAgICAgIC8v6I635Y+W5b2T5YmN6aG16Z2iKGxpc3TmiJbogIVjYXRlZ29yeSkKICAgICAgICBmdW5jdGlvbiBnZXRDdXJyZW50UGFnZSgpewogICAgICAgICAgICB2YXIgaGFzaCA9IGxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaGFzaC5zdWJzdHJpbmcoaGFzaC5pbmRleE9mKCcjJykrMSxoYXNoLmluZGV4T2YoJy8nKSkpOwogICAgICAgIH0KCiAgICAgICAgLy/ojrflj5bmlofku7bliJfooagKICAgICAgICBmdW5jdGlvbiBnZXRGaWxlTGlzdCgpewogICAgICAgICAgICB2YXIgZmlsZWxpc3QgPSBbXTsKICAgICAgICAgICAgdmFyIGxpc3RVcmwgPSBwYW5BUElVcmwgKyAibGlzdCI7CiAgICAgICAgICAgIHZhciBwYXRoID0gZ2V0UGF0aCgpOwogICAgICAgICAgICBsb2dpZCA9IGdldExvZ0lEKCk7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICAgICAgICBkaXI6cGF0aCwKICAgICAgICAgICAgICAgIGJkc3Rva2VuOmJkc3Rva2VuLAogICAgICAgICAgICAgICAgbG9naWQ6bG9naWQsCiAgICAgICAgICAgICAgICBvcmRlcjonc2l6ZScsCiAgICAgICAgICAgICAgICBkZXNjOjAsCiAgICAgICAgICAgICAgICBjbGllbnR0eXBlOjAsCiAgICAgICAgICAgICAgICBzaG93ZW1wdHk6MCwKICAgICAgICAgICAgICAgIHdlYjoxLAogICAgICAgICAgICAgICAgY2hhbm5lbDonY2h1bmxlaScsCiAgICAgICAgICAgICAgICBhcHBpZDoyNTA1MjgKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDpsaXN0VXJsLAogICAgICAgICAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgICAgICAgICBtZXRob2Q6J0dFVCcsCiAgICAgICAgICAgICAgICBkYXRhOnBhcmFtcywKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpewogICAgICAgICAgICAgICAgICAgIGZpbGVsaXN0ID0gMD09PXJlc3BvbnNlLmVycm5vID8gcmVzcG9uc2UubGlzdCA6IFtdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGZpbGVsaXN0OwogICAgICAgIH0KCiAgICAgICAgLy/ojrflj5bliIbnsbvpobXpnaLkuIvnmoTmlofku7bliJfooagKICAgICAgICBmdW5jdGlvbiBnZXRDYXRlZ29yeUZpbGVMaXN0KCl7CiAgICAgICAgICAgIHZhciBmaWxlbGlzdCA9IFtdOwogICAgICAgICAgICB2YXIgbGlzdFVybCA9IHBhbkFQSVVybCArICJjYXRlZ29yeWxpc3QiOwogICAgICAgICAgICB2YXIgY2F0ZWdvcnkgPSBnZXRDYXRlZ29yeSgpOwogICAgICAgICAgICBsb2dpZCA9IGdldExvZ0lEKCk7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICAgICAgICBjYXRlZ29yeTpjYXRlZ29yeSwKICAgICAgICAgICAgICAgIGJkc3Rva2VuOmJkc3Rva2VuLAogICAgICAgICAgICAgICAgbG9naWQ6bG9naWQsCiAgICAgICAgICAgICAgICBvcmRlcjonc2l6ZScsCiAgICAgICAgICAgICAgICBkZXNjOjAsCiAgICAgICAgICAgICAgICBjbGllbnR0eXBlOjAsCiAgICAgICAgICAgICAgICBzaG93ZW1wdHk6MCwKICAgICAgICAgICAgICAgIHdlYjoxLAogICAgICAgICAgICAgICAgY2hhbm5lbDonY2h1bmxlaScsCiAgICAgICAgICAgICAgICBhcHBpZDoyNTA1MjgKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDpsaXN0VXJsLAogICAgICAgICAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgICAgICAgICBtZXRob2Q6J0dFVCcsCiAgICAgICAgICAgICAgICBkYXRhOnBhcmFtcywKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpewogICAgICAgICAgICAgICAgICAgIGZpbGVsaXN0ID0gMD09PXJlc3BvbnNlLmVycm5vID8gcmVzcG9uc2UuaW5mbyA6IFtdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGZpbGVsaXN0OwogICAgICAgIH0KCiAgICAgICAgLy/nlJ/miJDkuIvovb3ml7bnmoRmaWRfbGlzdOWPguaVsAogICAgICAgIGZ1bmN0aW9uIGdldEZpZExpc3QobGlzdCl7CiAgICAgICAgICAgIHZhciBmaWRsaXN0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHZhciBmaWxlaWRsaXN0ID0gW107CiAgICAgICAgICAgICQuZWFjaChsaXN0LGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgZmlsZWlkbGlzdC5wdXNoKGVsZW1lbnQuZnNfaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZmlkbGlzdCA9ICdbJyArIGZpbGVpZGxpc3QgKyAnXSc7CiAgICAgICAgICAgIHJldHVybiBmaWRsaXN0OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0VGltZXN0YW1wKCl7CiAgICAgICAgICAgIHJldHVybiB5dW5EYXRhLnRpbWVzdGFtcDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEJEU3Rva2VuKCl7CiAgICAgICAgICAgIHJldHVybiB5dW5EYXRhLk1ZQkRTVE9LRU47CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPluebtOaOpeS4i+i9veWcsOWdgAogICAgICAgIC8v6L+Z5Liq5Zyw5Z2A5LiN5piv55u05o6l5LiL6L295Zyw5Z2A77yM6K6/6Zeu6L+Z5Liq5Zyw5Z2A5Lya6L+U5ZueMzAy77yMcmVzcG9uc2UgaGVhZGVy5Lit55qEbG9jYXRpb27miY3mmK/nnJ/lrp7kuIvovb3lnLDlnYAKICAgICAgICAvL+aaguaXtuayoeacieaJvuWIsOaPkOWPluaWueazlQogICAgICAgIGZ1bmN0aW9uIGdldERvd25sb2FkTGlua1dpdGhQYW5BUEkodHlwZSl7CiAgICAgICAgICAgIHZhciBkb3dubG9hZFVybCA9IHBhbkFQSVVybCArICJkb3dubG9hZCI7CiAgICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICAgIGxvZ2lkID0gZ2V0TG9nSUQoKTsKICAgICAgICAgICAgdmFyIHBhcmFtcz0gewogICAgICAgICAgICAgICAgc2lnbjpzaWduLAogICAgICAgICAgICAgICAgdGltZXN0YW1wOnRpbWVzdGFtcCwKICAgICAgICAgICAgICAgIGZpZGxpc3Q6ZmlkX2xpc3QsCiAgICAgICAgICAgICAgICB0eXBlOnR5cGUsCiAgICAgICAgICAgICAgICBjaGFubmVsOidjaHVubGVpJywKICAgICAgICAgICAgICAgIHdlYjoxLAogICAgICAgICAgICAgICAgYXBwX2lkOjI1MDUyOCwKICAgICAgICAgICAgICAgIGJkc3Rva2VuOmJkc3Rva2VuLAogICAgICAgICAgICAgICAgbG9naWQ6bG9naWQsCiAgICAgICAgICAgICAgICBjbGllbnR0eXBlOjAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDpkb3dubG9hZFVybCwKICAgICAgICAgICAgICAgIGFzeW5jOmZhbHNlLAogICAgICAgICAgICAgICAgbWV0aG9kOidHRVQnLAogICAgICAgICAgICAgICAgZGF0YTpwYXJhbXMsCiAgICAgICAgICAgICAgICBzdWNjZXNzOmZ1bmN0aW9uKHJlc3BvbnNlKXsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXREb3dubG9hZExpbmtXaXRoUkVTVEFQSUJhaWR1KHBhdGgpewogICAgICAgICAgICB2YXIgbGluayA9IHJlc3RBUElVcmwgKyAnZmlsZT9tZXRob2Q9ZG93bmxvYWQmYXBwX2lkPTI1MDUyOCZwYXRoPScgKyBlbmNvZGVVUklDb21wb25lbnQocGF0aCk7CiAgICAgICAgICAgIHJldHVybiBsaW5rOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RG93bmxvYWRMaW5rV2l0aFJFU1RBUElFUyhwYXRoKXsKICAgICAgICAgICAgdmFyIGxpbmsgPSByZXN0QVBJVXJsICsgJ2ZpbGU/bWV0aG9kPWRvd25sb2FkJmFwcF9pZD0yNjY3MTkmcGF0aD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHBhdGgpOwogICAgICAgICAgICByZXR1cm4gbGluazsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldERvd25sb2FkTGlua1dpdGhDbGllbnRBUEkocGF0aCl7CiAgICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICAgIHZhciB1cmwgPSBjbGllbnRBUElVcmwgKyAnZmlsZT9tZXRob2Q9bG9jYXRlZG93bmxvYWQmYXBwX2lkPTI1MDUyOCZ2ZXI9NC4wJnBhdGg9JyArIGVuY29kZVVSSUNvbXBvbmVudChwYXRoKTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDp1cmwsCiAgICAgICAgICAgICAgICBtZXRob2Q6J1BPU1QnLAogICAgICAgICAgICAgICAgeGhyRmllbGRzOiB7CiAgICAgICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOmZ1bmN0aW9uKHJlc3BvbnNlKXsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOnsKICAgICAgICAgICAgICAgICAgICA0MDQ6ZnVuY3Rpb24ocmVzcG9uc2UpewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXNwb25zZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZihyZXN1bHQpewogICAgICAgICAgICAgICAgaWYocmVzdWx0LmVycm9yX2NvZGUgPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQudXJscyA9PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJybm8gPSAyOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0LnVybHMsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQudXJsc1tpbmRleF0udXJsID0gZWxlbWVudC51cmwucmVwbGFjZSgnXFwnLCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5lcnJubyA9IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWVsc2UgaWYocmVzdWx0LmVycm9yX2NvZGUgPT0gMzEwNjYpewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5lcnJubyA9IDE7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJybm8gPSAtMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZXN1bHQgPSB7fTsKICAgICAgICAgICAgICAgIHJlc3VsdC5lcnJubyA9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleGVjRG93bmxvYWQobGluayl7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCLkuIvovb3pk77mjqXvvJoiK2xpbmspOwogICAgICAgICAgICAkKCcjaGVscGVyZG93bmxvYWRpZnJhbWUnKS5hdHRyKCdzcmMnLGxpbmspOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSWZyYW1lKCl7CiAgICAgICAgICAgIHZhciAkZGl2ID0gJCgnPGRpdiBjbGFzcz0iaGVscGVyLWhpZGUiIHN0eWxlPSJwYWRkaW5nOjA7bWFyZ2luOjA7ZGlzcGxheTpibG9jayI+PC9kaXY+Jyk7CiAgICAgICAgICAgIHZhciAkaWZyYW1lID0gJCgnPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6dm9pZCgwKSIgaWQ9ImhlbHBlcmRvd25sb2FkaWZyYW1lIiBzdHlsZT0iZGlzcGxheTpub25lIj48L2lmcmFtZT4nKTsKICAgICAgICAgICAgJGRpdi5hcHBlbmQoJGlmcmFtZSk7CiAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGRpdik7CgogICAgICAgIH0KICAgIH0KCiAgICAvL+WIhuS6q+mhtemdoueahOS4i+i9veWKqeaJiwogICAgZnVuY3Rpb24gUGFuU2hhcmVIZWxwZXIoKXsKICAgICAgICB2YXIgeXVuRGF0YSxzaWduLHRpbWVzdGFtcCxiZHN0b2tlbixjaGFubmVsLGNsaWVudHR5cGUsd2ViLGFwcF9pZCxsb2dpZCxlbmNyeXB0LHByb2R1Y3QsdWsscHJpbWFyeWlkLGZpZF9saXN0LGV4dHJhLHNoYXJlaWQ7CiAgICAgICAgdmFyIHZjb2RlOwogICAgICAgIHZhciBzaGFyZVR5cGUsYnV0dG9uVGFyZ2V0LGN1cnJlbnRQYXRoLGxpc3RfZ3JpZF9zdGF0dXMsb2JzZXJ2ZXIsZGlhbG9nLHZjb2RlRGlhbG9nOwogICAgICAgIHZhciBmaWxlTGlzdD1bXSxzZWxlY3RGaWxlTGlzdD1bXTsKICAgICAgICB2YXIgcGFuQVBJVXJsID0gbG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgbG9jYXRpb24uaG9zdCArICIvYXBpLyI7CiAgICAgICAgdmFyIHNoYXJlTGlzdFVybCA9IGxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGxvY2F0aW9uLmhvc3QgKyAiL3NoYXJlL2xpc3QiOwoKICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbigpewogICAgICAgICAgICB5dW5EYXRhID0gdW5zYWZlV2luZG93Lnl1bkRhdGE7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd5dW5EYXRhOicseXVuRGF0YSk7CiAgICAgICAgICAgIGlmKHl1bkRhdGEgPT09IHVuZGVmaW5lZCB8fCB5dW5EYXRhLkZJTEVJTkZPID09IG51bGwpewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+mhtemdouacquato+W4uOWKoOi9ve+8jOaIluiAheeZvuW6puW3sue7j+abtOaWsO+8gScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluaXRQYXJhbXMoKTsKICAgICAgICAgICAgYWRkQnV0dG9uKCk7CiAgICAgICAgICAgIGRpYWxvZyA9IG5ldyBEaWFsb2coe2FkZENvcHk6ZmFsc2V9KTsKICAgICAgICAgICAgdmNvZGVEaWFsb2cgPSBuZXcgVkNvZGVEaWFsb2cocmVmcmVzaFZDb2RlLGNvbmZpcm1DbGljayk7CiAgICAgICAgICAgIGNyZWF0ZUlmcmFtZSgpOwoKICAgICAgICAgICAgaWYoIWlzU2luZ2xlU2hhcmUoKSl7CiAgICAgICAgICAgICAgICByZWdpc3RlckV2ZW50TGlzdGVuZXIoKTsKICAgICAgICAgICAgICAgIGNyZWF0ZU9ic2VydmVyKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfliIbkuqvnm7TmjqXkuIvovb3liqDovb3miJDlip8hJyk7CiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdFBhcmFtcygpewogICAgICAgICAgICBzaGFyZVR5cGUgPSBnZXRTaGFyZVR5cGUoKTsKICAgICAgICAgICAgc2lnbiA9IHl1bkRhdGEuU0lHTjsKICAgICAgICAgICAgdGltZXN0YW1wID0geXVuRGF0YS5USU1FU1RBTVA7CiAgICAgICAgICAgIGJkc3Rva2VuID0geXVuRGF0YS5NWUJEU1RPS0VOOwogICAgICAgICAgICBjaGFubmVsID0gJ2NodW5sZWknOwogICAgICAgICAgICBjbGllbnR0eXBlID0gMDsKICAgICAgICAgICAgd2ViID0gMTsKICAgICAgICAgICAgYXBwX2lkID0gMjUwNTI4OwogICAgICAgICAgICBsb2dpZCA9IGdldExvZ0lEKCk7CiAgICAgICAgICAgIGVuY3J5cHQgPSAwOwogICAgICAgICAgICBwcm9kdWN0ID0gJ3NoYXJlJzsKICAgICAgICAgICAgcHJpbWFyeWlkID0geXVuRGF0YS5TSEFSRV9JRDsKICAgICAgICAgICAgdWsgPSB5dW5EYXRhLlNIQVJFX1VLOwoKICAgICAgICAgICAgaWYoc2hhcmVUeXBlID09ICdzZWNyZXQnKXsKICAgICAgICAgICAgICAgIGV4dHJhID0gZ2V0RXh0cmEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihpc1NpbmdsZVNoYXJlKCkpewogICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OwogICAgICAgICAgICAgICAgaWYoeXVuRGF0YS5DQVRFR09SWSA9PSAyKXsKICAgICAgICAgICAgICAgICAgICBvYmouZmlsZW5hbWUgPSB5dW5EYXRhLkZJTEVOQU1FOwogICAgICAgICAgICAgICAgICAgIG9iai5wYXRoID0geXVuRGF0YS5QQVRIOwogICAgICAgICAgICAgICAgICAgIG9iai5mc19pZCA9IHl1bkRhdGEuRlNfSUQ7CiAgICAgICAgICAgICAgICAgICAgb2JqLmlzZGlyID0gMDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb2JqLmZpbGVuYW1lID0geXVuRGF0YS5GSUxFSU5GT1swXS5zZXJ2ZXJfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYXRoID0geXVuRGF0YS5GSUxFSU5GT1swXS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICBvYmouZnNfaWQgPSB5dW5EYXRhLkZJTEVJTkZPWzBdLmZzX2lkLAogICAgICAgICAgICAgICAgICAgICAgICBvYmouaXNkaXIgPXl1bkRhdGEuRklMRUlORk9bMF0uaXNkaXIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGVjdEZpbGVMaXN0LnB1c2gob2JqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNoYXJlaWQgPSB5dW5EYXRhLlNIQVJFX0lEOwogICAgICAgICAgICAgICAgY3VycmVudFBhdGggPSBnZXRQYXRoKCk7CiAgICAgICAgICAgICAgICBsaXN0X2dyaWRfc3RhdHVzID0gZ2V0TGlzdEdyaWRTdGF0dXMoKTsKICAgICAgICAgICAgICAgIGZpbGVMaXN0ID0gZ2V0RmlsZUxpc3QoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy/liKTmlq3liIbkuqvnsbvlnovvvIhwdWJsaWPmiJbogIVzZWNyZXTvvIkKICAgICAgICBmdW5jdGlvbiBnZXRTaGFyZVR5cGUoKXsKICAgICAgICAgICAgcmV0dXJuIHl1bkRhdGEuU0hBUkVfUFVCTElDPT09MSA/ICdwdWJsaWMnIDogJ3NlY3JldCc7CiAgICAgICAgfQoKICAgICAgICAvL+WIpOaWreaYr+WNleS4quaWh+S7tuWIhuS6q+i/mOaYr+aWh+S7tuWkueaIluiAheWkmuaWh+S7tuWIhuS6qwogICAgICAgIGZ1bmN0aW9uIGlzU2luZ2xlU2hhcmUoKXsKICAgICAgICAgICAgcmV0dXJuIHl1bkRhdGEuZ2V0Q29udGV4dCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy/liKTmlq3mmK/lkKbkuLroh6rlt7HnmoTliIbkuqvpk77mjqUKICAgICAgICBmdW5jdGlvbiBpc1NlbGZTaGFyZSgpewogICAgICAgICAgICByZXR1cm4geXVuRGF0YS5NWVNFTEYgPT0gMSA/IHRydWUgOiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEV4dHJhKCl7CiAgICAgICAgICAgIHZhciBzZUtleSA9IGRlY29kZVVSSUNvbXBvbmVudChnZXRDb29raWUoJ0JEQ0xORCcpKTsKICAgICAgICAgICAgcmV0dXJuICd7JyArICcic2VrZXkiOiInICsgc2VLZXkgKyAnIicgKyAifSI7CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPluW9k+WJjeebruW9lQogICAgICAgIGZ1bmN0aW9uIGdldFBhdGgoKXsKICAgICAgICAgICAgdmFyIGhhc2ggPSBsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICB2YXIgcmVneCA9IC8oXnwmfFwvKXBhdGg9KFteJl0qKSgmfCQpL2k7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBoYXNoLm1hdGNoKHJlZ3gpOwogICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdFsyXSk7CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPluW9k+WJjeeahOinhuWbvuaooeW8jwogICAgICAgIGZ1bmN0aW9uIGdldExpc3RHcmlkU3RhdHVzKCl7CiAgICAgICAgICAgIHZhciBzdGF0dXMgPSAnbGlzdCc7CiAgICAgICAgICAgIHZhciAkc3RhdHVzX2RpdiA9ICQoJ2Rpdi5saXN0LWdyaWQtc3dpdGNoJyk7CiAgICAgICAgICAgIGlmICgkc3RhdHVzX2Rpdi5oYXNDbGFzcygnbGlzdC1zd2l0Y2hlZC1vbicpKXsKICAgICAgICAgICAgICAgIHN0YXR1cyA9ICdsaXN0JzsKICAgICAgICAgICAgfSBlbHNlIGlmICgkc3RhdHVzX2Rpdi5oYXNDbGFzcygnZ3JpZC1zd2l0Y2hlZC1vbicpKSB7CiAgICAgICAgICAgICAgICBzdGF0dXMgPSAnZ3JpZCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN0YXR1czsKICAgICAgICB9CgogICAgICAgIC8v5re75Yqg5LiL6L295Yqp5omL5oyJ6ZKuCiAgICAgICAgZnVuY3Rpb24gYWRkQnV0dG9uKCl7CiAgICAgICAgICAgIGlmKGlzU2luZ2xlU2hhcmUoKSl7CiAgICAgICAgICAgICAgICAkKCdkaXYuc2xpZGUtc2hvdy1yaWdodCcpLmNzcygnd2lkdGgnLCc1MDBweCcpOwogICAgICAgICAgICAgICAgJCgnZGl2LmZyYW1lLW1haW4nKS5jc3MoJ3dpZHRoJywnOTYlJyk7CiAgICAgICAgICAgICAgICAkKCdkaXYuc2hhcmUtZmlsZS12aWV3ZXInKS5jc3MoJ3dpZHRoJywnNzQwcHgnKS5jc3MoJ21hcmdpbi1sZWZ0JywnYXV0bycpLmNzcygnbWFyZ2luLXJpZ2h0JywnYXV0bycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICQoJ2Rpdi5zbGlkZS1zaG93LXJpZ2h0JykuY3NzKCd3aWR0aCcsJzUwMHB4Jyk7CiAgICAgICAgICAgIHZhciAkZHJvcGRvd25idXR0b24gPSAkKCc8c3BhbiBjbGFzcz0iZy1kcm9wZG93bi1idXR0b24iPjwvc3Bhbj4nKTsKICAgICAgICAgICAgdmFyICRkcm9wZG93bmJ1dHRvbl9hID0gJCgnPGEgY2xhc3M9ImctYnV0dG9uIiBkYXRhLWJ1dHRvbi1pZD0iYjIwMCIgZGF0YS1idXR0b24taW5kZXg9IjIwMCIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+PC9hPicpOwogICAgICAgICAgICB2YXIgJGRyb3Bkb3duYnV0dG9uX2Ffc3BhbiA9ICQoJzxzcGFuIGNsYXNzPSJnLWJ1dHRvbi1yaWdodCI+PGVtIGNsYXNzPSJpY29uIGljb24tZG93bmxvYWQiIHRpdGxlPSLnmb7luqbnvZHnm5jkuIvovb3liqnmiYsiPjwvZW0+PHNwYW4gY2xhc3M9InRleHQiIHN0eWxlPSJ3aWR0aDogYXV0bzsiPuS4i+i9veWKqeaJizwvc3Bhbj48L3NwYW4+Jyk7CiAgICAgICAgICAgIHZhciAkZHJvcGRvd25idXR0b25fc3BhbiA9ICQoJzxzcGFuIGNsYXNzPSJtZW51IiBzdHlsZT0id2lkdGg6YXV0bzt6LWluZGV4OjMxIj48L3NwYW4+Jyk7CgogICAgICAgICAgICB2YXIgJGRvd25sb2FkQnV0dG9uID0gJCgnPGEgZGF0YS1tZW51LWlkPSJiLW1lbnUyMDciIGNsYXNzPSJnLWJ1dHRvbi1tZW51IiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7Ij7nm7TmjqXkuIvovb08L2E+Jyk7CiAgICAgICAgICAgIHZhciAkbGlua0J1dHRvbiA9ICQoJzxhIGRhdGEtbWVudS1pZD0iYi1tZW51MjA4IiBjbGFzcz0iZy1idXR0b24tbWVudSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApOyI+5pi+56S66ZO+5o6lPC9hPicpOwoKICAgICAgICAgICAgJGRyb3Bkb3duYnV0dG9uX3NwYW4uYXBwZW5kKCRkb3dubG9hZEJ1dHRvbikuYXBwZW5kKCRsaW5rQnV0dG9uKTsKICAgICAgICAgICAgJGRyb3Bkb3duYnV0dG9uX2EuYXBwZW5kKCRkcm9wZG93bmJ1dHRvbl9hX3NwYW4pOwogICAgICAgICAgICAkZHJvcGRvd25idXR0b24uYXBwZW5kKCRkcm9wZG93bmJ1dHRvbl9hKS5hcHBlbmQoJGRyb3Bkb3duYnV0dG9uX3NwYW4pOwoKICAgICAgICAgICAgJGRyb3Bkb3duYnV0dG9uLmhvdmVyKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAkZHJvcGRvd25idXR0b24udG9nZ2xlQ2xhc3MoJ2J1dHRvbi1vcGVuJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJGRvd25sb2FkQnV0dG9uLmNsaWNrKGRvd25sb2FkQnV0dG9uQ2xpY2spOwogICAgICAgICAgICAkbGlua0J1dHRvbi5jbGljayhsaW5rQnV0dG9uQ2xpY2spOwoKICAgICAgICAgICAgJCgnZGl2Lm1vZHVsZS1zaGFyZS10b3AtYmFyIGRpdi5iYXIgZGl2LmJ1dHRvbi1ib3gnKS5hcHBlbmQoJGRyb3Bkb3duYnV0dG9uKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUlmcmFtZSgpewogICAgICAgICAgICB2YXIgJGRpdiA9ICQoJzxkaXYgY2xhc3M9ImhlbHBlci1oaWRlIiBzdHlsZT0icGFkZGluZzowO21hcmdpbjowO2Rpc3BsYXk6YmxvY2siPjwvZGl2PicpOwogICAgICAgICAgICB2YXIgJGlmcmFtZSA9ICQoJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGlkPSJoZWxwZXJkb3dubG9hZGlmcmFtZSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+PC9pZnJhbWU+Jyk7CiAgICAgICAgICAgICRkaXYuYXBwZW5kKCRpZnJhbWUpOwogICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRkaXYpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJFdmVudExpc3RlbmVyKCl7CiAgICAgICAgICAgIHJlZ2lzdGVySGFzaENoYW5nZSgpOwogICAgICAgICAgICByZWdpc3Rlckxpc3RHcmlkU3RhdHVzKCk7CiAgICAgICAgICAgIHJlZ2lzdGVyQ2hlY2tib3goKTsKICAgICAgICAgICAgcmVnaXN0ZXJBbGxDaGVja2JveCgpOwogICAgICAgICAgICByZWdpc3RlckZpbGVTZWxlY3QoKTsKICAgICAgICB9CgogICAgICAgIC8v55uR6KeG5Zyw5Z2A5qCPI+agh+etvuWPmOWMlgogICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVySGFzaENoYW5nZSgpewogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsZnVuY3Rpb24oZSl7CiAgICAgICAgICAgICAgICBsaXN0X2dyaWRfc3RhdHVzID0gZ2V0TGlzdEdyaWRTdGF0dXMoKTsKICAgICAgICAgICAgICAgIGlmKGN1cnJlbnRQYXRoID09IGdldFBhdGgoKSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGF0aCA9IGdldFBhdGgoKTsKICAgICAgICAgICAgICAgICAgICByZWZyZXNoRmlsZUxpc3QoKTsKICAgICAgICAgICAgICAgICAgICByZWZyZXNoU2VsZWN0RmlsZUxpc3QoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZWZyZXNoRmlsZUxpc3QoKXsKICAgICAgICAgICAgZmlsZUxpc3QgPSBnZXRGaWxlTGlzdCgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaFNlbGVjdEZpbGVMaXN0KCl7CiAgICAgICAgICAgIHNlbGVjdEZpbGVMaXN0ID0gW107CiAgICAgICAgfQoKICAgICAgICAvL+ebkeinhuinhuWbvuWPmOWMlgogICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyTGlzdEdyaWRTdGF0dXMoKXsKICAgICAgICAgICAgdmFyICRhX2xpc3QgPSAkKCdhW25vZGUtdHlwZT1saXN0LXN3aXRjaF0nKTsKICAgICAgICAgICAgJGFfbGlzdC5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgbGlzdF9ncmlkX3N0YXR1cyA9ICdsaXN0JzsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgJGFfZ3JpZCA9ICQoJ2Fbbm9kZS10eXBlPWdyaWQtc3dpdGNoXScpOwogICAgICAgICAgICAkYV9ncmlkLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBsaXN0X2dyaWRfc3RhdHVzID0gJ2dyaWQnOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8v55uR6KeG5paH5Lu26YCJ5oup5qGGCiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJDaGVja2JveCgpewogICAgICAgICAgICB2YXIgJGNoZWNrYm94ID0gJCgnc3Bhbi5jaGVja2JveCcpOwogICAgICAgICAgICAkY2hlY2tib3guZWFjaChmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICQoZWxlbWVudCkuYmluZCgnY2xpY2snLGZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgICAgIHZhciAkcGFyZW50ID0gJCh0aGlzKS5wYXJlbnQoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWU7CiAgICAgICAgICAgICAgICAgICAgaWYobGlzdF9ncmlkX3N0YXR1cyA9PSAnbGlzdCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSAkKCdkaXYuZmlsZS1uYW1lIGRpdi50ZXh0IGEnLCRwYXJlbnQpLmF0dHIoJ3RpdGxlJyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYobGlzdF9ncmlkX3N0YXR1cyA9PSAnZ3JpZCcpewogICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZSA9ICQoJ2Rpdi5maWxlLW5hbWUgYScsJHBhcmVudCkuYXR0cigndGl0bGUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJHBhcmVudC5oYXNDbGFzcygnaXRlbS1hY3RpdmUnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflj5bmtojpgInkuK3mlofku7bvvJonK2ZpbGVuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxzZWxlY3RGaWxlTGlzdC5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0W2ldLmZpbGVuYW1lID09IGZpbGVuYW1lKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdC5zcGxpY2UoaSwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6YCJ5Lit5paH5Lu277yaJytmaWxlbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChmaWxlTGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQuc2VydmVyX2ZpbGVuYW1lID09IGZpbGVuYW1lKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTplbGVtZW50LnNlcnZlcl9maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDplbGVtZW50LnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZzX2lkOmVsZW1lbnQuZnNfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzZGlyOmVsZW1lbnQuaXNkaXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdEZpbGVMaXN0LnB1c2gob2JqKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdW5yZWdpc3RlckNoZWNrYm94KCl7CiAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSAkKCdzcGFuLmNoZWNrYm94Jyk7CiAgICAgICAgICAgICRjaGVja2JveC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/nm5Hop4blhajpgInmoYYKICAgICAgICBmdW5jdGlvbiByZWdpc3RlckFsbENoZWNrYm94KCl7CiAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSAkKCdkaXYuY29sLWl0ZW0uY2hlY2snKTsKICAgICAgICAgICAgJGNoZWNrYm94LmVhY2goZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJHBhcmVudCA9ICQodGhpcykucGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJHBhcmVudC5oYXNDbGFzcygnY2hlY2tlZCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WPlua2iOWFqOmAiScpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflhajpg6jpgInkuK0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0RmlsZUxpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZpbGVMaXN0LGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTplbGVtZW50LnNlcnZlcl9maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOmVsZW1lbnQucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19pZDplbGVtZW50LmZzX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzZGlyOmVsZW1lbnQuaXNkaXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdC5wdXNoKG9iaik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJBbGxDaGVja2JveCgpewogICAgICAgICAgICB2YXIgJGNoZWNrYm94ID0gJCgnZGl2LmNvbC1pdGVtLmNoZWNrJyk7CiAgICAgICAgICAgICRjaGVja2JveC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/nm5Hop4bljZXkuKrmlofku7bpgInkuK0KICAgICAgICBmdW5jdGlvbiByZWdpc3RlckZpbGVTZWxlY3QoKXsKICAgICAgICAgICAgdmFyICRkZCA9ICQoJ2Rpdi5saXN0LXZpZXcgZGQnKTsKICAgICAgICAgICAgJGRkLmVhY2goZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBlLnRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKG5vZGVOYW1lICE9ICdzcGFuJyAmJiBub2RlTmFtZSAhPSAnYScgJiYgbm9kZU5hbWUgIT0gJ2VtJykgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSAkKCdkaXYuZmlsZS1uYW1lIGRpdi50ZXh0IGEnLCQodGhpcykpLmF0dHIoJ3RpdGxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfpgInkuK3mlofku7bvvJonICsgZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmlsZUxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihlbGVtZW50LnNlcnZlcl9maWxlbmFtZSA9PSBmaWxlbmFtZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ZWxlbWVudC5zZXJ2ZXJfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ZWxlbWVudC5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19pZDplbGVtZW50LmZzX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc2RpcjplbGVtZW50LmlzZGlyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RGaWxlTGlzdC5wdXNoKG9iaik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJGaWxlU2VsZWN0KCl7CiAgICAgICAgICAgIHZhciAkZGQgPSAkKCdkaXYubGlzdC12aWV3IGRkJyk7CiAgICAgICAgICAgICRkZC5lYWNoKGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgJChlbGVtZW50KS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy/nm5Hop4bmlofku7bliJfooajmmL7npLrlj5jljJYKICAgICAgICBmdW5jdGlvbiBjcmVhdGVPYnNlcnZlcigpewogICAgICAgICAgICB2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyOwogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICdjaGlsZExpc3QnOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24obXV0YXRpb25zKXsKICAgICAgICAgICAgICAgIHVucmVnaXN0ZXJDaGVja2JveCgpOwogICAgICAgICAgICAgICAgdW5yZWdpc3RlckFsbENoZWNrYm94KCk7CiAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyRmlsZVNlbGVjdCgpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJDaGVja2JveCgpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJBbGxDaGVja2JveCgpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJGaWxlU2VsZWN0KCk7IAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGxpc3RfdmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0LXZpZXcnKTsKICAgICAgICAgICAgdmFyIGdyaWRfdmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLXZpZXcnKTsKCiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUobGlzdF92aWV3LG9wdGlvbnMpOwogICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGdyaWRfdmlldyxvcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIC8v6I635Y+W5paH5Lu25L+h5oGv5YiX6KGoCiAgICAgICAgZnVuY3Rpb24gZ2V0RmlsZUxpc3QoKXsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgICBpZihnZXRQYXRoKCkgPT0gJy8nKXsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IHl1bkRhdGEuRklMRUlORk87CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2dpZCA9IGdldExvZ0lEKCk7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgIHVrOnVrLAogICAgICAgICAgICAgICAgICAgIHNoYXJlaWQ6c2hhcmVpZCwKICAgICAgICAgICAgICAgICAgICBvcmRlcjonb3RoZXInLAogICAgICAgICAgICAgICAgICAgIGRlc2M6MSwKICAgICAgICAgICAgICAgICAgICBzaG93ZW1wdHk6MCwKICAgICAgICAgICAgICAgICAgICB3ZWI6d2ViLAogICAgICAgICAgICAgICAgICAgIGRpcjpnZXRQYXRoKCksCiAgICAgICAgICAgICAgICAgICAgdDpNYXRoLnJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgIGJkc3Rva2VuOmJkc3Rva2VuLAogICAgICAgICAgICAgICAgICAgIGNoYW5uZWw6Y2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICBjbGllbnR0eXBlOmNsaWVudHR5cGUsCiAgICAgICAgICAgICAgICAgICAgYXBwX2lkOmFwcF9pZCwKICAgICAgICAgICAgICAgICAgICBsb2dpZDpsb2dpZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOnNoYXJlTGlzdFVybCwKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6J0dFVCcsCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZGF0YTpwYXJhbXMsCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczpmdW5jdGlvbihyZXNwb25zZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmVycm5vID09PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmxpc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZG93bmxvYWRCdXR0b25DbGljaygpewogICAgICAgICAgICBjb25zb2xlLmxvZygn6YCJ5Lit5paH5Lu25YiX6KGo77yaJyxzZWxlY3RGaWxlTGlzdCk7CiAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgICAgICBhbGVydCgn6I635Y+W5paH5Lu2SUTlpLHotKXvvIzor7fph43or5UnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBidXR0b25UYXJnZXQgPSAnZG93bmxvYWQnOwogICAgICAgICAgICB2YXIgZG93bmxvYWRMaW5rID0gZ2V0RG93bmxvYWRMaW5rKCk7CgogICAgICAgICAgICBpZihkb3dubG9hZExpbmsuZXJybm8gPT0gLTIwKSB7CiAgICAgICAgICAgICAgICB2Y29kZSA9IGdldFZDb2RlKCk7CiAgICAgICAgICAgICAgICBpZih2Y29kZS5lcnJubyAhPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ+iOt+WPlumqjOivgeeggeWksei0pe+8gScpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZjb2RlRGlhbG9nLm9wZW4odmNvZGUpOwogICAgICAgICAgICB9IGVsc2UgaWYoZG93bmxvYWRMaW5rLmVycm5vID09IDExMil7CiAgICAgICAgICAgICAgICBhbGVydCgn6aG16Z2i6L+H5pyf77yM6K+35Yi35paw6YeN6K+VJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG93bmxvYWRMaW5rLmVycm5vID09PSAwKSB7CiAgICAgICAgICAgICAgICB2YXIgbGluazsKICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PSAxICYmIHNlbGVjdEZpbGVMaXN0WzBdLmlzZGlyID09PSAwKQogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBkb3dubG9hZExpbmsubGlzdFswXS5kbGluazsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsaW5rID0gZG93bmxvYWRMaW5rLmRsaW5rOwogICAgICAgICAgICAgICAgZXhlY0Rvd25sb2FkKGxpbmspOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWxlcnQoJ+iOt+WPluS4i+i9vemTvuaOpeWksei0pe+8gScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL+iOt+WPlumqjOivgeeggQogICAgICAgIGZ1bmN0aW9uIGdldFZDb2RlKCl7CiAgICAgICAgICAgIHZhciB1cmwgPSBwYW5BUElVcmwgKyAnZ2V0dmNvZGUnOwogICAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgICBsb2dpZCA9IGdldExvZ0lEKCk7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICAgICAgICBwcm9kOidwYW4nLAogICAgICAgICAgICAgICAgdDpNYXRoLnJhbmRvbSgpLAogICAgICAgICAgICAgICAgYmRzdG9rZW46YmRzdG9rZW4sCiAgICAgICAgICAgICAgICBjaGFubmVsOmNoYW5uZWwsCiAgICAgICAgICAgICAgICBjbGllbnR0eXBlOmNsaWVudHR5cGUsCiAgICAgICAgICAgICAgICB3ZWI6d2ViLAogICAgICAgICAgICAgICAgYXBwX2lkOmFwcF9pZCwKICAgICAgICAgICAgICAgIGxvZ2lkOmxvZ2lkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6dXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOidHRVQnLAogICAgICAgICAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgICAgICAgICBkYXRhOnBhcmFtcywKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8v5Yi35paw6aqM6K+B56CBCiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaFZDb2RlKCl7CiAgICAgICAgICAgIHZjb2RlID0gZ2V0VkNvZGUoKTsKICAgICAgICAgICAgJCgnI2RpYWxvZy1pbWcnKS5hdHRyKCdzcmMnLHZjb2RlLmltZyk7CiAgICAgICAgfQoKICAgICAgICAvL+mqjOivgeeggeehruiupOaPkOS6pAogICAgICAgIGZ1bmN0aW9uIGNvbmZpcm1DbGljaygpewogICAgICAgICAgICB2YXIgdmFsID0gJCgnI2RpYWxvZy1pbnB1dCcpLnZhbCgpOwogICAgICAgICAgICBpZih2YWwubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAkKCcjZGlhbG9nLWVycicpLnRleHQoJ+ivt+i+k+WFpemqjOivgeeggScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYodmFsLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICAgICQoJyNkaWFsb2ctZXJyJykudGV4dCgn6aqM6K+B56CB6L6T5YWl6ZSZ6K+v77yM6K+36YeN5paw6L6T5YWlJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBnZXREb3dubG9hZExpbmtXaXRoVkNvZGUodmFsKTsKICAgICAgICAgICAgaWYocmVzdWx0LmVycm5vID09IC0yMCl7CiAgICAgICAgICAgICAgICB2Y29kZURpYWxvZy5jbG9zZSgpOwogICAgICAgICAgICAgICAgJCgnI2RpYWxvZy1lcnInKS50ZXh0KCfpqozor4HnoIHovpPlhaXplJnor6/vvIzor7fph43mlrDovpPlhaUnKTsKICAgICAgICAgICAgICAgIHJlZnJlc2hWQ29kZSgpOwogICAgICAgICAgICAgICAgaWYoIXZjb2RlIHx8IHZjb2RlLmVycm5vICE9PSAwKXsKICAgICAgICAgICAgICAgICAgICBhbGVydCgn6I635Y+W6aqM6K+B56CB5aSx6LSl77yBJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmNvZGVEaWFsb2cub3BlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5lcnJubyA9PT0gMCkgewogICAgICAgICAgICAgICAgdmNvZGVEaWFsb2cuY2xvc2UoKTsKICAgICAgICAgICAgICAgIHZhciBsaW5rOwogICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3QubGVuZ3RoID09MSAmJiBzZWxlY3RGaWxlTGlzdFswXS5pc2RpciA9PT0gMCkKICAgICAgICAgICAgICAgICAgICBsaW5rID0gcmVzdWx0Lmxpc3RbMF0uZGxpbms7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbGluayA9IHJlc3VsdC5kbGluazsKICAgICAgICAgICAgICAgIGlmKGJ1dHRvblRhcmdldCA9PSAnZG93bmxvYWQnKXsKICAgICAgICAgICAgICAgICAgICBleGVjRG93bmxvYWQobGluayk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJ1dHRvblRhcmdldCA9PSAnbGluaycpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2goc2VsZWN0RmlsZUxpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSBlbGVtZW50LmZpbGVuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggPT0wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZWxlbWVudC5maWxlbmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGZpbGVuYW1lICsgJywnICsgZWxlbWVudC5maWxlbmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBsaW5rTGlzdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybHM6WwogICAgICAgICAgICAgICAgICAgICAgICAgICAge3VybDpsaW5rLHJhbms6MX0KICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIHRpcCA9ICLmmL7npLrojrflj5bnmoTpk77mjqXvvIzlj6/ku6Xkvb/nlKjlj7PplK7ov4Xpm7fkuIvovb3vvIzlpI3liLbml6DnlKjvvIzpnIDopoHkvKDpgJJjb29raWUiOwogICAgICAgICAgICAgICAgICAgIGRpYWxvZy5vcGVuKHt0aXRsZTon5LiL6L296ZO+5o6lJyx0eXBlOidsaW5rJyxsaXN0OmxpbmtMaXN0LHRpcDp0aXB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCflj5HnlJ/plJnor6/vvIEnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy/nlJ/miJDkuIvovb3nlKjnmoRmaWRfbGlzdOWPguaVsAogICAgICAgIGZ1bmN0aW9uIGdldEZpZExpc3QoKXsKICAgICAgICAgICAgdmFyIGZpZGxpc3QgPSBbXTsKICAgICAgICAgICAgJC5lYWNoKHNlbGVjdEZpbGVMaXN0LGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgZmlkbGlzdC5wdXNoKGVsZW1lbnQuZnNfaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuICdbJyArIGZpZGxpc3QgKyAnXSc7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsaW5rQnV0dG9uQ2xpY2soKXsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+mAieS4reaWh+S7tuWIl+ihqO+8micsc2VsZWN0RmlsZUxpc3QpOwogICAgICAgICAgICBpZihzZWxlY3RGaWxlTGlzdC5sZW5ndGggPT09IDApewogICAgICAgICAgICAgICAgYWxlcnQoJ+ayoeaciemAieS4reaWh+S7tu+8jOivt+mHjeivlScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1dHRvblRhcmdldCA9ICdsaW5rJzsKICAgICAgICAgICAgdmFyIGRvd25sb2FkTGluayA9IGdldERvd25sb2FkTGluaygpOwoKICAgICAgICAgICAgaWYoZG93bmxvYWRMaW5rLmVycm5vID09IC0yMCkgewogICAgICAgICAgICAgICAgdmNvZGUgPSBnZXRWQ29kZSgpOwogICAgICAgICAgICAgICAgaWYoIXZjb2RlIHx8IHZjb2RlLmVycm5vICE9PSAwKXsKICAgICAgICAgICAgICAgICAgICBhbGVydCgn6I635Y+W6aqM6K+B56CB5aSx6LSl77yBJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmNvZGVEaWFsb2cub3Blbih2Y29kZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG93bmxvYWRMaW5rLmVycm5vID09IDExMikgewogICAgICAgICAgICAgICAgYWxlcnQoJ+mhtemdoui/h+acn++8jOivt+WIt+aWsOmHjeivlScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvd25sb2FkTGluay5lcnJubyA9PT0gMCkgewogICAgICAgICAgICAgICAgdmFyIGxpbms7CiAgICAgICAgICAgICAgICBpZihzZWxlY3RGaWxlTGlzdC5sZW5ndGggPT0gMSAmJiBzZWxlY3RGaWxlTGlzdFswXS5pc2RpciA9PT0gMCkKICAgICAgICAgICAgICAgICAgICBsaW5rID0gZG93bmxvYWRMaW5rLmxpc3RbMF0uZGxpbms7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbGluayA9IGRvd25sb2FkTGluay5kbGluazsKICAgICAgICAgICAgICAgIGlmKHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgICAgICQoJyNkaWFsb2ctZG93bmxvYWRsaW5rJykuYXR0cignaHJlZicsbGluaykudGV4dChsaW5rKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAkKCcjZGlhbG9nLWRvd25sb2FkbGluaycpLmF0dHIoJ2hyZWYnLGxpbmspLnRleHQobGluayk7CiAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSAnJzsKICAgICAgICAgICAgICAgICQuZWFjaChzZWxlY3RGaWxlTGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICBpZihzZWxlY3RGaWxlTGlzdC5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSBlbGVtZW50LmZpbGVuYW1lOwogICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGluZGV4ID09MCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZWxlbWVudC5maWxlbmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSBmaWxlbmFtZSArICcsJyArIGVsZW1lbnQuZmlsZW5hbWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2YXIgbGlua0xpc3QgPSB7CiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6ZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgdXJsczpbCiAgICAgICAgICAgICAgICAgICAgICAgIHt1cmw6bGluayxyYW5rOjF9CiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHZhciB0aXAgPSAi5pi+56S66I635Y+W55qE6ZO+5o6l77yM5Y+v5Lul5L2/55So5Y+z6ZSu6L+F6Zu35LiL6L2977yM5aSN5Yi25peg55So77yM6ZyA6KaB5Lyg6YCSY29va2llIjsKICAgICAgICAgICAgICAgIGRpYWxvZy5vcGVuKHt0aXRsZTon5LiL6L296ZO+5o6lJyx0eXBlOidsaW5rJyxsaXN0OmxpbmtMaXN0LHRpcDp0aXB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfojrflj5bkuIvovb3pk77mjqXlpLHotKXvvIEnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy/ojrflj5bkuIvovb3pk77mjqUKICAgICAgICBmdW5jdGlvbiBnZXREb3dubG9hZExpbmsoKXsKICAgICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgICAgaWYoaXNTaW5nbGVTaGFyZSl7CiAgICAgICAgICAgICAgICBmaWRfbGlzdCA9IGdldEZpZExpc3QoKTsKICAgICAgICAgICAgICAgIGxvZ2lkID0gZ2V0TG9nSUQoKTsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSBwYW5BUElVcmwgKyAnc2hhcmVkb3dubG9hZD9zaWduPScgKyBzaWduICsgJyZ0aW1lc3RhbXA9JyArIHRpbWVzdGFtcCArICcmYmRzdG9rZW49JyArIGJkc3Rva2VuICsgJyZjaGFubmVsPScgKyBjaGFubmVsICsgJyZjbGllbnR0eXBlPScgKyBjbGllbnR0eXBlICsgJyZ3ZWI9Jysgd2ViICsgJyZhcHBfaWQ9JyArIGFwcF9pZCArICcmbG9naWQ9JyArIGxvZ2lkOwogICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICBlbmNyeXB0OmVuY3J5cHQsCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdDpwcm9kdWN0LAogICAgICAgICAgICAgICAgICAgIHVrOnVrLAogICAgICAgICAgICAgICAgICAgIHByaW1hcnlpZDpwcmltYXJ5aWQsCiAgICAgICAgICAgICAgICAgICAgZmlkX2xpc3Q6ZmlkX2xpc3QKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZihzaGFyZVR5cGUgPT0gJ3NlY3JldCcpewogICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leHRyYSA9IGV4dHJhOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoc2VsZWN0RmlsZUxpc3RbMF0uaXNkaXIgPT0gMSB8fCBzZWxlY3RGaWxlTGlzdC5sZW5ndGggPiAxKXsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMudHlwZSA9ICdiYXRjaCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDp1cmwsCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOidQT1NUJywKICAgICAgICAgICAgICAgICAgICBhc3luYzpmYWxzZSwKICAgICAgICAgICAgICAgICAgICBkYXRhOnBhcmFtcywKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOmZ1bmN0aW9uKHJlc3BvbnNlKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8v5pyJ6aqM6K+B56CB6L6T5YWl5pe26I635Y+W5LiL6L296ZO+5o6lCiAgICAgICAgZnVuY3Rpb24gZ2V0RG93bmxvYWRMaW5rV2l0aFZDb2RlKHZjb2RlSW5wdXQpewogICAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgICBpZihpc1NpbmdsZVNoYXJlKXsKICAgICAgICAgICAgICAgIGZpZF9saXN0ID0gZ2V0RmlkTGlzdCgpOwogICAgICAgICAgICAgICAgdmFyIHVybCA9IHBhbkFQSVVybCArICdzaGFyZWRvd25sb2FkP3NpZ249JyArIHNpZ24gKyAnJnRpbWVzdGFtcD0nICsgdGltZXN0YW1wICsgJyZiZHN0b2tlbj0nICsgYmRzdG9rZW4gKyAnJmNoYW5uZWw9JyArIGNoYW5uZWwgKyAnJmNsaWVudHR5cGU9JyArIGNsaWVudHR5cGUgKyAnJndlYj0nKyB3ZWIgKyAnJmFwcF9pZD0nICsgYXBwX2lkICsgJyZsb2dpZD0nICsgbG9naWQ7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgIGVuY3J5cHQ6ZW5jcnlwdCwKICAgICAgICAgICAgICAgICAgICBwcm9kdWN0OnByb2R1Y3QsCiAgICAgICAgICAgICAgICAgICAgdmNvZGVfaW5wdXQ6dmNvZGVJbnB1dCwKICAgICAgICAgICAgICAgICAgICB2Y29kZV9zdHI6dmNvZGUudmNvZGUsCiAgICAgICAgICAgICAgICAgICAgdWs6dWssCiAgICAgICAgICAgICAgICAgICAgcHJpbWFyeWlkOnByaW1hcnlpZCwKICAgICAgICAgICAgICAgICAgICBmaWRfbGlzdDpmaWRfbGlzdAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmKHNoYXJlVHlwZSA9PSAnc2VjcmV0Jyl7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4dHJhID0gZXh0cmE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihzZWxlY3RGaWxlTGlzdFswXS5pc2RpciA9PSAxIHx8IHNlbGVjdEZpbGVMaXN0Lmxlbmd0aCA+IDEgKXsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMudHlwZSA9ICdiYXRjaCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDp1cmwsCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOidQT1NUJywKICAgICAgICAgICAgICAgICAgICBhc3luYzpmYWxzZSwKICAgICAgICAgICAgICAgICAgICBkYXRhOnBhcmFtcywKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOmZ1bmN0aW9uKHJlc3BvbnNlKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4ZWNEb3dubG9hZChsaW5rKXsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+S4i+i9vemTvuaOpe+8micrbGluayk7CiAgICAgICAgICAgICQoJyNoZWxwZXJkb3dubG9hZGlmcmFtZScpLmF0dHIoJ3NyYycsbGluayk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGJhc2U2NEVuY29kZSh0KXsKICAgICAgICB2YXIgYSwgciwgZSwgbiwgaSwgcywgbyA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIjsKICAgICAgICBmb3IgKGUgPSB0Lmxlbmd0aCxyID0gMCxhID0gIiI7IGUgPiByOyApIHsKICAgICAgICAgICAgaWYgKG4gPSAyNTUgJiB0LmNoYXJDb2RlQXQocisrKSxyID09IGUpIHsKICAgICAgICAgICAgICAgIGEgKz0gby5jaGFyQXQobiA+PiAyKTsKICAgICAgICAgICAgICAgIGEgKz0gby5jaGFyQXQoKDMgJiBuKSA8PCA0KTsKICAgICAgICAgICAgICAgIGEgKz0gIj09IjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpID0gdC5jaGFyQ29kZUF0KHIrKyksciA9PSBlKSB7CiAgICAgICAgICAgICAgICBhICs9IG8uY2hhckF0KG4gPj4gMik7CiAgICAgICAgICAgICAgICBhICs9IG8uY2hhckF0KCgzICYgbikgPDwgNCB8ICgyNDAgJiBpKSA+PiA0KTsKICAgICAgICAgICAgICAgIGEgKz0gby5jaGFyQXQoKDE1ICYgaSkgPDwgMik7CiAgICAgICAgICAgICAgICBhICs9ICI9IjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHMgPSB0LmNoYXJDb2RlQXQocisrKTsKICAgICAgICAgICAgYSArPSBvLmNoYXJBdChuID4+IDIpOwogICAgICAgICAgICBhICs9IG8uY2hhckF0KCgzICYgbikgPDwgNCB8ICgyNDAgJiBpKSA+PiA0KTsKICAgICAgICAgICAgYSArPSBvLmNoYXJBdCgoMTUgJiBpKSA8PCAyIHwgKDE5MiAmIHMpID4+IDYpOwogICAgICAgICAgICBhICs9IG8uY2hhckF0KDYzICYgcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGZ1bmN0aW9uIGRldGVjdFBhZ2UoKXsKICAgICAgICB2YXIgcmVneCA9IC9bXC9dLitbXC9dL2c7CiAgICAgICAgdmFyIHBhZ2UgPSBsb2NhdGlvbi5wYXRobmFtZS5tYXRjaChyZWd4KTsKICAgICAgICByZXR1cm4gcGFnZVswXS5yZXBsYWNlKC9cLy9nLCcnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb29raWUoZSkgewogICAgICAgIHZhciBvLCB0OwogICAgICAgIHZhciBuID0gZG9jdW1lbnQsYz1kZWNvZGVVUkk7CiAgICAgICAgcmV0dXJuIG4uY29va2llLmxlbmd0aCA+IDAgJiYgKG8gPSBuLmNvb2tpZS5pbmRleE9mKGUgKyAiPSIpLC0xICE9IG8pID8gKG8gPSBvICsgZS5sZW5ndGggKyAxLHQgPSBuLmNvb2tpZS5pbmRleE9mKCI7IiwgbyksLTEgPT0gdCAmJiAodCA9IG4uY29va2llLmxlbmd0aCksYyhuLmNvb2tpZS5zdWJzdHJpbmcobywgdCkpKSA6ICIiOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExvZ0lEKCl7CiAgICAgICAgdmFyIG5hbWUgPSAiQkFJRFVJRCI7CiAgICAgICAgdmFyIHUgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrL37vvIFAI++/pSXigKbigKYmIjsKICAgICAgICB2YXIgZCA9IC9bXHVEODAwLVx1REJGRl1bXHVEQzAwLVx1REZGRkZdfFteXHgwMC1ceDdGXS9nOwogICAgICAgIHZhciBmID0gU3RyaW5nLmZyb21DaGFyQ29kZTsKICAgICAgICBmdW5jdGlvbiBsKGUpewogICAgICAgICAgICBpZiAoZS5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IGUuY2hhckNvZGVBdCgwKTsKICAgICAgICAgICAgICAgIHJldHVybiAxMjggPiBuID8gZSA6IDIwNDggPiBuID8gZigxOTIgfCBuID4+PiA2KSArIGYoMTI4IHwgNjMgJiBuKSA6IGYoMjI0IHwgbiA+Pj4gMTIgJiAxNSkgKyBmKDEyOCB8IG4gPj4+IDYgJiA2MykgKyBmKDEyOCB8IDYzICYgbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSA2NTUzNiArIDEwMjQgKiAoZS5jaGFyQ29kZUF0KDApIC0gNTUyOTYpICsgKGUuY2hhckNvZGVBdCgxKSAtIDU2MzIwKTsKICAgICAgICAgICAgcmV0dXJuIGYoMjQwIHwgbiA+Pj4gMTggJiA3KSArIGYoMTI4IHwgbiA+Pj4gMTIgJiA2MykgKyBmKDEyOCB8IG4gPj4+IDYgJiA2MykgKyBmKDEyOCB8IDYzICYgbik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGcoZSl7CiAgICAgICAgICAgIHJldHVybiAoZSArICIiICsgTWF0aC5yYW5kb20oKSkucmVwbGFjZShkLCBsKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbShlKXsKICAgICAgICAgICAgdmFyIG4gPSBbMCwgMiwgMV1bZS5sZW5ndGggJSAzXTsKICAgICAgICAgICAgdmFyIHQgPSBlLmNoYXJDb2RlQXQoMCkgPDwgMTYgfCAoZS5sZW5ndGggPiAxID8gZS5jaGFyQ29kZUF0KDEpIDogMCkgPDwgOCB8IChlLmxlbmd0aCA+IDIgPyBlLmNoYXJDb2RlQXQoMikgOiAwKTsKICAgICAgICAgICAgdmFyIG8gPSBbdS5jaGFyQXQodCA+Pj4gMTgpLCB1LmNoYXJBdCh0ID4+PiAxMiAmIDYzKSwgbiA+PSAyID8gIj0iIDogdS5jaGFyQXQodCA+Pj4gNiAmIDYzKSwgbiA+PSAxID8gIj0iIDogdS5jaGFyQXQoNjMgJiB0KV07CiAgICAgICAgICAgIHJldHVybiBvLmpvaW4oIiIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoKGUpewogICAgICAgICAgICByZXR1cm4gZS5yZXBsYWNlKC9bXHNcU117MSwzfS9nLCBtKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcCgpewogICAgICAgICAgICByZXR1cm4gaChnKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdyhlLG4pewogICAgICAgICAgICByZXR1cm4gbiA/IHAoU3RyaW5nKGUpKS5yZXBsYWNlKC9bK1wvXS9nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIisiID09IGUgPyAiLSIgOiAiXyI7CiAgICAgICAgICAgIH0pLnJlcGxhY2UoLz0vZywgIiIpIDogcChTdHJpbmcoZSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdyhnZXRDb29raWUobmFtZSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIERpYWxvZygpewogICAgICAgIHZhciBsaW5rTGlzdCA9IFtdOwogICAgICAgIHZhciBzaG93UGFyYW1zOwogICAgICAgIHZhciBkaWFsb2csc2hhZG93OwogICAgICAgIHZhciBlZGl0ZWQgPSAwOwogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZURpYWxvZygpewogICAgICAgICAgICB2YXIgc2NyZWVuV2lkdGggPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOwogICAgICAgICAgICB2YXIgZGlhbG9nTGVmdCA9IHNjcmVlbldpZHRoPjgwMCA/IChzY3JlZW5XaWR0aC04MDApLzIgOiAwOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19kaXYgPSAkKCc8ZGl2IGNsYXNzPSJkaWFsb2ciIHN0eWxlPSJ3aWR0aDogODAwcHg7IHRvcDogMHB4OyBib3R0b206IGF1dG87IGxlZnQ6ICcrZGlhbG9nTGVmdCsncHg7IHJpZ2h0OiBhdXRvOyBkaXNwbGF5OiBoaWRkZW47IHZpc2liaWxpdHk6IHZpc2libGU7IHotaW5kZXg6IDUyOyI+PC9kaXY+Jyk7CiAgICAgICAgICAgIHZhciAkZGlhbG9nX2hlYWRlciA9ICQoJzxkaXYgY2xhc3M9ImRpYWxvZy1oZWFkZXIiPjxoMz48c3BhbiBjbGFzcz0iZGlhbG9nLXRpdGxlIj48L3NwYW4+PC9oMz48L2Rpdj4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfY29udHJvbCA9ICQoJzxkaXYgY2xhc3M9ImRpYWxvZy1jb250cm9sIj48c3BhbiBjbGFzcz0iZGlhbG9nLWljb24gZGlhbG9nLWNsb3NlIj7Dlzwvc3Bhbj48L2Rpdj4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfYm9keSA9ICQoJzxkaXYgY2xhc3M9ImRpYWxvZy1ib2R5IiBzdHlsZT0ibWF4LWhlaWdodDo0NTBweDtvdmVyZmxvdy15OmF1dG87cGFkZGluZzowIDIwcHg7Ij48L2Rpdj4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfdGlwID0gJCgnPGRpdiBjbGFzcz0iZGlhbG9nLXRpcCIgc3R5bGU9InBhZGRpbmctbGVmdDoyMHB4O2JhY2tncm91bmQtY29sb3I6I2ZhZjJkMztib3JkZXItdG9wOiAxcHggc29saWQgI2M0ZGJmZTsiPjxwPjwvcD48L2Rpdj4nKTsKCiAgICAgICAgICAgICRkaWFsb2dfZGl2LmFwcGVuZCgkZGlhbG9nX2hlYWRlci5hcHBlbmQoJGRpYWxvZ19jb250cm9sKSkuYXBwZW5kKCRkaWFsb2dfYm9keSk7CgogICAgICAgICAgICAvL3ZhciAkZGlhbG9nX3RleHRhcmVhID0gJCgnPHRleHRhcmVhIGNsYXNzPSJkaWFsb2ctdGV4dGFyZWEiIHN0eWxlPSJkaXNwbGF5Om5vbmU7d2lkdGgiPjwvdGV4dGFyZWE+Jyk7CgogICAgICAgICAgICB2YXIgJGRpYWxvZ19idXR0b24gPSAkKCc8ZGl2IGNsYXNzPSJkaWFsb2ctYnV0dG9uIiBzdHlsZT0iZGlzcGxheTpub25lIj48L2Rpdj4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfYnV0dG9uX2RpdiA9ICQoJzxkaXYgc3R5bGU9ImRpc3BsYXk6dGFibGU7bWFyZ2luOmF1dG8iPjwvZGl2PicpCiAgICAgICAgICAgIHZhciAkZGlhbG9nX2NvcHlfYnV0dG9uID0gJCgnPGJ1dHRvbiBpZD0iZGlhbG9nLWNvcHktYnV0dG9uIiBzdHlsZT0iZGlzcGxheTpub25lIj7lpI3liLY8L2J1dHRvbj4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfZWRpdF9idXR0b24gPSAkKCc8YnV0dG9uIGlkPSJkaWFsb2ctZWRpdC1idXR0b24iIHN0eWxlPSJkaXNwbGF5Om5vbmUiPue8lui+kTwvYnV0dG9uPicpOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19leGl0X2J1dHRvbiA9ICQoJzxidXR0b24gaWQ9ImRpYWxvZy1leGl0LWJ1dHRvbiIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+6YCA5Ye6PC9idXR0b24+Jyk7CgogICAgICAgICAgICAkZGlhbG9nX2J1dHRvbl9kaXYuYXBwZW5kKCRkaWFsb2dfY29weV9idXR0b24pLmFwcGVuZCgkZGlhbG9nX2VkaXRfYnV0dG9uKS5hcHBlbmQoJGRpYWxvZ19leGl0X2J1dHRvbik7CiAgICAgICAgICAgICRkaWFsb2dfYnV0dG9uLmFwcGVuZCgkZGlhbG9nX2J1dHRvbl9kaXYpOwogICAgICAgICAgICAkZGlhbG9nX2Rpdi5hcHBlbmQoJGRpYWxvZ19idXR0b24pOwoKICAgICAgICAgICAgJGRpYWxvZ19jb3B5X2J1dHRvbi5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAnJzsKICAgICAgICAgICAgICAgIGlmKHNob3dQYXJhbXMudHlwZSA9PSAnYmF0Y2gnKXsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gobGlua0xpc3QsZnVuY3Rpb24oaW5kZXgsZWxlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQuZG93bmxvYWRsaW5rID09ICdlcnJvcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGluZGV4ID09IGxpbmtMaXN0Lmxlbmd0aC0xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQgKyBlbGVtZW50LmRvd25sb2FkbGluazsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9ICBjb250ZW50ICsgZWxlbWVudC5kb3dubG9hZGxpbmsgKyAnXG4nOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNob3dQYXJhbXMudHlwZSA9PSAnbGluaycpewogICAgICAgICAgICAgICAgICAgICQuZWFjaChsaW5rTGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZWxlbWVudC51cmwgPT0gJ2Vycm9yJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggPT0gbGlua0xpc3QubGVuZ3RoLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gY29udGVudCArIGVsZW1lbnQudXJsOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gIGNvbnRlbnQgKyBlbGVtZW50LnVybCArICdcbic7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBHTV9zZXRDbGlwYm9hcmQoY29udGVudCwndGV4dCcpOwogICAgICAgICAgICAgICAgYWxlcnQoJ+W3suWwhumTvuaOpeWkjeWItuWIsOWJqui0tOadv++8gScpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICRkaWFsb2dfZWRpdF9idXR0b24uY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciAkZGlhbG9nX3RleHRhcmVhID0gJCgnZGl2LmRpYWxvZy1ib2R5IHRleHRhcmVhW25hbWU9ZGlhbG9nLXRleHRhcmVhXScsZGlhbG9nKTsKICAgICAgICAgICAgICAgIHZhciAkZGlhbG9nX2l0ZW0gPSAkKCdkaXYuZGlhbG9nLWJvZHkgZGl2JyxkaWFsb2cpOwogICAgICAgICAgICAgICAgJGRpYWxvZ19pdGVtLmhpZGUoKTsKICAgICAgICAgICAgICAgICRkaWFsb2dfY29weV9idXR0b24uaGlkZSgpOwogICAgICAgICAgICAgICAgJGRpYWxvZ19lZGl0X2J1dHRvbi5oaWRlKCk7CiAgICAgICAgICAgICAgICAkZGlhbG9nX3RleHRhcmVhLnNob3coKTsKICAgICAgICAgICAgICAgICRkaWFsb2dfZXhpdF9idXR0b24uc2hvdygpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICRkaWFsb2dfZXhpdF9idXR0b24uY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciAkZGlhbG9nX3RleHRhcmVhID0gJCgnZGl2LmRpYWxvZy1ib2R5IHRleHRhcmVhW25hbWU9ZGlhbG9nLXRleHRhcmVhXScsZGlhbG9nKTsKICAgICAgICAgICAgICAgIHZhciAkZGlhbG9nX2l0ZW0gPSAkKCdkaXYuZGlhbG9nLWJvZHkgZGl2JyxkaWFsb2cpOwogICAgICAgICAgICAgICAgJGRpYWxvZ190ZXh0YXJlYS5oaWRlKCk7CiAgICAgICAgICAgICAgICAkZGlhbG9nX2l0ZW0uc2hvdygpOwogICAgICAgICAgICAgICAgJGRpYWxvZ19leGl0X2J1dHRvbi5oaWRlKCk7CiAgICAgICAgICAgICAgICAkZGlhbG9nX2NvcHlfYnV0dG9uLnNob3coKTsKICAgICAgICAgICAgICAgICRkaWFsb2dfZWRpdF9idXR0b24uc2hvdygpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICRkaWFsb2dfZGl2LmFwcGVuZCgkZGlhbG9nX3RpcCk7CiAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGRpYWxvZ19kaXYpOwogICAgICAgICAgICAkZGlhbG9nX2Rpdi5kaWFsb2dEcmFnKCk7CiAgICAgICAgICAgICRkaWFsb2dfY29udHJvbC5jbGljayhkaWFsb2dDb250cm9sKTsKICAgICAgICAgICAgcmV0dXJuICRkaWFsb2dfZGl2OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlU2hhZG93KCl7CiAgICAgICAgICAgIHZhciAkc2hhZG93ID0gJCgnPGRpdiBjbGFzcz0iZGlhbG9nLXNoYWRvdyIgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgbGVmdDogMHB4OyB0b3A6IDBweDsgei1pbmRleDogNTA7IGJhY2tncm91bmQ6IHJnYigwLCAwLCAwKSBub25lIHJlcGVhdCBzY3JvbGwgMCUgMCU7IG9wYWNpdHk6IDAuNTsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgZGlzcGxheTogbm9uZTsiPjwvZGl2PicpOwogICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRzaGFkb3cpOwogICAgICAgICAgICByZXR1cm4gJHNoYWRvdzsKICAgICAgICB9CgogICAgICAgIHRoaXMub3BlbiA9IGZ1bmN0aW9uKHBhcmFtcyl7CiAgICAgICAgICAgIHNob3dQYXJhbXMgPSBwYXJhbXM7CiAgICAgICAgICAgIGxpbmtMaXN0ID0gW107CiAgICAgICAgICAgIGlmKHBhcmFtcy50eXBlID09ICdsaW5rJyl7CiAgICAgICAgICAgICAgICBsaW5rTGlzdCA9IHBhcmFtcy5saXN0LnVybHM7CiAgICAgICAgICAgICAgICAkKCdkaXYuZGlhbG9nLWhlYWRlciBoMyBzcGFuLmRpYWxvZy10aXRsZScsZGlhbG9nKS50ZXh0KHBhcmFtcy50aXRsZSArICLvvJoiICtwYXJhbXMubGlzdC5maWxlbmFtZSk7CiAgICAgICAgICAgICAgICAkLmVhY2gocGFyYW1zLmxpc3QudXJscyxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGRpdiA9ICQoJzxkaXY+PGRpdiBzdHlsZT0id2lkdGg6MzBweDtmbG9hdDpsZWZ0Ij4nK2VsZW1lbnQucmFuaysnOjwvZGl2PjxkaXYgc3R5bGU9IndoaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpcyI+PGEgaHJlZj0iJytlbGVtZW50LnVybCsnIj4nK2VsZW1lbnQudXJsKyc8L2E+PC9kaXY+PC9kaXY+Jyk7CiAgICAgICAgICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy1ib2R5JyxkaWFsb2cpLmFwcGVuZCgkZGl2KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYocGFyYW1zLnR5cGUgPT0gJ2JhdGNoJyl7CiAgICAgICAgICAgICAgICBsaW5rTGlzdCA9IHBhcmFtcy5saXN0OwogICAgICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy1oZWFkZXIgaDMgc3Bhbi5kaWFsb2ctdGl0bGUnLGRpYWxvZykudGV4dChwYXJhbXMudGl0bGUpOwogICAgICAgICAgICAgICAgaWYocGFyYW1zLnNob3dhbGwpewogICAgICAgICAgICAgICAgICAgICQuZWFjaChwYXJhbXMubGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRpdGVtX2RpdiA9ICQoJzxkaXYgY2xhc3M9Iml0ZW0tY29udGFpbmVyIiBzdHlsZT0ib3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7d2hpdGUtc3BhY2U6bm93cmFwIj48L2Rpdj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRpdGVtX25hbWUgPSAkKCc8ZGl2IHN0eWxlPSJ3aWR0aDoxMDBweDtmbG9hdDpsZWZ0O292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzIiB0aXRsZT0iJytlbGVtZW50LmZpbGVuYW1lKyciPicrZWxlbWVudC5maWxlbmFtZSsnPC9kaXY+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkaXRlbV9zZXAgPSAkKCc8ZGl2IHN0eWxlPSJ3aWR0aDoxMnB4O2Zsb2F0OmxlZnQiPjxzcGFuPu+8mjwvc3Bhbj48L2Rpdj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRpdGVtX2xpbmtfZGl2ID0gJCgnPGRpdiBjbGFzcz0iaXRlbS1saW5rIiBzdHlsZT0iZmxvYXQ6bGVmdDt3aWR0aDo2MThweDsiPjwvZGl2PicpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGl0ZW1fZmlyc3QgPSAkKCc8ZGl2IGNsYXNzPSJpdGVtLWZpcnN0IiBzdHlsZT0ib3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXMiPjxhIGhyZWY9IicrZWxlbWVudC5kb3dubG9hZGxpbmsrJyI+JytlbGVtZW50LmRvd25sb2FkbGluaysnPC9hPjwvZGl2PicpOwogICAgICAgICAgICAgICAgICAgICAgICAkaXRlbV9saW5rX2Rpdi5hcHBlbmQoJGl0ZW1fZmlyc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gocGFyYW1zLmFsbGxpc3RbaW5kZXhdLmxpbmtzLGZ1bmN0aW9uKG4saXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihlbGVtZW50LmRvd25sb2FkbGluayA9PSBpdGVtLnVybCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGl0ZW0gPSAkKCc8ZGl2IGNsYXNzPSJpdGVtLWV4IiBzdHlsZT0iZGlzcGxheTpub25lO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzIj48YSBocmVmPSInK2l0ZW0udXJsKyciPicraXRlbS51cmwrJzwvYT48L2Rpdj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtX2xpbmtfZGl2LmFwcGVuZCgkaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGl0ZW1fZXggPSAkKCc8ZGl2IHN0eWxlPSJ3aWR0aDoxNXB4O2Zsb2F0OmxlZnQ7Y3Vyc29yOnBvaW50ZXI7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1zaXplOjE2cHgiPjxzcGFuPis8L3NwYW4+PC9kaXY+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtX2Rpdi5hcHBlbmQoJGl0ZW1fbmFtZSkuYXBwZW5kKCRpdGVtX3NlcCkuYXBwZW5kKCRpdGVtX2xpbmtfZGl2KS5hcHBlbmQoJGl0ZW1fZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAkaXRlbV9leC5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRwYXJlbnQgPSAkKHRoaXMpLnBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcmVudC50b2dnbGVDbGFzcygnc2hvd2FsbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBhcmVudC5oYXNDbGFzcygnc2hvd2FsbCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnRleHQoJy0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdkaXYuaXRlbS1saW5rIGRpdi5pdGVtLWV4JywkcGFyZW50KS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykudGV4dCgnKycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Rpdi5pdGVtLWxpbmsgZGl2Lml0ZW0tZXgnLCRwYXJlbnQpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Rpdi5kaWFsb2ctYm9keScsZGlhbG9nKS5hcHBlbmQoJGl0ZW1fZGl2KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICQuZWFjaChwYXJhbXMubGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRkaXYgPSAkKCc8ZGl2IHN0eWxlPSJvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczt3aGl0ZS1zcGFjZTpub3dyYXAiPjxkaXYgc3R5bGU9IndpZHRoOjEwMHB4O2Zsb2F0OmxlZnQ7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXMiIHRpdGxlPSInK2VsZW1lbnQuZmlsZW5hbWUrJyI+JytlbGVtZW50LmZpbGVuYW1lKyc8L2Rpdj48c3Bhbj7vvJo8L3NwYW4+PGEgaHJlZj0iJytlbGVtZW50LmRvd25sb2FkbGluaysnIj4nK2VsZW1lbnQuZG93bmxvYWRsaW5rKyc8L2E+PC9kaXY+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Rpdi5kaWFsb2ctYm9keScsZGlhbG9nKS5hcHBlbmQoJGRpdik7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHBhcmFtcy50aXApewogICAgICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy10aXAgcCcsZGlhbG9nKS50ZXh0KHBhcmFtcy50aXApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihwYXJhbXMuc2hvd2NvcHkpewogICAgICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy1idXR0b24nLGRpYWxvZykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy1idXR0b24gYnV0dG9uI2RpYWxvZy1jb3B5LWJ1dHRvbicsZGlhbG9nKS5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYocGFyYW1zLnNob3dlZGl0KXsKICAgICAgICAgICAgICAgICQoJ2Rpdi5kaWFsb2ctYnV0dG9uJyxkaWFsb2cpLnNob3coKTsKICAgICAgICAgICAgICAgICQoJ2Rpdi5kaWFsb2ctYnV0dG9uIGJ1dHRvbiNkaWFsb2ctZWRpdC1idXR0b24nLGRpYWxvZykuc2hvdygpOwogICAgICAgICAgICAgICAgaWYoZWRpdGVkID09IDApewogICAgICAgICAgICAgICAgICAgIHZhciAkZGlhbG9nX3RleHRhcmVhID0gJCgnPHRleHRhcmVhIG5hbWU9ImRpYWxvZy10ZXh0YXJlYSIgc3R5bGU9ImRpc3BsYXk6bm9uZTt3aWR0aDo3NThweDtoZWlnaHQ6MzAwcHg7d2hpdGUtc3BhY2U6cHJlO3dvcmQtd3JhcDpub3JtYWw7b3ZlcmZsb3cteDpzY3JvbGwiPjwvdGV4dGFyZWE+Jyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZihzaG93UGFyYW1zLnR5cGUgPT0gJ2JhdGNoJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChsaW5rTGlzdCxmdW5jdGlvbihpbmRleCxlbGVtZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQuZG93bmxvYWRsaW5rID09ICdlcnJvcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXggPT0gbGlua0xpc3QubGVuZ3RoLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQgKyBlbGVtZW50LmRvd25sb2FkbGluazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gIGNvbnRlbnQgKyBlbGVtZW50LmRvd25sb2FkbGluayArICdcbic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaG93UGFyYW1zLnR5cGUgPT0gJ2xpbmsnKXsKICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGxpbmtMaXN0LGZ1bmN0aW9uKGluZGV4LGVsZW1lbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZWxlbWVudC51cmwgPT0gJ2Vycm9yJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCA9PSBsaW5rTGlzdC5sZW5ndGgtMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gY29udGVudCArIGVsZW1lbnQudXJsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAgY29udGVudCArIGVsZW1lbnQudXJsICsgJ1xuJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRkaWFsb2dfdGV4dGFyZWEudGV4dChjb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAkKCdkaXYuZGlhbG9nLWJvZHknLGRpYWxvZykuYXBwZW5kKCRkaWFsb2dfdGV4dGFyZWEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBzaGFkb3cuc2hvdygpOwogICAgICAgICAgICBkaWFsb2cuc2hvdygpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jbG9zZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGRpYWxvZ0NvbnRyb2woKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRpYWxvZ0NvbnRyb2woKXsKICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy1ib2R5JyxkaWFsb2cpLmNoaWxkcmVuKCkucmVtb3ZlKCk7CiAgICAgICAgICAgICQoJ2Rpdi5kaWFsb2ctaGVhZGVyIGgzIHNwYW4uZGlhbG9nLXRpdGxlJyxkaWFsb2cpLnRleHQoJycpOwogICAgICAgICAgICAkKCdkaXYuZGlhbG9nLXRpcCBwJyxkaWFsb2cpLnRleHQoJycpOwogICAgICAgICAgICAkKCdkaXYuZGlhbG9nLWJ1dHRvbicsZGlhbG9nKS5oaWRlKCk7CiAgICAgICAgICAgICQoJ2Rpdi5kaWFsb2ctYnV0dG9uIGJ1dHRvbiNkaWFsb2ctY29weS1idXR0b24nLGRpYWxvZykuaGlkZSgpOwogICAgICAgICAgICAkKCdkaXYuZGlhbG9nLWJ1dHRvbiBidXR0b24jZGlhbG9nLWVkaXQtYnV0dG9uJyxkaWFsb2cpLmhpZGUoKTsKICAgICAgICAgICAgJCgnZGl2LmRpYWxvZy1idXR0b24gYnV0dG9uI2RpYWxvZy1leGl0LWJ1dHRvbicsZGlhbG9nKS5oaWRlKCk7CiAgICAgICAgICAgIGVkaXRlZCA9IDA7CiAgICAgICAgICAgIGRpYWxvZy5oaWRlKCk7CiAgICAgICAgICAgIHNoYWRvdy5oaWRlKCk7CiAgICAgICAgfQoKICAgICAgICBkaWFsb2cgPSBjcmVhdGVEaWFsb2coKTsKICAgICAgICBzaGFkb3cgPSBjcmVhdGVTaGFkb3coKTsKICAgIH0KCiAgICBmdW5jdGlvbiBWQ29kZURpYWxvZyhyZWZyZXNoVkNvZGUsY29uZmlybUNsaWNrKXsKICAgICAgICB2YXIgZGlhbG9nLHNoYWRvdzsKICAgICAgICBmdW5jdGlvbiBjcmVhdGVEaWFsb2coKXsKICAgICAgICAgICAgdmFyIHNjcmVlbldpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsKICAgICAgICAgICAgdmFyIGRpYWxvZ0xlZnQgPSBzY3JlZW5XaWR0aD41MjAgPyAoc2NyZWVuV2lkdGgtNTIwKS8yIDogMDsKICAgICAgICAgICAgdmFyICRkaWFsb2dfZGl2ID0gJCgnPGRpdiBjbGFzcz0iZGlhbG9nIiBpZD0iZGlhbG9nLXZjb2RlIiBzdHlsZT0id2lkdGg6NTIwcHg7dG9wOjBweDtib3R0b206YXV0bztsZWZ0OicrZGlhbG9nTGVmdCsncHg7cmlnaHQ6YXV0bztkaXNwbGF5Om5vbmU7dmlzaWJpbGl0eTp2aXNpYmxlO3otaW5kZXg6NTIiPjwvZGl2PicpOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19oZWFkZXIgPSAkKCc8ZGl2IGNsYXNzPSJkaWFsb2ctaGVhZGVyIj48aDM+PHNwYW4gY2xhc3M9ImRpYWxvZy1oZWFkZXItdGl0bGUiPjxlbSBjbGFzcz0ic2VsZWN0LXRleHQiPuaPkOekujwvZW0+PC9zcGFuPjwvaDM+PC9kaXY+Jyk7CiAgICAgICAgICAgIHZhciAkZGlhbG9nX2NvbnRyb2wgPSAkKCc8ZGl2IGNsYXNzPSJkaWFsb2ctY29udHJvbCI+PHNwYW4gY2xhc3M9ImRpYWxvZy1pY29uIGRpYWxvZy1jbG9zZSBpY29uIGljb24tY2xvc2UiPjxzcGFuIGNsYXNzPSJzaWNvbiI+eDwvc3Bhbj48L3NwYW4+PC9kaXY+Jyk7CiAgICAgICAgICAgIHZhciAkZGlhbG9nX2JvZHkgPSAkKCc8ZGl2IGNsYXNzPSJkaWFsb2ctYm9keSI+PC9kaXY+Jyk7CiAgICAgICAgICAgIHZhciAkZGlhbG9nX2JvZHlfZGl2ID0gJCgnPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoyMnB4Ij48L2Rpdj4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfYm9keV9kb3dubG9hZF92ZXJpZnkgPSAkKCc8ZGl2IGNsYXNzPSJkb3dubG9hZC12ZXJpZnkiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7cGFkZGluZzowIDI4cHg7dGV4dC1hbGlnbjpsZWZ0O2ZvbnQtc2l6ZToxMnB4OyI+PC9kaXY+Jyk7CiAgICAgICAgICAgIHZhciAkZGlhbG9nX3ZlcmlmeV9ib2R5ID0gJCgnPGRpdiBjbGFzcz0idmVyaWZ5LWJvZHkiPuivt+i+k+WFpemqjOivgeegge+8mjwvZGl2PicpOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19pbnB1dCA9ICQoJzxpbnB1dCBpZD0iZGlhbG9nLWlucHV0IiB0eXBlPSJ0ZXh0IiBzdHlsZT0icGFkZGluZzozcHg7d2lkdGg6ODVweDtoZWlnaHQ6MjNweDtib3JkZXI6MXB4IHNvbGlkICNjNmM2YzY7YmFja2dyb3VuZC1jb2xvcjp3aGl0ZTt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7IiBjbGFzcz0iaW5wdXQtY29kZSIgbWF4bGVuZ3RoPSI0Ij4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfaW1nID0gJCgnPGltZyBpZD0iZGlhbG9nLWltZyIgY2xhc3M9ImltZy1jb2RlIiBzdHlsZT0ibWFyZ2luLWxlZnQ6MTBweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7IiBhbHQ9IueCueWHu+aNouS4gOW8oCIgc3JjPSIiIHdpZHRoPSIxMDAiIGhlaWdodD0iMzAiPicpOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19yZWZyZXNoID0gJCgnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0idGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTsiIGNsYXNzPSJ1bmRlcmxpbmUiPuaNouS4gOW8oDwvYT4nKTsKICAgICAgICAgICAgdmFyICRkaWFsb2dfZXJyID0gJCgnPGRpdiBpZD0iZGlhbG9nLWVyciIgc3R5bGU9InBhZGRpbmctbGVmdDo4NHB4O2hlaWdodDoxOHB4O2NvbG9yOiNkODAwMDAiIGNsYXNzPSJ2ZXJpZnktZXJyb3IiPjwvZGl2PicpOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19mb290ZXIgPSAkKCc8ZGl2IGNsYXNzPSJkaWFsb2ctZm9vdGVyIGctY2xlYXJmaXgiPjwvZGl2PicpOwogICAgICAgICAgICB2YXIgJGRpYWxvZ19jb25maXJtX2J1dHRvbiA9ICQoJzxhIGNsYXNzPSJnLWJ1dHRvbiBnLWJ1dHRvbi1ibHVlIiBkYXRhLWJ1dHRvbi1pZD0iIiBkYXRhLWJ1dHRvbi1pbmRleCBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MzZweCI+PHNwYW4gY2xhc3M9ImctYnV0dG9uLXJpZ2h0IiBzdHlsZT0icGFkZGluZy1yaWdodDozNnB4OyI+PHNwYW4gY2xhc3M9InRleHQiIHN0eWxlPSJ3aWR0aDphdXRvOyI+56Gu5a6aPC9zcGFuPjwvc3Bhbj48L2E+Jyk7CiAgICAgICAgICAgIHZhciAkZGlhbG9nX2NhbmNlbF9idXR0b24gPSAkKCc8YSBjbGFzcz0iZy1idXR0b24iIGRhdGEtYnV0dG9uLWlkPSIiIGRhdGEtYnV0dG9uLWluZGV4IGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiIHN0eWxlPSJwYWRkaW5nLWxlZnQ6IDM2cHg7Ij48c3BhbiBjbGFzcz0iZy1idXR0b24tcmlnaHQiIHN0eWxlPSJwYWRkaW5nLXJpZ2h0OiAzNnB4OyI+PHNwYW4gY2xhc3M9InRleHQiIHN0eWxlPSJ3aWR0aDogYXV0bzsiPuWPlua2iDwvc3Bhbj48L3NwYW4+PC9hPicpOwoKICAgICAgICAgICAgJGRpYWxvZ19oZWFkZXIuYXBwZW5kKCRkaWFsb2dfY29udHJvbCk7CiAgICAgICAgICAgICRkaWFsb2dfdmVyaWZ5X2JvZHkuYXBwZW5kKCRkaWFsb2dfaW5wdXQpLmFwcGVuZCgkZGlhbG9nX2ltZykuYXBwZW5kKCRkaWFsb2dfcmVmcmVzaCk7CiAgICAgICAgICAgICRkaWFsb2dfYm9keV9kb3dubG9hZF92ZXJpZnkuYXBwZW5kKCRkaWFsb2dfdmVyaWZ5X2JvZHkpLmFwcGVuZCgkZGlhbG9nX2Vycik7CiAgICAgICAgICAgICRkaWFsb2dfYm9keV9kaXYuYXBwZW5kKCRkaWFsb2dfYm9keV9kb3dubG9hZF92ZXJpZnkpOwogICAgICAgICAgICAkZGlhbG9nX2JvZHkuYXBwZW5kKCRkaWFsb2dfYm9keV9kaXYpOwogICAgICAgICAgICAkZGlhbG9nX2Zvb3Rlci5hcHBlbmQoJGRpYWxvZ19jb25maXJtX2J1dHRvbikuYXBwZW5kKCRkaWFsb2dfY2FuY2VsX2J1dHRvbik7CiAgICAgICAgICAgICRkaWFsb2dfZGl2LmFwcGVuZCgkZGlhbG9nX2hlYWRlcikuYXBwZW5kKCRkaWFsb2dfYm9keSkuYXBwZW5kKCRkaWFsb2dfZm9vdGVyKTsKICAgICAgICAgICAgJCgnYm9keScpLmFwcGVuZCgkZGlhbG9nX2Rpdik7CgogICAgICAgICAgICAkZGlhbG9nX2Rpdi5kaWFsb2dEcmFnKCk7CgogICAgICAgICAgICAkZGlhbG9nX2NvbnRyb2wuY2xpY2soZGlhbG9nQ29udHJvbCk7CiAgICAgICAgICAgICRkaWFsb2dfaW1nLmNsaWNrKHJlZnJlc2hWQ29kZSk7CiAgICAgICAgICAgICRkaWFsb2dfcmVmcmVzaC5jbGljayhyZWZyZXNoVkNvZGUpOwogICAgICAgICAgICAkZGlhbG9nX2lucHV0LmtleXByZXNzKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgIGlmKGV2ZW50LndoaWNoID09IDEzKQogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1DbGljaygpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGRpYWxvZ19jb25maXJtX2J1dHRvbi5jbGljayhjb25maXJtQ2xpY2spOwogICAgICAgICAgICAkZGlhbG9nX2NhbmNlbF9idXR0b24uY2xpY2soZGlhbG9nQ29udHJvbCk7CiAgICAgICAgICAgICRkaWFsb2dfaW5wdXQuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICQoJyNkaWFsb2ctZXJyJykudGV4dCgnJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gJGRpYWxvZ19kaXY7CiAgICAgICAgfQogICAgICAgIHRoaXMub3BlbiA9IGZ1bmN0aW9uKHZjb2RlKXsKICAgICAgICAgICAgaWYodmNvZGUpCiAgICAgICAgICAgICAgICAkKCcjZGlhbG9nLWltZycpLmF0dHIoJ3NyYycsdmNvZGUuaW1nKTsKICAgICAgICAgICAgZGlhbG9nLnNob3coKTsKICAgICAgICAgICAgc2hhZG93LnNob3coKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jbG9zZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGRpYWxvZ0NvbnRyb2woKTsKICAgICAgICB9CiAgICAgICAgZGlhbG9nID0gY3JlYXRlRGlhbG9nKCk7CiAgICAgICAgc2hhZG93ID0gJCgnZGl2LmRpYWxvZy1zaGFkb3cnKTsKICAgICAgICBmdW5jdGlvbiBkaWFsb2dDb250cm9sKCl7CiAgICAgICAgICAgICQoJyNkaWFsb2ctaW1nJyxkaWFsb2cpLmF0dHIoJ3NyYycsJycpOwogICAgICAgICAgICAkKCcjZGlhbG9nLWVycicpLnRleHQoJycpOwogICAgICAgICAgICBkaWFsb2cuaGlkZSgpOwogICAgICAgICAgICBzaGFkb3cuaGlkZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAkLmZuLmRpYWxvZ0RyYWcgPSBmdW5jdGlvbigpewogICAgICAgIHZhciBtb3VzZUluaXRYLG1vdXNlSW5pdFksZGlhbG9nSW5pdFgsZGlhbG9nSW5pdFk7CiAgICAgICAgdmFyIHNjcmVlbldpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsKICAgICAgICB2YXIgJHBhcmVudCA9IHRoaXM7CiAgICAgICAgJCgnZGl2LmRpYWxvZy1oZWFkZXInLHRoaXMpLm1vdXNlZG93bihmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIG1vdXNlSW5pdFggPSBwYXJzZUludChldmVudC5wYWdlWCk7CiAgICAgICAgICAgIG1vdXNlSW5pdFkgPSBwYXJzZUludChldmVudC5wYWdlWSk7CiAgICAgICAgICAgIGRpYWxvZ0luaXRYID0gcGFyc2VJbnQoJHBhcmVudC5jc3MoJ2xlZnQnKS5yZXBsYWNlKCdweCcsJycpKTsKICAgICAgICAgICAgZGlhbG9nSW5pdFkgPSBwYXJzZUludCgkcGFyZW50LmNzcygndG9wJykucmVwbGFjZSgncHgnLCcnKSk7CiAgICAgICAgICAgICQodGhpcykubW91c2Vtb3ZlKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgIHZhciB0ZW1wWCA9IGRpYWxvZ0luaXRYICsgcGFyc2VJbnQoZXZlbnQucGFnZVgpIC0gbW91c2VJbml0WDsKICAgICAgICAgICAgICAgIHZhciB0ZW1wWSA9IGRpYWxvZ0luaXRZICsgcGFyc2VJbnQoZXZlbnQucGFnZVkpIC0gbW91c2VJbml0WTsKICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IHBhcnNlSW50KCRwYXJlbnQuY3NzKCd3aWR0aCcpLnJlcGxhY2UoJ3B4JywnJykpOwogICAgICAgICAgICAgICAgdGVtcFggPSB0ZW1wWDwwID8gMCA6IHRlbXBYPnNjcmVlbldpZHRoLXdpZHRoID8gc2NyZWVuV2lkdGgtd2lkdGggOiB0ZW1wWDsKICAgICAgICAgICAgICAgIHRlbXBZID0gdGVtcFk8MCA/IDAgOiB0ZW1wWTsKICAgICAgICAgICAgICAgICRwYXJlbnQuY3NzKCdsZWZ0Jyx0ZW1wWCsncHgnKS5jc3MoJ3RvcCcsdGVtcFkrJ3B4Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgICQoJ2Rpdi5kaWFsb2ctaGVhZGVyJyx0aGlzKS5tb3VzZXVwKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgJCh0aGlzKS51bmJpbmQoJ21vdXNlbW92ZScpOwogICAgICAgIH0pOwogICAgfQoKfSkoKTs="},{"name":"YouTube +","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://www.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":["*://www.youtube.com/tv*","*://www.youtube.com/embed/*","*://www.youtube.com/live_chat*"],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":true,"orig_connects":[]}},"storage":{"ts":1483678683016,"data":{"particleSettings":"s{\"GEN_BTTR_NTF\":true,\"GEN_SUB_LIST\":true,\"GEN_INF_SCRL\":true,\"GEN_BLUE_GLOW\":true,\"GEN_PPOT_ON\":true,\"VID_END_SHRE\":true,\"VID_DFLT_QLTY\":\"auto\",\"VID_PLST_ATPL\":true,\"VID_PLST_RVRS\":true,\"VID_PLR_ATPL\":true,\"VID_PLR_ALVIS\":true,\"VID_PLR_SIZE_MEM\":true,\"VID_PLR_VOL_LDN\":true,\"VID_POST_TIME\":true,\"VID_VID_CNT\":true,\"VID_DESC_SHRT\":true,\"VID_PPOT_SZ\":533,\"VID_PLR_HTML5\":true,\"BLK_ON\":true,\"floaterX\":2000,\"floaterY\":2000,\"firstTime\":true,\"volLev\":50,\"advOpts\":true,\"blacklist\":{},\"extLang\":{\"zh_TW\":{\"YTSETS\":\"YouTube+ è¨­å®š\",\"ADV_OPTS\":\"é€²éšŽé¸é …\",\"SUB_PLST\":\"æ’­æ”¾æœ€æ–°ä¸Šå‚³çš„å…§å®¹\",\"BLCK_ADD\":\"åŠ å…¥åˆ°é»‘åå–®\",\"BLCK_EDIT\":\"ç·¨è¼¯\",\"BLCK_SAVE\":\"ä¿å­˜\",\"BLCK_CLSE\":\"é—œé–‰\",\"CNSL_AP\":\"è‡ªå‹•æ’­æ”¾\",\"CNSL_RPT\":\"å†æ¬¡æ’­æ”¾å½±ç‰‡\",\"CNSL_SVTH\":\"æ‰“é–‹ç¸®åœ–\",\"CNSL_SS\":\"èž¢å¹•æˆªåœ–\",\"CNSL_SS_CLS\":\"é—œé–‰\",\"CNSL_FLBR\":\"ç¶²é å…¨èž¢å¹•æ¨¡å¼\",\"CNSL_CINM_MD\":\"å½±é™¢æ¨¡å¼\",\"CNSL_FRME\":\"é€å¹€\",\"PLST_AP\":\"è‡ªå‹•æ’­æ”¾\",\"PLST_RVRS\":\"å¾Œé€€\",\"SHOW_CMTS\":\"é¡¯ç¤ºè©•è«–\",\"HIDE_CMTS\":\"éš±è—è©•è«–\",\"GLB_IMPR\":\"åŒ¯å…¥/åŒ¯å‡ºè¨­å®š\",\"GLB_LOCL_LANG\":\"é»žæ“Šä»¥è¨­å®š YT+ èªžè¨€\",\"GLB_LOCL_LANG_CSTM\":\"æœ¬åœ°åŒ–\",\"GLB_IMPR_SAVE\":\"ä¿å­˜å’ŒåŠ è¼‰\",\"GLB_RSET\":\"é‡è¨­\",\"GLB_SVE\":\"ä¿å­˜\",\"GLB_SVE_SETS\":\"è¨­å®šå·²ä¿å­˜\",\"FTR_DESC\":\"é€™æ˜¯ä»€éº¼\",\"GEN\":\"ä¸€èˆ¬\",\"VID\":\"å½±ç‰‡\",\"CHN\":\"é »é“\",\"BLK\":\"é»‘åå–®\",\"ABT\":\"é—œæ–¼\",\"HLP\":\"å¹«åŠ©\",\"DNT\":\"æè´ˆ\",\"GEN_TTL\":\"é€šç”¨è¨­å®š\",\"GEN_GEN\":\"ä¸€èˆ¬\",\"GEN_LYT\":\"ä»‹é¢\",\"GEN_LOCL_LANG\":\"ä½¿ç”¨æ›´æ”¹éŽçš„ YT+ èªžè¨€\",\"GEN_DSBL_ADS\":\"ç¦æ­¢å½±ç‰‡é é¢ä»¥å¤–çš„å»£å‘Š\",\"GEN_INF_SCRL\":\"åœ¨è¨Šæ¯æºåˆ—è¡¨å•Ÿç”¨ç„¡é™æ»¾å‹•\",\"GEN_YT_LOGO_LINK\":\"å°‡YouTubeæ¨™èªŒé‡å®šå‘åˆ°è¨‚é–±\",\"GEN_SUB_LIST\":\"å•Ÿç”¨æ’­æ”¾åˆ—è¡¨è¨‚é–±\",\"GEN_REM_APUN\":\"åˆªé™¤è‡ªå‹•æ’­æ”¾ä¸‹ä¸€å€‹\",\"GEN_SPF_OFF\":\"é—œé–‰SPF\",\"GEN_HIDE_FTR\":\"éš±è—é è…³\",\"GEN_BLUE_GLOW\":\"åˆªé™¤é»žæ“ŠéŽçš„æŒ‰éˆ•å‘¨åœçš„è—è‰²å…‰åœˆ\",\"GEN_HDE_RECM_SDBR\":\"éš±è—æŽ¨è–¦é »é“å´é‚Šæ¬„\",\"GEN_HDE_SRCH_SDBR\":\"éš±è—æœç´¢çµæžœå´é‚Šæ¬„\",\"GEN_HDE_CHN_SDBR\":\"éš±è—é »é“å´é‚Šæ¬„\",\"GEN_CMPT_TTLS\":\"åœ¨è¨Šæ¯æºä¸­ä½¿ç”¨ç·Šæ¹Šåž‹æ¨™é¡Œ\",\"GEN_DSB_HVRC\":\"é—œé–‰æ‡¸åœå¡ç‰‡\",\"GEN_BTTR_NTF\":\"æ”¹é€²çš„è—è‰²é€šçŸ¥æ¡†\",\"GEN_GRID_SUBS\":\"åœ¨è¨‚é–±ä¸­ä½¿ç”¨ç¶²æ ¼ä»‹é¢\",\"GEN_GRID_SRCH\":\"åœ¨æœç´¢çµæžœä¸­ä½¿ç”¨ç¶²æ ¼ä»‹é¢\",\"VID_TTL\":\"å½±ç‰‡è¨­å®š\",\"VID_PLR\":\"æ’­æ”¾å™¨è¨­å®š\",\"VID_PLR_LYT\":\"æ’­æ”¾å™¨ä»‹é¢\",\"VID_DFLT_QLTY\":\"é è¨­å½±ç‰‡è³ªé‡ï¼š\",\"VID_DFLT_QLTY_AUTO\":\"è‡ªå‹•\",\"VID_DFLT_QLTY_TNY\":\"144p\",\"VID_DFLT_QLTY_SML\":\"240p\",\"VID_DFLT_QLTY_MDM\":\"360p\",\"VID_DFLT_QLTY_LRG\":\"480p\",\"VID_DFLT_QLTY_720\":\"720p\",\"VID_DFLT_QLTY_1080\":\"1080p\",\"VID_DFLT_QLTY_1440\":\"1440p\",\"VID_DFLT_QLTY_2160\":\"2160p (4k)\",\"VID_DFLT_QLTY_2880\":\"2880p (5k)\",\"VID_DFLT_QLTY_ORIG\":\"4320p (8k)\",\"VID_PLR_ALVIS\":\"é–±è®€è©•è«–æ™‚ä¿æŒæ’­æ”¾å™¨å¯è¦‹\",\"VID_PLR_ALVIS_RST\":\"é‡è¨­ä½ç½®\",\"VID_PLR_ALVIS_SCRL_TOP\":\"è¿”å›žé ‚éƒ¨\",\"VID_PLR_ATPL\":\"è‡ªå‹•æ’­æ”¾å½±ç‰‡\",\"VID_LAYT\":\"ä»‹é¢\",\"VID_VID_CNT\":\"é¡¯ç¤ºæŒ‡å‘å·²ä¸Šå‚³å½±ç‰‡æ•¸çš„éˆ\",\"VID_POST_TIME\":\"é¡¯ç¤ºå½±ç‰‡å·²ç™¼å¸ƒæ™‚é–“\",\"VID_HIDE_DETLS\":\"éš±è—å½±ç‰‡è©³ç´°è³‡æ–™\",\"VID_HIDE_COMS\":\"è©•è«–å€\",\"VID_HIDE_COMS_SHOW\":\"é¡¯ç¤º\",\"VID_HIDE_COMS_HIDE\":\"éš±è—\",\"VID_HIDE_COMS_REM\":\"åˆªé™¤\",\"VID_END_SHRE\":\"å½±ç‰‡çµæŸæ™‚é—œé–‰åˆ†äº«é¢æ¿\",\"VID_PLST\":\"æ’­æ”¾åˆ—è¡¨\",\"VID_PLST_ATPL\":\"å•Ÿç”¨è‡ªå‹•æ’­æ”¾åˆ—è¡¨\",\"VID_PLST_RVRS\":\"å•Ÿç”¨åå‘æ’­æ”¾åˆ—è¡¨\",\"VID_PLR_SIZE_MEM\":\"è¨˜ä½æ’­æ”¾æ¨¡å¼\",\"VID_VOL_WHEEL\":\"ä½¿ç”¨é¼ æ¨™æ»¾è¼ªæ”¹è®ŠéŸ³é‡\",\"VID_PLR_VOL_MEM\":\"è¨˜ä½éŸ³é‡\",\"VID_PLR_ADS\":\"åœ¨å½±ç‰‡é é¢é—œé–‰å»£å‘Š\",\"VID_PLR_ALACT\":\"æ’­æ”¾å™¨å¿«æ·æ–¹å¼å§‹çµ‚è™•æ–¼æ´»å‹•ç‹€æ…‹\",\"VID_SUB_ADS\":\"åƒ…åœ¨è¨‚é–±é »é“çš„å½±ç‰‡ä¸­å•Ÿç”¨å»£å‘Š\",\"VID_PLR_ANTS\":\"é—œé–‰æ³¨é‡‹\",\"VID_PLR_DASH\":\"é—œé–‰æ’­æ”¾\",\"VID_PLR_CC\":\"é—œé–‰å­—å¹•å’ŒCC\",\"VID_PLR_INFO\":\"å•Ÿç”¨ç¨å¾Œè§€çœ‹æŒ‰éˆ•\",\"VID_PLR_FIT\":\"é©æ‡‰é é¢ç‚ºåŠ‡å ´æ¨¡å¼\",\"VID_PLR_FIT_WDTH\":\"é©æ‡‰é é¢ç‚ºæœ€å¤§å¯¬åº¦:\",\"VID_PLR_DYN_SIZE\":\"åœ¨é è¨­è¦–åœ–é—œé–‰æ’­æ”¾å™¨å‹•æ…‹å°ºå¯¸èª¿ç¯€\",\"VID_DESC_SHRT\":\"çŸ­å½±ç‰‡æè¿°æŒ‰éˆ•\",\"VID_TTL_CMPT\":\"åœ¨å½±ç‰‡æè¿°é æ‘ºç–Šæ¨™é¡Œ\",\"VID_LAYT_AUTO_PNL\":\"è‡ªå‹•å±•é–‹å½±ç‰‡æè¿°\",\"GEN_CHN_DFLT_PAGE\":\"é è¨­çš„é »é“é é¢:\",\"GEN_CHN_DFLT_PAGE_DFLT\":\"é è¨­\",\"GEN_CHN_DFLT_PAGE_VID\":\"å½±ç‰‡\",\"GEN_CHN_DFLT_PAGE_PL\":\"æ’­æ”¾åˆ—è¡¨\",\"GEN_CHN_DFLT_PAGE_CHN\":\"é »é“\",\"GEN_CHN_DFLT_PAGE_DISC\":\"è¨Žè«–\",\"GEN_CHN_DFLT_PAGE_ABT\":\"é—œæ–¼\",\"BLK_TTL\":\"é»‘åå–®è¨­å®š\",\"BLK_BLK\":\"é»‘åå–®\",\"BLK_ON\":\"å•Ÿç”¨é»‘åå–®\",\"ABT_TTL\":\"è¨Šæ¯å’Œæœ‰ç”¨çš„éˆæŽ¥\",\"ABT_THKS\":\"é³´è¬:\",\"ABT_THKS_YEPPHA\":\"ï¼Œä»–å€‘çš„å·¥ä½œçµ¦æ­¤é …ç›®å¸¶ä¾†äº†éˆæ„Ÿï¼Œæ²’æœ‰ä»–å€‘ä»Šå¤©é€™äº›éƒ½ä¸æœƒå­˜åœ¨ã€‚\",\"ABT_THKS_USERSCRIPT\":\" ä½¿é–‹ç™¼å’Œç™¼è¡Œç¬¬ä¸‰æ–¹è»Ÿä»¶çš„ä»»å‹™ç„¡æ¯”ç°¡å–®ã€‚\",\"ABT_THKS_STACKOV\":\" ç„¡åƒ¹çš„è¨Šæ¯å°è»Ÿä»¶é–‹ç™¼åšå‡ºäº†å·¨å¤§è²¢ç»ã€‚\",\"ABT_INFO\":\"å®˜æ–¹é é¢\",\"ABT_LNK_GHB\":\"GitHub\",\"ABT_LNK_GRFK\":\"Greasy Fork\",\"ABT_LNK_OPNU\":\"OpenUserJS\",\"LOCALE\":\"ä¸­æ–‡ (ç¹é«”)\",\"lastMod\":1483377370000},\"nextCheck\":1484283483015}}"}},"enabled":true,"position":11,"file_url":"https://greasyfork.org/scripts/9932-youtube/code/YouTube%20+.user.js","uuid":"2a7d33ba-6291-4a42-885b-87cd4e342c14","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQHZlcnNpb24gICAgICAgICAxLjcuNQovLyBAbmFtZSAgICAgICAgICAgIFlvdVR1YmUgKwovLyBAbmFtZXNwYWNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUKLy8gQGRlc2NyaXB0aW9uICAgICBZb3VUdWJlIHdpdGggbW9yZSBmcmVlZG9tCi8vIEBpY29uICAgICAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS9naC1wYWdlcy9pbWFnZXMvWVQlMkJpY29uLnBuZwovLyBAbWF0Y2ggICAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vdHYqCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8qCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9saXZlX2NoYXQqCi8vIEBydW4tYXQgICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQGhvbWVwYWdlVVJMICAgICBodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlCi8vIEBzdXBwb3J0VVJMICAgICAgaHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpCi8vIEBjb250cmlidXRpb25VUkwgaHR0cHM6Ly93d3cucGF5cGFsLmNvbS9jZ2ktYmluL3dlYnNjcj9jbWQ9X3MteGNsaWNrJmhvc3RlZF9idXR0b25faWQ9VU1WUUpKRkc0QkZIVwovLyBAZ3JhbnQgICAgICAgICAgIEdNX2dldFZhbHVlCi8vIEBncmFudCAgICAgICAgICAgR01fc2V0VmFsdWUKLy8gQG5vZnJhbWVzCi8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24gKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHBhcnRpY2xlID0gewogICAgICAgIGluamVjdDogZnVuY3Rpb24oaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICBmdW5jdGlvbiBzZXRMb2NhbGUoY29udGVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGxpc3QsIHRlbXAsIHl0cGxhYmVsOwogICAgICAgICAgICAgICAgeXRwbGFiZWwgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXBdIik7CiAgICAgICAgICAgICAgICBpID0geXRwbGFiZWwubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QgPSB5dHBsYWJlbFtpXS5kYXRhc2V0LnAuc3BsaXQoIiYiKTsKICAgICAgICAgICAgICAgICAgICBqID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gbGlzdFtqXS5zcGxpdCgifCIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFswXSA9PT0gInRuZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0cGxhYmVsW2ldLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxhbmcodGVtcFsxXSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wWzBdID09PSAidHRsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uc2V0QXR0cmlidXRlKCJ0aXRsZSIsIGxhbmcodGVtcFsxXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uZGF0YXNldC50b29sdGlwVGV4dCA9IGxhbmcodGVtcFsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRMb2NhbGUoZGF0YSkgewogICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgZGF0YSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZTsKICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhICYmIEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gPSBKU09OLnBhcnNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXS5sYXN0TW9kID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgNjA0OEU1OwogICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYW5nLm9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRMYW5ndWFnZShkYXRhKSB7CiAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS50YXJnZXQucmVhZHlTdGF0ZSA9PT0gNCAmJiBkYXRhLnRhcmdldC5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gPSBKU09OLnBhcnNlKGRhdGEudGFyZ2V0LnJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QgPSBuZXcgRGF0ZShkYXRhLnRhcmdldC5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyA2MDQ4RTU7CiAgICAgICAgICAgICAgICBzZXQoImV4dExhbmciLCB1c2VyX3NldHRpbmdzLmV4dExhbmcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrTW9kaWZpZWQoZGF0YSkgewogICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGRhdGEudGFyZ2V0LnJlYWR5U3RhdGUgPT09IDQgJiYgZGF0YS50YXJnZXQuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0TGFuZ3VhZ2UsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJBY2NlcHQiLCAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5yYXciXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbGFuZyhsYWJlbCkgewogICAgICAgICAgICAgICAgbGFuZy55dGxhbmcgPSB3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgd2luZG93Lnl0LmNvbmZpZ18uR0FQSV9MT0NBTEU7CiAgICAgICAgICAgICAgICBsYW5nLnVybEJhc2UgPSAiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9QYXJ0aWNsZUNvcmUvUGFydGljbGUvY29udGVudHMvTG9jYWxlLyI7CiAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZykgewogICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHt9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmdbbGFiZWxdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHVzZXJfc2V0dGluZ3MuZXh0TGFuZykgIT09ICJ7fSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJleHRMYW5nIiwge30pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcl9zZXR0aW5ncy5sb2NhbExhbmdbbGFiZWxdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgbGFuZy55dGxhbmcgJiYgbGFuZy55dGxhbmcgIT09ICJlbl9VUyIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXSAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddW2xhYmVsXSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxhbmcuZmV0Y2hpbmcgJiYgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrIDw9IG5ldyBEYXRlKCkuZ2V0VGltZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihnZXRMb2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtc2V0bG9jYWxlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC5nZXRsb2NhbGUgPSBsYW5nLnl0bGFuZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkhFQUQiLCBjaGVja01vZGlmaWVkLCBsYW5nLnVybEJhc2UgKyBsYW5nLnl0bGFuZyArICIuanNvbiIsIFsiSWYtTW9kaWZpZWQtU2luY2UiLCBuZXcgRGF0ZSh1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QpLnRvVVRDU3RyaW5nKCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDYwNDhFNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ11bbGFiZWxdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gJiYgIWxhbmcuZmV0Y2hpbmcgJiYgKCF1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrIHx8IHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPD0gbmV3IERhdGUoKS5nZXRUaW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcuZmV0Y2hpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihnZXRMb2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5vYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtc2V0bG9jYWxlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQuZ2V0bG9jYWxlID0gbGFuZy55dGxhbmc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0TGFuZ3VhZ2UsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJBY2NlcHQiLCAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5yYXciXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VbbGFiZWxdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNvcnRMaXN0KHByZXZpb3VzLCBuZXh0KXsKICAgICAgICAgICAgICAgIHJldHVybiBuZXh0W09iamVjdC5rZXlzKG5leHQpWzBdXS5sb2NhbGVDb21wYXJlKHByZXZpb3VzW09iamVjdC5rZXlzKHByZXZpb3VzKVswXV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEJsYWNrbGlzdChibGlzdCkgewogICAgICAgICAgICAgICAgdmFyIGksIG9iaiwgdGVtcCwgbG5rLCBrZXlzLCBsaXN0LCBmcmFnbWVudCwgc29ydEFscGhhOwogICAgICAgICAgICAgICAgbGlzdCA9IHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0OwogICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgICAgICAgICBzb3J0QWxwaGEgPSBbXTsKICAgICAgICAgICAgICAgIHRlbXAgPSBPYmplY3Qua2V5cyhsaXN0KTsKICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgICAgICAgICBvYmpbdGVtcFtpXV0gPSBsaXN0W3RlbXBbaV1dOwogICAgICAgICAgICAgICAgICAgIHNvcnRBbHBoYS5wdXNoKG9iaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wID0gc29ydEFscGhhLnNvcnQoc29ydExpc3QpOwogICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyh0ZW1wW2ldKTsKICAgICAgICAgICAgICAgICAgICBvYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIG9iai5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBjbGFzcz0nYmxhY2tsaXN0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J2Nsb3NlJyBkYXRhLXA9J3R0bHxHTEJfUk1CTCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PScwIDAgMTAgMTAnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzEwLDEuNCA4LjYsMCA1LDMuNiAxLjQsMCAwLDEuNCAzLjYsNSAwLDguNiAxLjQsMTAgNSw2LjQgOC42LDEwIDEwLDguNiA2LjQsNScvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+PGEgdGFyZ2V0PSdfYmxhbmsnPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBvYmogPSBzZXRMb2NhbGUob2JqLmNvbnRlbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgbG5rID0gb2JqLnF1ZXJ5U2VsZWN0b3IoImEiKTsKICAgICAgICAgICAgICAgICAgICBsbmsuaHJlZiA9ICIvY2hhbm5lbC8iICsga2V5c1swXTsKICAgICAgICAgICAgICAgICAgICBsbmsuc2V0QXR0cmlidXRlKCJ0aXRsZSIsIHRlbXBbaV1ba2V5c1swXV0pOwogICAgICAgICAgICAgICAgICAgIGxuay50ZXh0Q29udGVudCA9IHRlbXBbaV1ba2V5c1swXV07CiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQob2JqKTsKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiXG4iKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBibGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmFsdWVzKG1lbnUpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB5dHAsIGxpc3Q7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncykgewogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBtZW51LnF1ZXJ5U2VsZWN0b3IoIiNibGFja2xpc3QiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBnZXRCbGFja2xpc3QobGlzdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHl0cCA9IG1lbnUucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbaWRdIik7CiAgICAgICAgICAgICAgICAgICAgaSA9IHl0cC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeXRwW2ldLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdXNlcl9zZXR0aW5nc1t5dHBbaV0uaWRdID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBbaV0uc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgInRydWUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeXRwW2ldLnR5cGUgPT09ICJ0ZXh0IiAmJiB0eXBlb2YgdXNlcl9zZXR0aW5nc1t5dHBbaV0uaWRdID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwW2ldLnNldEF0dHJpYnV0ZSgidmFsdWUiLCB1c2VyX3NldHRpbmdzW3l0cFtpXS5pZF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHl0cCA9IG1lbnUucXVlcnlTZWxlY3RvckFsbCgib3B0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgaSA9IHl0cC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5nc1t5dHBbaV0ucGFyZW50Tm9kZS5pZF0gPT09IHl0cFtpXS52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwW2ldLnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG1lbnU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWVudShzZWN0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgdGVtcCwgc3ZnLCBpbnB1dHM7CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uID09PSAiTUVOIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1Atc2V0dGluZ3MnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nUC1jb250YWluZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J1Atc2lkZWJhcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBpZD0nUC1zaWRlYmFyLWxpc3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdHRU4nIGNsYXNzPSdzZWxlY3RlZCcgZGF0YS1wPSd0bmR8R0VOJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdWSUQnIGRhdGEtcD0ndG5kfFZJRCc+PC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0nQkxLJyBkYXRhLXA9J3RuZHxCTEsnPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0FCVCcgZGF0YS1wPSd0bmR8QUJUJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdITFAnPjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2knIGRhdGEtcD0ndG5kfEhMUCc+PC9hPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0ROVCc+PGEgdGl0bGU9J1BheVBhbCcgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vd3d3LnBheXBhbC5jb20vY2dpLWJpbi93ZWJzY3I/Y21kPV9zLXhjbGljayZob3N0ZWRfYnV0dG9uX2lkPVVNVlFKSkZHNEJGSFcnIGRhdGEtcD0ndG5kfEROVCc+PC9hPjxzdmcgdmlld0JveD0nMCAwIDE1LjMgMTgnPjxwYXRoIHN0eWxlPSdmaWxsOiMyNzM0NkE7JyBkPSdNMTMsMS40QzEyLjIsMC40LDEwLjYsMCw4LjcsMEgzLjFDMi43LDAsMi40LDAuMywyLjMsMC43TDAsMTUuNEMwLDE1LjcsMC4yLDE2LDAuNSwxNmgzLjUgbDAuOS01LjVsMCwwLjJDNC44LDEwLjMsNS4yLDEwLDUuNiwxMGgxLjZjMy4yLDAsNS43LTEuMyw2LjUtNS4xYzAtMC4xLDAtMC4yLDAuMS0wLjNjLTAuMSwwLTAuMSwwLDAsMEMxNCwzLjIsMTMuNywyLjIsMTMsMS40Jy8+PHBhdGggc3R5bGU9J2ZpbGw6IzI3MzQ2QTsnIGQ9J002LjEsNC4xQzYuMiw0LDYuMyw0LDYuNCw0aDQuNGMwLjUsMCwxLDAsMS40LDAuMWMwLjEsMCwwLjIsMCwwLjQsMC4xYzAuMSwwLDAuMiwwLjEsMC4zLDAuMSBjMC4xLDAsMC4xLDAsMC4yLDAuMWMwLjIsMC4xLDAuNCwwLjIsMC42LDAuM2MwLjItMS40LDAtMi40LTAuOC0zLjJDMTIuMiwwLjQsMTAuNiwwLDguNywwSDMuMUMyLjcsMCwyLjQsMC4zLDIuMywwLjdMMCwxNS40IEMwLDE1LjcsMC4yLDE2LDAuNSwxNmgzLjVMNS43LDQuNkM1LjgsNC40LDUuOSw0LjIsNi4xLDQuMXonLz48cGF0aCBzdHlsZT0nZmlsbDojMjc5MEMzOycgZD0nTTEzLjcsNC45QzEzLDguNywxMC40LDEwLDcuMiwxMEg1LjZjLTAuNCwwLTAuNywwLjMtMC44LDAuN2wtMS4xLDYuOGMwLDAuMywwLjIsMC41LDAuNCwwLjVINyBjMC4zLDAsMC42LTAuMywwLjctMC42bDAtMC4xbDAuNS0zLjVsMC0wLjJDOC40LDEzLjMsOC43LDEzLDksMTNoMC40YzIuOCwwLDUtMS4xLDUuNy00LjVjMC4zLTEuNCwwLjEtMi41LTAuNi0zLjQgYy0wLjItMC4yLTAuNS0wLjQtMC44LTAuNkMxMy43LDQuNywxMy43LDQuOCwxMy43LDQuOUwxMy43LDQuOXonLz48cGF0aCBzdHlsZT0nZmlsbDojMUYyNjRGOycgZD0nTTEzLDQuM2MtMC4xLDAtMC4yLTAuMS0wLjMtMC4xYy0wLjEsMC0wLjIsMC0wLjQtMC4xQzExLjgsNCwxMS4zLDQsMTAuOCw0SDYuNCBDNi4zLDQsNi4yLDQsNi4xLDQuMUM1LjksNC4yLDUuOCw0LjQsNS43LDQuNmwtMC45LDUuOWwwLDAuMkM0LjgsMTAuMyw1LjIsMTAsNS42LDEwaDEuNmMzLjIsMCw1LjctMS4zLDYuNS01LjEgYzAtMC4xLDAtMC4yLDAuMS0wLjNjLTAuMi0wLjEtMC40LTAuMi0wLjYtMC4zQzEzLjEsNC4zLDEzLDQuMywxMyw0LjMnLz48L3N2Zz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHN0eWxlPSdkaXNwbGF5Om5vbmU7Jz48c3ltYm9sIGlkPSd5dHAtc3ZnLWNoZWNrbWFyaycgdmlld0JveD0nMCAwIDEyLjcgOS45Jz48cG9seWdvbiBwb2ludHM9JzEuNCw0LjIgMCw1LjcgNC4yLDkuOSAxMi43LDEuNCAxMS4zLDAgNC4yLDcuMScvPjwvc3ltYm9sPjxzeW1ib2wgaWQ9J3l0cC1zdmctc2F2ZScgdmlld0JveD0nMCAwIDE2IDE2Jz48cGF0aCBkPSdNMTMsMEgwdjE2aDE2VjNMMTMsMHogTTMsMWg5djZIM1YxeiBNMTQsMTVIMlY5aDEyVjE1eicvPjxyZWN0IHg9JzEwJyB5PScyJyB3aWR0aD0nMScgaGVpZ2h0PSc0Jy8+PC9zeW1ib2w+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJHRU4iKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXNhdmUnICAgIGRhdGEtcD0ndG5kfEdMQl9TVkUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtcmVzZXQnICAgZGF0YS1wPSd0bmR8R0xCX1JTRVQnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wZXhwJyAgZGF0YS1wPSd0dGx8R0xCX0lNUFInPjxzdmcgY2xhc3M9J3NhdmUnPjx1c2UgeGxpbms6aHJlZj0nI3l0cC1zdmctc2F2ZScvPjwvc3ZnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wbGFuZycgZGF0YS1wPSd0dGx8R0xCX0xPQ0xfTEFORyZ0bmR8TE9DQUxFJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgZGF0YS1wPSd0bmR8R0VOX1RUTCc+PC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGhyIGNsYXNzPSdQLWhvcnonPjwvaHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8R0VOX0dFTic+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fTE9DTF9MQU5HJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0xPQ0xfTEFORycgICAgZGF0YS1wPSd0bmR8R0VOX0xPQ0xfTEFORyc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNjdXN0b21fbGFuZycgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9EU0JMX0FEUycgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fRFNCTF9BRFMnICAgICBkYXRhLXA9J3RuZHxHRU5fRFNCTF9BRFMnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI291dHNpZGVfYWRzJyAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1lUX0xPR09fTElOSycgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9ZVF9MT0dPX0xJTksnIGRhdGEtcD0ndG5kfEdFTl9ZVF9MT0dPX0xJTksnPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjbG9nb19yZWRpcmVjdCcgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fU1VCX0xJU1QnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX1NVQl9MSVNUJyAgICAgZGF0YS1wPSd0bmR8R0VOX1NVQl9MSVNUJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzdWJfcGxheWxpc3QnICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9JTkZfU0NSTCcgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fSU5GX1NDUkwnICAgICBkYXRhLXA9J3RuZHxHRU5fSU5GX1NDUkwnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2luZmluaXRlX3Njcm9sbCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1BQT1RfT04nICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9QUE9UX09OJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9QUE9UX09OJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcG9wb3V0X29uJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fUkVNX0FQVU4nICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX1JFTV9BUFVOJyAgICAgZGF0YS1wPSd0bmR8R0VOX1JFTV9BUFVOJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNyZW1vdmVfYXV0b3BsYXknIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9TUEZfT0ZGJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fU1BGX09GRicgICAgICBkYXRhLXA9J3RuZHxHRU5fU1BGX09GRic+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3NwZl9vZmYnICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J0dFTl9DSE5fREZMVF9QQUdFJyBkYXRhLXA9J3RuZHxHRU5fQ0hOX0RGTFRfUEFHRSc+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLXNlbGVjdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9J0dFTl9DSE5fREZMVF9QQUdFJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2RlZmF1bHQnICAgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0RGTFQnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ndmlkZW9zJyAgICAgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfVklEJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J3BsYXlsaXN0cycgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX1BMJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2NoYW5uZWxzJyAgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0NITic+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdkaXNjdXNzaW9uJyBkYXRhLXA9J3RuZHxHRU5fQ0hOX0RGTFRfUEFHRV9ESVNDJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2Fib3V0JyAgICAgIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0FCVCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2NoYW5uZWxfcGFnZScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxHRU5fTFlUJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9HUklEX1NVQlMnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0dSSURfU1VCUycgICAgIGRhdGEtcD0ndG5kfEdFTl9HUklEX1NVQlMnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1Yl9ncmlkJyAgICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fR1JJRF9TUkNIJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9HUklEX1NSQ0gnICAgICBkYXRhLXA9J3RuZHxHRU5fR1JJRF9TUkNIJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzZWFyY2hfZ3JpZCcgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0JUVFJfTlRGJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fQlRUUl9OVEYnICAgICAgZGF0YS1wPSd0bmR8R0VOX0JUVFJfTlRGJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmx1ZV9ib3gnICAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9EU0JfSFZSQycgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0RTQl9IVlJDJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9EU0JfSFZSQyc+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hvdmVyY2FyZHNfb2ZmJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fQ01QVF9UVExTJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9DTVBUX1RUTFMnICAgICBkYXRhLXA9J3RuZHxHRU5fQ01QVF9UVExTJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmZWVkX3RpdGxlcycgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0JMVUVfR0xPVycgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fQkxVRV9HTE9XJyAgICAgZGF0YS1wPSd0bmR8R0VOX0JMVUVfR0xPVyc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmx1ZV9nbG93JyAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9ISURFX0ZUUicgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0hJREVfRlRSJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9ISURFX0ZUUic+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfZm9vdGVyJyAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fSERFX1JFQ01fU0RCUicgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9IREVfUkVDTV9TREJSJyBkYXRhLXA9J3RuZHxHRU5fSERFX1JFQ01fU0RCUic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNoaWRlX3JlY29tX3NpZGViYXInICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0hERV9TUkNIX1NEQlInIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fSERFX1NSQ0hfU0RCUicgZGF0YS1wPSd0bmR8R0VOX0hERV9TUkNIX1NEQlInPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9zZWFyY2hfc2lkZWJhcicgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9IREVfQ0hOX1NEQlInICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0hERV9DSE5fU0RCUicgIGRhdGEtcD0ndG5kfEdFTl9IREVfQ0hOX1NEQlInPiA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfY2hhbm5lbF9zaWRlYmFyJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fTE9DTF9MQU5HICYmIHVzZXJfc2V0dGluZ3MubG9jYWxMYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAuY29udGVudC5xdWVyeVNlbGVjdG9yKCIuUC1pbXBsYW5nIikuZGF0YXNldC5wID0gIkdMQl9MT0NMX0xBTkdfQ1NUTSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWN0aW9uID09PSAiVklEIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1AtY29udGVudCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLWhlYWRlcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1zYXZlJyAgICBkYXRhLXA9J3RuZHxHTEJfU1ZFJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXJlc2V0JyAgIGRhdGEtcD0ndG5kfEdMQl9SU0VUJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGV4cCcgIGRhdGEtcD0ndHRsfEdMQl9JTVBSJz48c3ZnIGNsYXNzPSdzYXZlJz48dXNlIHhsaW5rOmhyZWY9JyN5dHAtc3ZnLXNhdmUnLz48L3N2Zz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGxhbmcnIGRhdGEtcD0ndHRsfEdMQl9MT0NMX0xBTkcmdG5kfExPQ0FMRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGRhdGEtcD0ndG5kfFZJRF9UVEwnPjwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxociBjbGFzcz0nUC1ob3J6Jz48L2hyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfFZJRF9QTFInPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BRFMnICAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9BRFMnICAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9BRFMnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN2aWRlb19hZHMnICAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9TVUJfQURTJyAgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9TVUJfQURTJyAgICAgIGRhdGEtcD0ndG5kfFZJRF9TVUJfQURTJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc3Vic19hZHNfb24nICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FMVklTJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0FMVklTJyAgICBkYXRhLXA9J3RuZHxWSURfUExSX0FMVklTJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Zsb2F0aW5nX3BsYXllcicgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTFZJU19XRFRIJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nMzUwJyBzaXplPSc2Jz48bGFiZWwgZm9yPSdWSURfUExSX0FMVklTX1dEVEgnIGRhdGEtcD0ndG5kfFZJRF9QTFJfQUxWSVNfV0RUSCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmbG9hdGluZ19wbGF5ZXJfd2lkdGgnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQVRQTCcgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQVRQTCcgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfQVRQTCc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjdmlkZW9fYXV0b3BsYXknICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0NDJyAgICAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0NDJyAgICAgICBkYXRhLXA9J3RuZHxWSURfUExSX0NDJz4gICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1YnRpdGxlc19vZmYnICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTlRTJyAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9BTlRTJyAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9BTlRTJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNhbm5vdGF0aW9uc19vZmYnICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9FTkRfU0hSRScgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9FTkRfU0hSRScgICAgIGRhdGEtcD0ndG5kfFZJRF9FTkRfU0hSRSc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc2hhcmVfcGFuZWxfb2ZmJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX1ZPTF9NRU0nICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX1ZPTF9NRU0nICBkYXRhLXA9J3RuZHxWSURfUExSX1ZPTF9NRU0nPiA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbWVtYmVyX3ZvbHVtZScgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9WT0xfTEROJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9WT0xfTEROJyAgZGF0YS1wPSd0bmR8VklEX1BMUl9WT0xfTEROJz4gPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNkaXNhYmxlX25vcm1hbGlzYXRpb24nIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQUxBQ1QnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQUxBQ1QnICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfQUxBQ1QnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc2hvcnRjdXRzX29uJyAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX1NJWkVfTUVNJyAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX1NJWkVfTUVNJyBkYXRhLXA9J3RuZHxWSURfUExSX1NJWkVfTUVNJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbWVtYmVyX21vZGUnICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1ZPTF9XSEVFTCcgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1ZPTF9XSEVFTCcgICAgZGF0YS1wPSd0bmR8VklEX1ZPTF9XSEVFTCc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN3aGVlbF92b2x1bWUnICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfSEZSJyAgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfSEZSJyAgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfSEZSJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGZyX29mZicgICAgICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0hUTUw1JyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0hUTUw1JyAgICBkYXRhLXA9J3RuZHxWSURfUExSX0hUTUw1Jz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2ZvcmNlX2h0bWw1JyAgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J1ZJRF9ERkxUX1FMVFknIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFknPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1zZWxlY3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSdWSURfREZMVF9RTFRZJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2F1dG8nICAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfQVVUTyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoaWdocmVzJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX09SSUcnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQyODgwJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV8yODgwJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2hkMjE2MCcgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfMjE2MCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoZDE0NDAnICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzE0NDAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQxMDgwJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV8xMDgwJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2hkNzIwJyAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfNzIwJyA+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdsYXJnZScgICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX0xSRycgPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nbWVkaXVtJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV9NRE0nID48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J3NtYWxsJyAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfU01MJyA+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSd0aW55JyAgICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX1ROWScgPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNkZWZhdWx0X3F1YWxpdHknIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8VklEX1BMUl9MWVQnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9JTkZPJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfSU5GTycgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfSU5GTyc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaW5mb19iYXInICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfRFlOX1NJWkUnIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0RZTl9TSVpFJyBkYXRhLXA9J3RuZHxWSURfUExSX0RZTl9TSVpFJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2R5bmFtaWNfc2l6ZV9vZmYnICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0ZJVCcgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9GSVQnICAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9GSVQnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmaXRfdG9fcGFnZScgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9GSVRfV0RUSCcgdHlwZT0ndGV4dCcgcGxhY2Vob2xkZXI9JzEyODBweCcgc2l6ZT0nNic+PGxhYmVsIGZvcj0nVklEX1BMUl9GSVRfV0RUSCcgZGF0YS1wPSd0bmR8VklEX1BMUl9GSVRfV0RUSCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmaXRfbWF4X3dpZHRoJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxWSURfUExTVCc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExTVF9BVFBMJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMU1RfQVRQTCcgICAgZGF0YS1wPSd0bmR8VklEX1BMU1RfQVRQTCc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNwbGF5bGlzdF9hdXRvcGxheScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMU1RfUlZSUycgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFNUX1JWUlMnICAgIGRhdGEtcD0ndG5kfFZJRF9QTFNUX1JWUlMnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcGxheWxpc3RfcmV2ZXJzZScgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfFZJRF9MQVlUJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QUE9UX1NaJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nNTMzJyBzaXplPSc2Jz48bGFiZWwgZm9yPSdWSURfUFBPVF9TWicgZGF0YS1wPSd0bmR8VklEX1BQT1RfU1onPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcG9wb3V0X3NpemUnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSdWSURfSElERV9DT01TJyBkYXRhLXA9J3RuZHxWSURfSElERV9DT01TJz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1Atc2VsZWN0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0nVklEX0hJREVfQ09NUyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPScwJyBkYXRhLXA9J3RuZHxWSURfSElERV9DT01TX1NIT1cnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nMScgZGF0YS1wPSd0bmR8VklEX0hJREVfQ09NU19ISURFJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzInIGRhdGEtcD0ndG5kfFZJRF9ISURFX0NPTVNfUkVNJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjY29tbWVudHMnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1RUTF9DTVBUJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfVFRMX0NNUFQnICAgICAgZGF0YS1wPSd0bmR8VklEX1RUTF9DTVBUJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjdmlkZW9fdGl0bGUnICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9ERVNDX1NIUlQnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX0RFU0NfU0hSVCcgICAgIGRhdGEtcD0ndG5kfFZJRF9ERVNDX1NIUlQnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2xhYmVsbGVzc19idXR0b25zJyAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfVklEX0NOVCcgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9WSURfQ05UJyAgICAgICBkYXRhLXA9J3RuZHxWSURfVklEX0NOVCc+ICAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN1cGxvYWRfY291bnRlcicgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BPU1RfVElNRScgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUE9TVF9USU1FJyAgICAgZGF0YS1wPSd0bmR8VklEX1BPU1RfVElNRSc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcmVsYXRpdmVfdXBsb2FkX3RpbWUnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9ISURFX0RFVExTJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX0hJREVfREVUTFMnICAgIGRhdGEtcD0ndG5kfFZJRF9ISURFX0RFVExTJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfdmlkZW9fZGV0YWlscycgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfTEFZVF9BVVRPX1BOTCcgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9MQVlUX0FVVE9fUE5MJyBkYXRhLXA9J3RuZHxWSURfTEFZVF9BVVRPX1BOTCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNleHBhbmRfZGVzY3JpcHRpb24nICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX0xPQ0xfTEFORyAmJiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZykgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLmNvbnRlbnQucXVlcnlTZWxlY3RvcigiLlAtaW1wbGFuZyIpLmRhdGFzZXQucCA9ICJHTEJfTE9DTF9MQU5HX0NTVE0iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbiA9PT0gIkJMSyIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdQLWNvbnRlbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1oZWFkZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1Atc2F2ZScgICAgZGF0YS1wPSd0bmR8R0xCX1NWRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1yZXNldCcgICBkYXRhLXA9J3RuZHxHTEJfUlNFVCc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBleHAnICBkYXRhLXA9J3R0bHxHTEJfSU1QUic+PHN2ZyBjbGFzcz0nc2F2ZSc+PHVzZSB4bGluazpocmVmPScjeXRwLXN2Zy1zYXZlJy8+PC9zdmc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBsYW5nJyBkYXRhLXA9J3R0bHxHTEJfTE9DTF9MQU5HJnRuZHxMT0NBTEUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBkYXRhLXA9J3RuZHxCTEtfVFRMJz48L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3M9J1AtaG9yeicvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEJMS19CTEsnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nQkxLX09OJyB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nQkxLX09OJyBkYXRhLXA9J3RuZHxCTEtfT04nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmxhY2tsaXN0X29uJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2JsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYmxhY2tsaXN0LWNvbnRyb2xzJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWVkaXQnICBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX0VESVQnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LXNhdmUnICBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX1NBVkUnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWNsb3NlJyBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX0NMU0UnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9J2JsYWNrbGlzdC1lZGl0LWxpc3QnPjwvdGV4dGFyZWE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX0xPQ0xfTEFORyAmJiB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZykgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLmNvbnRlbnQucXVlcnlTZWxlY3RvcigiLlAtaW1wbGFuZyIpLmRhdGFzZXQucCA9ICJ0dGx8R0xCX0xPQ0xfTEFORyZ0bmR8R0xCX0xPQ0xfTEFOR19DU1RNIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJBQlQiKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgZGF0YS1wPSd0bmR8QUJUX1RUTCc+PC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGhyIGNsYXNzPSdQLWhvcnonLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxBQlRfVEhLUyc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9ZZVBwSGEnPkplcHBlIFJ1bmUgTW9ydGVuc2VuPC9hPjxzcGFuIGRhdGEtcD0ndG5kfEFCVF9USEtTX1lFUFBIQSc+PC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cDovL3d3dy5ncmVhc2VzcG90Lm5ldC8nPkdyZWFzZW1vbmtleTwvYT4gKyA8YSBocmVmPSdodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8nPlRhbXBlcm1vbmtleTwvYT48c3BhbiBkYXRhLXA9J3RuZHxBQlRfVEhLU19VU0VSU0NSSVBUJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vJz5TdGFjayBPdmVyZmxvdzwvYT48c3BhbiBkYXRhLXA9J3RuZHxBQlRfVEhLU19TVEFDS09WJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8QUJUX0lORk8nPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlLyc+R2l0SHViPC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9lbi91c2Vycy84MjIzLXBhcnRpY2xlY29yZSc+R3JlYXN5IEZvcms8L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vb3BlbnVzZXJqcy5vcmcvc2NyaXB0cy9QYXJ0aWNsZUNvcmUvJz5PcGVuVXNlckpTPC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5wdXRzID0gdGVtcC5jb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0W3R5cGU9J2NoZWNrYm94J10gKyBsYWJlbCIpOwogICAgICAgICAgICAgICAgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJzdmciKTsKICAgICAgICAgICAgICAgIHN2Zy5pbm5lckhUTUwgPSAiPHVzZSB4bGluazpocmVmPScjeXRwLXN2Zy1jaGVja21hcmsnPiI7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2ldLmFwcGVuZENoaWxkKHN2Zy5jbG9uZU5vZGUodHJ1ZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNldExvY2FsZShnZXRWYWx1ZXModGVtcC5jb250ZW50KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZXhwb3J0U2V0dGluZ3ModGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgZXhwQ29udDsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wbGFuZyIpKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJleHAtY29udCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChleHBDb250KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cENvbnQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nZXhwLWNvbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdpbXBsYW5nLXNhdmUnIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1zZXNzaW9ubGluayB5dC11aXgtYnV0dG9uLWRlZmF1bHQgeXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSd5dC11aXgtYnV0dG9uLWNvbnRlbnQnIGRhdGEtcD0ndG5kfEdMQl9JTVBSX1NBVkUnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9J2ltcGV4cC1saXN0Jz48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cENvbnQuY29udGVudC5xdWVyeVNlbGVjdG9yKCIjaW1wbGFuZy1zYXZlIikuaWQgPSAiaW1wZXhwLXNhdmUiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBleHBDb250ID0gc2V0TG9jYWxlKGV4cENvbnQuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1jb250ZW50IikuYXBwZW5kQ2hpbGQoZXhwQ29udCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUgPSBKU09OLnN0cmluZ2lmeSgodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1pbXBleHAiKSAmJiB1c2VyX3NldHRpbmdzKSB8fCB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZyB8fCBsYW5ndWFnZSwgdW5kZWZpbmVkLCAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmlkID09PSAiaW1wZXhwLXNhdmUiIHx8IHRhcmdldC5pZCA9PT0gImltcGxhbmctc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSAiaW1wbGFuZy1zYXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICBzZXQoImxvY2FsTGFuZyIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldCgidXNlcl9zZXR0aW5ncyIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbi5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRCbGFja0xpc3QodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LWVkaXQiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJsYWNrbGlzdCIpLmNsYXNzTGlzdC5hZGQoImVkaXQiKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmxhY2tsaXN0LWVkaXQtbGlzdCIpLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkodXNlcl9zZXR0aW5ncy5ibGFja2xpc3QsIHVuZGVmaW5lZCwgMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1zYXZlIikgewogICAgICAgICAgICAgICAgICAgIHNldCgiYmxhY2tsaXN0IiwgSlNPTi5wYXJzZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmxhY2tsaXN0LWVkaXQtbGlzdCIpLnZhbHVlKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1jbG9zZSIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQkxLIikuY2xpY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWxCbGFja0xpc3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBuZXdLZXkgPSB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdDsKICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXdLZXlbZXZlbnQudGFyZ2V0Lm5leHRTaWJsaW5nLmhyZWYuc3BsaXQoIi9jaGFubmVsLyIpWzFdXTsKICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCBuZXdLZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlbE5vdGlmaWNhdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgic2hvdy1ndWlkZS1idXR0b24tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKHNhbHQpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB2YWx1ZSwgbm90aWZpY2F0aW9uLCBuYXZJZCwgdXNlclNldHMsIHNhdmVkU2V0czsKICAgICAgICAgICAgICAgIG5hdklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnNlbGVjdGVkIikuaWQ7CiAgICAgICAgICAgICAgICB1c2VyU2V0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLWNvbnRlbnQiKS5xdWVyeVNlbGVjdG9yQWxsKCJbaWRePSciICsgbmF2SWQgKyAiJ10iKTsKICAgICAgICAgICAgICAgIHNhdmVkU2V0cyA9IHVzZXJfc2V0dGluZ3M7CiAgICAgICAgICAgICAgICBpID0gdXNlclNldHMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKHVzZXJTZXRzW2ldLmNoZWNrZWQgJiYgKHVzZXJTZXRzW2ldLnZhbHVlID09PSAib24iIHx8IHVzZXJTZXRzW2ldLnZhbHVlKSkgfHwgKHVzZXJTZXRzW2ldLmxlbmd0aCAmJiB1c2VyU2V0c1tpXS52YWx1ZSkgfHwgKHVzZXJTZXRzW2ldLmdldEF0dHJpYnV0ZSgidHlwZSIpID09PSAidGV4dCIgJiYgdXNlclNldHNbaV0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFNldHNbdXNlclNldHNbaV0ubmFtZSB8fCB1c2VyU2V0c1tpXS5pZF0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF2YWx1ZSAmJiB1c2VyU2V0c1tpXS50eXBlICE9PSAicmFkaW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkU2V0c1t1c2VyU2V0c1tpXS5pZF0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXQoInVzZXJfc2V0dGluZ3MiLCBzYXZlZFNldHMpOwogICAgICAgICAgICAgICAgY3VzdG9tU3R5bGVzKCk7CiAgICAgICAgICAgICAgICBpZiAoIXNhbHQpIHsKICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXBwYmFyLW1haW4tZ3VpZGUtbm90aWZpY2F0aW9uLWNvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24uY2hpbGROb2Rlcy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nYXBwYmFyLW1haW4tZ3VpZGUtbm90aWZpY2F0aW9uLWNvbnRhaW5lcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbicgcm9sZT0nYWxlcnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi1jb250ZW50LXdyYXBwZXIgeXQtdmFsaWduJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSdhcHBiYXItZ3VpZGUtbm90aWZpY2F0aW9uLWljb24geXQtc3ByaXRlJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi10ZXh0LWNvbnRlbnQnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gc2V0TG9jYWxlKG5vdGlmaWNhdGlvbi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXQtbWFzdGhlYWQtbG9nby1jb250YWluZXIiKS5hcHBlbmRDaGlsZChub3RpZmljYXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi10ZXh0LWNvbnRlbnQiKS50ZXh0Q29udGVudCA9IGxhbmcoIkdMQl9TVkVfU0VUUyIpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgic2hvdy1ndWlkZS1idXR0b24tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZGVsTm90aWZpY2F0aW9uLCAyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBuYXZpZ2F0ZVNldHRpbmdzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1zYXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1yZXNldCIpICYmIHdpbmRvdy5jb25maXJtKGxhbmcoIkdMQl9SU0VUX0NPTkYiKSkpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoInVzZXJfc2V0dGluZ3MiLCBkZWZhdWx0X3NldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24uY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24uY2xpY2soKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY2xvc2UiKSkgewogICAgICAgICAgICAgICAgICAgIGRlbEJsYWNrTGlzdChldmVudCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wZXhwIikgfHwgZXZlbnQudGFyZ2V0LmlkID09PSAiaW1wZXhwLXNhdmUiIHx8IGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wbGFuZyIpIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImltcGxhbmctc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICBleHBvcnRTZXR0aW5ncyhldmVudC50YXJnZXQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJibGFja2xpc3QtZWRpdCIgfHwgZXZlbnQudGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LXNhdmUiIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1jbG9zZSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXRCbGFja0xpc3QoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiUC1jb250YWluZXIiIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gIlAtc2V0dGluZ3MiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQgPSAoZXZlbnQudGFyZ2V0LmlkID09PSAiUC1zZXR0aW5ncyIpID8gZXZlbnQudGFyZ2V0IDogZXZlbnQudGFyZ2V0LnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlkICE9PSAiRE5UIiAmJiBldmVudC50YXJnZXQudGFnTmFtZSAhPT0gIkEiICYmIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLmlkID09PSAiUC1zaWRlYmFyLWxpc3QiKSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCJuby1ub3RpZmljYXRpb24iKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1jb250ZW50Iikub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtY29udGFpbmVyIikuYXBwZW5kQ2hpbGQoZ2V0TWVudShldmVudC50YXJnZXQuaWQpKTsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCIuc2VsZWN0ZWQiKS5yZW1vdmVBdHRyaWJ1dGUoImNsYXNzIik7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSA9ICJzZWxlY3RlZCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0dGluZ3NUZW1wbGF0ZShldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHBXcmFwcGVyOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gIlAiICYmIGV2ZW50LnRhcmdldC50YWdOYW1lICE9PSAiSU5QVVQiKSB7CiAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1zZXR0aW5ncyIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwV3JhcHBlcikgewogICAgICAgICAgICAgICAgICAgICAgICBwV3JhcHBlci5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygiZmxvYXRlciIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwV3JhcHBlciA9IGdldE1lbnUoIk1FTiIpOwogICAgICAgICAgICAgICAgICAgICAgICBwV3JhcHBlci5xdWVyeVNlbGVjdG9yKCIjUC1jb250YWluZXIiKS5hcHBlbmRDaGlsZChnZXRNZW51KCJHRU4iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJib2R5LWNvbnRhaW5lciIpLmluc2VydEJlZm9yZShwV3JhcHBlciwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhZ2UtY29udGFpbmVyIikpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG5hdmlnYXRlU2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFsod2luZG93LmNocm9tZSAmJiAiYm9keSIpIHx8ICJkb2N1bWVudEVsZW1lbnQiXS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGZpcnN0VGltZShldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZSAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZS5jbGFzc05hbWUgPT09ICJwYXJfY2xvc2V3bGNtIikgewogICAgICAgICAgICAgICAgICAgIHNldCgiZmlyc3RUaW1lIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZmlyc3RUaW1lKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUud2VsY29tZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldHRpbmdzTWVudSgpIHsKICAgICAgICAgICAgICAgIHZhciBub3RpZl9idXR0b24sIHNldHRpbmdzX2J1dHRvbiwgd2VsY29tZV9tZXNzYWdlOwogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vdGlmX2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN5dC1tYXN0aGVhZC1ub3RpZmljYXRpb25zLCAubm90aWZpY2F0aW9ucy1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzX2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN5dC1tYXN0aGVhZC11c2VyLCAjeXQtbWFzdGhlYWQtc2lnbmluIik7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NfYnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICB3ZWxjb21lX21lc3NhZ2UuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1BzZXR0aW5ncyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdQJyBkYXRhLXA9J3R0bHxZVFNFVFMnIHN0eWxlPSdoZWlnaHQ6MjhweDttYXJnaW4tcmlnaHQ6MTBweDtvcGFjaXR5Oi41NTt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7d2lkdGg6MThweDsnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgdmlld0JveD0nMCAwIDE4IDIwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScwLDIwIDE0LDEyIDAsNCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzE1LDMgMTUsMCAxMywwIDEzLDMgMTAsMyAxMCw1IDEzLDUgMTMsOCAxNSw4IDE1LDUgMTgsNSAxOCwzJy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3BhcnRfd2VsY29tZScgc3R5bGU9J2Rpc3BsYXk6bm9uZTttYXJnaW4tbGVmdDotMjIwcHg7dG9wOjM4cHg7cmlnaHQ6MCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1wPSd0bmR8V0xDTSc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1wPSd0bmR8V0xDTVNUUlQnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPjxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgZGF0YS1wPSd0bmR8V0xDTUZUUlMnIHN0eWxlPSdjb2xvcjojRkZGOycgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzJyB0YXJnZXQ9J19ibGFuayc+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J3Bhcl9jbG9zZXdsY20nPjxzcGFuPsOXPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gc2V0TG9jYWxlKHdlbGNvbWVfbWVzc2FnZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHNldHRpbmdzVGVtcGxhdGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChub3RpZl9idXR0b24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfYnV0dG9uLmluc2VydEJlZm9yZSh3ZWxjb21lX21lc3NhZ2UsIG5vdGlmX2J1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfYnV0dG9uLmFwcGVuZENoaWxkKHdlbGNvbWVfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQIik7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LndlbGNvbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFydF93ZWxjb21lIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmlyc3RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS53ZWxjb21lLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZpcnN0VGltZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZENvbW1lbnQob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50cywgaXNfbGl2ZTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1kaXNjdXNzaW9uIik7CiAgICAgICAgICAgICAgICAgICAgaXNfbGl2ZSA9IHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MubGl2ZXN0cmVhbTsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5zcGxpdCgiY29tbWVudHMiKS5sZW5ndGggPiAxICYmICFpc19saXZlICYmIGNvbW1lbnRzICYmICFjb21tZW50cy5sYXp5bG9hZCAmJiB1c2VyX3NldHRpbmdzLlZJRF9ISURFX0NPTVMgPT09ICIxIiAmJiAhY29tbWVudHMuY2xhc3NMaXN0LmNvbnRhaW5zKCJzaG93IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMubGF6eWxvYWQgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RTZXRDb25maWcob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJTSEFSRV9PTl9WSURFT19FTkQiIGluIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuU0hBUkVfT05fVklERU9fRU5EID0gIXVzZXJfc2V0dGluZ3MuVklEX0VORF9TSFJFOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiVU5JVkVSU0FMX0hPVkVSQ0FSRFMiIGluIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuVU5JVkVSU0FMX0hPVkVSQ0FSRFMgPSAhdXNlcl9zZXR0aW5ncy5HRU5fRFNCX0hWUkM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kRW1iZWQob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wLCBwbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGEuaWQgfHwgYTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCAhPT0gInBsYXllci1hcGkiICYmIHRlbXAgIT09ICJ1cHNlbGwtdmlkZW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvKmIgPSAqL21vZEFyZ3MoYik7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnNldFBsYXliYWNrUXVhbGl0eSh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQXV0b3BsYXkob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgIGlmICghYiB8fCB1c2VyX3NldHRpbmdzLnBsQXBsIHx8ICghdXNlcl9zZXR0aW5ncy5wbEFwbCAmJiBiLmZlYXR1cmUgJiYgYi5mZWF0dXJlICE9PSAiYXV0b3BsYXkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQXV0b3BsYXlGdWxsc2NyZWVuKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBoYXNfZW5kZWQsIG5leHRfYnV0dG9uLCBuZXh0X2NsaWNrZWQ7CiAgICAgICAgICAgICAgICAgICAgaGFzX2VuZGVkID0gYXBpICYmIGFwaS5nZXRDdXJyZW50VGltZSAmJiBNYXRoLnJvdW5kKGFwaS5nZXRDdXJyZW50VGltZSgpKSA+PSBNYXRoLmZsb29yKGFwaS5nZXREdXJhdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICBuZXh0X2NsaWNrZWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygieXRwLWJ1dHRvbi1uZXh0IikgfHwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInl0cC1uZXh0LWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgICAgIGlmICghdXNlcl9zZXR0aW5ncy5wbEFwbCAmJiAhbmV4dF9jbGlja2VkICYmIGhhc19lbmRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0X2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtbmV4dC1idXR0b24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRfYnV0dG9uICYmIG5leHRfYnV0dG9uLmdldEF0dHJpYnV0ZSgiYXJpYS1kaXNhYmxlZCIpID09PSAidHJ1ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfYnV0dG9uLm9uY2xpY2sgPSBhcGkubmV4dFZpZGVvOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBhcGkubmV4dFZpZGVvKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1kaXNhYmxlZCIsICJmYWxzZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MucGxBcGwgfHwgbmV4dF9jbGlja2VkIHx8ICFoYXNfZW5kZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRfY2xpY2tlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RQbGF5ZXJDcmVhdGUob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciBpLCB0ZW1wLCBwbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGEuaWQgfHwgYTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCAhPT0gInBsYXllci1hcGkiICYmIHRlbXAgIT09ICJ1cHNlbGwtdmlkZW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvKmIgPSAqL21vZEFyZ3MoYik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuaWQgPT09ICJ1cHNlbGwtdmlkZW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2luc3RhbmNlID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IE9iamVjdC5rZXlzKHBsYXllcl9pbnN0YW5jZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGF5ZXJfaW5zdGFuY2VbdGVtcFtpXV0gPT09ICJvYmplY3QiICYmIHBsYXllcl9pbnN0YW5jZVt0ZW1wW2ldXSAmJiBwbGF5ZXJfaW5zdGFuY2VbdGVtcFtpXV0uaGFzTmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pbnN0YW5jZVt0ZW1wW2ldXS5oYXNOZXh0ID0gbW9kQXV0b3BsYXlGdWxsc2NyZWVuKHBsYXllcl9pbnN0YW5jZVt0ZW1wW2ldXS5oYXNOZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemVQbGF5ZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kU2Vla1RvKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odGltZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuY2FsbCh0aGlzLCB0aW1lLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZEFyZ3NXYXRjaChhcmdzKSB7CiAgICAgICAgICAgICAgICBpZiAoYXJncyAmJiBhcmdzLmF1dG9wbGF5ID09PSAiMSIgJiYgIXVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoID09PSAiIikgewogICAgICAgICAgICAgICAgICAgIGFyZ3MuYXV0b3BsYXkgPSAiMCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gTW9kQXJnc1dhdGNoLk9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0RXhpdChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGtleSwgdGVtcDsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC50YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgibmFtZSIpID09PSAid3d3L2Jhc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dC5zZXRDb25maWcgPSBtb2RTZXRDb25maWcod2luZG93Lnl0LnNldENvbmZpZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuX3l0X3d3dykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IE9iamVjdC5rZXlzKHdpbmRvdy5feXRfd3d3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGogPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IHRlbXBbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuX3l0X3d3d1trZXldID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTdHJpbmcod2luZG93Ll95dF93d3dba2V5XSkuc3BsaXQoInBsYXllci1hZGRlZCIpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5feXRfd3d3W2tleV0gPSBtb2RFbWJlZCh3aW5kb3cuX3l0X3d3d1trZXldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChTdHJpbmcod2luZG93Ll95dF93d3dba2V5XSkuc3BsaXQoIndpbmRvdy5zcGYubmF2aWdhdGUiKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuX3l0X3d3d1trZXldID0gbW9kQXV0b3BsYXkod2luZG93Ll95dF93d3dba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nKHdpbmRvdy5feXRfd3d3W2tleV0pLnNwbGl0KCIuc2V0KFwiXCIrYSxiLGMsXCIvXCIsZCIpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBzZXR3aWRlID0gd2luZG93Ll95dF93d3dba2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA9PT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoIm5hbWUiKSA9PT0gInd3dy93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0Lnd3dy53YXRjaC5wbGF5ZXIuc2Vla1RvID0gbW9kU2Vla1RvKHdpbmRvdy55dC53d3cud2F0Y2gucGxheWVyLnNlZWtUbyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJzcGYvc3BmIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3BmLmxvYWQgPSBtb2RDb21tZW50KHdpbmRvdy5zcGYubG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYucHJlZmV0Y2ggPSBmdW5jdGlvbigpe307CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubmFtZSA9PT0gInBvcE91dCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYubmF2aWdhdGUgPSBmdW5jdGlvbigpe307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJwbGF5ZXIvYmFzZSIpIHx8CiAgICAgICAgICAgICAgICAgICAgKCF3aW5kb3cuaHRtbDVQYXRjaGVkICYmIHdpbmRvdy55dCAmJiB3aW5kb3cueXQucGxheWVyICYmIHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24gJiYgd2luZG93Lnl0LnBsYXllci5BcHBsaWNhdGlvbi5jcmVhdGUpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaHRtbDVQYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXQucGxheWVyLkFwcGxpY2F0aW9uLmNyZWF0ZSA9IG1vZFBsYXllckNyZWF0ZSh3aW5kb3cueXQucGxheWVyLkFwcGxpY2F0aW9uLmNyZWF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5feXRfcGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBPYmplY3Qua2V5cyh3aW5kb3cuX3l0X3BsYXllcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dID09PSAiZnVuY3Rpb24iICYmIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dLnRvU3RyaW5nKCkubWF0Y2goL3RoaXNcLmFkYXB0aXZlRm9ybWF0cy8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gdGVtcFtpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RBcmdzV2F0Y2guT3JpZ2luYWwgPSB3aW5kb3cuX3l0X3BsYXllcltrZXldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kQXJnc1dhdGNoLnByb3RvdHlwZSA9IE1vZEFyZ3NXYXRjaC5PcmlnaW5hbC5wcm90b3R5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gT2JqZWN0LmtleXMoTW9kQXJnc1dhdGNoLk9yaWdpbmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kQXJnc1dhdGNoW3RlbXBbaV1dID0gTW9kQXJnc1dhdGNoLk9yaWdpbmFsW3RlbXBbaV1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Ll95dF9wbGF5ZXJba2V5XSA9IE1vZEFyZ3NXYXRjaDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja0JvdW5kcyhlbG0sIFgsIFkpIHsKICAgICAgICAgICAgICAgIHZhciBzbmFwWCwgc25hcFk7CiAgICAgICAgICAgICAgICBpZiAoWCA+IC0xICYmIFggKyBlbG0ub2Zmc2V0V2lkdGggPCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICBzbmFwWCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChYIDwgMSkgewogICAgICAgICAgICAgICAgICAgIFggPSAwOwogICAgICAgICAgICAgICAgICAgIHNuYXBYID0gLTE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGggLSBlbG0ub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgc25hcFggPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKFkgPiA1MCAmJiBZICsgZWxtLm9mZnNldEhlaWdodCA8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICBzbmFwWSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChZIDwgNTEpIHsKICAgICAgICAgICAgICAgICAgICBZID0gNTA7CiAgICAgICAgICAgICAgICAgICAgc25hcFkgPSAtMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgWSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQgLSBlbG0ub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIHNuYXBZID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB7WDogWCArICJweCIsIFk6IFkgKyAicHgiLCBzbmFwWDogc25hcFgsIHNuYXBZOiBzbmFwWX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlUG9zKCkgewogICAgICAgICAgICAgICAgdmFyIHgsIHksIGhlaWdodCwgcGxheWVyLCBib3VuZHM7CiAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKSB8fCB3aW5kb3cuaW5uZXJXaWR0aCA8IDY1NykgewogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdXBkYXRlUG9zKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoZWlnaHQgPSBwYXJzZUludCh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQUxWSVNfV0RUSCkgfHwgMzUwOwogICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgYm91bmRzID0gY2hlY2tCb3VuZHMocGxheWVyLCB1c2VyX3NldHRpbmdzLmZsb2F0ZXJYLCB1c2VyX3NldHRpbmdzLmZsb2F0ZXJZKTsKICAgICAgICAgICAgICAgIGhlaWdodCA9IChoZWlnaHQgPCAzNTAgPyAzNTAgOiBoZWlnaHQpIC8gKDE2IC8gOSk7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFggPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgeCA9ICIwcHgiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGggLSBwbGF5ZXIub2Zmc2V0V2lkdGggKyAicHgiOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB4ID0gYm91bmRzLlg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9ICI1MHB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFkgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB5ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldEhlaWdodCAtIHBsYXllci5vZmZzZXRIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB5ID0gYm91bmRzLlk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwbGF5ZXIuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDoiICsgKGhlaWdodCAqICgxNiAvIDkpKSArICJweDtoZWlnaHQ6IiArIGhlaWdodCArICJweDtsZWZ0OiIgKyB4ICsgIjt0b3A6IiArIHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdvVG9Ub3AoKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudFsod2luZG93LmNocm9tZSAmJiAiYm9keSIpIHx8ICJkb2N1bWVudEVsZW1lbnQiXS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRyYWdGbG9hdGVyKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgZXhjbHVkZWQsIGlzRlNjcmVlbiwgaXNGbG9hdGVyLCBib3VuZHMsIHBsYXllcjsKICAgICAgICAgICAgICAgIGlzRlNjcmVlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtZnVsbHNjcmVlbiIpOwogICAgICAgICAgICAgICAgaXNGbG9hdGVyID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmICFpc0ZTY3JlZW4gJiYgaXNGbG9hdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5idXR0b25zID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1jaHJvbWUtYm90dG9tIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAibW91c2Vkb3duIiAmJiBwbGF5ZXIuY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiAoIWV4Y2x1ZGVkIHx8ICFleGNsdWRlZC5jb250YWlucyhldmVudC50YXJnZXQpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgZHJhZ0Zsb2F0ZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnRmxvYXRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5vbGRQb3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWDogcGFyc2VJbnQocGxheWVyLnN0eWxlLmxlZnQpIC0gZXZlbnQuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZOiBwYXJzZUludChwbGF5ZXIuc3R5bGUudG9wKSAtIGV2ZW50LmNsaWVudFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWDogZXZlbnQuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmdZOiBldmVudC5jbGllbnRZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudHlwZSA9PT0gIm1vdXNlbW92ZSIgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLmhhc01vdmVkIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZXZlbnQuY2xpZW50WCAtIGRyYWdGbG9hdGVyLm9sZFBvcy5vcmdYKSA+IDEwIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZXZlbnQuY2xpZW50WSAtIGRyYWdGbG9hdGVyLm9sZFBvcy5vcmdZKSA+IDEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzID0gY2hlY2tCb3VuZHMocGxheWVyLCBldmVudC5jbGllbnRYICsgZHJhZ0Zsb2F0ZXIub2xkUG9zLlgsIGV2ZW50LmNsaWVudFkgKyBkcmFnRmxvYXRlci5vbGRQb3MuWSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuc3R5bGUubGVmdCA9IGJvdW5kcy5YOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnN0eWxlLnRvcCA9IGJvdW5kcy5ZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIuc25hcFggPSBib3VuZHMuc25hcFg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5zbmFwWSA9IGJvdW5kcy5zbmFwWTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyAhPT0gMSB8fCBldmVudC50eXBlID09PSAiY2xpY2siKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcmFnRmxvYXRlci5oYXNNb3ZlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIub2xkUG9zID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5oYXNNb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5mbG9hdGVyWCA9IHBhcnNlSW50KHBsYXllci5zdHlsZS5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZmxvYXRlclkgPSBwYXJzZUludChwbGF5ZXIuc3R5bGUudG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBYID0gZHJhZ0Zsb2F0ZXIuc25hcFg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWSA9IGRyYWdGbG9hdGVyLnNuYXBZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJ1c2VyX3NldHRpbmdzIiwgdXNlcl9zZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgZHJhZ0Zsb2F0ZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGRyYWdGbG9hdGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaW5pRmxvYXRlcigpIHsKICAgICAgICAgICAgICAgIHZhciBwbGF5ZXIsIHBsckFwaSwgb3V0X29mX3NpZ2h0LCBpc0Zsb2F0ZXIsIGlzRlNjcmVlbiwgZmxvYXRlclVJLCBzZXR0aW5nc19vcGVuOwogICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgcGxyQXBpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllci1hcGkiKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzX29wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1zZXR0aW5ncyIpOwogICAgICAgICAgICAgICAgaWYgKHBsYXllcikgewogICAgICAgICAgICAgICAgICAgIG91dF9vZl9zaWdodCA9IHBsckFwaS5ib3R0b20gPCAoKHBsckFwaS5oZWlnaHQgLyAyKSArIDUwKTsKICAgICAgICAgICAgICAgICAgICBpc0Zsb2F0ZXIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgaXNGU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1mdWxsc2NyZWVuIik7CiAgICAgICAgICAgICAgICAgICAgZmxvYXRlclVJID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhcnRfZmxvYXRlcnVpIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbG9hdGVyVUkgJiYgIWlzRlNjcmVlbikgewogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdwYXJ0X2Zsb2F0ZXJ1aSc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ncGFydF9mbG9hdGVydWlfbW92ZScgZGF0YS1wPSd0dGx8VklEX1BMUl9BTFZJU19NT1ZFJz48c3ZnIHZpZXdCb3g9JzAgMCAyMCAyMCc+PHBvbHlnb24gcG9pbnRzPSc2LjQsMy42IDcuMiw0LjMgMTAsMS41IDEyLjgsNC4zIDEzLjYsMy42IDEwLDAnLz48cG9seWdvbiBwb2ludHM9JzE2LjQsNi40IDE1LjcsNy4yIDE4LjUsMTAgMTUuNywxMi44IDE2LjQsMTMuNiAyMCwxMCcvPjxwb2x5Z29uIHBvaW50cz0nMy42LDYuNCAwLDEwIDMuNiwxMy42IDQuMywxMi44IDEuNSwxMCA0LjMsNy4yJy8+PHBvbHlnb24gcG9pbnRzPScxMCwxOC41IDcuMiwxNS43IDYuNCwxNi40IDEwLDIwIDEzLjYsMTYuNCAxMi44LDE1LjcnLz48Y2lyY2xlIGN4PScxMCcgY3k9JzEwJyByPScyJy8+PC9zdmc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ncGFydF9mbG9hdGVydWlfc2Nyb2xsdG9wJyBkYXRhLXA9J3R0bHxWSURfUExSX0FMVklTX1NDUkxfVE9QJz48c3ZnIHZpZXdCb3g9JzAgMCAyMCAyMCc+PHBvbHlnb24gcG9pbnRzPScxMCwwLjEgMCwxMC4xIDIuOSwxMi45IDEwLDUuOCAxNy4xLDEyLjkgMjAsMTAuMSAnLz48L3N2Zz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0ZXJVSSA9IHNldExvY2FsZShmbG9hdGVyVUkuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmFwcGVuZENoaWxkKGZsb2F0ZXJVSSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXJ0X2Zsb2F0ZXJ1aV9tb3ZlIikuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZHJhZ0Zsb2F0ZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFydF9mbG9hdGVydWlfc2Nyb2xsdG9wIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBnb1RvVG9wKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG91dF9vZl9zaWdodCAmJiAhaXNGbG9hdGVyICYmICFzZXR0aW5nc19vcGVuICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHVwZGF0ZVBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVBvcygpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCghb3V0X29mX3NpZ2h0IHx8IHNldHRpbmdzX29wZW4gfHwgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSAiL3dhdGNoIikgJiYgaXNGbG9hdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCB1cGRhdGVQb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWx3YXlzVmlzaWJsZSgpIHsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQUxWSVMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgaW5pRmxvYXRlcik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBpbmlGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWx3YXlzQWN0aXZlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgbGlzdCwgY2xlYXIsIGxlbmd0aCwgZXZlbnRDbG9uZTsKICAgICAgICAgICAgICAgIGNsZWFyID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09ICIvd2F0Y2giICYmIGFwaSAmJiBhcGkgIT09IGV2ZW50LnRhcmdldCAmJiAhYXBpLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgIWV2ZW50LmN0cmxLZXkgJiYgIWV2ZW50LnNoaWZ0S2V5ICYmICFldmVudC5hbHRLZXkgJiYgIWV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LnRhcmdldC5pc0NvbnRlbnRFZGl0YWJsZTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBjbGVhciAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LndoaWNoID4gNDcgJiYgZXZlbnQud2hpY2ggPCA1OCB8fAogICAgICAgICAgICAgICAgICAgICAgICBldmVudC53aGljaCA+IDk1ICYmIGV2ZW50LndoaWNoIDwgMTA2IHx8CiAgICAgICAgICAgICAgICAgICAgICAgIFsyNywgMzIsIDM1LCAzNiwgMzcsIDM4LCAzOSwgNDAsIDY2LCA2NywgNzksIDg3LCAxODcsIDE4OV0uaW5kZXhPZihldmVudC53aGljaCkgPiAtMQogICAgICAgICAgICAgICAgICAgICkgJiYKICAgICAgICAgICAgICAgICAgICBbIkVNQkVEIiwgIklOUFVUIiwgIk9CSkVDVCIsICJURVhUQVJFQSIsICJJRlJBTUUiXS5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQudGFnTmFtZSkgPCAwCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICBldmVudENsb25lID0gbmV3IEV2ZW50KCJrZXlkb3duIik7CiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IE9iamVjdC5rZXlzKE9iamVjdC5nZXRQcm90b3R5cGVPZihldmVudCkpOwogICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudENsb25lW2xpc3RbaV1dID0gZXZlbnRbbGlzdFtpXV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgYXBpLmRpc3BhdGNoRXZlbnQoZXZlbnRDbG9uZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcGxheWVyU3RhdGUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmZ1bGxCcnMgfHwgdXNlcl9zZXR0aW5ncy5saWdodHNPdXQpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0WyhldmVudCA8IDUgJiYgZXZlbnQgPiAwICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oKHVzZXJfc2V0dGluZ3MuZnVsbEJycyAmJiAicGFydF9mdWxsYnJvd3NlciIpIHx8ICIwIiwgKHVzZXJfc2V0dGluZ3MubGlnaHRzT3V0ICYmICJwYXJ0X2NpbmVtYV9tb2RlIikgfHwgIjAiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZUN1c3RvbXMoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJ2b2xMZXYiLCBldmVudC52b2x1bWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXQoInRoZWF0ZXJNb2RlIiwgZXZlbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkgewogICAgICAgICAgICAgICAgYXBpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgaWYgKGFwaSAmJiAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImM0LXBsYXllciIpKSB7CiAgICAgICAgICAgICAgICAgICAgYXBpLmFkZEV2ZW50TGlzdGVuZXIoIm9uU3RhdGVDaGFuZ2UiLCBwbGF5ZXJTdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9WT0xfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5hZGRFdmVudExpc3RlbmVyKCJvblZvbHVtZUNoYW5nZSIsIGhhbmRsZUN1c3RvbXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1NJWkVfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5hZGRFdmVudExpc3RlbmVyKCJTSVpFX0NMSUNLRUQiLCBoYW5kbGVDdXN0b21zKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9WT0xfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5zZXRWb2x1bWUodXNlcl9zZXR0aW5ncy52b2xMZXYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5sb29wVmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIikubG9vcCA9IHVzZXJfc2V0dGluZ3MubG9vcFZpZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BTEFDVCkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgYWx3YXlzQWN0aXZlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VGh1bWIoKSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncywgYmFzZSwgdGh1bWJfdXJsOwogICAgICAgICAgICAgICAgYXJncyA9IHdpbmRvdy55dHBsYXllci5jb25maWcuYXJnczsKICAgICAgICAgICAgICAgIGJhc2UgPSAoYXJncy5pdXJsX3dlYnAgJiYgIl93ZWJwIikgfHwgIiI7CiAgICAgICAgICAgICAgICB0aHVtYl91cmwgPSBhcmdzWyJpdXJsbWF4cmVzIiArIGJhc2VdIHx8IGFyZ3NbIml1cmxzZCIgKyBiYXNlXSB8fCBhcmdzWyJpdXJsIiArIGJhc2VdOwogICAgICAgICAgICAgICAgd2luZG93Lm9wZW4odGh1bWJfdXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoaWRlU2NyZWVuc2hvdChldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gImNsb3NlLXNjcmVlbnNob3QiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoaWRlU2NyZWVuc2hvdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2NyZWVuc2hvdCgpIHsKICAgICAgICAgICAgICAgIHZhciB3aWR0aCwgaGVpZ2h0LCBhc3BlY3RSYXRpbywgdmlkZW8sIGNvbnRhaW5lciwgY2FudmFzLCBjbG9zZSwgY29udGV4dDsKICAgICAgICAgICAgICAgIHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKTsKICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzY3JlZW5zaG90LXJlc3VsdCIpIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgY2FudmFzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoImNhbnZhcyIpIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgICAgICAgICAgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgYXNwZWN0UmF0aW8gPSB2aWRlby52aWRlb1dpZHRoIC8gdmlkZW8udmlkZW9IZWlnaHQ7CiAgICAgICAgICAgICAgICB3aWR0aCA9IHZpZGVvLnZpZGVvV2lkdGg7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSBwYXJzZUludCh3aWR0aCAvIGFzcGVjdFJhdGlvLCAxMCk7CiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICBjb250ZXh0LmRyYXdJbWFnZSh2aWRlbywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5lci5pZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pZCA9ICJzY3JlZW5zaG90LXJlc3VsdCI7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNhbnZhcyk7CiAgICAgICAgICAgICAgICAgICAgY2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgICAgICBjbG9zZS5pZCA9ICJjbG9zZS1zY3JlZW5zaG90IjsKICAgICAgICAgICAgICAgICAgICBjbG9zZS50ZXh0Q29udGVudCA9IGxhbmcoIkNOU0xfU1NfQ0xTIik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoaWRlU2NyZWVuc2hvdCk7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNsb3NlKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZXhpdEZ1bGxCcm93c2VyKGtleSkgewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInBhcnRfZnVsbGJyb3dzZXIiKSAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGtleS5rZXlDb2RlID09PSAyNyB8fAogICAgICAgICAgICAgICAgICAgICAgICBrZXkua2V5ID09PSAiRXNjYXBlIiB8fCAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkudGFyZ2V0LmNsYXNzTmFtZSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5LnRhcmdldC5jbGFzc05hbWUuc3BsaXQoInl0cC1zaXplIikubGVuZ3RoID4gMQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRnVsbEJyb3dzZXIoa2V5KTsKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LnR5cGUgPT09ICJtb3VzZWRvd24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBleGl0RnVsbEJyb3dzZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBleGl0RnVsbEJyb3dzZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBrZXkucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRnVsbEJyb3dzZXIoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBwbHJTdGF0ZSA9IGFwaSAmJiBhcGkuZ2V0UGxheWVyU3RhdGUgJiYgYXBpLmdldFBsYXllclN0YXRlKCk7CiAgICAgICAgICAgICAgICBwbHJTdGF0ZSA9IHBsclN0YXRlIDwgNSAmJiBwbHJTdGF0ZSA+IDA7CiAgICAgICAgICAgICAgICBkb2N1bWVudFsod2luZG93LmNocm9tZSAmJiAiYm9keSIpIHx8ICJkb2N1bWVudEVsZW1lbnQiXS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGV4aXRGdWxsQnJvd3Nlcik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBleGl0RnVsbEJyb3dzZXIpOwogICAgICAgICAgICAgICAgc2V0KCJmdWxsQnJzIiwgZXZlbnQgPyAhdXNlcl9zZXR0aW5ncy5mdWxsQnJzIDogdHJ1ZSk7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyLmNsYXNzTGlzdFsodXNlcl9zZXR0aW5ncy5mdWxsQnJzICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIChwbHJTdGF0ZSB8fCBldmVudC5rZXlDb2RlID09PSAyNyB8fCBldmVudC5rZXkgPT09ICJFc2NhcGUiKSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuZnVsbEJycyAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJwYXJ0X2Z1bGxicm93c2VyIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRnJhbWVzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgcGksIGZwcywgdGVtcDsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZyYW1lc3RlcC1idXR0b24iKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBbIkVNQkVEIiwgIklOUFVUIiwgIk9CSkVDVCIsICJURVhUQVJFQSJdLmluZGV4T2YoZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50YWdOYW1lKSA8IDAgJiYgZXZlbnQudGFyZ2V0LnRhZ05hbWUgIT09ICJJRlJBTUUiICYmICFldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJjb250ZW50ZWRpdGFibGUiKSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoZXZlbnQua2V5Q29kZSA9PT0gMzcgfHwgZXZlbnQua2V5Q29kZSA9PT0gMzkpICYmIGV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBpID0gYXBpLmdldFZpZGVvU3RhdHMoKS5mbXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLmFkYXB0aXZlX2ZtdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MuYWRhcHRpdmVfZm10cy5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldLmluZGV4T2YoIml0YWc9IiArIHBpKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZwcyA9IHBhcnNlSW50KHRlbXBbaV0ubWF0Y2goL2Zwcz0oW1xkXSspLylbMV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhZHZhbmNlZE9wdGlvbnMuZnBzIHx8IGFkdmFuY2VkT3B0aW9ucy5mcHMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcHMgPSAzMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmcHMgPSAoKGV2ZW50LmtleUNvZGUgPCAzOSAmJiAtMSkgfHwgMSkgKiAoKGFkdmFuY2VkT3B0aW9ucy5mcHMgPCAyICYmIDMwKSB8fCBhZHZhbmNlZE9wdGlvbnMuZnBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZwcyAmJiBhcGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKS5wYXVzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGkucGF1c2VWaWRlbygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpLnNlZWtCeSgxIC8gZnBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICJjbGljayIgJiYgZXZlbnQudGFyZ2V0LmlkID09PSAiZnJhbWVzdGVwLWJ1dHRvbiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJmcmFtZV9zdGVwIiwgIXVzZXJfc2V0dGluZ3MuZnJhbWVfc3RlcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwLmNsYXNzTGlzdFsodXNlcl9zZXR0aW5ncy5mcmFtZV9zdGVwICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcCAmJiBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcC5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIHRvZ2dsZUZyYW1lcywgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcCB8fCAhYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0b2dnbGVGcmFtZXMsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVNob3J0Y3V0cygpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKCJodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvWW91VHViZS1zaG9ydGN1dHMiLCAiX2JsYW5rIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlQ29uc29sZShldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gImNvbnNvbGUtYnV0dG9uIikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCJwbGF5ZXItY29uc29sZSIpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3RbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygicGxheWVyLWNvbnNvbGUiKSA/ICJhZGQiIDogInJlbW92ZSJdKCJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIHNldCgiYWR2T3B0cyIsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInBsYXllci1jb25zb2xlIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVBsYXkoKSB7CiAgICAgICAgICAgICAgICBzZXQoIlZJRF9QTFJfQVRQTCIsICF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJwYXJ0X2F1dG9wbGF5b24iKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdXRvcGxheS1idXR0b24iKS5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUxvb3AoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB2aWRlb1BsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7CiAgICAgICAgICAgICAgICBpZiAodmlkZW9QbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICB2aWRlb1BsYXllci5sb29wID0gZXZlbnQgPyAhdXNlcl9zZXR0aW5ncy5sb29wVmlkIDogdXNlcl9zZXR0aW5ncy5sb29wVmlkOwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24uY2xhc3NMaXN0WyghdXNlcl9zZXR0aW5ncy5sb29wVmlkICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldCgibG9vcFZpZCIsIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVDaW5lbWFNb2RlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcGxyU3RhdGUgPSBhcGkgJiYgYXBpLmdldFBsYXllclN0YXRlICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSgpIDwgNSAmJiBhcGkuZ2V0UGxheWVyU3RhdGUoKSA+IDA7CiAgICAgICAgICAgICAgICBzZXQoImxpZ2h0c091dCIsIGV2ZW50ID8gIXVzZXJfc2V0dGluZ3MubGlnaHRzT3V0IDogdHJ1ZSk7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY2luZW1hX21vZGUuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLmxpZ2h0c091dCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBwbHJTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MubGlnaHRzT3V0ICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oInBhcnRfY2luZW1hX21vZGUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVUb2dnbGVzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmRhdGFzZXQgJiYgZXZlbnQudGFyZ2V0LmRhdGFzZXQuYWN0aW9uICYmIGFkdmFuY2VkT3B0aW9ucy5hY3Rpb25zW2V2ZW50LnRhcmdldC5kYXRhc2V0LmFjdGlvbl0pIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuYWN0aW9uc1tldmVudC50YXJnZXQuZGF0YXNldC5hY3Rpb25dKGV2ZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBob29rQnV0dG9ucygpIHsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5wb3BQbGF5ZXIgPSBwb3BQbGF5ZXI7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyID0gYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLnF1ZXJ5U2VsZWN0b3IoIiNmdWxsYnJvd3Nlci1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jaW5lbWFfbW9kZSA9IGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5xdWVyeVNlbGVjdG9yKCIjY2luZW1hbW9kZS1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbiA9IGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5xdWVyeVNlbGVjdG9yKCIjbG9vcC1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwID0gYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLnF1ZXJ5U2VsZWN0b3IoIiNmcmFtZXN0ZXAtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuYWN0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICB0b2dnbGVQbGF5OiB0b2dnbGVQbGF5LAogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUxvb3A6IHRvZ2dsZUxvb3AsCiAgICAgICAgICAgICAgICAgICAgZ2V0VGh1bWI6IGdldFRodW1iLAogICAgICAgICAgICAgICAgICAgIGdldFNjcmVlbnNob3Q6IGdldFNjcmVlbnNob3QsCiAgICAgICAgICAgICAgICAgICAgcG9wUGxheWVyOiBwb3BQbGF5ZXIsCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRnVsbEJyb3dzZXI6IHRvZ2dsZUZ1bGxCcm93c2VyLAogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNpbmVtYU1vZGU6IHRvZ2dsZUNpbmVtYU1vZGUsCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRnJhbWVzOiB0b2dnbGVGcmFtZXMsCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlU2hvcnRjdXRzOiB0b2dnbGVTaG9ydGN1dHMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZVRvZ2dsZXMpOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MubG9vcFZpZCAmJiAhYWR2YW5jZWRPcHRpb25zLmxvb3BfYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24uY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlTG9vcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZnVsbEJycyAmJiAhYWR2YW5jZWRPcHRpb25zLmZ1bGxfYnJvd3Nlci5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZ1bGxfYnJvd3Nlci5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB0b2dnbGVGdWxsQnJvd3NlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MubGlnaHRzT3V0ICYmICFhZHZhbmNlZE9wdGlvbnMuY2luZW1hX21vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jaW5lbWFfbW9kZS5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB0b2dnbGVDaW5lbWFNb2RlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5mcmFtZV9zdGVwICYmICFhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcC5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRnJhbWVzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWR2YW5jZWRPcHRpb25zKCkgewogICAgICAgICAgICAgICAgdmFyIGhlYWRlciwgY25zbEJ0biwgY25zbENvbnQ7CiAgICAgICAgICAgICAgICBoZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2F0Y2gtaGVhZGVyIik7CiAgICAgICAgICAgICAgICBjbnNsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbnNvbGUtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyLWNvbnNvbGUiKTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giICYmIGhlYWRlciAmJiAhY25zbEJ0bikgewogICAgICAgICAgICAgICAgICAgIGNuc2xCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGNuc2xCdG4uaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxidXR0b24gaWQ9J2NvbnNvbGUtYnV0dG9uJyBkYXRhLXA9J3R0bHxBRFZfT1BUUyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSdjbG9zZScgdmlld0JveD0nMCAwIDEwIDEwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzEwLDEuNCA4LjYsMCA1LDMuNiAxLjQsMCAwLDEuNCAzLjYsNSAwLDguNiAxLjQsMTAgNSw2LjQgOC42LDEwIDEwLDguNiA2LjQsNScvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSdvcGVuJyB2aWV3Qm94PScwIDAgMTIgMTAnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IHdpZHRoPScxMicgaGVpZ2h0PScyJy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3Qgd2lkdGg9JzEyJyBoZWlnaHQ9JzInIHk9JzQnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCB3aWR0aD0nMTInIGhlaWdodD0nMicgeT0nOCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7CiAgICAgICAgICAgICAgICAgICAgY25zbEJ0biA9IHNldExvY2FsZShjbnNsQnRuLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0b2dnbGVDb25zb2xlKTsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgY25zbENvbnQuaW5uZXJIVE1MID0gIjxkaXYgaWQ9J2FkdmFuY2VkLW9wdGlvbnMnPjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgY25zbENvbnQgPSBjbnNsQ29udC5jb250ZW50LmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgY25zbENvbnQuYXBwZW5kQ2hpbGQoY25zbEJ0bik7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmFwcGVuZENoaWxkKGNuc2xDb250KTsKICAgICAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J3BsYXllci1jb25zb2xlJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2F1dG9wbGF5LWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX0FQJyBkYXRhLWFjdGlvbj0ndG9nZ2xlUGxheSc+PHN2ZyB2aWV3Qm94PScwIDAgMTQgMTYnPjxwb2x5Z29uIHBvaW50cz0nMCwxNiAxNCw4IDAsMCcvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nbG9vcC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9SUFQnIGRhdGEtYWN0aW9uPSd0b2dnbGVMb29wJz48c3ZnIHZpZXdCb3g9JzAgMCAyMC41IDE4Jz48cGF0aCBkPSdNMTEuNSwwQzksMCw2LjgsMSw1LjEsMi42bDEuNCwxLjRDNy44LDIuOCw5LjYsMiwxMS41LDJjMy45LDAsNywzLjEsNyw3YzAsMy45LTMuMSw3LTcsN3MtNy0zLjEtNy03SDdMMy41LDRMMCw5IGgyLjVjMCw1LDQsOSw5LDlzOS00LDktOUMyMC41LDQsMTYuNSwwLDExLjUsMHonLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3NhdmUtdGh1bWJuYWlsLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX1NWVEgnIGRhdGEtYWN0aW9uPSdnZXRUaHVtYic+PHN2ZyB2aWV3Qm94PScwIDAgMjQgMTgnPjxwYXRoIGQ9J00wLDB2MThoMjRWMEgweiBNMjIsMTZIMlYyaDIwVjE2eicvPjxjaXJjbGUgY3g9JzgnIGN5PSc2JyByPSczJy8+PHBvbHlnb24gcG9pbnRzPSczLDEyIDYsMTAgOSwxMiAxMCwxMiAxNiw2IDIxLDExIDIxLDE1IDMsMTUnLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3NjcmVlbnNob3QtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfU1MnIGRhdGEtYWN0aW9uPSdnZXRTY3JlZW5zaG90Jz48c3ZnIHZpZXdCb3g9JzAgMCAyMiAxOCc+PHBhdGggZD0nTTE3LjcsNGwtMi4zLTRoLTlMNC4xLDRIMHYxNGgyMlY0SDE3Ljd6IE0xMSwxNWMtMi44LDAtNS0yLjItNS01czIuMi01LDUtNXM1LDIuMiw1LDVTMTMuOCwxNSwxMSwxNXonLz48Y2lyY2xlIGN4PScxMScgY3k9JzEwJyByPSc0Jy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdwb3BvdXQtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfUFBPVCcgZGF0YS1hY3Rpb249J3BvcFBsYXllcic+PHN2ZyB2aWV3Qm94PScwIDAgMjIgMTYnPjxwYXRoIGQ9J002LDB2MTJoMTZWMEg2eiBNMjAsMTBIOFYyaDEyVjEweicvPjxwb2x5Z29uIHBvaW50cz0nMTQsMTQgMiwxNCAyLDYgNSw2IDUsNCAwLDQgMCwxNiAxNiwxNiAxNiwxMyAxNCwxMycvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nZnVsbGJyb3dzZXItYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfRkxCUicgZGF0YS1hY3Rpb249J3RvZ2dsZUZ1bGxCcm93c2VyJz48c3ZnIHZpZXdCb3g9JzAgMCAyMCAxOCc+PHBhdGggZD0nTTAsMHYxOGgyMFYwSDB6IE0xOCwxNkgyVjRoMTZWMTZ6Jy8+PHBvbHlnb24gcG9pbnRzPSczLDUgMyw5IDUsOSA1LDcgNyw3IDcsNScvPjxwb2x5Z29uIHBvaW50cz0nMTcsNSAxMyw1IDEzLDcgMTUsNyAxNSw5IDE3LDknLz48cG9seWdvbiBwb2ludHM9JzE3LDE1IDE3LDExIDE1LDExIDE1LDEzIDEzLDEzIDEzLDE1Jy8+PHBvbHlnb24gcG9pbnRzPSczLDE1IDcsMTUgNywxMyA1LDEzIDUsMTEgMywxMScvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nY2luZW1hbW9kZS1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9DSU5NX01EJyBkYXRhLWFjdGlvbj0ndG9nZ2xlQ2luZW1hTW9kZSc+PHN2ZyB2aWV3Qm94PScwIDAgMjAgMTgnPjxwYXRoIGQ9J00xOCwwdjJoLTJWMEg0djJIMlYwSDB2MThoMnYtMmgydjJoMTJ2LTJoMnYyaDJWMEgxOHogTTQsMTRIMnYtMmgyVjE0eiBNNCwxMEgyVjhoMlYxMHogTTQsNkgyVjRoMlY2eiBNMTQsMTYgSDZ2LTZoOFYxNnogTTE0LDhINlYyaDhWOHogTTE4LDE0aC0ydi0yaDJWMTR6IE0xOCwxMGgtMlY4aDJWMTB6IE0xOCw2aC0yVjRoMlY2eicvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nZnJhbWVzdGVwLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX0ZSTUUnIGRhdGEtYWN0aW9uPSd0b2dnbGVGcmFtZXMnPjxzdmcgdmlld0JveD0nMCAwIDIwIDIwJz48cGF0aCBkPSdNMjAsOWgtMi4xYy0wLjUtMy42LTMuMy02LjUtNi45LTYuOVYwSDl2Mi4xQzUuNCwyLjUsMi41LDUuNCwyLjEsOUgwdjJoMi4xYzAuNSwzLjYsMy4zLDYuNSw2LjksNi45VjIwaDIgdi0yLjFjMy42LTAuNSw2LjUtMy4zLDYuOS02LjlIMjBWOXogTTExLDE1LjlWMTRIOXYxLjljLTIuNS0wLjQtNC41LTIuNC00LjktNC45SDZWOUg0LjFDNC41LDYuNSw2LjUsNC41LDksNC4xVjZoMlY0LjEgYzIuNSwwLjQsNC41LDIuNCw0LjksNC45SDE0djJoMS45QzE1LjUsMTMuNSwxMy41LDE1LjUsMTEsMTUuOXonLz48Y2lyY2xlIGN4PScxMCcgY3k9JzEwJyByPScxJy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdzaG9ydGN1dHMtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfWVRTQycgZGF0YS1hY3Rpb249J3RvZ2dsZVNob3J0Y3V0cyc+PHN2ZyB2aWV3Qm94PScwIDAgMTggMTgnPjxwb2x5Z29uIHBvaW50cz0nNyw4IDEwLDggMTAsMTMgMTEsMTMgMTEsMTQgNywxNCA3LDEzIDgsMTMgOCw5IDcsOScvPjxyZWN0IHg9JzgnIHk9JzQnIHdpZHRoPScyJyBoZWlnaHQ9JzInLz48cGF0aCBkPSdNOSwwQzQsMCwwLDQsMCw5YzAsNSw0LDksOSw5czktNCw5LTlDMTgsNCwxNCwwLDksMHogTTksMTYuMWMtMy45LDAtNy4xLTMuMi03LjEtNy4xUzUuMSwxLjksOSwxLjkgczcuMSwzLjIsNy4xLDcuMVMxMi45LDE2LjEsOSwxNi4xeicvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuY29udGVudC5xdWVyeVNlbGVjdG9yKCIjYXV0b3BsYXktYnV0dG9uIikuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scyA9IHNldExvY2FsZShhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5hcHBlbmRDaGlsZChhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMpOwogICAgICAgICAgICAgICAgICAgIGhvb2tCdXR0b25zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuYWR2T3B0cykgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgicGxheWVyLWNvbnNvbGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgY25zbEJ0bi5jbGFzc0xpc3QuYWRkKCJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBpbmlBY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBvYnNlcnZlciwgbG9hZF9tb3JlLCBjbGlja190aXRsZTsKICAgICAgICAgICAgICAgIGxvYWRfbW9yZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN3YXRjaC1tb3JlLXJlbGF0ZWQsIC5sb2FkLW1vcmUtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBjbGlja190aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtdGlsZSIpOwogICAgICAgICAgICAgICAgd2hpbGUgKGNsaWNrX3RpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgY2xpY2tfdGl0bGUuY2xhc3NMaXN0LnJlbW92ZSgieXQtdWl4LXRpbGUiKTsKICAgICAgICAgICAgICAgICAgICBjbGlja190aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtdGlsZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxvYWRfbW9yZSAmJiAhbG9hZF9tb3JlLmNsYXNzTGlzdC5jb250YWlucygibW9kVGh1bWJzIikpIHsKICAgICAgICAgICAgICAgICAgICBsb2FkX21vcmUuY2xhc3NMaXN0LmFkZCgibW9kVGh1bWJzIik7CiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtb2RUaHVtYnMpOwogICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUobG9hZF9tb3JlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAvcG9wb3V0bW9kZXxibGFja2xpc3QvLnRlc3QoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50ID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5jbGFzc0xpc3QuY29udGFpbnMoInBvcG91dG1vZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwb3BQbGF5ZXIoZXZlbnQuZGF0YXNldC5saW5rKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmRhdGFzZXQueXRpZCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5ibGFja2xpc3RbZXZlbnQuZGF0YXNldC55dGlkXSA9IGV2ZW50LmRhdGFzZXQudXNlcjsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRCdXR0b25zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGxpc3QsIHRlbXAsIHRodW1iLCBidXR0b247CiAgICAgICAgICAgICAgICBsaXN0ID0gT2JqZWN0LmtleXMobW9kVGh1bWJzLnRodW1icyk7CiAgICAgICAgICAgICAgICBpID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZFRodW1icy50aHVtYnNbbGlzdFtpXV07CiAgICAgICAgICAgICAgICAgICAgaiA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSB0ZW1wW2pdLnF1ZXJ5U2VsZWN0b3IoIi55dC1sb2NrdXAtdGh1bWJuYWlsLCAudGh1bWItd3JhcHBlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGh1bWIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9QUE9UX09OICYmICF0aHVtYi5xdWVyeVNlbGVjdG9yKCIucG9wb3V0bW9kZSIpICYmICEvY2hhbm5lbC8udGVzdCh0ZW1wW2pdLmZpcnN0Q2hpbGQuY2xhc3NOYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGRhdGEtcD0ndHRsfFBQT1RfT1BFTiZ0dHB8UFBPVF9PUEVOJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAgcG9wb3V0bW9kZSc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHZpZXdCb3g9JzAgMCAxMCAxMCcgY2xhc3M9J3RodW1iLXN2Zyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPSc3LDkgMSw5IDEsNCAzLDQgMywyIDAsMiAwLDEwIDgsMTAgOCw3IDcsNycvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9J000LDB2Nmg2VjBINHogTTksNUg1VjJoNFY1eicvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5kYXRhc2V0LmxpbmsgPSB0ZW1wW2pdLnF1ZXJ5U2VsZWN0b3IoImFbaHJlZio9Jy93YXRjaD92J10iKS5ocmVmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iLmFwcGVuZENoaWxkKHNldExvY2FsZShidXR0b24uY29udGVudCkuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5CTEtfT04gJiYgIXRodW1iLnF1ZXJ5U2VsZWN0b3IoIi5ibGFja2xpc3QiKSAmJiB3aW5kb3cueXQuY29uZmlnXy5QQUdFX05BTUUgIT09ICJjaGFubmVsIiAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvZmVlZC9zdWJzY3JpcHRpb25zIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGRhdGEtcD0ndHRsfEJMQ0tfQUREJnR0cHxCTENLX0FERCcgY2xhc3M9J3l0LXVpeC10b29sdGlwIGJsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHZpZXdCb3g9JzAgMCAxMCAxMCcgY2xhc3M9J3RodW1iLXN2Zyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScxMCwxLjQgOC42LDAgNSwzLjYgMS40LDAgMCwxLjQgMy42LDUgMCw4LjYgMS40LDEwIDUsNi40IDguNiwxMCAxMCw4LjYgNi40LDUnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuZGF0YXNldC51c2VyID0gdGVtcFtqXS51c2VybmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmRhdGFzZXQueXRpZCA9IGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIuYXBwZW5kQ2hpbGQoc2V0TG9jYWxlKGJ1dHRvbi5jb250ZW50KS5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWxWaWRlb3MoKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgaiwgdGVtcCwgcGFyZW50LCBibGFja2xpc3QsIGhhc191cG5leHQ7CiAgICAgICAgICAgICAgICBoYXNfdXBuZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmF1dG9wbGF5LWJhciIpOwogICAgICAgICAgICAgICAgYmxhY2tsaXN0ID0gT2JqZWN0LmtleXModXNlcl9zZXR0aW5ncy5ibGFja2xpc3QpOwogICAgICAgICAgICAgICAgaSA9IGJsYWNrbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZFRodW1icy50aHVtYnNbYmxhY2tsaXN0W2ldXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCkgewogICAgICAgICAgICAgICAgICAgICAgICBqID0gdGVtcC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNfdXBuZXh0ICYmIGhhc191cG5leHQuY29udGFpbnModGVtcFtqXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNfdXBuZXh0LnBhcmVudE5vZGUub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzX3VwbmV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi53YXRjaC1zaWRlYmFyLXNlcGFyYXRpb24tbGluZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNfdXBuZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGVtcFtqXS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbal0ub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNoaWxkRWxlbWVudENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZmlyc3RDaGlsZC5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRlbXAubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbW9kVGh1bWJzLnRodW1ic1tibGFja2xpc3RbaV1dOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZlZWQtaXRlbS1jb250YWluZXI6bm90KC5zZWFyY2gtaGlzdG9yeS1pdGVtKSIpOwogICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoInVsIikubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSB0ZW1wW2ldLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbaV0ub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuY2hpbGRFbGVtZW50Q291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmZpcnN0Q2hpbGQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmlkZW9zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGxpc3QsIHRlbXAsIGNoYW5uZWxfaWQ7CiAgICAgICAgICAgICAgICBtb2RUaHVtYnMudGh1bWJzID0ge307CiAgICAgICAgICAgICAgICBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgCiAgICAgICAgICAgICAgICAgICAgLnl0LWxvY2t1cC1ieWxpbmUgPiBhLAogICAgICAgICAgICAgICAgICAgIC55dC1sb2NrdXAtY29udGVudCAuZy1ob3ZlcmNhcmQsCiAgICAgICAgICAgICAgICAgICAgLnZpZGVvLWxpc3QtaXRlbSAuZy1ob3ZlcmNhcmQsCiAgICAgICAgICAgICAgICAgICAgLmNoYW5uZWxzLWNvbnRlbnQtaXRlbSAueXQtbG9ja3VwLXRpdGxlID4gYQogICAgICAgICAgICAgICAgYCk7CiAgICAgICAgICAgICAgICBpID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbF9pZCA9IHRlbXAuZGF0YXNldC55dGlkOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0ZW1wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wLnRhZ05hbWUgJiYgdGVtcC50YWdOYW1lID09PSAiTEkiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLnVzZXJuYW1lID0gbGlzdFtpXS50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW9kVGh1bWJzLnRodW1ic1tjaGFubmVsX2lkXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0gPSBbdGVtcF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0uaW5kZXhPZih0ZW1wKSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RUaHVtYnMudGh1bWJzW2NoYW5uZWxfaWRdLnB1c2godGVtcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RUaHVtYnMoKSB7CiAgICAgICAgICAgICAgICBpZiAoKHVzZXJfc2V0dGluZ3MuQkxLX09OIHx8IHVzZXJfc2V0dGluZ3MuR0VOX1BQT1RfT04pICYmICF3aW5kb3cub3BlbmVyICYmIHdpbmRvdy55dCAmJiB3aW5kb3cueXQuY29uZmlnXyAmJiAvd2F0Y2h8aW5kZXh8ZmVlZHxjaGFubmVsfHJlc3VsdHMvLnRlc3Qod2luZG93Lnl0LmNvbmZpZ18uUEFHRV9OQU1FKSkgewogICAgICAgICAgICAgICAgICAgIGdldFZpZGVvcygpOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkJMS19PTiAmJiB3aW5kb3cueXQuY29uZmlnXy5QQUdFX05BTUUgIT09ICJjaGFubmVsIikgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxWaWRlb3MoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0QnV0dG9ucygpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaW5pQWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpbmlBY3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRWaWRlb0NvdW50KCkgewogICAgICAgICAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgICAgICAgICAgICBzcGFuLnRleHRDb250ZW50ID0gIiDCtyAiOwogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lLmFwcGVuZENoaWxkKHNwYW4pOwogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAiL2NoYW5uZWwvIiArIGVuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZCArICIvdmlkZW9zIjsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VybmFtZS5hcHBlbmRDaGlsZChlbmhhbmNlZERldGFpbHMubGluayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVmlkZW9Db3VudChkZXRhaWxzKSB7CiAgICAgICAgICAgICAgICBkZXRhaWxzID0gZGV0YWlscy50YXJnZXQucmVzcG9uc2UucXVlcnlTZWxlY3RvcigiLnBsLWhlYWRlci1kZXRhaWxzIGxpOm50aC1jaGlsZCgyKSIpOwogICAgICAgICAgICAgICAgaWYgKGRldGFpbHMpIHsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMubGluay5jbGFzc05hbWUgPSAic3BmLWxpbmsiOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy5saW5rLnRleHRDb250ZW50ID0gY2lkW2VuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZF0gPSBkZXRhaWxzLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIHNldFZpZGVvQ291bnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRWaWRlb0NvdW50KCkgewogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0LXVzZXItaW5mbyIpOwogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXBsb2FkZWQtdmlkZW9zIikgJiYgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuaWQgPSAidXBsb2FkZWQtdmlkZW9zIjsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlcm5hbWUuYXBwZW5kQ2hpbGQoZW5oYW5jZWREZXRhaWxzLmxpbmspOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VyID0gZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lLnF1ZXJ5U2VsZWN0b3IoImEiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2lkW2VuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsudGV4dENvbnRlbnQgPSBjaWRbZW5oYW5jZWREZXRhaWxzLnVzZXIuZGF0YXNldC55dGlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VmlkZW9Db3VudCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCB1cGRhdGVWaWRlb0NvdW50LCAiL3BsYXlsaXN0P2xpc3Q9IiArIGVuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZC5yZXBsYWNlKCJVQyIsICJVVSIpLCAiZG9jIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENoYW5uZWxJbmZvKGRldGFpbHMpIHsKICAgICAgICAgICAgICAgIHZhciByZXRyeSwgaXNMaXZlOwogICAgICAgICAgICAgICAgaXNMaXZlID0gZGV0YWlscy50YXJnZXQucmVzcG9uc2UucXVlcnlTZWxlY3RvcigiLnl0LWJhZGdlLWxpdmUiKTsKICAgICAgICAgICAgICAgIGlmICghaXNMaXZlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0cnkgPSBkZXRhaWxzLnRhcmdldC5yZXNwb25zZVVSTC5zcGxpdCgiL3ZpZGVvcyIpLmxlbmd0aCA8IDI7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlscyA9IGRldGFpbHMudGFyZ2V0LnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWNvbnRleHQtaXRlbS1pZD0nIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy52aWRlb19pZCArICInXSAueXQtbG9ja3VwLW1ldGEtaW5mbyBsaSIpOwogICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzICYmIGRldGFpbHMubGVuZ3RoID4gMCAmJiBlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lLnRleHRDb250ZW50LnNwbGl0KCLCtyIpLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS50ZXh0Q29udGVudCArPSAiIMK3ICIgKyBkZXRhaWxzW3JldHJ5ID8gMCA6IDFdLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmV0cnkgJiYgd2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy51Y2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCBnZXRDaGFubmVsSW5mbywgIi9jaGFubmVsLyIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudWNpZCArICIvdmlkZW9zIiwgImRvYyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRQdWJsaXNoZWRUaW1lKCkgewogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi53YXRjaC10aW1lLXRleHQiKTsKICAgICAgICAgICAgICAgIGlmIChlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lICYmICFlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lLmZldGNoaW5nICYmIHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS5mZXRjaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkdFVCIsIGdldENoYW5uZWxJbmZvLCAiL2NoYW5uZWwvIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy51Y2lkICsgIi9zZWFyY2g/cXVlcnk9JTIyIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy52aWRlb19pZCArICIlMjIiLCAiZG9jIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZW5oYW5jZWREZXRhaWxzKCkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfVklEX0NOVCkgewogICAgICAgICAgICAgICAgICAgICAgICBnZXRWaWRlb0NvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QT1NUX1RJTUUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UHVibGlzaGVkVGltZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlQ29udHJvbCgpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB0ZW1wLCBwcmV2LCBuZXh0LCBsaXN0LCB2aWRlb3M7CiAgICAgICAgICAgICAgICBwcmV2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnByZXYtcGxheWxpc3QtbGlzdC1pdGVtIik7CiAgICAgICAgICAgICAgICBuZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm5leHQtcGxheWxpc3QtbGlzdC1pdGVtIik7CiAgICAgICAgICAgICAgICBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXlsaXN0LWF1dG9zY3JvbGwtbGlzdCIpOwogICAgICAgICAgICAgICAgdmlkZW9zID0gbGlzdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGkiKTsKICAgICAgICAgICAgICAgIGkgPSB2aWRlb3MubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQodmlkZW9zW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAgPSBwcmV2LmhyZWY7CiAgICAgICAgICAgICAgICBwcmV2LmhyZWYgPSBuZXh0LmhyZWY7CiAgICAgICAgICAgICAgICBuZXh0LmhyZWYgPSB0ZW1wOwogICAgICAgICAgICAgICAgbGlzdC5zY3JvbGxUb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY3VycmVudGx5LXBsYXlpbmciKS5vZmZzZXRUb3A7CiAgICAgICAgICAgICAgICBpZiAoYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgYXBpLnVwZGF0ZVBsYXlsaXN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUJ1dHRvbihldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gInJldmVyc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldCgicGxSZXYiLCBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKSk7CiAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZUNvbnRyb2woKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBhdXRvcGxheUJ1dHRvbihldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gImF1dG9wbGF5IikgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKTsKICAgICAgICAgICAgICAgICAgICBzZXQoInBsQXBsIiwgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygieXQtdWl4LWJ1dHRvbi10b2dnbGVkIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1dHRvbih0eXBlLCBsYWJlbCwgYm9vbCwgY2FsbCkgewogICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICBidXR0b24uaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICBgPGJ1dHRvbiBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtYnV0dG9uLXBsYXllci1jb250cm9scyB5dC11aXgtYnV0dG9uLW9wYWNpdHkgeXQtdWl4LXRvb2x0aXAnIHR5cGU9J2J1dHRvbic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSdwbC1hdXRvcGxheScgdmlld0JveD0nMCAwIDE0IDE2Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzAsMTYgMTQsOCAwLDAnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ncGwtcmV2ZXJzZScgdmlld0JveD0nMCAwIDE2IDIwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzcsOCAzLDggMywxNCAwLDE0IDUsMjAgMTAsMTQgNywxNCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMTEsMCA2LDYgOSw2IDksMTIgMTMsMTIgMTMsNiAxNiw2Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgaWYgKGJvb2wgPT09IHRydWUgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoYm9vbCkubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoImJ1dHRvbiIpLmNsYXNzTGlzdC5hZGQoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5pZCA9IHR5cGU7CiAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmRhdGFzZXQucCA9ICJ0dHB8IiArIGxhYmVsICsgIiZ0dGx8IiArIGxhYmVsOwogICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5jbGFzc0xpc3QuYWRkKCJ5dC11aXgtYnV0dG9uLWljb24td2F0Y2gtYXBwYmFyLSIgKyB0eXBlICsgIi12aWRlby1saXN0Iik7CiAgICAgICAgICAgICAgICBidXR0b24gPSBzZXRMb2NhbGUoYnV0dG9uLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICBwbGF5bGlzdENvbnRyb2xzLnBsQmFyLmNsYXNzTmFtZSA9IHBsYXlsaXN0Q29udHJvbHMucGxCYXIuY2xhc3NOYW1lLnJlcGxhY2UoInJhZGlvLXBsYXlsaXN0IiwgIiIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjYWxsKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5wbGF5bGlzdC1uYXYtY29udHJvbHMiKS5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYXlsaXN0Q29udHJvbHMoKSB7CiAgICAgICAgICAgICAgICBwbGF5bGlzdENvbnRyb2xzLnBsQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWFwcGJhci1wbGF5bGlzdCIpOwogICAgICAgICAgICAgICAgaWYgKHBsYXlsaXN0Q29udHJvbHMucGxCYXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiAmJiB1c2VyX3NldHRpbmdzLnBsUmV2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVyc2VDb250cm9sKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFNUX1JWUlMgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXZlcnNlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQnV0dG9uKCJyZXZlcnNlIiwgIlBMU1RfUlZSUyIsIHVzZXJfc2V0dGluZ3MucGxSZXYsIHJldmVyc2VCdXR0b24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExTVF9BVFBMICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXV0b3BsYXkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVCdXR0b24oImF1dG9wbGF5IiwgIlBMU1RfQVAiLCB1c2VyX3NldHRpbmdzLnBsQXBsLCBhdXRvcGxheUJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHhoclBhdGNoKCkgewogICAgICAgICAgICAgICAgdmFyIHRlbXAsIHBsYXllcjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0ge2FyZ3M6IEpTT04ucGFyc2UoCiAgICAgICAgICAgICAgICAgICAgICAgICJ7XCIiICsKICAgICAgICAgICAgICAgICAgICAgICAgZGVjb2RlVVJJQ29tcG9uZW50KHRoaXMucmVzcG9uc2VUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTVDL2csICIlNUMlNUMiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyMi9nLCAiJTVDJTIyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICJcIixcIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXD0vZywgIlwiOlwiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cKy9nLCAiJTIwIikKICAgICAgICAgICAgICAgICAgICAgICAgKSArCiAgICAgICAgICAgICAgICAgICAgICAgICJcIn0iCiAgICAgICAgICAgICAgICAgICAgKX07CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZEFyZ3ModGVtcCk7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeSh0ZW1wLmFyZ3MpLnNwbGl0KC9ceyIoW1x3XFddKj8pIn0vKVsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1QyU1Qy9nLCAiJTVDIikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1QyUyMi9nLCAiJTIyIikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyMiUyQyUyMi9nLCAiJiIpCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lMjIlM0ElMjIvZywgIj0iKQogICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTIwL2csICIrIik7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJyZXNwb25zZVRleHQiLCB7d3JpdGFibGU6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlVGV4dCA9IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnNldFBsYXliYWNrUXVhbGl0eSh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja1hIUihvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG1ldGhvZCwgdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVybC5tYXRjaCgiZ2V0X3ZpZGVvX2luZm8iKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoInJlYWR5c3RhdGVjaGFuZ2UiLCB4aHJQYXRjaCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoaWRlVm9sdW1lKCkgewogICAgICAgICAgICAgICAgaWYgKHZvbHVtZVdoZWVsLmNCb3R0b20gJiYgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QuY29udGFpbnMoInl0cC12b2x1bWUtc2xpZGVyLWFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QucmVtb3ZlKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB2b2x1bWVXaGVlbChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGZzUGwsIHBTZXRzLCBpdkNhcmQsIHBsYXllciwgY2FuU2Nyb2xsLCBkaXJlY3Rpb247CiAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgZnNQbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtcGxheWxpc3QtbWVudSIpOwogICAgICAgICAgICAgICAgcFNldHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLXNldHRpbmdzLW1lbnUiKTsKICAgICAgICAgICAgICAgIGl2Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5pdi1kcmF3ZXIiKTsKICAgICAgICAgICAgICAgIGNhblNjcm9sbCA9IGV2ZW50ICYmICghZnNQbCB8fCAoZnNQbCAmJiAhZnNQbC5jb250YWlucyhldmVudC50YXJnZXQpKSkgJiYgKCFpdkNhcmQgfHwgKGl2Q2FyZCAmJiAhaXZDYXJkLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpKSAmJiAoIXBTZXRzIHx8IChwU2V0cyAmJiAhcFNldHMuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGFwaSAmJiBwbGF5ZXIgJiYgY2FuU2Nyb2xsICYmIChldmVudC50YXJnZXQuaWQgPT09IGFwaSB8fCBhcGkuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHZvbHVtZVdoZWVsLmNCb3R0b20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLWNocm9tZS1ib3R0b20iKTsKICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lV2hlZWwuY0JvdHRvbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZvbHVtZVdoZWVsLmNCb3R0b20uY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QuYWRkKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh2b2x1bWVXaGVlbC5jQm90dG9tLnRpbWVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoIm1vdXNlbW92ZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWVXaGVlbC5jQm90dG9tLnRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoaGlkZVZvbHVtZSwgNDAwMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGV2ZW50ICYmIChldmVudC5kZWx0YVkgfHwgZXZlbnQud2hlZWxEZWx0YVkpOwogICAgICAgICAgICAgICAgICAgIGFwaS5zZXRWb2x1bWUocGxheWVyLnZvbHVtZSAqIDEwMCAtIChNYXRoLnNpZ24oZGlyZWN0aW9uKSAqIDUpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50ICYmIHVzZXJfc2V0dGluZ3MuVklEX1ZPTF9XSEVFTCkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgdm9sdW1lV2hlZWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigid2hlZWwiLCB2b2x1bWVXaGVlbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ1BvcE91dChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGV4Y2x1ZGVkLCBpc0ZTY3JlZW47CiAgICAgICAgICAgICAgICBleGNsdWRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtY2hyb21lLWJvdHRvbSIpOwogICAgICAgICAgICAgICAgaXNGU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1mdWxsc2NyZWVuIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgIWlzRlNjcmVlbiAmJiAoIWV4Y2x1ZGVkIHx8IChldmVudC50YXJnZXQgIT09IGV4Y2x1ZGVkICYmICFleGNsdWRlZC5jb250YWlucyhldmVudC50YXJnZXQpKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gIm1vdXNlZG93biIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnUG9wT3V0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRQb3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWDogZXZlbnQuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZOiBldmVudC5jbGllbnRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ1g6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWTogZXZlbnQuY2xpZW50WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnR5cGUgPT09ICJtb3VzZW1vdmUiICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGFzTW92ZWQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhldmVudC5jbGllbnRYIC0gd2luZG93Lm9sZFBvcy5vcmdYKSA+IDEwIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZXZlbnQuY2xpZW50WSAtIHdpbmRvdy5vbGRQb3Mub3JnWSkgPiAxMCkKICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubW92ZUJ5KGV2ZW50LmNsaWVudFggLSB3aW5kb3cub2xkUG9zLlgsIGV2ZW50LmNsaWVudFkgLSB3aW5kb3cub2xkUG9zLlkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lmhhc01vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyAhPT0gMSB8fCBldmVudC50eXBlID09PSAiY2xpY2siKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaGFzTW92ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB3aW5kb3cub2xkUG9zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdpbmRvdy5oYXNNb3ZlZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBkcmFnUG9wT3V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnUG9wT3V0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFldmVudCAmJiB3aW5kb3cubmFtZSA9PT0gInBvcE91dCIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBkcmFnUG9wT3V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXN1bWVQbGF5YmFjaygpIHsKICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgaWYgKHRlbXAgJiYgIWlzTmFOKHRlbXAuZHVyYXRpb24pICYmIHRlbXAuY3VycmVudFRpbWUgPCB0ZW1wLmR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IHRlbXAuY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gInQ9IiArIHRlbXA7CiAgICAgICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcG9wUGxheWVyKHVybCkgewogICAgICAgICAgICAgICAgdmFyIHBvcE91dCwgd2lkdGgsIGhlaWdodCwgcG9wX3VybCwgdmlkZW87CiAgICAgICAgICAgICAgICB3aWR0aCA9IHBhcnNlSW50KHVzZXJfc2V0dGluZ3MuVklEX1BQT1RfU1opIHx8IDUzMzsKICAgICAgICAgICAgICAgIGhlaWdodCA9IE1hdGgucm91bmQod2lkdGggLyAoMTYgLyA5KSk7CiAgICAgICAgICAgICAgICB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7CiAgICAgICAgICAgICAgICBwb3BfdXJsID0gKCF1cmwudGFyZ2V0ICYmIHVybCkgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoLyZ0PVswLTldK3wjdD1bMC05XSt8JnRpbWU9WzAtOV0rLykuam9pbigiIik7CiAgICAgICAgICAgICAgICBpZiAodXJsLnRhcmdldCAmJiB2aWRlbyAmJiB2aWRlby5jdXJyZW50VGltZSAmJiB2aWRlby5jdXJyZW50VGltZSA8IHZpZGVvLmR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcG9wX3VybCArPSAiI3Q9IiArIHZpZGVvLmN1cnJlbnRUaW1lOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy5zdGFydCA9IHZpZGVvLmN1cnJlbnRUaW1lOwogICAgICAgICAgICAgICAgICAgIGFwaS5jdWVWaWRlb0J5UGxheWVyVmFycyh3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9wT3V0ID0gd2luZG93Lm9wZW4ocG9wX3VybCwgInBvcE91dCIsICJ3aWR0aD0iICsgd2lkdGggKyAiLGhlaWdodD0iICsgaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICh1cmwudGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9wT3V0LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIHJlc3VtZVBsYXliYWNrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBvcE91dC5mb2N1cygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFN1YlBsYXlsaXN0KGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgbGlzdCwgYnV0dG9uOwogICAgICAgICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuaWQgPT09ICJzdWJzY3JpcHRpb24tcGxheWxpc3QiKSB7CiAgICAgICAgICAgICAgICAgICAgaSA9IHN1YlBsYXlsaXN0LnZpZGVvX2xpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKHN1YlBsYXlsaXN0LnZpZGVvX2xpc3RbaV0uZGF0YXNldC52aWRlb0lkcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QucmV2ZXJzZSgpLnNwbGljZSgwLCAyMCkuam9pbigiJTJDIik7CiAgICAgICAgICAgICAgICAgICAgc3ViUGxheWxpc3QubGlzdF90aXRsZSA9IHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgJiYgc3ViUGxheWxpc3QubGlzdF90aXRsZS5xdWVyeVNlbGVjdG9yKCIuZXBpYy1uYXYtaXRlbS1oZWFkaW5nIikudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdWJzY3JpcHRpb24tcGxheWxpc3QiKTsKICAgICAgICAgICAgICAgICAgICBidXR0b24uaHJlZiA9ICIvd2F0Y2hfdmlkZW9zP3RpdGxlPSIgKyBzdWJQbGF5bGlzdC5saXN0X3RpdGxlICsgIiZ2aWRlb19pZHM9IiArIGxpc3Q7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc3ViUGxheWxpc3QoKSB7CiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uLCBuYXZfbWVudTsKICAgICAgICAgICAgICAgIG5hdl9tZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmFwcGJhci1uYXYtbWVudSIpOwogICAgICAgICAgICAgICAgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN1YnNjcmlwdGlvbi1wbGF5bGlzdCIpOwogICAgICAgICAgICAgICAgc3ViUGxheWxpc3QubGlzdF90aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hcHBiYXItbmF2LW1lbnUiKTsKICAgICAgICAgICAgICAgIHN1YlBsYXlsaXN0LnZpZGVvX2xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJhZGR0by13YXRjaC1sYXRlci1idXR0b24iKTsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9TVUJfTElTVCAmJiBuYXZfbWVudSAmJiB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgiL2ZlZWQvc3Vic2NyaXB0aW9ucyIpLmxlbmd0aCA+IDEgJiYgIWJ1dHRvbiAmJiBzdWJQbGF5bGlzdC5saXN0X3RpdGxlICYmIHN1YlBsYXlsaXN0LnZpZGVvX2xpc3QpIHsKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGxpIGlkPSdzdWJzY3JpcHRpb24tcGxheWxpc3QtaWNvbic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBpZD0nc3Vic2NyaXB0aW9uLXBsYXlsaXN0JyBkYXRhLXA9J3R0bHxTVUJfUExTVCcgY2xhc3M9J3l0LXVpeC1idXR0b24gc3BmLWxpbmsgeXQtdWl4LXNlc3Npb25saW5rIHl0LXVpeC1idXR0b24tZXBpYy1uYXYtaXRlbSB5dC11aXgtYnV0dG9uLXNpemUtZGVmYXVsdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PScwIDAgMTQgMTYnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzAsMTYgMTQsOCAwLDAgJy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+YDsKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBzZXRMb2NhbGUoYnV0dG9uLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgbmF2X21lbnUuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHNldFN1YlBsYXlsaXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBsb2FkQ29tbWVudHMoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUuaWQgPT09ICJQLXNob3ctY29tbWVudHMiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZENvbW1lbnRzLmNvbW1lbnRzLmxhenlsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYubG9hZC5hcHBseShtYWluLCBtb2RDb21tZW50cy5jb21tZW50cy5sYXp5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLmNvbW1lbnRzLmNsYXNzTGlzdC50b2dnbGUoInNob3ciKTsKICAgICAgICAgICAgICAgICAgICBtb2RDb21tZW50cy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoImJ1dHRvbiIpLnRleHRDb250ZW50ID0gbGFuZygobW9kQ29tbWVudHMuY29tbWVudHMuY2xhc3NMaXN0LmNvbnRhaW5zKCJzaG93IikgJiYgIkhJREVfQ01UUyIpIHx8ICJTSE9XX0NNVFMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXNpemVQbGF5ZXIoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB0ZW1wLCBpc19zbWFsbCwgY29udGVudCwgbWF4X3dpZHRoOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5pbmRleE9mKCIvd2F0Y2giKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyLWFwaSIpOwogICAgICAgICAgICAgICAgaWYgKCF0ZW1wKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgIGlzX3NtYWxsID0gd2luZG93LmlubmVyV2lkdGggPCA2NTcgPyAiIiA6ICIud2F0Y2gtc3RhZ2UtbW9kZSAiOwogICAgICAgICAgICAgICAgaWYgKGlzX3NtYWxsICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUX1dEVEgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVRfV0RUSC5tYXRjaCgvJS8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB3aW5kb3cucGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUExSX0ZJVF9XRFRIKSAvIDEwMCAqIHRlbXA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB3aW5kb3cucGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUExSX0ZJVF9XRFRIKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB0ZW1wID49IG1heF93aWR0aCA/IG1heF93aWR0aCA6IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3dpZHRoID0gdGVtcCA+PSAxMjgwID8gMTI4MCA6IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB0ZW1wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGVudCA9IC8vCiAgICAgICAgICAgICAgICAgICAgYEBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY1NnB4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICNwbGF5ZXItYXBpLAogICAgICAgICAgICAgICAgICAgICAgICAjcGxheWVyLXVuYXZhaWxhYmxlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogNTFweDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDEwcHggIzAwMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAjdGhlYXRlci1iYWNrZ3JvdW5kIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHtpc19zbWFsbH0ucGxheWVyLXdpZHRoIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICR7bWF4X3dpZHRofXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICR7bWF4X3dpZHRoIC8gMiAqIC0xfXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR7aXNfc21hbGx9LnBsYXllci1oZWlnaHQ6bm90KC53YXRjaC1wbGF5bGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICR7bWF4X3dpZHRoIC8gKDE2IC8gOSl9cHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHtpc19zbWFsbH0jd2F0Y2gtYXBwYmFyLXBsYXlsaXN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAke21heF93aWR0aCAvICgxNiAvIDkpIC0gKGlzX3NtYWxsID09PSAiIiA/IDAgOiAzNjApfXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgfWA7CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInl0cC1yZXNpemVyIik7CiAgICAgICAgICAgICAgICBpZiAoIXRlbXApIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlkID0gInl0cC1yZXNpemVyIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRlbXApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGVtcC50ZXh0Q29udGVudCA9IGNvbnRlbnQ7CiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kUGxheWVyU2l6ZSgpIHsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzaXplUGxheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHJlc2l6ZVBsYXllcik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic3BmZG9uZSIsIHJlc2l6ZVBsYXllcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCByZXNpemVQbGF5ZXIpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoInNwZmRvbmUiLCByZXNpemVQbGF5ZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZENvbW1lbnRzKCkgewogICAgICAgICAgICAgICAgdmFyIGlzX2xpdmUgPSB3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLmxpdmVzdHJlYW07CiAgICAgICAgICAgICAgICBtb2RDb21tZW50cy5jb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1kaXNjdXNzaW9uIik7CiAgICAgICAgICAgICAgICBpZiAoIWlzX2xpdmUgJiYgbW9kQ29tbWVudHMuY29tbWVudHMgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLXNob3ctY29tbWVudHMiKSAmJiB1c2VyX3NldHRpbmdzLlZJRF9ISURFX0NPTVMgPT09ICIxIikgewogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1Atc2hvdy1jb21tZW50cycgY2xhc3M9J3l0LWNhcmQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtYnV0dG9uLWV4cGFuZGVyJyBkYXRhLXA9J3RuZHxTSE9XX0NNVFMnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIgPSBzZXRMb2NhbGUobW9kQ29tbWVudHMud3JhcHBlci5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9hZENvbW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICBtb2RDb21tZW50cy5jb21tZW50cy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb2RDb21tZW50cy53cmFwcGVyLCBtb2RDb21tZW50cy5jb21tZW50cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0Q3VzdG9tU3R5bGVzKGNsc3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbdXNlcl9zZXR0aW5nc1tjbHNzXSA/ICJhZGQiIDogInJlbW92ZSJdKGN1c3RvbVN0eWxlcy5jdXN0b21fc3R5bGVzW2Nsc3NdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjdXN0b21TdHlsZXMoKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hpbGQsIHBhcmVudCwgY29tbWVudHMsIHNpZGViYXIsIHl0R3JpZCwgYWR2ZXJ0cywgYWRzX2xpc3Q7CiAgICAgICAgICAgICAgICBjb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1kaXNjdXNzaW9uIik7CiAgICAgICAgICAgICAgICB5dEdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXQtdWl4LW1lbnUtdG9wLWxldmVsLWZsb3ctYnV0dG9uOmxhc3QtY2hpbGQgYSIpOwogICAgICAgICAgICAgICAgY3VzdG9tU3R5bGVzLmN1c3RvbV9zdHlsZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgR0VOX0RTQkxfQURTICAgIDogInBhcnRfbm9fYWRzIiwKICAgICAgICAgICAgICAgICAgICBHRU5fQkxVRV9HTE9XICAgOiAicGFydF9kc2JsX2dsb3ciLAogICAgICAgICAgICAgICAgICAgIEdFTl9ISURFX0ZUUiAgICA6ICJwYXJ0X2hpZGVfZm9vdGVyIiwKICAgICAgICAgICAgICAgICAgICBHRU5fQlRUUl9OVEYgICAgOiAicGFydF9ub3RpZl9idXR0b24iLAogICAgICAgICAgICAgICAgICAgIEdFTl9HUklEX1NVQlMgICA6ICJwYXJ0X2dyaWRfc3VicyIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0dSSURfU1JDSCAgIDogInBhcnRfZ3JpZF9zZWFyY2giLAogICAgICAgICAgICAgICAgICAgIEdFTl9DTVBUX1RUTFMgICA6ICJwYXJ0X2NvbXBhY3RfdGl0bGVzIiwKICAgICAgICAgICAgICAgICAgICBWSURfUExSX0FUUEwgICAgOiAicGFydF9hdXRvcGxheW9uIiwKICAgICAgICAgICAgICAgICAgICBWSURfUExSX0RZTl9TSVpFOiAicGFydF9zdGF0aWNfc2l6ZSIsCiAgICAgICAgICAgICAgICAgICAgVklEX0hJREVfREVUTFMgIDogInBhcnRfaGlkZV9kZXRhaWxzIiwKICAgICAgICAgICAgICAgICAgICBWSURfVFRMX0NNUFQgICAgOiAicGFydF9jb21wYWN0X3RpdGxlIiwKICAgICAgICAgICAgICAgICAgICBWSURfREVTQ19TSFJUICAgOiAicGFydF9sYWJlbGxlc3NfYnV0dG9ucyIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0ICYmIHdpbmRvdy55dC5jb25maWdfICYmIHdpbmRvdy55dC5jb25maWdfLlBBR0VfTkFNRSA9PT0gInNoYXJlZF9jb252ZXJzYXRpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbcmVsPSdzaG9ydGxpbmsnXSIpLmhyZWY7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJwYXJ0X3BvcG91dCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHl0R3JpZCAmJiB1c2VyX3NldHRpbmdzLkdFTl9HUklEX1NVQlMpIHsKICAgICAgICAgICAgICAgICAgICB5dEdyaWQuY2xpY2soKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2lkZWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5icmFuZGVkLXBhZ2UtdjItc2Vjb25kYXJ5LWNvbCIpOwogICAgICAgICAgICAgICAgICAgIGFkc19saXN0ID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYCNtYXN0aGVhZF9jaGlsZCwKICAgICAgICAgICAgICAgICAgICAgICAgI2ZlZWQtcHl2LWNvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgI3dhdGNoNy1zaWRlYmFyLWFkcywKICAgICAgICAgICAgICAgICAgICAgICAgI3dhdGNoNy1zaWRlYmFyLW9mZmVyLAogICAgICAgICAgICAgICAgICAgICAgICAuYWQtZGl2LAogICAgICAgICAgICAgICAgICAgICAgICAucHl2LWFmYy1hZHMtY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAudmlkZW8tbGlzdC1pdGVtOm5vdCgucmVsYXRlZC1saXN0LWl0ZW0pOm5vdCguZGFzaGJvYXJkLXdpZGdldC1pdGVtKWA7CiAgICAgICAgICAgICAgICAgICAgYWR2ZXJ0cyA9IHVzZXJfc2V0dGluZ3MuR0VOX0RTQkxfQURTICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWRzX2xpc3QpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChhZHZlcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gYWR2ZXJ0czsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGNoaWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBjaGlsZC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5jaGlsZEVsZW1lbnRDb3VudCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gcGFyZW50OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmVydHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGFkc19saXN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICBzaWRlYmFyICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHNpZGViYXIucGFyZW50Tm9kZSAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvcmVzdWx0cyIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGViYXIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGViYXIucXVlcnlTZWxlY3RvckFsbCgiKiIpLmxlbmd0aCA8IDEwKSB8fCAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhciAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuR0VOX0hERV9SRUNNX1NEQlIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIi9mZWVkL3N1YnNjcmlwdGlvbnMiKS5sZW5ndGggPiAxIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuR0VOX0hERV9TUkNIX1NEQlIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3Jlc3VsdHMiIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuR0VOX0hERV9DSE5fU0RCUiAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgvXC8oY2hhbm5lbHx1c2VyfGMpXC8vKS5sZW5ndGggPiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhci5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgdXNlcl9zZXR0aW5ncy5WSURfSElERV9DT01TID4gMSAmJiBjb21tZW50cykgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJwYXJ0X2hpZGVfY29tbWVudHMiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyAhPT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJwYXJ0X2hpZGVfY29tbWVudHMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kUGxheWVyU2l6ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhjdXN0b21TdHlsZXMuY3VzdG9tX3N0eWxlcykuZm9yRWFjaChzZXRDdXN0b21TdHlsZXMpOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgiL2ZlZWQvc3Vic2NyaXB0aW9ucyIpLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoInBhcnRfZ3JpZF9zdWJzIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlZmF1bHRDaGFubmVsUGFnZShldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fQ0hOX0RGTFRfUEFHRSAhPT0gImRlZmF1bHQiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnRhZ05hbWUgIT09ICJBIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnROb2RlICYmIHBhcmVudE5vZGUudGFnTmFtZSA9PT0gIkEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmhyZWYgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUuaHJlZi5zcGxpdCh1c2VyX3NldHRpbmdzLkdFTl9DSE5fREZMVF9QQUdFKS5sZW5ndGggPCAyICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZS5ocmVmLnNwbGl0KCIvY2hhbm5lbC8iKS5sZW5ndGggPiAxIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZS5ocmVmLnNwbGl0KCIvdXNlci8iKS5sZW5ndGggPiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmhyZWYuc3BsaXQoL1thLXowLTldXC9bYS16MC05XS9pKS5sZW5ndGggPCA0CiAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZS5ocmVmICs9ICIvIiArIHVzZXJfc2V0dGluZ3MuR0VOX0NITl9ERkxUX1BBR0U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgZGVmYXVsdENoYW5uZWxQYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQXJncyhjb25maWcpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB0ZW1wLCBsaXN0LCBsZW5ndGgsIHZpZGVvcywgbmV3X2xpc3QsIGNhbl9zaGFyZTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubmFtZSA9PT0gInBvcE91dCIpIHsKICAgICAgICAgICAgICAgICAgICBjYW5fc2hhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIucGxheWxpc3QtaGVhZGVyLWNvbnRlbnQiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FuX3NoYXJlICYmIGNhbl9zaGFyZS5kYXRhc2V0LnNoYXJlYWJsZSA9PT0gIkZhbHNlIiAmJiAhY29uZmlnLmFyZ3MudmlkZW8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MudmlkZW8gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgibGlbZGF0YS12aWRlby1pZF0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gdmlkZW9zLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy52aWRlb1tpXSA9IHsiZW5jcnlwdGVkX2lkIjogdmlkZW9zW2ldLmdldEF0dHJpYnV0ZSgiZGF0YS12aWRlby1pZCIpfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGNvbmZpZy5hcmdzLnRpdGxlOwogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmVsID0gImVtYmVkZGVkIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy52cSkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnZxID0gdXNlcl9zZXR0aW5ncy5WSURfREZMVF9RTFRZOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0RGTFRfUUxUWSAhPT0gImF1dG8iKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZVsieXQtcGxheWVyLXF1YWxpdHkiXSA9IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkYXRhIjogdXNlcl9zZXR0aW5ncy5WSURfREZMVF9RTFRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4cGlyYXRpb24iOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDg2NEU1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImNyZWF0aW9uIjogbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoaWdub3JlKSB7fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5hcmdzLmNhcHRpb25fYXVkaW9fdHJhY2tzICYmIHVzZXJfc2V0dGluZ3MuVklEX1BMUl9DQykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmNhcHRpb25fYXVkaW9fdHJhY2tzID0gY29uZmlnLmFyZ3MuY2FwdGlvbl9hdWRpb190cmFja3Muc3BsaXQoLyZkPVswLTldfGQ9WzAtOV0mLykuam9pbigiIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1ZPTF9MRE4pIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLmFyZ3MubG91ZG5lc3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0hUTUw1KSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmh0bWw1ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfSU5GTykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnNob3dpbmZvID0gIjEiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5vcGVuZXIgJiYgd2luZG93LmxvY2F0aW9uLmhhc2ggIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuYXV0b3BsYXkgPSAiMSI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmF1dG9wbGF5ID0gIjAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5hcmdzLmZmbGFncykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmZmbGFncyA9IGNvbmZpZy5hcmdzLmZmbGFncy5yZXBsYWNlKCJsZWdhY3lfYXV0b3BsYXlfZmxhZz10cnVlIiwgImxlZ2FjeV9hdXRvcGxheV9mbGFnPWZhbHNlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1NJWkVfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MucGxheWVyX3dpZGUgPSAodXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSAmJiAiMSIpIHx8ICIwIjsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cHNldHdpZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cHNldHdpZGUoIndpZGUiLCBjb25maWcuYXJncy5wbGF5ZXJfd2lkZSwgLTEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5pdl9sb2FkX3BvbGljeSAmJiB1c2VyX3NldHRpbmdzLlZJRF9QTFJfQU5UUykgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLml2X2xvYWRfcG9saWN5ID0gIjMiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BRFMgJiYgKCF1c2VyX3NldHRpbmdzLlZJRF9TVUJfQURTIHx8ICh1c2VyX3NldHRpbmdzLlZJRF9TVUJfQURTICYmICFjb25maWcuYXJncy5zdWJzY3JpYmVkKSkpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLmFyZ3MuYWQzX21vZHVsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzICYmIHVzZXJfc2V0dGluZ3MuVklEX1BMUl9IRlIpIHsKICAgICAgICAgICAgICAgICAgICBuZXdfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBjb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzLnNwbGl0KCIsIik7CiAgICAgICAgICAgICAgICAgICAgaSA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGxpc3RbaV0uc3BsaXQoL2Zwcz0oWzAtOV17Mn0pLylbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVtcCB8fCB0ZW1wIDwgMzEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19saXN0LnB1c2gobGlzdFtpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuYWRhcHRpdmVfZm10cyA9IG5ld19saXN0LmpvaW4oIiwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kTWF0Y2hNZWRpYShvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgPT09ICJzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDY1NnB4KSIgJiYgdGVtcC5tYXRjaGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGVtcCwgIm1hdGNoZXMiLCB7d3JpdGFibGU6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB0ZW1wLm1hdGNoZXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2VuZXJhbENoYW5nZXMoKSB7CiAgICAgICAgICAgICAgICB2YXIgbG9nbywgY2hlY2tib3gsIGF1dG9wbGF5YmFyLCBkZXNjcmlwdGlvbjsKICAgICAgICAgICAgICAgIGF1dG9wbGF5YmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmF1dG9wbGF5LWJhciIpOwogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWN0aW9uLXBhbmVsLWRldGFpbHMiKTsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9ZVF9MT0dPX0xJTksgJiYgd2luZG93Lnl0ICYmIHdpbmRvdy55dC5jb25maWdfICYmIHdpbmRvdy55dC5jb25maWdfLkxPR0dFRF9JTikgewogICAgICAgICAgICAgICAgICAgIGxvZ28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJtYXBbbmFtZT0nZG9vZGxlJ10gPiBhcmVhLCBhI2xvZ28tY29udGFpbmVyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ28gJiYgbG9nby5ocmVmID09PSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgIi8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ28uaHJlZiA9ICIvZmVlZC9zdWJzY3JpcHRpb25zIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fUkVNX0FQVU4gJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIiAmJiBhdXRvcGxheWJhcikgewogICAgICAgICAgICAgICAgICAgIGNoZWNrYm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoZWNrYm94LW9uLW9mZiIpOwogICAgICAgICAgICAgICAgICAgIGlmIChjaGVja2JveCkgewogICAgICAgICAgICAgICAgICAgICAgICBjaGVja2JveC5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfTEFZVF9BVVRPX1BOTCAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giICYmIGRlc2NyaXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24uY2xhc3NMaXN0LnJlbW92ZSgieXQtdWl4LWV4cGFuZGVyLWNvbGxhcHNlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX1NQRl9PRkYgJiYgd2luZG93LnNwZiAmJiB3aW5kb3cuc3BmLmRpc3Bvc2UpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3BmLmRpc3Bvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBsb2NhbFhIUihtZXRob2QsIGNhbGwsIHVybCwgaGVhZCkgewogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIGNhbGwpOwogICAgICAgICAgICAgICAgcmVxdWVzdC5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChoZWFkICYmIGhlYWQgIT09ICJkb2MiKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRbMF0sIGhlYWRbMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9ICJkb2N1bWVudCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXF1ZXN0LnNlbmQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwbGF5ZXJNb2RlKCkgewogICAgICAgICAgICAgICAgdmFyIHBhZ2VFbGVtZW50LCBwbGF5ZXJFbGVtZW50OwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9TSVpFX01FTSkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhZ2UiKTsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cueXRwc2V0d2lkZSkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXRwc2V0d2lkZSgid2lkZSIsICh1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlID8gIjEiIDogIjAiKSwgLTEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyRWxlbWVudCAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VFbGVtZW50LmNsYXNzTGlzdFt1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlID8gImFkZCIgOiAicmVtb3ZlIl0oIndhdGNoLXdpZGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUVsZW1lbnQuY2xhc3NOYW1lID0gcGFnZUVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UodXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSA/ICJub24tIiA6ICJ3YXRjaC1zdGFnZSIsIHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyAiIiA6ICJ3YXRjaC1ub24tc3RhZ2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyRWxlbWVudC5jbGFzc05hbWUgPSB1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlID8gcGxheWVyRWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgic21hbGwiLCAibGFyZ2UiKSA6IHBsYXllckVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UoImxhcmdlIiwgInNtYWxsIikucmVwbGFjZSgibWVkaXVtIiwgInNtYWxsIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGluZmluaXRlU2Nyb2xsKCkgewogICAgICAgICAgICAgICAgdmFyIG9ic2VydmVyLCBsb2FkTW9yZTsKICAgICAgICAgICAgICAgIGxvYWRNb3JlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmxvYWQtbW9yZS1idXR0b24iKTsKICAgICAgICAgICAgICAgIGlmIChsb2FkTW9yZSAmJiB1c2VyX3NldHRpbmdzLkdFTl9JTkZfU0NSTCkgewogICAgICAgICAgICAgICAgICAgIGlmICghbG9hZE1vcmUuY2xhc3NMaXN0LmNvbnRhaW5zKCJpbmZpbml0ZVNjcm9sbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRNb3JlLmNsYXNzTGlzdC5hZGQoImluZmluaXRlU2Nyb2xsIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoaW5maW5pdGVTY3JvbGwpOwogICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGxvYWRNb3JlLCB7YXR0cmlidXRlczogdHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWxvYWRNb3JlLmNsYXNzTGlzdC5jb250YWlucygic2Nyb2xsZGV0ZWN0IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZE1vcmUuY2xhc3NMaXN0LmFkZCgic2Nyb2xsZGV0ZWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRNb3JlLmRhdGFzZXQuc2Nyb2xsZGV0ZWN0Q2FsbGJhY2sgPSAibG9hZC1tb3JlLWF1dG8iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja05ld0ZlYXR1cmVzKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGtleXM7CiAgICAgICAgICAgICAgICBrZXlzID0gT2JqZWN0LmtleXMoZGVmYXVsdF9zZXR0aW5ncyk7CiAgICAgICAgICAgICAgICBpID0ga2V5cy5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaSkgewogICAgICAgICAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoa2V5c1tpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KGtleXNbaV0sIGRlZmF1bHRfc2V0dGluZ3Nba2V5c1tpXV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzaGFyZUFwaShvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXJSZWFkeSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHJlcXVlc3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB2aWRlb19wbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgaWYgKHZpZGVvX3BsYXllcikgewogICAgICAgICAgICAgICAgICAgIHZpZGVvX3BsYXllci5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCB8fCAhZXZlbnQuZGV0YWlsLnVybC5pbmRleE9mKCIvd2F0Y2giKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5sb2FkZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmxvYWRlZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhcGkuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwYWdlU2NyaXB0TWVzc2FnZXMoKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5LCBnYXRlLCBzZXRzLCBvYnNlcnZlcjsKICAgICAgICAgICAgICAgIGtleSA9ICJwYXJyZWNlaXZlIjsKICAgICAgICAgICAgICAgIGdhdGUgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICBzZXRzID0gSlNPTi5wYXJzZShnYXRlLmRhdGFzZXRba2V5XSB8fCBudWxsKTsKICAgICAgICAgICAgICAgIGlmICghZ2F0ZS5wYWdlc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgICAgZ2F0ZS5wYWdlc2NyaXB0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHBhZ2VTY3JpcHRNZXNzYWdlcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLm9ic2VydmUoZ2F0ZSwgewogICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsiZGF0YS0iICsga2V5XQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNldHMpIHsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzID0gc2V0czsKICAgICAgICAgICAgICAgICAgICBnYXRlLmRhdGFzZXRba2V5XSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tU3R5bGVzKCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS1wYXJyZWNlaXZlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0KHNldHRpbmcsIG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHNldHRpbmcgIT09ICJ1c2VyX3NldHRpbmdzIikgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3Nbc2V0dGluZ10gPSBuZXdfdmFsdWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MgPSBuZXdfdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC5wYXJzZW5kID0gSlNPTi5zdHJpbmdpZnkodXNlcl9zZXR0aW5ncyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbWFpbigpIHsKICAgICAgICAgICAgICAgIGlmIChpc01hdGVyaWFsKCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwYWdlU2NyaXB0TWVzc2FnZXMoKTsKICAgICAgICAgICAgICAgIGN1c3RvbVN0eWxlcygpOwogICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51KCk7CiAgICAgICAgICAgICAgICBpbmZpbml0ZVNjcm9sbCgpOwogICAgICAgICAgICAgICAgcGxheWxpc3RDb250cm9scygpOwogICAgICAgICAgICAgICAgcGxheWVyTW9kZSgpOwogICAgICAgICAgICAgICAgbW9kUGxheWVyU2l6ZSgpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zKCk7CiAgICAgICAgICAgICAgICB2b2x1bWVXaGVlbCgpOwogICAgICAgICAgICAgICAgc3ViUGxheWxpc3QoKTsKICAgICAgICAgICAgICAgIGFsd2F5c1Zpc2libGUoKTsKICAgICAgICAgICAgICAgIG1vZFRodW1icygpOwogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzKCk7CiAgICAgICAgICAgICAgICBtb2RDb21tZW50cygpOwogICAgICAgICAgICAgICAgZGVmYXVsdENoYW5uZWxQYWdlKCk7CiAgICAgICAgICAgICAgICBnZW5lcmFsQ2hhbmdlcygpOwogICAgICAgICAgICAgICAgZHJhZ1BvcE91dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGlzTWF0ZXJpYWwoKSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcDsKICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ5dGQtYXBwIik7CiAgICAgICAgICAgICAgICBpZiAodGVtcCAmJiAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1hdGVyaWFsLW5vdGljZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nbWF0ZXJpYWwtbm90aWNlJyBzdHlsZT0nYm9yZGVyLXJhZGl1czoycHg7Y29sb3I6I0ZGRjtwYWRkaW5nOjEwcHg7YmFja2dyb3VuZC1jb2xvcjojMDlGO2JveC1zaGFkb3c6MCAwIDNweCByZ2JhKDAsMCwwLC41KTtmb250LXNpemU6MTJweDtwb3NpdGlvbjpmaXhlZDtib3R0b206MjBweDtyaWdodDoyMHB4O3otaW5kZXg6OTk5OTknPgogICAgICAgICAgICAgICAgICAgICAgICBZb3VUdWJlIFBsdXMgaXMgbm90IHlldCBjb21wYXRpYmxlIHdpdGggdGhlIFlvdVR1YmUgYmV0YSBNYXRlcmlhbCBMYXlvdXQ8YnI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9SZXN0b3JlLWNsYXNzaWMtWW91VHViZScgdGFyZ2V0PSdfYmxhbmsnIHN0eWxlPSdjb2xvcjojRkZGO2ZvbnQtd2VpZ2h0OmJvbGQ7Jz5DbGljayBoZXJlPC9hPiBmb3IgaW5zdHJ1Y3Rpb25zIHRvIHJlc3RvcmUgY2xhc3NpYyBZb3VUdWJlIGFuZCBjb250aW51ZSB1c2luZyBZVCs8YnI+CiAgICAgICAgICAgICAgICAgICAgICAgIFRvIGtlZXAgdXNpbmcgdGhlIGN1cnJlbnQgbGF5b3V0IHdpdGhvdXQgdGhpcyBtZXNzYWdlIHBsZWFzZSBkaXNhYmxlIFlUKwogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0ZW1wLmNvbnRlbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS11c2VyX3NldHRpbmdzIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VNaWdyYXRpb25JbnN0cnVjdGlvbnMoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LmlkID09PSAiY2xvc2VfbWlncmF0aW9uX2luc3RydWN0aW9ucyIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGNsb3NlTWlncmF0aW9uSW5zdHJ1Y3Rpb25zKTsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICBzZXQoIm1pZ3JhdGlvbl9pbnN0cnVjdGlvbnMiLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtaWdyYXRpb25JbnN0cnVjdGlvbnMoKSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgYDxkaXYgc3R5bGU9J2JvcmRlci1yYWRpdXM6IDJweDsgY29sb3I6ICNGRkY7IGZvbnQ6IDEycHggUm9ib3RvLGFyaWFsLHNhbnMtc2VyaWY7IHBhZGRpbmc6IDEwcHg7IGJhY2tncm91bmQtY29sb3I6IHJnYigwLCAxNTMsIDI1NSk7IGJveC1zaGFkb3c6IDAgMCAzcHggcmdiYSgwLCAwLCAwLCAwLjUpOyBwb3NpdGlvbjogZml4ZWQ7IHotaW5kZXg6IDk5OTk5OyB0b3A6IDUwJTsgbGVmdDogNTAlOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsnPgogICAgICAgICAgICAgICAgICAgIFlvdVR1YmUgUGx1cyBoYXMgYmVlbiB1cGRhdGVkIGFuZCBpcyBub3cgYSBXZWJleHRlbnNpb24uIFVuZm9ydHVuYXRlbHkgdGhpcyBtZWFucyB0aGF0IHlvdXIgcHJldmlvdXMgc2V0dGluZ3MgbmVlZCB0byBiZSBpbXBvcnRlZCBtYW51YWxseS48YnI+CiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL1Jlc3RvcmUtc2V0dGluZ3MnIHRhcmdldD0nX2JsYW5rJyBzdHlsZT0nY29sb3I6I0ZGRjtmb250LXdlaWdodDpib2xkOyc+Q2xpY2sgaGVyZTwvYT4gaWYgeW91IHdpc2ggdG8gaW1wb3J0IHRoZSBwcmV2aW91cyBzZXR0aW5ncyBvciBrbm93IG1vcmUgYWJvdXQgdGhpcyBjaGFuZ2UuPGJyPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9J2Nsb3NlX21pZ3JhdGlvbl9pbnN0cnVjdGlvbnMnIHN0eWxlPSdiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMyk7IGNvbG9yOiAjRkZGOyBjdXJzb3I6IHBvaW50ZXI7IG1hcmdpbi10b3A6IDEwcHg7IGJvcmRlci1yYWRpdXM6IDJweDsgcGFkZGluZzogNHB4OyBmbG9hdDogcmlnaHQ7Jz5DTE9TRTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGVtcC5jb250ZW50LmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjbG9zZU1pZ3JhdGlvbkluc3RydWN0aW9ucyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGFwaSwgY2lkLCBsYW5ndWFnZSwgdXNlcl9zZXR0aW5ncywgcGxheWVyX2luc3RhbmNlLCBkZWZhdWx0X3NldHRpbmdzOwogICAgICAgICAgICBpZiAoaXNNYXRlcmlhbCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2lkID0ge307CiAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MgPSBKU09OLnBhcnNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnVzZXJfc2V0dGluZ3MgfHwgbnVsbCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC51c2VyX3NldHRpbmdzKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLXVzZXJfc2V0dGluZ3MiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0X3NldHRpbmdzID0gewogICAgICAgICAgICAgICAgR0VOX0JUVFJfTlRGICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEdFTl9TVUJfTElTVCAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBHRU5fSU5GX1NDUkwgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgR0VOX0JMVUVfR0xPVyAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEdFTl9QUE9UX09OICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfRU5EX1NIUkUgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWSAgIDogImF1dG8iLAogICAgICAgICAgICAgICAgVklEX1BMU1RfQVRQTCAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFNUX1JWUlMgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUExSX0FUUEwgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTFZJUyAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFJfU0laRV9NRU06IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUExSX1ZPTF9MRE4gOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BPU1RfVElNRSAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9WSURfQ05UICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfREVTQ19TSFJUICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BQT1RfU1ogICAgIDogNTMzLAogICAgICAgICAgICAgICAgVklEX1BMUl9IVE1MNSAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEJMS19PTiAgICAgICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBmbG9hdGVyWCAgICAgICAgOiAyMDAwLAogICAgICAgICAgICAgICAgZmxvYXRlclkgICAgICAgIDogMjAwMCwKICAgICAgICAgICAgICAgIGZpcnN0VGltZSAgICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICB2b2xMZXYgICAgICAgICAgOiA1MCwKICAgICAgICAgICAgICAgIGFkdk9wdHMgICAgICAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBibGFja2xpc3QgICAgICAgOiB7fQogICAgICAgICAgICB9OwogICAgICAgICAgICBsYW5ndWFnZSA9IHsKICAgICAgICAgICAgICAgIFlUU0VUUyAgICAgICAgICAgICAgICA6ICJZb3VUdWJlKyBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBBRFZfT1BUUyAgICAgICAgICAgICAgOiAiQWR2YW5jZWQgb3B0aW9ucyIsCiAgICAgICAgICAgICAgICBTVUJfUExTVCAgICAgICAgICAgICAgOiAiUGxheSByZWNlbnQgdXBsb2FkcyIsCiAgICAgICAgICAgICAgICBQUE9UX09QRU4gICAgICAgICAgICAgOiAiT3BlbiBpbiBwb3Atb3V0IiwKICAgICAgICAgICAgICAgIEJMQ0tfQUREICAgICAgICAgICAgICA6ICJBZGQgdG8gYmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEJMQ0tfRURJVCAgICAgICAgICAgICA6ICJFZGl0IiwKICAgICAgICAgICAgICAgIEJMQ0tfU0FWRSAgICAgICAgICAgICA6ICJTYXZlIiwKICAgICAgICAgICAgICAgIEJMQ0tfQ0xTRSAgICAgICAgICAgICA6ICJDbG9zZSIsCiAgICAgICAgICAgICAgICBDTlNMX0FQICAgICAgICAgICAgICAgOiAiQXV0b3BsYXkiLAogICAgICAgICAgICAgICAgQ05TTF9SUFQgICAgICAgICAgICAgIDogIlJlcGVhdCB2aWRlbyIsCiAgICAgICAgICAgICAgICBDTlNMX1NWVEggICAgICAgICAgICAgOiAiT3BlbiB0aHVtYm5haWwiLAogICAgICAgICAgICAgICAgQ05TTF9TUyAgICAgICAgICAgICAgIDogIlRha2Ugc2NyZWVuc2hvdCIsCiAgICAgICAgICAgICAgICBDTlNMX1NTX0NMUyAgICAgICAgICAgOiAiQ0xPU0UiLAogICAgICAgICAgICAgICAgQ05TTF9QUE9UICAgICAgICAgICAgIDogIlBvcC1vdXQgdmlkZW8iLAogICAgICAgICAgICAgICAgQ05TTF9GTEJSICAgICAgICAgICAgIDogIkZ1bGxicm93c2VyIG1vZGUiLAogICAgICAgICAgICAgICAgQ05TTF9DSU5NX01EICAgICAgICAgIDogIkNpbmVtYSBtb2RlIiwKICAgICAgICAgICAgICAgIENOU0xfRlJNRSAgICAgICAgICAgICA6ICJGcmFtZSBieSBmcmFtZSAoU2hpZnQgKyDihpAgb3Ig4oaSKSIsCiAgICAgICAgICAgICAgICBDTlNMX1lUU0MgICAgICAgICAgICAgOiAiWW91VHViZSBzaG9ydGN1dHMgbGlzdCIsCiAgICAgICAgICAgICAgICBQTFNUX0FQICAgICAgICAgICAgICAgOiAiQXV0b3BsYXkiLAogICAgICAgICAgICAgICAgUExTVF9SVlJTICAgICAgICAgICAgIDogIlJldmVyc2UiLAogICAgICAgICAgICAgICAgU0hPV19DTVRTICAgICAgICAgICAgIDogIlNob3cgY29tbWVudHMiLAogICAgICAgICAgICAgICAgSElERV9DTVRTICAgICAgICAgICAgIDogIkhpZGUgY29tbWVudHMiLAogICAgICAgICAgICAgICAgR0xCX0lNUFIgICAgICAgICAgICAgIDogIkltcG9ydC9leHBvcnQgc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgR0xCX0xPQ0xfTEFORyAgICAgICAgIDogIkNsaWNrIHRvIGVkaXQgWVQrIGxhbmd1YWdlIiwKICAgICAgICAgICAgICAgIEdMQl9MT0NMX0xBTkdfQ1NUTSAgICA6ICJMb2NhbCIsCiAgICAgICAgICAgICAgICBHTEJfSU1QUl9TQVZFICAgICAgICAgOiAiU2F2ZSBhbmQgbG9hZCIsCiAgICAgICAgICAgICAgICBHTEJfUlNFVCAgICAgICAgICAgICAgOiAiUmVzZXQiLAogICAgICAgICAgICAgICAgR0xCX1JTRVRfQ09ORiAgICAgICAgIDogIlRoaXMgd2lsbCByZXNldCBZVCsgc2V0dGluZ3MgYW5kIHRoZSBibGFja2xpc3Qgd2lsbCBiZSBlcmFzZWQuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlPyIsCiAgICAgICAgICAgICAgICBHTEJfU1ZFICAgICAgICAgICAgICAgOiAiU2F2ZSIsCiAgICAgICAgICAgICAgICBHTEJfU1ZFX1NFVFMgICAgICAgICAgOiAiU2V0dGluZ3Mgc2F2ZWQiLAogICAgICAgICAgICAgICAgR0xCX1JNQkwgICAgICAgICAgICAgIDogIlJlbW92ZSBmcm9tIGJsYWNrbGlzdCIsCiAgICAgICAgICAgICAgICBGVFJfREVTQyAgICAgICAgICAgICAgOiAiRmluZCBvdXQgd2hhdCB0aGlzIGRvZXMiLAogICAgICAgICAgICAgICAgR0VOICAgICAgICAgICAgICAgICAgIDogIkdlbmVyYWwiLAogICAgICAgICAgICAgICAgVklEICAgICAgICAgICAgICAgICAgIDogIlZpZGVvIiwKICAgICAgICAgICAgICAgIENITiAgICAgICAgICAgICAgICAgICA6ICJDaGFubmVscyIsCiAgICAgICAgICAgICAgICBCTEsgICAgICAgICAgICAgICAgICAgOiAiQmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEFCVCAgICAgICAgICAgICAgICAgICA6ICJBYm91dCIsCiAgICAgICAgICAgICAgICBITFAgICAgICAgICAgICAgICAgICAgOiAiSGVscCIsCiAgICAgICAgICAgICAgICBETlQgICAgICAgICAgICAgICAgICAgOiAiRG9uYXRlIiwKICAgICAgICAgICAgICAgIEdFTl9UVEwgICAgICAgICAgICAgICA6ICJHZW5lcmFsIHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIEdFTl9HRU4gICAgICAgICAgICAgICA6ICJHZW5lcmFsIiwKICAgICAgICAgICAgICAgIEdFTl9MWVQgICAgICAgICAgICAgICA6ICJMYXlvdXQiLAogICAgICAgICAgICAgICAgR0VOX0xPQ0xfTEFORyAgICAgICAgIDogIlVzZSBtb2RpZmllZCBZVCsgbGFuZ3VhZ2UiLAogICAgICAgICAgICAgICAgR0VOX1BQT1RfT04gICAgICAgICAgIDogIkVuYWJsZSBwb3Atb3V0IG1vZGUiLAogICAgICAgICAgICAgICAgR0VOX0RTQkxfQURTICAgICAgICAgIDogIkRpc2FibGUgYWR2ZXJ0aXNlbWVudHMgb3V0c2lkZSB0aGUgdmlkZW8gcGFnZSIsCiAgICAgICAgICAgICAgICBHRU5fSU5GX1NDUkwgICAgICAgICAgOiAiRW5hYmxlIGluZmluaXRlIHNjcm9sbCBpbiBmZWVkcyIsCiAgICAgICAgICAgICAgICBHRU5fWVRfTE9HT19MSU5LICAgICAgOiAiWW91VHViZSBsb2dvIHJlZGlyZWN0cyB0byBzdWJzY3JpcHRpb25zIiwKICAgICAgICAgICAgICAgIEdFTl9TVUJfTElTVCAgICAgICAgICA6ICJFbmFibGUgc3Vic2NyaXB0aW9uIHBsYXlsaXN0IiwKICAgICAgICAgICAgICAgIEdFTl9SRU1fQVBVTiAgICAgICAgICA6ICJSZW1vdmUgYXV0b3BsYXkgdXAgbmV4dCIsCiAgICAgICAgICAgICAgICBHRU5fU1BGX09GRiAgICAgICAgICAgOiAiRGlzYWJsZSBTUEYiLAogICAgICAgICAgICAgICAgR0VOX0hJREVfRlRSICAgICAgICAgIDogIkhpZGUgZm9vdGVyIiwKICAgICAgICAgICAgICAgIEdFTl9CTFVFX0dMT1cgICAgICAgICA6ICJSZW1vdmUgYmx1ZSBnbG93IGFyb3VuZCBjbGlja2VkIGJ1dHRvbnMiLAogICAgICAgICAgICAgICAgR0VOX0hERV9SRUNNX1NEQlIgICAgIDogIkhpZGUgcmVjb21tZW5kZWQgY2hhbm5lbHMgc2lkZWJhciIsCiAgICAgICAgICAgICAgICBHRU5fSERFX1NSQ0hfU0RCUiAgICAgOiAiSGlkZSBzZWFyY2ggcmVzdWx0cyBzaWRlYmFyIiwKICAgICAgICAgICAgICAgIEdFTl9IREVfQ0hOX1NEQlIgICAgICA6ICJIaWRlIGNoYW5uZWwgc2lkZWJhciIsCiAgICAgICAgICAgICAgICBHRU5fQ01QVF9UVExTICAgICAgICAgOiAiQ29tcGFjdCB0aXRsZXMgaW4gZmVlZHMiLAogICAgICAgICAgICAgICAgR0VOX0RTQl9IVlJDICAgICAgICAgIDogIkRpc2FibGUgaG92ZXJjYXJkcyIsCiAgICAgICAgICAgICAgICBHRU5fQlRUUl9OVEYgICAgICAgICAgOiAiSW1wcm92ZWQgYmx1ZSBub3RpZmljYXRpb24gYm94IiwKICAgICAgICAgICAgICAgIEdFTl9HUklEX1NVQlMgICAgICAgICA6ICJHcmlkIGxheW91dCBpbiBzdWJzY3JpcHRpb25zIiwKICAgICAgICAgICAgICAgIEdFTl9HUklEX1NSQ0ggICAgICAgICA6ICJHcmlkIGxheW91dCBpbiBzZWFyY2ggcmVzdWx0cyIsCiAgICAgICAgICAgICAgICBWSURfVFRMICAgICAgICAgICAgICAgOiAiVmlkZW8gc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgVklEX1BMUiAgICAgICAgICAgICAgIDogIlBsYXllciBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0xZVCAgICAgICAgICAgOiAiUGxheWVyIGxheW91dCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZICAgICAgICAgOiAiRGVmYXVsdCB2aWRlbyBxdWFsaXR5OiIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX0FVVE8gICAgOiAiQXV0byIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX1ROWSAgICAgOiAiMTQ0cCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX1NNTCAgICAgOiAiMjQwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX01ETSAgICAgOiAiMzYwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX0xSRyAgICAgOiAiNDgwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzcyMCAgICAgOiAiNzIwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzEwODAgICAgOiAiMTA4MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV8xNDQwICAgIDogIjE0NDBwIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfMjE2MCAgICA6ICIyMTYwcCAoNGspIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfMjg4MCAgICA6ICIyODgwcCAoNWspIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfT1JJRyAgICA6ICI0MzIwcCAoOGspIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVMgICAgICAgICA6ICJQbGF5ZXIgYWx3YXlzIHZpc2libGUgd2hlbiByZWFkaW5nIGNvbW1lbnRzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVNfV0RUSCAgICA6ICJGbG9hdGluZyBwbGF5ZXIgd2lkdGgiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTFZJU19NT1ZFICAgIDogIk1vdmUgcGxheWVyIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVNfU0NSTF9UT1A6ICJHbyB0byB0b3AiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BVFBMICAgICAgICAgIDogIkF1dG9wbGF5IHZpZGVvcyIsCiAgICAgICAgICAgICAgICBWSURfTEFZVCAgICAgICAgICAgICAgOiAiTGF5b3V0IiwKICAgICAgICAgICAgICAgIFZJRF9WSURfQ05UICAgICAgICAgICA6ICJTaG93IGxpbmsgd2l0aCBudW1iZXIgb2YgdXBsb2FkZWQgdmlkZW9zIiwKICAgICAgICAgICAgICAgIFZJRF9QT1NUX1RJTUUgICAgICAgICA6ICJTaG93IGhvdyBsb25nIHRoZSB2aWRlbyBoYXMgYmVlbiBwdWJsaXNoZWQiLAogICAgICAgICAgICAgICAgVklEX0hJREVfREVUTFMgICAgICAgIDogIkhpZGUgdmlkZW8gZGV0YWlscyIsCiAgICAgICAgICAgICAgICBWSURfSElERV9DT01TICAgICAgICAgOiAiQ29tbWVudCBzZWN0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfU0hPVyAgICA6ICJTaG93IiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfSElERSAgICA6ICJIaWRlIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfUkVNICAgICA6ICJSZW1vdmUiLAogICAgICAgICAgICAgICAgVklEX0VORF9TSFJFICAgICAgICAgIDogIkRpc2FibGUgc2hhcmUgcGFuZWwgd2hlbiB2aWRlbyBlbmRzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUICAgICAgICAgICAgICA6ICJQbGF5bGlzdHMiLAogICAgICAgICAgICAgICAgVklEX1BMU1RfQVRQTCAgICAgICAgIDogIkVuYWJsZSBwbGF5bGlzdCBhdXRvcGxheSBjb250cm9sIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUX1JWUlMgICAgICAgICA6ICJFbmFibGUgcmV2ZXJzZSBwbGF5bGlzdCBjb250cm9sIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfU0laRV9NRU0gICAgICA6ICJNZW1vcml6ZSBwbGF5ZXIgbW9kZSIsCiAgICAgICAgICAgICAgICBWSURfVk9MX1dIRUVMICAgICAgICAgOiAiQ2hhbmdlIHZvbHVtZSB3aXRoIG1vdXNlIHdoZWVsIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfVk9MX01FTSAgICAgICA6ICJNZW1vcml6ZSBhdWRpbyB2b2x1bWUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9WT0xfTEROICAgICAgIDogIkRpc2FibGUgWW91VHViZSBsb3VkbmVzcyBub3JtYWxpc2F0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQURTICAgICAgICAgICA6ICJEaXNhYmxlIGFkdmVydGlzZW1lbnRzIGluIHRoZSB2aWRlbyBwYWdlIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxBQ1QgICAgICAgICA6ICJQbGF5ZXIgc2hvcnRjdXRzIGFsd2F5cyBhY3RpdmUiLAogICAgICAgICAgICAgICAgVklEX1NVQl9BRFMgICAgICAgICAgIDogIkVuYWJsZSBhZHZlcnRpc2VtZW50cyBvbmx5IGluIHZpZGVvcyBmcm9tIHN1YnNjcmliZWQgY2hhbm5lbHMiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTlRTICAgICAgICAgIDogIkRpc2FibGUgYW5ub3RhdGlvbnMiLAogICAgICAgICAgICAgICAgVklEX1BMUl9IRlIgICAgICAgICAgIDogIkRpc2FibGUgSEZSICg2MGZwcykiLAogICAgICAgICAgICAgICAgVklEX1BMUl9IVE1MNSAgICAgICAgIDogIlVzZSB0aGUgSFRNTDUgcGxheWVyIHdoZW4gcG9zc2libGUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9DQyAgICAgICAgICAgIDogIkRpc2FibGUgc3VidGl0bGVzIGFuZCBDQyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0lORk8gICAgICAgICAgOiAiRW5hYmxlIGluZm8gYmFyIHdpdGggd2F0Y2ggbGF0ZXIgYnV0dG9uIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfRklUICAgICAgICAgICA6ICJGaXQgdG8gcGFnZSBpbiB0aGVhdGVyIG1vZGUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9GSVRfV0RUSCAgICAgIDogIkZpdCB0byBwYWdlIG1heCB3aWR0aDoiLAogICAgICAgICAgICAgICAgVklEX1BMUl9EWU5fU0laRSAgICAgIDogIkRpc2FibGUgZHluYW1pYyBwbGF5ZXIgc2l6ZSBpbiBkZWZhdWx0IHZpZXciLAogICAgICAgICAgICAgICAgVklEX0RFU0NfU0hSVCAgICAgICAgIDogIlNob3J0IHZpZGVvIGRlc2NyaXB0aW9uIGJ1dHRvbnMiLAogICAgICAgICAgICAgICAgVklEX1RUTF9DTVBUICAgICAgICAgIDogIkNvbXBhY3QgdGl0bGUgaW4gdmlkZW8gZGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgVklEX1BQT1RfU1ogICAgICAgICAgIDogIlBvcC1vdXQgcGxheWVyIHNpemUiLAogICAgICAgICAgICAgICAgVklEX0xBWVRfQVVUT19QTkwgICAgIDogIkF1dG8gZXhwYW5kIHZpZGVvIGRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFICAgICA6ICJEZWZhdWx0IGNoYW5uZWwgcGFnZToiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfREZMVDogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfVklEIDogIlZpZGVvcyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9QTCAgOiAiUGxheWxpc3RzIiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFX0NITiA6ICJDaGFubmVscyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9ESVNDOiAiRGlzY3Vzc2lvbiIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9BQlQgOiAiQWJvdXQiLAogICAgICAgICAgICAgICAgQkxLX1RUTCAgICAgICAgICAgICAgIDogIkJsYWNrbGlzdCBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBCTEtfQkxLICAgICAgICAgICAgICAgOiAiQmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEJMS19PTiAgICAgICAgICAgICAgICA6ICJFbmFibGUgYmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEFCVF9UVEwgICAgICAgICAgICAgICA6ICJJbmZvcm1hdGlvbiBhbmQgdXNlZnVsIGxpbmtzIiwKICAgICAgICAgICAgICAgIEFCVF9USEtTICAgICAgICAgICAgICA6ICJUaGFua3MgdG86IiwKICAgICAgICAgICAgICAgIEFCVF9USEtTX1lFUFBIQSAgICAgICA6ICIsIHdobydzIHdvcmsgaW5zcGlyZWQgdGhlIGNyZWF0aW9uIG9mIHRoaXMgcHJvamVjdCwgd2l0aG91dCB3aG9tIG5vbmUgb2YgdGhpcyB3b3VsZCBleGlzdCB0b2RheS4iLAogICAgICAgICAgICAgICAgQUJUX1RIS1NfVVNFUlNDUklQVCAgIDogIiBmb3IgbWFraW5nIHRoZSB0YXNrIG9mIGRldmVsb3BpbmcgYW5kIHNoaXBwaW5nIHRoaXJkIHBhcnR5IHNvZnR3YXJlIGluY3JlZGlibHkgZWFzaWVyLiIsCiAgICAgICAgICAgICAgICBBQlRfVEhLU19TVEFDS09WICAgICAgOiAiIGZvciBhbGwgb2YgaXRzIHByaWNlbGVzcyBpbmZvcm1hdGlvbiB3aGljaCBncmVhdGx5IGNvbnRyaWJ1dGVzIGZvciBzb2Z0d2FyZSBkZXZlbG9wbWVudC4iLAogICAgICAgICAgICAgICAgQUJUX0lORk8gICAgICAgICAgICAgIDogIk9mZmljaWFsIHBhZ2VzIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfR0hCICAgICAgICAgICA6ICJHaXRIdWIiLAogICAgICAgICAgICAgICAgQUJUX0xOS19HUkZLICAgICAgICAgIDogIkdyZWFzeSBGb3JrIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfT1BOVSAgICAgICAgICA6ICJPcGVuVXNlckpTIiwKICAgICAgICAgICAgICAgIFdMQ00gICAgICAgICAgICAgICAgICA6ICJUaGFuayB5b3UgZm9yIGluc3RhbGxpbmcgWW91VHViZSsiLAogICAgICAgICAgICAgICAgV0xDTVNUUlQgICAgICAgICAgICAgIDogIllvdSBjYW4gY3VzdG9taXplIHlvdXIgc2V0dGluZ3MgYnkgY2xpY2tpbmcgdGhlIGJ1dHRvbiBhYm92ZSIsCiAgICAgICAgICAgICAgICBXTENNRlRSUyAgICAgICAgICAgICAgOiAiQ2xpY2sgaGVyZSB0byBzZWUgYWxsIHRoZSBmZWF0dXJlcyIsCiAgICAgICAgICAgICAgICBMT0NBTEUgICAgICAgICAgICAgICAgOiAiRW5nbGlzaCAoVVMpIgogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MgfHwgT2JqZWN0LmtleXModXNlcl9zZXR0aW5ncykubGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IGRlZmF1bHRfc2V0dGluZ3M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjaGVja05ld0ZlYXR1cmVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdpbmRvdy5jaHJvbWUpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgc2NyaXB0RXhpdCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJhZnRlcnNjcmlwdGV4ZWN1dGUiLCBzY3JpcHRFeGl0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzX3VzZXJzY3JpcHQgJiYgIXdpbmRvdy5jaHJvbWUgJiYgIXVzZXJfc2V0dGluZ3MubWlncmF0aW9uX2luc3RydWN0aW9ucykgewogICAgICAgICAgICAgICAgbWlncmF0aW9uSW5zdHJ1Y3Rpb25zKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic3BmZG9uZSIsIG1haW4pOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJzcGZyZXF1ZXN0IiwgcmVxdWVzdCk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInJlYWR5c3RhdGVjaGFuZ2UiLCBtYWluLCB0cnVlKTsKICAgICAgICAgICAgWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLm9wZW4gPSBjaGVja1hIUihYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3Blbik7CiAgICAgICAgICAgIHdpbmRvdy5vbllvdVR1YmVQbGF5ZXJSZWFkeSA9IHNoYXJlQXBpKHdpbmRvdy5vbllvdVR1YmVQbGF5ZXJSZWFkeSk7CiAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhID0gbW9kTWF0Y2hNZWRpYSh3aW5kb3cubWF0Y2hNZWRpYSk7CiAgICAgICAgICAgIG1haW4oKTsKICAgICAgICB9LAogICAgICAgIGNvbnRlbnRTY3JpcHRNZXNzYWdlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBrZXkxLCBrZXkyLCBnYXRlLCBzZXRzLCBsb2NzLCBvYnNlcnZlcjsKICAgICAgICAgICAga2V5MSA9ICJwYXJzZW5kIjsKICAgICAgICAgICAga2V5MiA9ICJnZXRsb2NhbGUiOwogICAgICAgICAgICBnYXRlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICBzZXRzID0gSlNPTi5wYXJzZShnYXRlLmRhdGFzZXRba2V5MV0gfHwgbnVsbCk7CiAgICAgICAgICAgIGxvY3MgPSBnYXRlLmRhdGFzZXRba2V5Ml0gfHwgbnVsbDsKICAgICAgICAgICAgaWYgKCFnYXRlLmNvbnRlbnRzY3JpcHQpIHsKICAgICAgICAgICAgICAgIGdhdGUuY29udGVudHNjcmlwdCA9IHRydWU7CiAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHBhcnRpY2xlLmNvbnRlbnRTY3JpcHRNZXNzYWdlcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIub2JzZXJ2ZShnYXRlLCB7CiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsiZGF0YS0iICsga2V5MSwgImRhdGEtIiArIGtleTJdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2V0cykgewogICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5HTV9zZXRWYWx1ZShwYXJ0aWNsZS5pZCwgSlNPTi5zdHJpbmdpZnkoc2V0cykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoe3BhcnRpY2xlU2V0dGluZ3M6IHNldHN9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtcGFyc2VuZCIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxvY3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZSA9IGNocm9tZS5pMThuLmdldE1lc3NhZ2UobG9jcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZpbHRlckNocm9tZUtleXM6IGZ1bmN0aW9uKGtleXMpIHsKICAgICAgICAgICAgaWYgKGtleXNbcGFydGljbGUuaWRdICYmIGtleXNbcGFydGljbGUuaWRdLm5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQucGFycmVjZWl2ZSA9IEpTT04uc3RyaW5naWZ5KAogICAgICAgICAgICAgICAgICAgIChrZXlzW3BhcnRpY2xlLmlkXS5uZXdfdmFsdWUgJiYga2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlW3BhcnRpY2xlLmlkXSkgfHwga2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlIHx8IHt9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtYWluOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICB2YXIgaG9sZGVyOwogICAgICAgICAgICBpZiAoIWV2ZW50ICYmIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgIGV2ZW50ID0gSlNPTi5wYXJzZShwYXJ0aWNsZS5HTV9nZXRWYWx1ZShwYXJ0aWNsZS5pZCwgInt9IikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChldmVudCkgewogICAgICAgICAgICAgICAgZXZlbnQgPSBKU09OLnN0cmluZ2lmeShldmVudFtwYXJ0aWNsZS5pZF0gfHwgZXZlbnQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQudXNlcl9zZXR0aW5ncyA9IGV2ZW50OwogICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaW5rIik7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLnJlbCA9ICJzdHlsZXNoZWV0IjsKICAgICAgICAgICAgICAgICAgICBob2xkZXIudHlwZSA9ICJ0ZXh0L2NzcyI7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLmhyZWYgPSAiaHR0cHM6Ly9wYXJ0aWNsZWNvcmUuZ2l0aHViLmlvL1BhcnRpY2xlL3N0eWxlc2hlZXRzL1lvdVR1YmVQbHVzLmNzcz92PTEuNy41IjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoaG9sZGVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgICAgICAgICAgaG9sZGVyLnRleHRDb250ZW50ID0gIigiICsgcGFydGljbGUuaW5qZWN0ICsgIigiICsgcGFydGljbGUuaXNfdXNlcnNjcmlwdCArICIpKSI7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoaG9sZGVyKTsKICAgICAgICAgICAgICAgIGlmICghcGFydGljbGUuaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLm9uQ2hhbmdlZC5hZGRMaXN0ZW5lcihwYXJ0aWNsZS5maWx0ZXJDaHJvbWVLZXlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaW5pOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcGFydGljbGUuaWQgPSAicGFydGljbGVTZXR0aW5ncyI7CiAgICAgICAgICAgIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQgPSB0eXBlb2YgR01faW5mbyA9PT0gIm9iamVjdCI7CiAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5pc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5HTV9nZXRWYWx1ZSA9IEdNX2dldFZhbHVlOwogICAgICAgICAgICAgICAgcGFydGljbGUuR01fc2V0VmFsdWUgPSBHTV9zZXRWYWx1ZTsKICAgICAgICAgICAgICAgIHBhcnRpY2xlLm1haW4oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldChwYXJ0aWNsZS5pZCwgcGFydGljbGUubWFpbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFydGljbGUuY29udGVudFNjcmlwdE1lc3NhZ2VzKCk7CiAgICAgICAgfQogICAgfTsKICAgIHBhcnRpY2xlLmluaSgpOwp9KCkpOw=="}]}